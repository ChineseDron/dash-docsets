<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Session Handling</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.msession-unlock.html">msession_unlock</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.session.html">Introduction</a></div>
 <div class="up"><a href="refs.basic.session.html">Session Extensions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="book.session" class="book">
 <h1 class="title">Session Handling</h1>
 

 
 
 

 





 

 






 







 







 







 







 







<ul class="chunklist chunklist_book"><li><a href="intro.session.html">Introduction</a></li><li><a href="session.setup.html">Installing/Configuring</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.requirements.html">Requirements</a></li><li><a href="session.installation.html">Installation</a></li><li><a href="session.configuration.html">Runtime Configuration</a></li><li><a href="session.resources.html">Resource Types</a></li></ul></li><li><a href="session.constants.html">Predefined Constants</a></li><li><a href="session.examples.html">Examples</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.examples.basic.html">Basic usage</a></li><li><a href="session.idpassing.html">Passing the Session ID</a></li><li><a href="session.customhandler.html">Custom Session Handlers</a></li></ul></li><li><a href="session.upload-progress.html">Session Upload Progress</a></li><li><a href="session.security.html">Sessions and security</a></li><li><a href="ref.session.html">Session Functions</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.session-cache-expire.html">session_cache_expire</a> â€” Return current cache expire</li><li><a href="function.session-cache-limiter.html">session_cache_limiter</a> â€” Get and/or set the current cache limiter</li><li><a href="function.session-commit.html">session_commit</a> â€” Alias of session_write_close</li><li><a href="function.session-decode.html">session_decode</a> â€” Decodes session data from a string</li><li><a href="function.session-destroy.html">session_destroy</a> â€” Destroys all data registered to a session</li><li><a href="function.session-encode.html">session_encode</a> â€” Encodes the current session data as a string</li><li><a href="function.session-get-cookie-params.html">session_get_cookie_params</a> â€” Get the session cookie parameters</li><li><a href="function.session-id.html">session_id</a> â€” Get and/or set the current session id</li><li><a href="function.session-is-registered.html">session_is_registered</a> â€” Find out whether a global variable is registered in a session</li><li><a href="function.session-module-name.html">session_module_name</a> â€” Get and/or set the current session module</li><li><a href="function.session-name.html">session_name</a> â€” Get and/or set the current session name</li><li><a href="function.session-regenerate-id.html">session_regenerate_id</a> â€” Update the current session id with a newly generated one</li><li><a href="function.session-register-shutdown.html">session_register_shutdown</a> â€” Session shutdown function</li><li><a href="function.session-register.html">session_register</a> â€” Register one or more global variables with the current session</li><li><a href="function.session-save-path.html">session_save_path</a> â€” Get and/or set the current session save path</li><li><a href="function.session-set-cookie-params.html">session_set_cookie_params</a> â€” Set the session cookie parameters</li><li><a href="function.session-set-save-handler.html">session_set_save_handler</a> â€” Sets user-level session storage functions</li><li><a href="function.session-start.html">session_start</a> â€” Initialize session data</li><li><a href="function.session-status.html">session_status</a> â€” Returns the current session status</li><li><a href="function.session-unregister.html">session_unregister</a> â€” Unregister a global variable from the current session</li><li><a href="function.session-unset.html">session_unset</a> â€” Free all session variables</li><li><a href="function.session-write-close.html">session_write_close</a> â€” Write session data and end session</li></ul></li><li><a href="class.sessionhandler.html">SessionHandler</a> â€” The SessionHandler class<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandler.close.html">SessionHandler::close</a> â€” Close the session</li><li><a href="sessionhandler.destroy.html">SessionHandler::destroy</a> â€” Destroy a session</li><li><a href="sessionhandler.gc.html">SessionHandler::gc</a> â€” Cleanup old sessions</li><li><a href="sessionhandler.open.html">SessionHandler::open</a> â€” Initialize session</li><li><a href="sessionhandler.read.html">SessionHandler::read</a> â€” Read session data</li><li><a href="sessionhandler.write.html">SessionHandler::write</a> â€” The write purpose</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103020""></a>
  <div class="note">
   <strong class="user">roberto at spadim dot com dot br</strong>
   <a href="#103020" class="date">20-Mar-2011 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
instead of memcache, you should consider using redis<br />
<a href="http://redis.io/commands" rel="nofollow" target="_blank">http://redis.io/commands</a><br />
<br />
it have KEYS command (<a href="http://redis.io/commands/keys" rel="nofollow" target="_blank">http://redis.io/commands/keys</a>) that can return all keys (like 'ls'/'dir' at php sessions directory)<br />
<br />
it allow replication too (cluster use)<br />
<br />
i don't know if anyone wrote a version of phpsessions using redis yet, but since memcache don't have KEYS command, it's hard to know if the users is connected (at app side) or what sessions still active (not expired/not logged)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102685""></a>
  <div class="note">
   <strong class="user">elephant at punx dot pl</strong>
   <a href="#102685" class="date">28-Feb-2011 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note, that database is NOT recommended for session storage. It can be a big performance bottleneck, especially in replicated environments.<br />
<br />
For saving sessions, file handler seems to be very effective for most setups, except those situations:<br />
&nbsp;- if performance is an issue, the directory which stores session files can be mounted as tmpfs (ram disk).<br />
&nbsp;- if sharing sessions across multiple webservers is needed (in clustered environments), use memcache for storing session information (tip: you can setup more than one instance of memcache eliminate single point of failure). This method, however, sets a limitation of session size to 64k (this should be enough for most applications)<br />
&nbsp;- don't use NFS for sharing session files between webservers, it does not handle locking correctly and can cause corruption of session data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100180""></a>
  <div class="note">
   <strong class="user">php_engineer_bk at yahoo dot com</strong>
   <a href="#100180" class="date">29-Sep-2010 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* PHP session handling with MySQL-DB<br />
&nbsp;*<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">class </span><span class="default">Session<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * a database connection resource<br />
&nbsp;&nbsp; &nbsp; * @var resource<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static </span><span class="default">$_sess_db</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Open the session<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">open</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'root'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">''</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'trading'</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Close the session<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">close</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Read the session<br />
&nbsp;&nbsp; &nbsp; * @param int session id<br />
&nbsp;&nbsp; &nbsp; * @return string string of the sessoin<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"SELECT `session_data` FROM `sessions` " </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"WHERE `session` = '%s'"</span><span class="keyword">, </span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">mysql_num_rows</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$record </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$record</span><span class="keyword">[</span><span class="string">'session_data'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Write the session<br />
&nbsp;&nbsp; &nbsp; * @param int session id<br />
&nbsp;&nbsp; &nbsp; * @param string data of the session<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">write</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"REPLACE INTO `sessions` VALUES('%s', '%s', '%s')"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">()),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Destoroy the session<br />
&nbsp;&nbsp; &nbsp; * @param int session id<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">destroy</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"DELETE FROM `sessions` WHERE `session` = '%s'"</span><span class="keyword">, </span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Garbage Collector<br />
&nbsp;&nbsp; &nbsp; * @param int life time (sec.)<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; * @see session.gc_divisor&nbsp; &nbsp; &nbsp; 100<br />
&nbsp;&nbsp; &nbsp; * @see session.gc_maxlifetime 1440<br />
&nbsp;&nbsp; &nbsp; * @see session.gc_probability&nbsp; &nbsp; 1<br />
&nbsp;&nbsp; &nbsp; * @usage execution rate 1/100<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; (session.gc_probability/session.gc_divisor)<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">gc</span><span class="keyword">(</span><span class="default">$max</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"DELETE FROM `sessions` WHERE `session_expires` &lt; '%s'"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">() - </span><span class="default">$max</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_sess_db</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//ini_set('session.gc_probability', 50);<br />
<br />
</span><span class="default">?&gt;<br />
</span>Iranian php programming (farhad zandmoghadam)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90351""></a>
  <div class="note">
   <strong class="user">e dot mortoray at ecircle dot com</strong>
   <a href="#90351" class="date">17-Apr-2009 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a nuance we found with session timing out although the user is still active in the session.&nbsp; The problem has to do with never modifying the session variable.<br />
<br />
The GC will clear the session data files based on their last modification time.&nbsp; Thus if you never modify the session, you simply read from it, then the GC will eventually clean up.<br />
<br />
To prevent this you need to ensure that your session is modified within the GC delete time.&nbsp; You can accomplish this like below.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if( !isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) || (</span><span class="default">time</span><span class="keyword">() - </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) &gt; </span><span class="default">60 </span><span class="keyword">)<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">] = </span><span class="default">time</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
This will update the session every 60s to ensure that the modification date is altered.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88230""></a>
  <div class="note">
   <strong class="user">Some Guy</strong>
   <a href="#88230" class="date">16-Jan-2009 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just some notes - it seems that php does the session writing after the script exits.<br />
For example, if you set a bunch of session variables and then run session_regenerate_id() - the session variables are never written to the old session. The new session id is generated when you ask it to be generated, but the session exists only in memory until after the script exits - when the session is written and any and all session variables are written to it.<br />
<br />
This caused me some confusion, as I'm running sessions in an sql database rather than flat file, trying to do any manipulation of the session database directly in a script where you have run session_regenerate_id() will fail for the new session ID because the insert hasn't been done yet, and setting any session variables will only be written to the new session, even if set before you regenerate the session ID.<br />
<br />
Also - if using a database for sessions, make sure to use mysql_real_escape_string() before saving any session variables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87477""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#87477" class="date">06-Dec-2008 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Variations from Http://, Https:// and <a href="http://www. will throw off session data." rel="nofollow" target="_blank">http://www. will throw off session data.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85602""></a>
  <div class="note">
   <strong class="user">master dot twinkle at virgin dot net</strong>
   <a href="#85602" class="date">08-Sep-2008 11:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have links from your website to other domains even if they open in new windows, session data will be lost.&nbsp; I am using a session variable to store the number of hits and avoid the problem by opening links in the top location - this will of course give you the bonus of an extra hit when the visitor returns!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85224""></a>
  <div class="note">
   <strong class="user">SebastianJu</strong>
   <a href="#85224" class="date">21-Aug-2008 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Cant believe this problem isnt described herein. I wondered why my session-variables lost their values when going from first site to second site. Both had a session_start();.<br />
<br />
A session is working only on one domain. Subdomains dont use the Session of the maindomain. That means if someone comes to your site at yourdomain.com and the session is started there and then clicks a link where he is lead to www.yourdomain.com then the old session isnt working there anymore. Because www. is a subdomain.<br />
<br />
In the practice that will mean a lot of lost sessions only because webmasters dont know this behaviour. I have never read a word about this in manuals or somewhere...<br />
<br />
The solution is to put this code before the first session_start();<br />
<br />
ini_set("session.cookie_domain",substr($_SERVER[HTTP_HOST],3));<br />
<br />
Now it works. At the second place of parameters has to come in ".yourdomain.com" (with a dot before). With that the subdomains will use the same session like the maindomain. In this example domainname taken from Server-variable.<br />
<br />
Greetings!<br />
Sebastian</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85021""></a>
  <div class="note">
   <strong class="user">zareef at zareef dot net</strong>
   <a href="#85021" class="date">11-Aug-2008 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Persistence of session data in included file also has one more aspects if you are including a file using/over the http connection. <br />
Session will not be available without refresh (it's a separate thread even if you are on the same domain/server), which is again a correct behavior, but if you are including a file from local file system then it should have session data if you are setting and accessing the $_SESSION variable even before page refresh because it is available globally.<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'example'</span><span class="keyword">]=</span><span class="string">"yes"</span><span class="keyword">;<br />
<br />
Include(</span><span class="string">"otherfile"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Session variable will be available in included file.<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'example'</span><span class="keyword">]=</span><span class="string">"yes"</span><span class="keyword">;<br />
<br />
Include(</span><span class="string">"<a href="http://domain.com/otherfile.php" rel="nofollow" target="_blank">http://domain.com/otherfile.php</a>"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Session will NOT be available in other file.<br />
BUt if both files are on same server then after refresh values will be available.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84753""></a>
  <div class="note">
   <strong class="user">Madster</strong>
   <a href="#84753" class="date">28-Jul-2008 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you include a php file in your current script it's included, not processed separately, thus it's still within the same page and the current page hasn't finished processing.<br />
Thus, session is not set yet. This is the expected behaviour.<br />
<br />
If you need to load a page after setting session data, you should set session data and then send a redirection or refresh header (remember not to send anything, not even whitespace before sending headers).<br />
<br />
Always consider session data to be updated after the next page load (as in http request completed).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84287""></a>
  <div class="note">
   <strong class="user">mike at basementideas dot com</strong>
   <a href="#84287" class="date">07-Jul-2008 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The note about an included file not being able to access the sessions is not true.&nbsp; You just have to do a session_start(); in the included file.<br />
<br />
This is what drove me here today, because I was noticing the same thing.&nbsp; But I tried the above on a whim and it works fine.&nbsp; You wouldn't think you'd need to start a session twice, but I guess the scripts are looked on as separate in that regard.<br />
<br />
Mike</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84176""></a>
  <div class="note">
   <strong class="user">pushedx</strong>
   <a href="#84176" class="date">02-Jul-2008 03:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is something to watch out for when working with sessions.<br />
<br />
Let's say you have two pages, Page A and Template Z. If Page A sets session data and includes Template Z, the session data is not properly registered for the execution of Template Z due to how session data is written *after* a script has executed [1].<br />
<br />
As a result, your second page will not have the right session data, so you are a bit in a pickle. I'm sure there are other work arounds, perhaps with cookies or flat files, but you cannot use session data in that fashion.<br />
<br />
The reason I have this setup is because I will have a number of Page A-Z's that will contain page specific content and one Template Z page that renders each page's specific content in the site layout. This way, the site content changing is independent of the style the site uses and the site style can change without modifying the actual content. It's a dynamically configurable site template design.<br />
<br />
[1] See the&nbsp; "session_write_close" documentation page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.msession-unlock.html">msession_unlock</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.session.html">Introduction</a></div>
 <div class="up"><a href="refs.basic.session.html">Session Extensions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
