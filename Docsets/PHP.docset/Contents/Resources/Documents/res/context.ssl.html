<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>SSL context option listing</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="context.ftp.html">FTP context options</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="context.curl.html">CURL context options</a></div>
 <div class="up"><a href="context.html">Context options and parameters</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="context.ssl" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">SSL context options</h1>
  <p class="refpurpose"><span class="refname">SSL context options</span> &mdash; <span class="dc-title">SSL context option listing</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-context.ssl-description">
  <h3 class="title">Description</h3>
  <p class="para">
   Context options for <i>ssl://</i> and <i>tls://</i>
   transports.
  </p>
 </div>


 <div class="refsect1 options" id="refsect1-context.ssl-options">
  <h3 class="title">Options</h3>
  <p class="para">
   <dl>

    <dt id="context.ssl.verify-peer">
     <span class="term">
      <i><tt class="parameter">verify_peer</tt></i>
      <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>
     </span>
     <dd>

      <p class="para">
       Require verification of SSL certificate used.
      </p>
      <p class="para">
       Defaults to <b><tt>FALSE</tt></b>.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.allow-self-signed">
     <span class="term">
      <i><tt class="parameter">allow_self_signed</tt></i>
      <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>
     </span>
     <dd>

      <p class="para">
       Allow self-signed certificates. Requires
       <a href="context.ssl.html#context.ssl.verify-peer" class="link"><i><tt class="parameter">verify_peer</tt></i></a>.
      </p>
      <p class="para">
       Defaults to <b><tt>FALSE</tt></b>
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.cafile">
     <span class="term">
      <i><tt class="parameter">cafile</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       Location of Certificate Authority file on local filesystem
       which should be used with the <i>verify_peer</i>
       context option to authenticate the identity of the remote peer.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.capath">
     <span class="term">
      <i><tt class="parameter">capath</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       If <i>cafile</i> is not specified or if the certificate
       is not found there, the directory pointed to by <i>capath</i> 
       is searched for a suitable certificate.  <i>capath</i>
       must be a correctly hashed certificate directory.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.local-cert">
     <span class="term">
      <i><tt class="parameter">local_cert</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       Path to local certificate file on filesystem.  It must be a PEM
       encoded file which contains your certificate and private key.
       It can optionally contain the certificate chain of issuers.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.passphrase">
     <span class="term">
      <i><tt class="parameter">passphrase</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       Passphrase with which your <i>local_cert</i> file
       was encoded.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.cn-match">
     <span class="term">
      <i><tt class="parameter">CN_match</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       Common Name we are expecting.  PHP will perform limited wildcard
       matching.  If the Common Name does not match this, the connection
       attempt will fail.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.verify-depth">
     <span class="term">
      <i><tt class="parameter">verify_depth</tt></i>
      <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>
     </span>
     <dd>

      <p class="para">
       Abort if the certificate chain is too deep.
      </p>
      <p class="para">
       Defaults to no verification.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.ciphers">
     <span class="term">
      <i><tt class="parameter">ciphers</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       Sets the list of available ciphers. The format of the string is described
       in <a href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT" class="link external" title="Link : http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT">&raquo;&nbsp;ciphers(1)</a>.
      </p>
      <p class="para">
       Defaults to <i>DEFAULT</i>.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.capture-peer-cert">
     <span class="term">
      <i><tt class="parameter">capture_peer_cert</tt></i>
      <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>
     </span>
     <dd>

      <p class="para">
       If set to <b><tt>TRUE</tt></b> a <i>peer_certificate</i> context option
       will be created containing the peer certificate.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.capture-peer-cert-chain">
     <span class="term">
      <i><tt class="parameter">capture_peer_cert_chain</tt></i>
      <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>
     </span>
     <dd>

      <p class="para">
       If set to <b><tt>TRUE</tt></b> a <i>peer_certificate_chain</i> context
       option will be created containing the certificate chain.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.sni-enabled">
     <span class="term">
      <i><tt class="parameter">SNI_enabled</tt></i>
      <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>
     </span>
     <dd>

      <p class="para">
       If set to <b><tt>TRUE</tt></b> server name indication will be enabled. Enabling SNI 
       allows multiple certificates on the same IP address.
      </p>
     </dd>

    </dt>

    <dt id="context.ssl.sni-server-name">
     <span class="term">
      <i><tt class="parameter">SNI_server_name</tt></i>
      <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     </span>
     <dd>

      <p class="para">
       If set, then this value will be used as server name for server name 
       indication. If this value is not set, then the server name is guessed 
       based on the hostname used when opening the stream.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-context.ssl-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.3.2</td>
       <td align="left">
        Added <i><tt class="parameter">SNI_enabled</tt></i> and
        <i><tt class="parameter">SNI_server_name</tt></i>.
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">5.0.0</td>
       <td align="left">
        Added <i><tt class="parameter">capture_peer_cert</tt></i>,
        <i><tt class="parameter">capture_peer_chain</tt></i> and
        <i><tt class="parameter">ciphers</tt></i>.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-context.ssl-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <span class="simpara">
    Because <i>ssl://</i> is the underlying transport for the
    <a href="wrappers.http.html" class="link"><i>https://</i></a> and
    <a href="wrappers.ftp.html" class="link"><i>ftps://</i></a> wrappers, 
    any context options which apply to <i>ssl://</i> also apply to
    <i>https://</i> and <i>ftps://</i>.
   </span>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <span class="simpara">
    For SNI (Server Name Indication) to be available, then PHP must be compiled 
    with OpenSSL 0.9.8j or greater. Use the 
    <b><tt>OPENSSL_TLSEXT_SERVER_NAME</tt></b> to determine whether SNI is 
    supported.
   </span>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-context.ssl-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="context.socket.html" class="xref">Socket context options</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="96328""></a>
  <div class="note">
   <strong class="user">Botjan kufca</strong>
   <a href="#96328" class="date">20-Feb-2010 11:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CN_match works contrary to intuitive thinking. I came across this when I was developing SSL server implemented in PHP. I stated (in code): <br />
<br />
- do not allow self signed certs (works)<br />
- verify peer certs against CA cert (works)<br />
- verify the client's CN against CN_match (does not work), like this:<br />
<br />
stream_context_set_option($context, 'ssl', 'CN_match', '*.example.org');<br />
<br />
I presumed this would match any client with CN below .example.org domain.<br />
Unfortunately this is NOT the case. The option above does not do that.<br />
<br />
What it really does is this:<br />
- it takes client's CN and compares it to CN_match<br />
- IF CLIENT's CN CONTAINS AN ASTERISK like *.example.org, then it is matched against CN_match in wildcard matching fashion<br />
<br />
Examples to illustrate behaviour:<br />
(CNM = server's CN_match)<br />
(CCN = client's CN)<br />
<br />
- CNM=host.example.org, CCN=host.example.org ---&gt; OK<br />
- CNM=host.example.org, CCN=*.example.org ---&gt; OK<br />
- CNM=.example.org, CCN=*.example.org ---&gt; OK<br />
- CNM=example.org, CCN=*.example.org ---&gt; ERROR<br />
<br />
- CNM=*.example.org, CCN=host.example.org ---&gt; ERROR<br />
- CNM=*.example.org, CCN=*.example.org ---&gt; OK<br />
<br />
According to PHP sources I believe that the same applies if you are trying to act as Client and the server contains a wildcard certificate. If you set CN_match to myserver.example.org and server presents itself with *.example.org, the connection is allowed.<br />
<br />
Everything above applies to PHP version 5.2.12.<br />
I will supply a patch to support CN_match starting with asterisk.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="context.ftp.html">FTP context options</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="context.curl.html">CURL context options</a></div>
 <div class="up"><a href="context.html">Context options and parameters</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
