<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Evaluate a string as PHP code</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.die.html">die</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.exit.html">exit</a></div>
 <div class="up"><a href="ref.misc.html">Misc. Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.eval" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">eval</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">eval</span> &mdash; <span class="dc-title">Evaluate a string as PHP code</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.eval-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><b>eval</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$code</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Evaluates the given <i><tt class="parameter">code</tt></i> as PHP.
  </p>
  <div class="caution"><b class="caution">Caution</b>
   <p class="para">
    The <span class="function"><b>eval()</b></span> language construct is <em class="emphasis">very dangerous</em>
    because it allows execution of arbitrary PHP code. <em class="emphasis">Its use thus is
    discouraged.</em> If you have carefully verified that there is no other option
    than to use this construct, pay special attention <em class="emphasis">not to pass any user
    provided data</em> into it without properly validating it beforehand.
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.eval-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">code</tt></i></span>
     <dd>

      <p class="para">
       Valid PHP code to be evaluated.
      </p>
      <p class="para">
       The code mustn&#039;t be wrapped in opening and closing
       <a href="language.basic-syntax.phpmode.html" class="link">PHP tags</a>, i.e.
       <i>&#039;echo &quot;Hi!&quot;;&#039;</i> must be passed instead of
       <i>&#039;&lt;? echo &quot;Hi!&quot;; &gt;&#039;</i>. It is still possible to leave and
       reenter PHP mode though using the appropriate PHP tags, e.g.
       <i>&#039;echo &quot;In PHP mode!&quot;; ?&gt;In HTML mode!&lt;? echo &quot;Back in PHP mode!&quot;;&#039;</i>.
      </p>
      <p class="para">
       Apart from that the passed code must be valid PHP. This includes that all statements
       must be properly terminated using a semicolon.
       <i>&#039;echo &quot;Hi!&quot;&#039;</i> for example will cause a parse error, whereas
       <i>&#039;echo &quot;Hi!&quot;;&#039;</i> will work.
      </p>
      <p class="para">
       A <i>return</i> statement will immediately terminate the
       evaluation of the code. 
      </p>
      <p class="para">
       The code will be executed in the scope of the code calling <span class="function"><b>eval()</b></span>. Thus any
       variables defined or changed in the <span class="function"><b>eval()</b></span> call will remain visible after
       it terminates.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.eval-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><b>eval()</b></span> returns <b><tt>NULL</tt></b> unless 
   <i>return</i> is called in the evaluated code, in which case
   the value passed to <i>return</i> is returned. If there is a
   parse error in the evaluated code, <span class="function"><b>eval()</b></span> returns
   <b><tt>FALSE</tt></b> and execution of the following code continues normally. It is
   not possible to catch a parse error in <span class="function"><b>eval()</b></span>
   using <span class="function"><a href="function.set-error-handler.html" class="function">set_error_handler()</a></span>.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.eval-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-3421">
    <p><b>Example #1 <span class="function"><b>eval()</b></span> example - simple text merge</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'cup'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'coffee'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;a&nbsp;$string&nbsp;with&nbsp;my&nbsp;$name&nbsp;in&nbsp;it.'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />eval(</span><span style="color: #DD0000">"\$str&nbsp;=&nbsp;\"</span><span style="color: #0000BB">$str</span><span style="color: #DD0000">\";"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
This is a $string with my $name in it.
This is a cup with my coffee in it.
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.eval-notes">
  <h3 class="title">Notes</h3>

  <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">Because this is a
language construct and not a function, it cannot be called using
<a href="functions.variable-functions.html" class="link">variable functions</a></span>
</p></blockquote>

  <div class="tip"><b class="tip">Tip</b><p class="simpara">As with anything that outputs
its result directly to the browser, the <a href="book.outcontrol.html" class="link">output-control functions</a> can be used to capture
the output of this function, and save it in a
<span class="type"><a href="language.types.string.html" class="type string">string</a></span> (for example).</p></div>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    In case of a fatal error in the evaluated code, the whole script exits.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.eval-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.call-user-func.html" class="function" rel="rdfs-seeAlso">call_user_func()</a> - Call the callback given by the first parameter</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106481""></a>
  <div class="note">
   <strong class="user">socram8888 at gmail dot com</strong>
   <a href="#106481" class="date">12-Nov-2011 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It may be a bit obvious, but if you don't want eval'd code to interfere with main code variables, all you have to do is to call an eval from another function like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">localeval</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return eval(</span><span class="default">$code</span><span class="keyword">);<br />
};<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="string">"a"</span><span class="keyword">;<br />
echo </span><span class="string">'$a before eval code: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// prints "a"<br />
</span><span class="default">localeval</span><span class="keyword">(</span><span class="string">'$a = \'b\';'</span><span class="keyword">);<br />
echo </span><span class="string">'$a after localeval: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// still prints "a"<br />
</span><span class="keyword">eval(</span><span class="string">'$a = \'b\';'</span><span class="keyword">);<br />
echo </span><span class="string">'$a after eval: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// prints "b"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106235""></a>
  <div class="note">
   <strong class="user">kevin at NOSPAM dot schinkenbraten dot de</strong>
   <a href="#106235" class="date">20-Oct-2011 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey guys.<br />
With the eval()-function it is possible to create functions with specific names. <br />
<br />
Imagine if you have an Array and want to create some function of these names.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Setting up the names for the functions.<br />
</span><span class="default">$names </span><span class="keyword">= Array ( </span><span class="string">"foo"</span><span class="keyword">, </span><span class="string">"bar"</span><span class="keyword">, </span><span class="string">"test"</span><span class="keyword">, </span><span class="string">"foobar"</span><span class="keyword">);<br />
</span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">"func_"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Running a loop for the names and setting up the functions.<br />
</span><span class="keyword">foreach (</span><span class="default">$names </span><span class="keyword">as </span><span class="default">$j</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function </span><span class="keyword">= </span><span class="default">$prefix</span><span class="keyword">.</span><span class="default">$j</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="string">"function "</span><span class="keyword">.</span><span class="default">$function</span><span class="keyword">.</span><span class="string">" () {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo '"</span><span class="keyword">.</span><span class="default">$j</span><span class="keyword">.</span><span class="string">"&lt;br /&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$code</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// Now we can run the functions easily now.<br />
</span><span class="default">func_foo</span><span class="keyword">();<br />
</span><span class="default">func_bar</span><span class="keyword">();<br />
</span><span class="default">func_test</span><span class="keyword">();<br />
</span><span class="default">func_foobar</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output will be:<br />
foo<br />
bar<br />
test<br />
foobar<br />
<br />
--------<br />
The point is that you don't have to run the function from a variable [create_function()].<br />
I hope this is helpful for someone. ;) Kevin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103360""></a>
  <div class="note">
   <strong class="user">sfinktah at php dot spamtrak dot org</strong>
   <a href="#103360" class="date">09-Apr-2011 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you really want a bullet-proof eval, you can use a socket_pair and fork().&nbsp; (Not tested under windows).<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">lookupErrorCode</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">) { static </span><span class="default">$lookup </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$lookup </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">) foreach (array(</span><span class="string">"E_ERROR"</span><span class="keyword">, </span><span class="string">"E_WARNING"</span><span class="keyword">, </span><span class="string">"E_PARSE"</span><span class="keyword">, </span><span class="string">"E_NOTICE"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"E_CORE_ERROR"</span><span class="keyword">, </span><span class="string">"E_CORE_WARNING"</span><span class="keyword">, </span><span class="string">"E_COMPILE_ERROR"</span><span class="keyword">, </span><span class="string">"E_COMPILE_WARNING"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"E_USER_ERROR"</span><span class="keyword">, </span><span class="string">"E_USER_WARNING"</span><span class="keyword">, </span><span class="string">"E_USER_NOTICE"</span><span class="keyword">, </span><span class="string">"E_STRICT"</span><span class="keyword">, </span><span class="string">"E_RECOVERABLE_"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"ERROR"</span><span class="keyword">, </span><span class="string">"E_DEPRECATED"</span><span class="keyword">, </span><span class="string">"E_USER_DEPRECATED"</span><span class="keyword">) as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$lookup</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">&lt;&lt;</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (!empty(</span><span class="default">$lookup</span><span class="keyword">[</span><span class="default">$errno</span><span class="keyword">]) ? </span><span class="default">$lookup</span><span class="keyword">[</span><span class="default">$errno</span><span class="keyword">] : </span><span class="string">"UNKNOWN"</span><span class="keyword">); }<br />
<br />
function </span><span class="default">child_exit_handler</span><span class="keyword">(</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$paired_socket </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$socket </span><span class="keyword">|| </span><span class="default">$socket </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return </span><span class="default">$paired_socket </span><span class="keyword">= </span><span class="default">$socket</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$paired_socket</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">"ERROR_" </span><span class="keyword">. </span><span class="default">lookupErrorCode</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">]) . </span><span class="string">":&nbsp; </span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">[</span><span class="string">"message"</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$paired_socket</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"socket_write() failed. Reason: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="default">2</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># Child Process Dies, writing an error to it's paired socket.<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">forked_eval</span><span class="keyword">(</span><span class="default">$eval</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sockets </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* On Windows we need to use AF_INET */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain </span><span class="keyword">= (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">PHP_OS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) == </span><span class="string">'WIN' </span><span class="keyword">? </span><span class="default">AF_INET </span><span class="keyword">: </span><span class="default">AF_UNIX</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Setup socket pair */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">socket_create_pair</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$sockets</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"socket_create_pair failed. Reason: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$child </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case -</span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Could not fork"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Child Thread<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">"child_exit_handler"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">child_exit_handler</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment"># Register the socket<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(eval(</span><span class="default">$eval</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">child_exit_handler</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># We didn't crash<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$result</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"socket_write() failed. Reason: "</span><span class="keyword">. </span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Parent Thread<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ((</span><span class="default">$nread </span><span class="keyword">= </span><span class="default">socket_recv</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$data</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">&lt;&lt;</span><span class="default">16</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) &lt; </span><span class="default">1</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"socket_read() failed. Reason: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">strncmp</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"ERROR_"</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">); </span><span class="comment"># throw new Exception(substr($data, 6));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">safe_eval</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$str </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$file </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$line </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$err_strings </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$cmd </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) return </span><span class="default">count</span><span class="keyword">(</span><span class="default">$err_strings</span><span class="keyword">) ? </span><span class="default">$err_strings </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$str </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$err_strings</span><span class="keyword">[] = </span><span class="default">lookupErrorCode</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">) . </span><span class="string">":&nbsp; </span><span class="default">$str</span><span class="string"> in </span><span class="default">$file</span><span class="string"> on line </span><span class="default">$line</span><span class="string">"</span><span class="keyword">) &amp;&amp; </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$err_strings </span><span class="keyword">= array(); </span><span class="default">$old_error_handler </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="default">__FUNCTION__</span><span class="keyword">, </span><span class="default">E_ALL</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rv </span><span class="keyword">= @eval(</span><span class="string">"return true; </span><span class="default">$cmd</span><span class="string">"</span><span class="keyword">) ? </span><span class="default">forked_eval</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : (</span><span class="default">$or </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">()) &amp;&amp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">__FUNCTION__</span><span class="keyword">, </span><span class="default">$or</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">restore_error_handler</span><span class="keyword">(); return </span><span class="default">$rv</span><span class="keyword">;<br />
}<br />
<br />
foreach (array( </span><span class="string">"return sleep(2) &amp;&amp; foobar();"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">, </span><span class="string">"return date('Y-m-d');" </span><span class="keyword">, </span><span class="string">"return touch('/error/error/error') ? 'OK' : 'Failed';"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">, </span><span class="string">"return ==" </span><span class="keyword">, </span><span class="string">"return 2 + array();" </span><span class="keyword">, </span><span class="string">"return foobar();" </span><span class="keyword">, </span><span class="string">"return 2;"</span><span class="keyword">) as </span><span class="default">$cmd</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"\nAttempting to evaluate: </span><span class="default">$cmd</span><span class="string">\n"</span><span class="keyword">); </span><span class="default">$rv </span><span class="keyword">= </span><span class="default">safe_eval</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%s\n"</span><span class="keyword">, (</span><span class="default">$e </span><span class="keyword">= </span><span class="default">safe_eval</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">)) ? </span><span class="string">"ERROR: </span><span class="default">$e</span><span class="string">" </span><span class="keyword">: </span><span class="string">"Result: </span><span class="default">$rv</span><span class="string">"</span><span class="keyword">); }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102698""></a>
  <div class="note">
   <strong class="user">Mark Simon</strong>
   <a href="#102698" class="date">01-Mar-2011 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have looked for a simple way of forcing PHP to interpolate strings after the event (that is, after they have already been assigned, say from a text file).<br />
<br />
The following seems to work:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $text</span><span class="keyword">=</span><span class="string">'$a + $b = $c'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">$a</span><span class="keyword">+</span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print eval(</span><span class="string">"return&lt;&lt;&lt;END\n</span><span class="default">$text</span><span class="string">\nEND;\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
I have even tried it with some potentially evil code, but the context seems to preclude interpreting it as anything other than a string.<br />
<br />
Mark</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102665""></a>
  <div class="note">
   <strong class="user">Jordan Rutty</strong>
   <a href="#102665" class="date">27-Feb-2011 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is to automatically sort a 2 dimensional array (like that from mysql fetches) into unlimited dimension array's<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
@param $array mysql fetch array<br />
@param $row_key array of rowkeys to be used ex array('country', 'state', 'city');<br />
*/<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">LoopRowKey</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$row_key</span><span class="keyword">, &amp;</span><span class="default">$result</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row_key </span><span class="keyword">= (array)</span><span class="default">$row_key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$row_key </span><span class="keyword">as </span><span class="default">$var</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">$var</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">$var</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">.= </span><span class="string">"['</span><span class="default">$var</span><span class="string">']"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$result</span><span class="default">$i</span><span class="string">"</span><span class="keyword">.</span><span class="string">'[]'</span><span class="keyword">.</span><span class="string">" = \$value;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">//this function will turn:<br />
</span><span class="default">$array </span><span class="keyword">= array{<br />
&nbsp;&nbsp;&nbsp; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; </span><span class="string">'1'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'country' </span><span class="keyword">=&gt; </span><span class="string">'canada'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="string">'QC'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="string">'montreal'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; </span><span class="string">'2'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'country' </span><span class="keyword">=&gt; </span><span class="string">'canada'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="string">'ON'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="string">'toronto'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; </span><span class="string">'3'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'country' </span><span class="keyword">=&gt; </span><span class="string">'canada'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="string">'QC'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="string">'quebec'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; }<br />
};<br />
<br />
</span><span class="default">$row_key </span><span class="keyword">= array(</span><span class="string">'country'</span><span class="keyword">, </span><span class="string">'state'</span><span class="keyword">);<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">LoopRowKey</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$row_key</span><span class="keyword">);<br />
<br />
</span><span class="comment">//will give<br />
<br />
</span><span class="default">$result </span><span class="keyword">= array{<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'canada' </span><span class="keyword">=&gt; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'QC' </span><span class="keyword">=&gt; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'0' </span><span class="keyword">=&gt; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; </span><span class="string">'1'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'country' </span><span class="keyword">=&gt; </span><span class="string">'canada'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="string">'QC'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="string">'montreal'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'1' </span><span class="keyword">=&gt; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; </span><span class="string">'3'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'country' </span><span class="keyword">=&gt; </span><span class="string">'canada'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="string">'QC'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="string">'quebec'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'ON'&nbsp; &nbsp; </span><span class="keyword">=&gt; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'0' </span><span class="keyword">=&gt; array{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; </span><span class="string">'2'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'country' </span><span class="keyword">=&gt; </span><span class="string">'canada'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="string">'ON'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="string">'toronto'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
};<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101103""></a>
  <div class="note">
   <strong class="user">piyush25378 at gmail dot com</strong>
   <a href="#101103" class="date">26-Nov-2010 01:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using the eval() function like<br />
eval('?&gt;' . $data['content'] . '&lt;?');<br />
<br />
Please be sure to check that the short_open_tag is on in php.ini. Otherwise it will append the opening tag to the string.<br />
<br />
If you are using eval function like<br />
eval('?&gt;' . $data['content'] . '&lt;?php'); and you have short_open_tag on there will be parse error. So if it is required to use function like this turn off short_open_tags.<br />
Also it is advisable to put a space after <span class="default">&lt;?php to avoid any accidental error</span><span class="keyword">.</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100032""></a>
  <div class="note">
   <strong class="user">jason at joeymail dot net</strong>
   <a href="#100032" class="date">21-Sep-2010 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An alternative to using eval to mimic include - is to just use include on an in-memory stream. This allows a user-cooked class to pretend it is a stream, so methods which expect a stream or URL will be happy (like include)<br />
<br />
i) register a global variable stream wrapper using stream_wrapper_register(). (search the man page for "Example class registered as stream wrapper")<br />
<br />
ii) use file_get_contents (or db read or...) to read your php script into a global variable.<br />
eg<br />
$GLOBALS['yourvar']=file_get_contents('somefile.php');<br />
<br />
iii) call include with the URL you registered. Using the example wrapper above:<br />
include 'var://yourvar';<br />
<br />
Easy as. Not a magic regexp in sight!&nbsp; Enjoy.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99891""></a>
  <div class="note">
   <strong class="user">php at rijkvanwel dot nl</strong>
   <a href="#99891" class="date">13-Sep-2010 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To catch a parse error in eval()'ed code with a custom error handler, use error_get_last() (PHP &gt;= 5.2.0).<br />
<br />
<span class="default">&lt;?php<br />
$return </span><span class="keyword">= eval( </span><span class="string">'parse error' </span><span class="keyword">);<br />
<br />
if ( </span><span class="default">$return </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">&amp;&amp; ( </span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">() ) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">myErrorHandler</span><span class="keyword">( </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">], </span><span class="default">null </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Since the "execution of the following code continues normally", as stated in the manual,<br />
&nbsp;&nbsp;&nbsp; // we still have to exit explicitly in case of an error<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">exit;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98731""></a>
  <div class="note">
   <strong class="user">php at dynamicplus dot it</strong>
   <a href="#98731" class="date">02-Jul-2010 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that using <br />
eval( 'return TRUE;?&gt;' . $sPhpCode );<br />
<br />
is not safe to check if syntax is correct... as this will procuce a fatal error (uncatchable)....<br />
<br />
eval( 'return TRUE;?&gt;<span class="default">&lt;?php </span><span class="keyword">empty( function(</span><span class="default">$var</span><span class="keyword">) ); </span><span class="default">?&gt;</span>' );<br />
<br />
using empty() on a non-pure variable will produce a<br />
compilation error!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97063""></a>
  <div class="note">
   <strong class="user">darkhogg (foo) gmail (bar) com</strong>
   <a href="#97063" class="date">30-Mar-2010 10:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following code<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">eval( </span><span class="string">'?&gt; foo &lt;?php' </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
does not throw any error, but prints the opening tag.<br />
Adding a space after the open tag fixes it:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">eval( </span><span class="string">'?&gt; foo &lt;?php ' </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96413""></a>
  <div class="note">
   <strong class="user">vladimiroski at gmail dot com</strong>
   <a href="#96413" class="date">25-Feb-2010 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that when you do something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">eval(</span><span class="string">'?&gt;' </span><span class="keyword">. </span><span class="default">$code </span><span class="keyword">. </span><span class="string">'&lt;?'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You must end it with '&lt;?' because the following will give you a parse error:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">eval(</span><span class="string">'?&gt;' </span><span class="keyword">. </span><span class="default">$code </span><span class="keyword">. </span><span class="string">'&lt;?php'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Somehow eval() only likes PHP opening short-tag AKA '&lt;?' but fails with '&lt;?php'</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96407""></a>
  <div class="note">
   <strong class="user">john dot risken at gmail dot com</strong>
   <a href="#96407" class="date">25-Feb-2010 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple use of eval:<br />
<br />
Sometimes you want to know both the value of a variable being passed to a function and its name. Passing by reference can get you there, but only through a lot of convolutions (as far as I can tell!)<br />
<br />
But by using the stem of a variable's name, there are two methods to achieve this.<br />
<br />
Say that <br />
<br />
<span class="default">&lt;?php<br />
$emailName</span><span class="keyword">=</span><span class="string">"me@example.com"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
You can pass this information thusly:<br />
<br />
First, if you have the stem, "emailName', in a string var<br />
<br />
<span class="default">&lt;?php<br />
$theVarStem</span><span class="keyword">=</span><span class="string">"emailName"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
you can recover the value of the original variable like this:<br />
<br />
<span class="default">&lt;?php<br />
$theVarValue</span><span class="keyword">=eval(</span><span class="string">"return \$</span><span class="default">$theVarStem</span><span class="string">;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Using 'return' inside the eval is the trick that makes it work - something inherent in the documentation&nbsp; but not at all obvious to me.<br />
<br />
Unless $emailName has global scope, this method won't work inside a function. For that purpose, you can do the following:<br />
<br />
<span class="default">&lt;?php<br />
myFunction</span><span class="keyword">(</span><span class="default">compact</span><span class="keyword">(</span><span class="string">"emailName"</span><span class="keyword">))<br />
<br />
function </span><span class="default">myFunction</span><span class="keyword">(</span><span class="default">$theInfo</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">$theVarStem</span><span class="keyword">=</span><span class="default">key</span><span class="keyword">(</span><span class="default">$theInfo</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$theVarValue</span><span class="keyword">=</span><span class="default">current</span><span class="keyword">(</span><span class="default">$theInfo</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="comment">//...<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
I apologize if all this seems too obvious: it took me a lotta sloggin' to figure it out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95478""></a>
  <div class="note">
   <strong class="user">ajo at NO dot SPAM dot mydevnull dot net</strong>
   <a href="#95478" class="date">05-Jan-2010 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Inspired from the users microvalen at NOSPAM dot microvalen dot com and javis, i combined their notes and came up with a very simple "template engine", for testing purposes (to save the time and trouble of downloading and including a real template engine like the Smarty):<br />
<br />
<span class="default">&lt;?php<br />
$var </span><span class="keyword">= </span><span class="string">'dynamic content'</span><span class="keyword">;<br />
echo eval(</span><span class="string">'?&gt;' </span><span class="keyword">. </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'template.phtml'</span><span class="keyword">) . </span><span class="string">'&lt;?'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and the&nbsp; template.phtml:<br />
&lt;html&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;head&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;!-- ... --&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/head&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;body&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;!-- ... --&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;?=$var?&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;!-- ... --&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/body&gt;<br />
&lt;/html&gt;<br />
<br />
This is something i use a lot (specially when studying new PHP Libraries or trying new jQuery plugins) and i think it might help others too.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92851""></a>
  <div class="note">
   <strong class="user">Nico</strong>
   <a href="#92851" class="date">11-Aug-2009 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
eval and namespace<br />
<br />
For those who wonder: since eval executes the code in another context than the current script, it is possible to evaluate code that uses a particular namespace without changing the current one (and it does not trigger an error if there is no namespace and the evaluated one is not at the top of the script).<br />
Exemple:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">Foo</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'namespace 1: '</span><span class="keyword">.</span><span class="default">__NAMESPACE__</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
eval(</span><span class="string">'namespace Bar;<br />
&nbsp;&nbsp; &nbsp;&nbsp; class BarClass {}<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo \'namespace 2: \'.__NAMESPACE__."\n";'</span><span class="keyword">);<br />
echo </span><span class="string">'namespace 1 again: '</span><span class="keyword">.</span><span class="default">__NAMESPACE__</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
output:<br />
namespace 1: Foo<br />
namespace 2: Bar<br />
namespace 1 again: Foo<br />
<br />
And it will create the class Bar\BarClass.<br />
<br />
Also, the eval code will not belong to the namespace of the code that do the eval:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">Foo</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'namespace 1: '</span><span class="keyword">.</span><span class="default">__NAMESPACE__</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
eval(</span><span class="string">'class BarClass {}<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo \'namespace 2: \'.__NAMESPACE__."\n";'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
output:<br />
namespace 1: Foo<br />
namespace 2: // global namespace</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92603""></a>
  <div class="note">
   <strong class="user">cmr at expansys dot com</strong>
   <a href="#92603" class="date">31-Jul-2009 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Fixed matheval function when percentage is less than 10:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">matheval</span><span class="keyword">(</span><span class="default">$equation</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/[^0-9+\-.*\/()%]/"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// fix percentage calcul when percentage value &lt; 10<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([+-])([0-9]{1})(%)/"</span><span class="keyword">,</span><span class="string">"*(1\$1.0\$2)"</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// calc percentage<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([+-])([0-9]+)(%)/"</span><span class="keyword">,</span><span class="string">"*(1\$1.\$2)"</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// you could use str_replace on this next line<br />
&nbsp;&nbsp;&nbsp; // if you really, really want to fine-tune this equation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([0-9]+)(%)/"</span><span class="keyword">,</span><span class="string">".\$1"</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$equation </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$return=" </span><span class="keyword">. </span><span class="default">$equation </span><span class="keyword">. </span><span class="string">";" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91201""></a>
  <div class="note">
   <strong class="user">webmaster at drakkofox dot net</strong>
   <a href="#91201" class="date">29-May-2009 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Never, Never ever forget the ";" on the end of the eval string, if you are adding it to eval a variable attribuition;<br />
<span class="default">&lt;?php<br />
&nbsp; $data </span><span class="keyword">= </span><span class="string">"</span><span class="default">$key</span><span class="string">"</span><span class="keyword">.</span><span class="string">"_</span><span class="default">$sequence</span><span class="string">"</span><span class="keyword">;<br />
&nbsp; eval(</span><span class="string">"\$idct=\$idedit_</span><span class="default">$data</span><span class="string">;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
we took a long time to discover that the problem was a ";" missing in the end.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89543""></a>
  <div class="note">
   <strong class="user">JURGEN AT PERSON DOT BE</strong>
   <a href="#89543" class="date">12-Mar-2009 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I updated my code because there are many abuses of the function eval() in phpscripts to break security, privacy, to perform callbacks, to execute commands on the server by remote.&nbsp; This could not be allowed in a professional environment which often deals with sensitive, important or financial data.<br />
<br />
Code obfuscation is not a safe solution to protect Your source at all. As I do disagree with some programmers to use any ( ! ) solution to encrypt php code. I advocate to not scramble code and to not implement call home events (which hit the firewall or reverse proxy anyway).&nbsp;&nbsp; Call backs do violate privacy of the user.&nbsp; It can be considered as spyware, theft of information.&nbsp; All serverside code should be readable to to verify if no sensitive information is transfered to the vendor or to verify it is not malware.&nbsp; Running scrambled code is as dangerous as to run a server without any security measures. That's why some hosting providers refuse to run scrambled code on their servers. As programmer, the best way You can do is to create many revisions of Your code,&nbsp; as to provide additional plugins, services and support for registered users.&nbsp; So do not encrypt a single line of code at all, do follow the opensource standard and do respect privacy and the right of verification of the user of your scripts.&nbsp; <br />
<br />
So here is an updated version, to use with PHP-CLI&nbsp; If it fails in the process, You can invoke with the verbose option so You can follow the process and alter this code.<br />
<br />
----- snippet denest.php.sh -----------<br />
#!/usr/bin/php<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// FILE: denest.php.sh<br />
&nbsp;&nbsp;&nbsp; // perform chmod +x denest.php.sh&nbsp; &nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"\nDECODE nested eval(gzinflate()) by DEBO Jurgen &lt;webmaster@purechocolates.com&gt;\n\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* invokation php-cli:&nbsp; #php denest.php &lt;your_nested_script.php&gt; &lt;verbose empty,0=OFF 1=ON&gt; */&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename_full </span><span class="keyword">= </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$verbose&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= (bool) </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename_base </span><span class="keyword">= </span><span class="default">basename </span><span class="keyword">(</span><span class="default">$filename_full</span><span class="keyword">,</span><span class="string">'.php'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Using: "</span><span class="keyword">.</span><span class="default">$filename_base</span><span class="keyword">.</span><span class="string">".php\n"</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Read...\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp1&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="default">$filename_full</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content&nbsp; </span><span class="keyword">= </span><span class="default">fread </span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">, </span><span class="default">filesize </span><span class="keyword">(</span><span class="default">$filename_full</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Decode...\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while ( </span><span class="default">is_nested</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">) ) </span><span class="default">$content</span><span class="keyword">=</span><span class="default">denest</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">dump</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">is_nested </span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/eval\(gzinflate/"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">denest </span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$verbose</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;\?php|&lt;\?|\?&gt;/"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$verbose</span><span class="keyword">) </span><span class="default">dump </span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/eval/"</span><span class="keyword">, </span><span class="string">"\$text="</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$verbose</span><span class="keyword">) </span><span class="default">dump </span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">dump </span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$final</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$counter </span><span class="keyword">= </span><span class="default">0 </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$filename_base</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename_new </span><span class="keyword">= (</span><span class="default">$final</span><span class="keyword">) ? (</span><span class="default">$filename_base</span><span class="keyword">.</span><span class="string">".done.php"</span><span class="keyword">) : (</span><span class="default">$filename_base</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%04d"</span><span class="keyword">, ++</span><span class="default">$counter</span><span class="keyword">).</span><span class="string">".php"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Writing "</span><span class="keyword">.</span><span class="default">$filename_new</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp2 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename_new</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span> <br />
----- snippet denest.php.sh -----------</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89109""></a>
  <div class="note">
   <strong class="user">microvalen at NOSPAM dot microvalen dot com</strong>
   <a href="#89109" class="date">21-Feb-2009 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
very simple example to includea html file:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$simple_var </span><span class="keyword">= </span><span class="string">'This is a simple var'</span><span class="keyword">;<br />
<br />
eval(</span><span class="string">"\$file=\"" </span><span class="keyword">. </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="string">"test.html"</span><span class="keyword">))) . </span><span class="string">"\";"</span><span class="keyword">);<br />
print </span><span class="default">$file</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
and the html:<br />
&lt;body&gt;<br />
$simple_var<br />
&lt;/body&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88820""></a>
  <div class="note">
   <strong class="user">javis</strong>
   <a href="#88820" class="date">09-Feb-2009 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
you can actually run strings with html and php code. To do that you need to append ?&gt; and &lt;? simbols like this:<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">eval(</span><span class="string">"?&gt;" </span><span class="keyword">. </span><span class="default">$code </span><span class="keyword">. </span><span class="string">"&lt;?"</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87296""></a>
  <div class="note">
   <strong class="user">php at stock-consulting dot com</strong>
   <a href="#87296" class="date">28-Nov-2008 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Magic constants like __FILE__ may not return what you expect if used inside eval()'d code. Instead, it'll answer something like "c:\directory\filename.php(123) : eval()'d code" (under Windows, obviously, checked with PHP5.2.6) - which can still be processed with a function like preg_replace to receive the filename of the file containing the eval().<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$filename </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@\(.*\(.*$@'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">__FILE__</span><span class="keyword">);<br />
echo </span><span class="default">$filename</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86884""></a>
  <div class="note">
   <strong class="user">maurice at chandoo dot de</strong>
   <a href="#86884" class="date">07-Nov-2008 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">safe_eval</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">,&amp;</span><span class="default">$status</span><span class="keyword">) { </span><span class="comment">//status 0=failed,1=all clear<br />
&nbsp;&nbsp;&nbsp; //Signs<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Can't assign stuff<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bl_signs </span><span class="keyword">= array(</span><span class="string">"="</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Language constructs<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bl_constructs </span><span class="keyword">= array(</span><span class="string">"print"</span><span class="keyword">,</span><span class="string">"echo"</span><span class="keyword">,</span><span class="string">"require"</span><span class="keyword">,</span><span class="string">"include"</span><span class="keyword">,</span><span class="string">"if"</span><span class="keyword">,</span><span class="string">"else"</span><span class="keyword">,<br />
</span><span class="string">"while"</span><span class="keyword">,</span><span class="string">"for"</span><span class="keyword">,</span><span class="string">"switch"</span><span class="keyword">,</span><span class="string">"exit"</span><span class="keyword">,</span><span class="string">"break"</span><span class="keyword">);&nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Functions<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$funcs </span><span class="keyword">= </span><span class="default">get_defined_functions</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$funcs </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">[</span><span class="string">'internal'</span><span class="keyword">],</span><span class="default">$funcs</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Functions allowed&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Math cant be evil, can it?<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$whitelist </span><span class="keyword">= array(</span><span class="string">"pow"</span><span class="keyword">,</span><span class="string">"exp"</span><span class="keyword">,</span><span class="string">"abs"</span><span class="keyword">,</span><span class="string">"sin"</span><span class="keyword">,</span><span class="string">"cos"</span><span class="keyword">,</span><span class="string">"tan"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Remove whitelist elements<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$whitelist </span><span class="keyword">as </span><span class="default">$f</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$funcs</span><span class="keyword">[</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$funcs</span><span class="keyword">)]);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Append '(' to prevent confusion (e.g. array() and array_fill())<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$funcs </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$funcs</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">.</span><span class="string">"("</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$blacklist </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$bl_signs</span><span class="keyword">,</span><span class="default">$bl_constructs</span><span class="keyword">,</span><span class="default">$funcs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Check<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$blacklist </span><span class="keyword">as </span><span class="default">$nono</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">,</span><span class="default">$nono</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Eval<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return @eval(</span><span class="default">$code</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Note: Try to include this after all of your other self-defined functions and consider whether the blacklist is appropriate for your purpose<br />
<br />
I wouldn't recommend this function if you're going to use eval extensively in your script. However, it's worth a try if you are going to put user input into eval</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86820""></a>
  <div class="note">
   <strong class="user">alexis at amigo dot com</strong>
   <a href="#86820" class="date">04-Nov-2008 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
eval vs include<br />
<br />
i have to make a script to take code from a database and excute it, but i'm not sure is eval was hight server load than include, so i take the example of Luke at chaoticlogic dot net and test it, the results are great for eval:<br />
<br />
test.php<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//establish a blank integer<br />
</span><span class="default">$increment</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
<br />
</span><span class="comment">//establish the code to be executed<br />
//one hundred million times<br />
</span><span class="default">$code</span><span class="keyword">=</span><span class="string">"\$increment++;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//remember the time this test started<br />
</span><span class="default">$started</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
<br />
</span><span class="comment">//execute $code on hundred million times<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">100000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$code</span><span class="keyword">);<br />
}<br />
</span><span class="comment">//find out how long it took, in<br />
//seconds<br />
</span><span class="default">$ended</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
</span><span class="default">$spent</span><span class="keyword">=</span><span class="default">$ended</span><span class="keyword">-</span><span class="default">$started</span><span class="keyword">;<br />
<br />
</span><span class="comment">//tell the user this<br />
</span><span class="keyword">print </span><span class="string">"Eval()ed code took </span><span class="default">$spent</span><span class="string"> seconds to execute 100,000 times.\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//re-establish that same blank integer<br />
</span><span class="default">$increment</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
<br />
</span><span class="comment">//remember the time this second test<br />
//started<br />
</span><span class="default">$started</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
<br />
</span><span class="comment">//execute the test again, with<br />
//pre-parsed code<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">100000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
include(</span><span class="string">"increment.php"</span><span class="keyword">);<br />
}<br />
</span><span class="comment">//find out how long it took, in<br />
//seconds<br />
</span><span class="default">$ended</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
</span><span class="default">$spent</span><span class="keyword">=</span><span class="default">$ended</span><span class="keyword">-</span><span class="default">$started</span><span class="keyword">;<br />
<br />
</span><span class="comment">//tell the user this<br />
</span><span class="keyword">print </span><span class="string">"Included file with Pre-parsed code took </span><span class="default">$spent</span><span class="string"> seconds to execute 100,000 times.\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
increment.php<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $increment</span><span class="keyword">++;<br />
</span><span class="default">?&gt;<br />
</span><br />
Eval()ed code took 0 seconds to execute 100,000 times. Included file with Pre-parsed code took 17 seconds to execute 100,000 times.<br />
<br />
i change 100,000,000 for 100,000 because the script take so much time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86697""></a>
  <div class="note">
   <strong class="user">Mark dot Sheppard at disney dot com</strong>
   <a href="#86697" class="date">30-Oct-2008 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing to note is that an exit() call inside an eval() exits the entire script, *not* just the eval(), which is what you'd expect if you've ever used eval() in any other language.&nbsp; This makes it somewhat useless in my opinion.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85790""></a>
  <div class="note">
   <strong class="user">luke at cywh dot com</strong>
   <a href="#85790" class="date">17-Sep-2008 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Finally, a good use for eval :)!<br />
<br />
If you want to be able to check for syntax errors WITHOUT executing the code, add "return true;" before all the code. All execution of the code stops after that mark, and makes eval returns true on no syntax errors, and false on syntax errors.<br />
<br />
This is especially useful for anyone making a template system.<br />
<br />
Here's a working example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">check_syntax</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return @eval(</span><span class="string">'return true;' </span><span class="keyword">. </span><span class="default">$code</span><span class="keyword">);<br />
}<br />
<br />
print </span><span class="string">"&lt;b&gt;No Code execution:&lt;/b&gt;&lt;br /&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">$code </span><span class="keyword">= </span><span class="string">"print \"&lt;b&gt;&lt;i&gt;hello! you don't want me...&lt;/i&gt;&lt;/b&gt;&lt;br /&gt;\n\";"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">check_syntax</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">)); </span><span class="comment">// Good syntax<br />
</span><span class="keyword">print </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">check_syntax</span><span class="keyword">(</span><span class="default">$code </span><span class="keyword">. </span><span class="string">' =='</span><span class="keyword">)); </span><span class="comment">// Bad syntax<br />
</span><span class="keyword">print </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
<br />
print </span><span class="string">"&lt;b&gt;Code Executed...Bad&lt;/b&gt;:&lt;br /&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(eval(</span><span class="default">$code</span><span class="keyword">) === </span><span class="default">null</span><span class="keyword">); </span><span class="comment">// Good syntax<br />
</span><span class="keyword">print </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(@eval(</span><span class="default">$code </span><span class="keyword">. </span><span class="string">' =='</span><span class="keyword">) === </span><span class="default">null</span><span class="keyword">); </span><span class="comment">// Bad syntax<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85677""></a>
  <div class="note">
   <strong class="user">asohn at aircanopy dot net</strong>
   <a href="#85677" class="date">11-Sep-2008 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
$hello</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">4</span><span class="keyword">][</span><span class="default">6</span><span class="keyword">][</span><span class="default">8</span><span class="keyword">][</span><span class="default">10</span><span class="keyword">] = </span><span class="string">'this is a test'</span><span class="keyword">;<br />
</span><span class="default">$w </span><span class="keyword">= </span><span class="string">"[2]"</span><span class="keyword">;<br />
</span><span class="default">$o </span><span class="keyword">= </span><span class="string">"[4]"</span><span class="keyword">;<br />
</span><span class="default">$r </span><span class="keyword">= </span><span class="string">"[6]"</span><span class="keyword">;<br />
</span><span class="default">$l </span><span class="keyword">= </span><span class="string">"[8]"</span><span class="keyword">;<br />
</span><span class="default">$d </span><span class="keyword">= </span><span class="string">"[10]"</span><span class="keyword">;<br />
echo </span><span class="string">'hello, '</span><span class="keyword">.eval(</span><span class="string">"return \$hello</span><span class="default">$w$o$r$l$d</span><span class="string">;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>The above will output:<br />
hello, this is a test</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84140""></a>
  <div class="note">
   <strong class="user">marco at harddisk dot is-a-geek dot org</strong>
   <a href="#84140" class="date">30-Jun-2008 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
eval does not work reliably in conjunction with global, at least not in the cygwin port version.<br />
<br />
So:<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">//my class...<br />
</span><span class="keyword">}<br />
function </span><span class="default">load_module</span><span class="keyword">(</span><span class="default">$module</span><span class="keyword">) {<br />
&nbsp; eval(</span><span class="string">"global \$"</span><span class="keyword">.</span><span class="default">$module</span><span class="keyword">.</span><span class="string">"_var;"</span><span class="keyword">);<br />
&nbsp; eval(</span><span class="string">"\$"</span><span class="keyword">.</span><span class="default">$module</span><span class="keyword">.</span><span class="string">"_var=&amp;new foo();"</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">//various stuff ... ...<br />
</span><span class="keyword">}<br />
</span><span class="default">load_module</span><span class="keyword">(</span><span class="string">"foo"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
becomes to working:<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">//my class...<br />
</span><span class="keyword">}<br />
function </span><span class="default">load_module</span><span class="keyword">(</span><span class="default">$module</span><span class="keyword">) {<br />
&nbsp; eval(</span><span class="string">'$GLOBALS["'</span><span class="keyword">.</span><span class="default">$module</span><span class="keyword">.</span><span class="string">'_var"]=&amp;new foo();'</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">//various stuff ... ...<br />
</span><span class="keyword">}<br />
</span><span class="default">load_module</span><span class="keyword">(</span><span class="string">"foo"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Note in the 2nd example, you _always_ need to use $GLOBALS[$module] to access the variable!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83782""></a>
  <div class="note">
   <strong class="user">trukin at gmail dot com</strong>
   <a href="#83782" class="date">11-Jun-2008 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The EVAL function can be used&nbsp; as a fast Template system.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parseTemplate</span><span class="keyword">(</span><span class="default">$template</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">=array()) {<br />
&nbsp; foreach (</span><span class="default">$params </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; $</span><span class="default">$k </span><span class="keyword">= </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp; eval(</span><span class="string">"?&gt;" </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$template</span><span class="keyword">)) . </span><span class="string">"&lt;?"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp; </span><span class="default">ob_end_flush</span><span class="keyword">();<br />
&nbsp; return </span><span class="default">$c</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example: <br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="default">parseTemplate</span><span class="keyword">(</span><span class="string">"myTemplate.php"</span><span class="keyword">, array(</span><span class="string">'account'</span><span class="keyword">=&gt;</span><span class="default">$row</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
and myTemplate.php can be like<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">foreach(</span><span class="default">$account </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">) : </span><span class="default">?&gt;<br />
</span>&nbsp; <span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$k</span><span class="keyword">; </span><span class="default">?&gt;</span>: <span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$v</span><span class="keyword">; </span><span class="default">?&gt;<br />
&lt;?php </span><span class="keyword">endforeach; </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82240""></a>
  <div class="note">
   <strong class="user">Ivan Zahariev</strong>
   <a href="#82240" class="date">02-Apr-2008 01:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that the Magic constants (<a href="http://www.php.net/manual/en/language.constants.predefined.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/language.constants.predefined.php</a>) do NOT work in an eval()'ed code.<br />
<br />
Probably because PHP substitutes these statically when it compiles the source code of your PHP script initially.<br />
<br />
So the following will not work as expected:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">user_func1</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"User function name: "</span><span class="keyword">.</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="string">'echo "in eval(): User function name: ".__FUNCTION__."\n";'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Calling user_func1() will output:<br />
&nbsp; User function name: user_func1<br />
&nbsp; User function name:</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82239""></a>
  <div class="note">
   <strong class="user">Luke at chaoticlogic dot net</strong>
   <a href="#82239" class="date">02-Apr-2008 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I thought it was pertinent to demonstrate just how slow the eval() function is when compared to pre-parsed code, so I wrote this.<br />
<br />
In my case, it took 54 seconds to execute the code 100,000,000 times through eval(), and only 4 seconds with pre-parsed code.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//establish a blank integer<br />
</span><span class="default">$increment</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
<br />
</span><span class="comment">//establish the code to be executed<br />
//one hundred million times<br />
</span><span class="default">$code</span><span class="keyword">=</span><span class="string">"\$increment++;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//remember the time this test started<br />
</span><span class="default">$started</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
<br />
</span><span class="comment">//execute $code on hundred million times<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">10000000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$code</span><span class="keyword">);<br />
}<br />
</span><span class="comment">//find out how long it took, in<br />
//seconds<br />
</span><span class="default">$ended</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
</span><span class="default">$spent</span><span class="keyword">=</span><span class="default">$ended</span><span class="keyword">-</span><span class="default">$started</span><span class="keyword">;<br />
<br />
</span><span class="comment">//tell the user this<br />
</span><span class="keyword">print </span><span class="string">"Eval()ed code took </span><span class="default">$spent</span><span class="string"> seconds to execute 100,000,000 times.\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//re-establish that same blank integer<br />
</span><span class="default">$increment</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
<br />
</span><span class="comment">//remember the time this second test<br />
//started<br />
</span><span class="default">$started</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
<br />
</span><span class="comment">//execute the test again, with<br />
//pre-parsed code<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">10000000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$increment</span><span class="keyword">++;<br />
}<br />
</span><span class="comment">//find out how long it took, in<br />
//seconds<br />
</span><span class="default">$ended</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
</span><span class="default">$spent</span><span class="keyword">=</span><span class="default">$ended</span><span class="keyword">-</span><span class="default">$started</span><span class="keyword">;<br />
<br />
</span><span class="comment">//tell the user this<br />
</span><span class="keyword">print </span><span class="string">"Pre-parsed code took </span><span class="default">$spent</span><span class="string"> seconds to execute 100,000,000 times.\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>I wish there was some way to parse code, store the pre-parsed binary in a variable, and then tell PHP to execute that variable as if it was part of the program.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81376""></a>
  <div class="note">
   <strong class="user">Ipseno at yahoo dot com</strong>
   <a href="#81376" class="date">25-Feb-2008 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you attempt to call a user defined function in eval() and .php files are obfuscated by Zend encoder, it will result in a fatal error.<br />
<br />
Use a call_user_func() inside eval() to call your personal hand made functions.<br />
<br />
This is user function<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">square_it</span><span class="keyword">(</span><span class="default">$nmb</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$nmb </span><span class="keyword">* </span><span class="default">$nmb</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
//Checking if eval sees it?<br />
<span class="default">&lt;?php<br />
<br />
$code </span><span class="keyword">= </span><span class="default">var_export</span><span class="keyword">( </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'square_it'</span><span class="keyword">) );<br />
<br />
eval( </span><span class="default">$code </span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//returns TRUE - so yes it does!<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This will result in a fatal error:<br />
PHP Fatal error:&nbsp; Call to undefined function square_it()<br />
<span class="default">&lt;?php<br />
<br />
$code </span><span class="keyword">= </span><span class="string">'echo square_it(55);' </span><span class="keyword">;<br />
<br />
eval( </span><span class="default">$code </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This will work<br />
<span class="default">&lt;?php<br />
<br />
$code </span><span class="keyword">= </span><span class="string">'echo call_user_func(\'square_it\', 55);' </span><span class="keyword">;<br />
<br />
eval( </span><span class="default">$code </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76164""></a>
  <div class="note">
   <strong class="user">pierrotevrard at gmail dot com</strong>
   <a href="#76164" class="date">03-Jul-2007 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A wonderful world of eval() applications<br />
<br />
You certainly know how to simulate an array as a constant using eval(), not ? See the code below:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if( ! </span><span class="default">defined</span><span class="keyword">(</span><span class="string">'MY_ARRAY'</span><span class="keyword">) )<br />
{<br />
&nbsp; </span><span class="default">define</span><span class="keyword">( </span><span class="string">'MY_ARRAY' </span><span class="keyword">, </span><span class="string">'return ' </span><span class="keyword">. </span><span class="default">var_export</span><span class="keyword">( array( </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">5 </span><span class="keyword">) , </span><span class="default">true </span><span class="keyword">) . </span><span class="string">';' </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
And far, far away in your code...<br />
<br />
<span class="default">&lt;?php<br />
<br />
$my_array </span><span class="keyword">= eval( </span><span class="default">MY_ARRAY </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
But the grandeur of eval is when you use it to customize some method of a class :<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if( ! </span><span class="default">class_exists</span><span class="keyword">( </span><span class="string">'my_class' </span><span class="keyword">) )<br />
{<br />
&nbsp; class </span><span class="default">my_class<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//private propreties<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$_prop</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$_custom_check </span><span class="keyword">= </span><span class="string">'return true;'</span><span class="keyword">; </span><span class="comment">//of course, I want a default check code that return true<br />
<br />
&nbsp;&nbsp;&nbsp; //PHP4 constructor<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">my_class</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_prop </span><span class="keyword">= eval( </span><span class="default">MY_ARRAY </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">customize_check</span><span class="keyword">( </span><span class="default">$code </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_custom_check </span><span class="keyword">= </span><span class="default">$code</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">check</span><span class="keyword">( </span><span class="default">$val </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return eval( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_custom_check </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$my_class </span><span class="keyword">= new </span><span class="default">my_class</span><span class="keyword">();<br />
<br />
</span><span class="default">$check </span><span class="keyword">= </span><span class="string">'return in_array( $val , $this -&gt; _prop , true );'</span><span class="keyword">;<br />
</span><span class="default">$my_class </span><span class="keyword">-&gt; </span><span class="default">customize_check</span><span class="keyword">( </span><span class="default">$check </span><span class="keyword">);<br />
<br />
print </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
if( </span><span class="default">$my_class </span><span class="keyword">-&gt; </span><span class="default">check</span><span class="keyword">( </span><span class="default">1 </span><span class="keyword">) )<br />
{<br />
&nbsp;&nbsp; echo </span><span class="string">'1 is checked as true.' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
else<br />
{<br />
&nbsp;&nbsp; echo </span><span class="string">'1 is checked as false.' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">//show: 1 is checked as true.<br />
<br />
</span><span class="keyword">if( </span><span class="default">$my_class </span><span class="keyword">-&gt; </span><span class="default">check</span><span class="keyword">( </span><span class="string">'1' </span><span class="keyword">) )<br />
{<br />
&nbsp;&nbsp; echo </span><span class="string">'"1" is checked as true.' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
else<br />
{<br />
&nbsp;&nbsp; echo </span><span class="string">'"1" is checked as false.' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">//show: "1" is checked as false.<br />
<br />
</span><span class="keyword">print </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The application of eval() using propreties of a class gives you so much possibilities...<br />
Of course, combinate with a safer eval code, will be better but if you use it only in your code ( for framework project by example ) that's note necessary...<br />
<br />
Have fun.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75389""></a>
  <div class="note">
   <strong class="user">udo dot schroeter at gmail dot com</strong>
   <a href="#75389" class="date">26-May-2007 11:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Safer Eval<br />
<br />
eval() is used way to often. It slows down code, makes it harder to maintain and it created security risks. However, sometimes, I found myself wishing I could allow some user-controlled scripting in my software, without giving access to dangerous functions. <br />
<br />
That's what the following class does: it uses PHP's tokenizer to parse a script, compares every function call against a list of allowed functions. Only if the script is "clean", it gets eval'd.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">class </span><span class="default">SaferScript </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$source</span><span class="keyword">, </span><span class="default">$allowedCalls</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">SaferScript</span><span class="keyword">(</span><span class="default">$scriptText</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">source </span><span class="keyword">= </span><span class="default">$scriptText</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">allowedCalls </span><span class="keyword">= array();&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">allowHarmlessCalls</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">allowedCalls </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'explode,implode,date,time,round,trunc,rand,ceil,floor,srand,'</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'strtolower,strtoupper,substr,stristr,strpos,print,print_r'</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">parse</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$tokens </span><span class="keyword">= </span><span class="default">token_get_all</span><span class="keyword">(</span><span class="string">'&lt;?'</span><span class="keyword">.</span><span class="string">'php '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">source</span><span class="keyword">.</span><span class="string">' ?'</span><span class="keyword">.</span><span class="string">'&gt;'</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$vcall </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$tokens </span><span class="keyword">as </span><span class="default">$token</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$token</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="default">T_VARIABLE</span><span class="keyword">): { </span><span class="default">$vcall </span><span class="keyword">.= </span><span class="string">'v'</span><span class="keyword">; break; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="default">T_STRING</span><span class="keyword">): { </span><span class="default">$vcall </span><span class="keyword">.= </span><span class="string">'s'</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="default">T_REQUIRE_ONCE</span><span class="keyword">): case(</span><span class="default">T_REQUIRE</span><span class="keyword">): case(</span><span class="default">T_NEW</span><span class="keyword">): case(</span><span class="default">T_RETURN</span><span class="keyword">): <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="default">T_BREAK</span><span class="keyword">): case(</span><span class="default">T_CATCH</span><span class="keyword">): case(</span><span class="default">T_CLONE</span><span class="keyword">): case(</span><span class="default">T_EXIT</span><span class="keyword">): <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="default">T_PRINT</span><span class="keyword">): case(</span><span class="default">T_GLOBAL</span><span class="keyword">): case(</span><span class="default">T_ECHO</span><span class="keyword">): case(</span><span class="default">T_INCLUDE_ONCE</span><span class="keyword">): <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="default">T_INCLUDE</span><span class="keyword">): case(</span><span class="default">T_EVAL</span><span class="keyword">): case(</span><span class="default">T_FUNCTION</span><span class="keyword">): { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">allowedCalls</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">[] = </span><span class="string">'illegal call: '</span><span class="keyword">.</span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$vcall </span><span class="keyword">.= </span><span class="default">$token</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$vcall</span><span class="keyword">, </span><span class="string">'v('</span><span class="keyword">) != </span><span class="string">''</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">[] = array(</span><span class="string">'illegal dynamic function call'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; return(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">execute</span><span class="keyword">(</span><span class="default">$parameters </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$parameters </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $</span><span class="default">$k </span><span class="keyword">= </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">source</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'cannot execute, script contains errors'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }&nbsp; <br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage example:<br />
<span class="default">&lt;?php<br />
&nbsp; $ls </span><span class="keyword">= new </span><span class="default">SaferScript</span><span class="keyword">(</span><span class="string">'horribleCode();'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$ls</span><span class="keyword">-&gt;</span><span class="default">allowHarmlessCalls</span><span class="keyword">();<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$ls</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">());<br />
&nbsp; </span><span class="default">$ls</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Of course it is not entirely safe, but it's a start ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73940""></a>
  <div class="note">
   <strong class="user">kai dot chan at kaisystems dot co dot uk</strong>
   <a href="#73940" class="date">16-Mar-2007 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since JSON started becoming popular. I've started applying the same idea to PHP arrays. Its an alternative to using XML or CSV. For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$from_external_source </span><span class="keyword">= </span><span class="string">'( "a" =&gt; "1", "b" =&gt; array( "b1" =&gt; "2", "b2" =&gt; "3" ) )'</span><span class="keyword">;<br />
<br />
eval( </span><span class="string">'$external_source_as_array = array'</span><span class="keyword">.</span><span class="default">$from_external_source</span><span class="keyword">.</span><span class="string">';' </span><span class="keyword">);<br />
<br />
if ( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$external_source_as_array </span><span class="keyword">) ) {<br />
<br />
</span><span class="comment">// now you can work with the external source as an array<br />
</span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$external_source_as_array </span><span class="keyword">);<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span>It can be less verbose than XML, but provide more meta data than CSV, and unlike CSV, data ordering is not an issue.<br />
<br />
I used it when I wanted to store log data externally in a text file.<br />
<br />
Kai</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72343""></a>
  <div class="note">
   <strong class="user">f dot boender at electricmonk dot nl</strong>
   <a href="#72343" class="date">15-Jan-2007 12:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Errors that occur in evaluated code are hard to catch. burninleo at gmx dot net posted some code below that will buffer the output of the evaluated code and search the output for errors. Another way you can do this would be using a custom error handler that's only in effect during the eval() of the code. A very (very) crude example:<br />
<br />
<span class="default">&lt;?php<br />
$errors </span><span class="keyword">= array();<br />
function </span><span class="default">error_hndl</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$errors</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errors</span><span class="keyword">[] = array(</span><span class="string">"errno"</span><span class="keyword">=&gt;</span><span class="default">$errno</span><span class="keyword">, </span><span class="string">"errstr"</span><span class="keyword">=&gt;</span><span class="default">$errstr</span><span class="keyword">);<br />
}<br />
function </span><span class="default">evale </span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$errors</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$orig_hndl </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"error_hndl"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$code</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">restore_error_handler</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="default">evale</span><span class="keyword">(</span><span class="string">'print("foo" . $bar);'</span><span class="keyword">); </span><span class="comment">// Undefined variable: bar<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$errors</span><span class="keyword">);<br />
<br />
</span><span class="comment">//fooarray(1) {<br />
//&nbsp; [0]=&gt;<br />
//&nbsp; array(2) {<br />
//&nbsp; &nbsp; ["errno"]=&gt;<br />
//&nbsp; &nbsp; int(8)<br />
//&nbsp; &nbsp; ["errstr"]=&gt;<br />
//&nbsp; &nbsp; string(23) "Undefined variable: bar"<br />
//&nbsp; }<br />
//}<br />
</span><span class="default">?&gt;<br />
</span><br />
This will however not catch syntax errors in the code you're trying to eval. This can cause your script to stop with a fatal error inside the eval(). You can catch syntax errors using the Parsekit PECL extension. The parsekit_compile_string() function will try to compile a piece of PHP code and will catch syntax errors if they occur. To extend the earlier piece of code:<br />
<br />
<span class="default">&lt;?php<br />
$errors </span><span class="keyword">= array();<br />
function </span><span class="default">error_hndl</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$errors</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errors</span><span class="keyword">[] = array(</span><span class="string">"errno"</span><span class="keyword">=&gt;</span><span class="default">$errno</span><span class="keyword">, </span><span class="string">"errstr"</span><span class="keyword">=&gt;</span><span class="default">$errstr</span><span class="keyword">);<br />
}<br />
function </span><span class="default">evale </span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$errors</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">= array(); </span><span class="comment">// Reset errors<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$orig_hndl </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"error_hndl"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">parsekit_compile_string</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">, &amp;</span><span class="default">$errors</span><span class="keyword">, </span><span class="default">PARSEKIT_QUIET</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$code</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">restore_error_handler</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$errors</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if (!</span><span class="default">evale</span><span class="keyword">(</span><span class="string">'print("foo . $bar);'</span><span class="keyword">)) { </span><span class="comment">// syntax error, unexpected $end (no closing double quote)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$errors</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
(NOTE: Please do not use the code above directly in your program. It's merely a proof-of-concept).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70292""></a>
  <div class="note">
   <strong class="user">Dale Kern, Salt Lake City</strong>
   <a href="#70292" class="date">10-Oct-2006 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to get eval()&nbsp; to run a string as if it were from an include file, try this:<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">eval(</span><span class="string">"?&gt;"</span><span class="keyword">.</span><span class="default">$string</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
Eval starts in PHP Script mode, break into html mode first thing and you're done.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68312""></a>
  <div class="note">
   <strong class="user">Nova912</strong>
   <a href="#68312" class="date">21-Jul-2006 01:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well let me just start off by saying that eval(); confused the heck out of me untill I read that you can use Return.<br />
<br />
This will help anyone who wants to "Inject" code into an IF statement. My example is a survey site, some questions are required, some are only required if others are checked. So let me share with you my dynamic script and show you how I was able to make a Dynamic IF Statement.<br />
<br />
The code below had been altered to be understandable.<br />
<span class="default">&lt;?php<br />
$survey_number </span><span class="keyword">= </span><span class="default">3 </span><span class="comment">// The third survey. (Out of 10 Surveys)<br />
</span><span class="default">$rq</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] = array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">,</span><span class="default">13</span><span class="keyword">,</span><span class="default">15</span><span class="keyword">,</span><span class="default">17</span><span class="keyword">,</span><span class="default">19</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">); </span><span class="comment">// Required Questions&nbsp; for Survey 3 - Some of these can not be "NULL" (not NULL) or they will stop the script from going any further. (In my script I replaced any questions that were not answered with "NULL" using a for loop based on the number of questions in the survey)<br />
</span><span class="default">$aa</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">4</span><span class="keyword">] = </span><span class="string">' &amp;&amp; '</span><span class="keyword">.</span><span class="default">$q</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">].</span><span class="string">' == "1"'</span><span class="keyword">; </span><span class="comment">// Added Arguments - 3 = Survey 3's Arguments, 4= Argument belongs to question 4, $q[1-20] (20 Questions total in this case.<br />
<br />
//HERE IS THE DYNAMIC IF STATEMENT<br />
</span><span class="default">$count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$rq</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$if_statement </span><span class="keyword">= </span><span class="string">'$q['</span><span class="keyword">.</span><span class="default">$rq</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">].</span><span class="string">'] == "NULL"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$aa</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$rq</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$if_statement </span><span class="keyword">.= </span><span class="default">$aa</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$rq</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(eval(</span><span class="string">"return "</span><span class="keyword">.</span><span class="default">$if_statement</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$rq</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">].</span><span class="string">': Is NULL and IS NOT ok.&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$rq</span><span class="keyword">[</span><span class="default">$survey_number</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">].</span><span class="string">': Is NULL and IS ok.&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
In my experiance with this the Added Argument needs to have an actual value inplanted into the string, it did not work by just putting $q[3], i had to use '.$q[3].' to place the value of question 3 in the string.<br />
<br />
I hope this help someone, I spent so much time trying to figure this out and want to share how something this simple is done.<br />
<br />
Thank you.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67849""></a>
  <div class="note">
   <strong class="user">brettz9 a/- yah00 do/- com</strong>
   <a href="#67849" class="date">05-Jul-2006 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was trying to build a multidimensional array to an unknown dimension (within a loop or "while") and found that eval is, as far as I can tell, the only simple way to solve the problem.<br />
<br />
<span class="default">&lt;?php<br />
$arr </span><span class="keyword">= array(</span><span class="default">2</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="string">"v"</span><span class="keyword">, </span><span class="string">"q"</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">5</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">, </span><span class="string">"g"</span><span class="keyword">), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"x"</span><span class="keyword">));<br />
</span><span class="default">$i</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">;<br />
</span><span class="default">$key1 </span><span class="keyword">= </span><span class="string">"[1]"</span><span class="keyword">;<br />
</span><span class="default">$key2 </span><span class="keyword">= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">; </span><span class="comment">// E.g., could build this conditionally within a loop<br />
</span><span class="default">$key3 </span><span class="keyword">= </span><span class="string">"[2]"</span><span class="keyword">;<br />
<br />
</span><span class="default">$keys </span><span class="keyword">= </span><span class="default">$key1</span><span class="keyword">.</span><span class="default">$key2</span><span class="keyword">.</span><span class="default">$key3</span><span class="keyword">; </span><span class="comment">// Can add as many keys as needed (could be done instead via a loop with repeated calls to .= )<br />
<br />
</span><span class="keyword">print </span><span class="default">$arr</span><span class="keyword">{</span><span class="default">$keys</span><span class="keyword">}; </span><span class="comment">// This does not work<br />
</span><span class="keyword">print </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$keys</span><span class="keyword">]; </span><span class="comment">// This also does not work<br />
<br />
// However...<br />
</span><span class="keyword">eval(</span><span class="string">"\$value = \$arr</span><span class="keyword">{</span><span class="default">$keys</span><span class="keyword">}</span><span class="string">;"</span><span class="keyword">);<br />
print </span><span class="default">$value</span><span class="keyword">; </span><span class="comment">// Correctly prints "g"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66631""></a>
  <div class="note">
   <strong class="user">burninleo at gmx dot net</strong>
   <a href="#66631" class="date">25-May-2006 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The only way to retreive information on parse errors in eval'd code seems to be the output buffering.<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="comment">// Append a return true to php-code to check on errors<br />
</span><span class="default">$code</span><span class="keyword">.= </span><span class="string">"\nreturn true;"</span><span class="keyword">;<br />
</span><span class="comment">// Send any output to buffer<br />
</span><span class="default">ob_start</span><span class="keyword">();<br />
</span><span class="comment">// Do eval()<br />
</span><span class="default">$check </span><span class="keyword">= eval(</span><span class="default">$code</span><span class="keyword">);<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
</span><span class="comment">// Send output or report errors<br />
</span><span class="keyword">if (</span><span class="default">$check </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp; echo </span><span class="default">$output</span><span class="keyword">;<br />
} else {<br />
&nbsp; </span><span class="comment">// Manually parse output for errors and<br />
&nbsp; // generate usable information for the user<br />
&nbsp; // especially content of error-lines.<br />
&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">'/^\s*Parse error\s*:(.+) in (.+) on line (\d+)\s*$/m'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">etc </span><span class="keyword">...<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61247""></a>
  <div class="note">
   <strong class="user">jkuckartz1984 at hotmail dot com</strong>
   <a href="#61247" class="date">29-Jan-2006 04:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Might you have to do eval in if statements, you will find it's quite some task to make it work.<br />
<br />
The only way to make it work is to make a reference to the eval'd variable. This example will show the different usage of eval in if-statements. It simply becomes clear that an eval() in an if() is not working as you want to.<br />
<br />
<span class="default">&lt;?php<br />
$total2</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">;<br />
</span><span class="default">$total3</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$i</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">;<br />
if (eval(</span><span class="string">"\$total"</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"eval: total2 is full&lt;br&gt;"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"eval: total2 is empty&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">// returns "empty"<br />
// eval without the ";" will generate a warning<br />
<br />
</span><span class="default">$str</span><span class="keyword">=</span><span class="string">"\$refer=&amp;\$total"</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">;<br />
eval(</span><span class="default">$str</span><span class="keyword">);<br />
if (</span><span class="default">$refer</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"eval: total2 is full&lt;br&gt;"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"eval: total2 is empty&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">// returns "full"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60953""></a>
  <div class="note">
   <strong class="user">Sarangan Thuraisingham</strong>
   <a href="#60953" class="date">20-Jan-2006 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The eval function can be misused for Cross Site Scripting(XSS) as well. Les say we have this very trivial page that allows a user to enter a text and see it formated using different styles. If the site designer was lazy and used eval function to come up with somethig like this:<br />
<span class="default">&lt;?php<br />
$mytxt </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"text"</span><span class="keyword">];<br />
</span><span class="default">$strFormats </span><span class="keyword">= array( </span><span class="string">'&lt;h1&gt;$mytxt&lt;/h1&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;h2&gt;$mytxt&lt;/h2&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;span class="style1"&gt;$mytxt&lt;/span&gt;'</span><span class="keyword">); </span><span class="comment">//so on<br />
<br />
</span><span class="keyword">foreach (</span><span class="default">$strFormats </span><span class="keyword">as </span><span class="default">$style</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="string">"echo </span><span class="default">$style</span><span class="string">;"</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span>This page could be a target for XSS, because user input is not validated. So the hacker could enter any valid PHP commands and the site will execute it. Imagine what could happen if the injected script reads files like config.php and passed it to the hacker's site.<br />
<br />
If the file permissions are not set correctly, the injected script could modify the current script. A form's action parameter can be set to a hacker's site or worse every transaction could be secretly posted to another website from within the server. Injected script could be something like this:<br />
<span class="default">&lt;?php<br />
$filename</span><span class="keyword">=</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]);<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"a"</span><span class="keyword">);<br />
</span><span class="default">$str </span><span class="keyword">= echo </span><span class="string">"&lt;!-- XSS Vulnerability--&gt;"</span><span class="keyword">; </span><span class="comment">// could be any PHP command<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The golden rule is don't trust the user. Always validate data from the client side.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59862""></a>
  <div class="note">
   <strong class="user">jurgen at person dot be</strong>
   <a href="#59862" class="date">18-Dec-2005 09:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
eval() is used to protect (read: hide) source code. A well known way to encrypt some php code is security through obscurity.&nbsp; Someone used eval(base64_encode(".....")); - which basically had 10-16 nested calls to eval(base64_encode()) inside the data.<br />
<br />
E.g.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">eval(</span><span class="default">gzinflate</span><span class="keyword">(</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="string">'AjHRawIHG1ypUpudV.....'</span><span class="keyword">)));<br />
</span><span class="default">?&gt;<br />
</span><br />
However this can be decoded in this way:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"\nDECODE nested eval(gzinflate()) by DEBO Jurgen &lt;jurgen@person.be&gt;\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"1. Reading coded.txt\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp1&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"coded.txt"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">fread </span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">, </span><span class="default">filesize </span><span class="keyword">(</span><span class="string">"coded.txt"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"2. Decoding\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/eval\(gzinflate/"</span><span class="keyword">,</span><span class="default">$contents</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;\?|\?&gt;/"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/eval/"</span><span class="keyword">, </span><span class="string">"\$contents="</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"3. Writing decoded.txt\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp2 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"decoded.txt"</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59038""></a>
  <div class="note">
   <strong class="user">onlyphp</strong>
   <a href="#59038" class="date">24-Nov-2005 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To simulate the register_globals setting in php.ini, you must put it in the top of your php page:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rg</span><span class="keyword">() {<br />
&nbsp; </span><span class="default">$ar </span><span class="keyword">= array(</span><span class="default">$_POST</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">, </span><span class="default">$_SESSION</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">);<br />
&nbsp; foreach(</span><span class="default">$ar </span><span class="keyword">as </span><span class="default">$ar_</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$ar_as $key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$" </span><span class="keyword">. </span><span class="default">$key </span><span class="keyword">. </span><span class="string">" = \"" </span><span class="keyword">. </span><span class="default">$value </span><span class="keyword">. </span><span class="string">"\";"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56641""></a>
  <div class="note">
   <strong class="user">matt at mattsoft dot net</strong>
   <a href="#56641" class="date">10-Sep-2005 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to load a php file to a variable then execute it, try this<br />
<br />
<span class="default">&lt;?php<br />
$code</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"file.php"</span><span class="keyword">);<br />
</span><span class="default">$code</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="string">'?php'</span><span class="keyword">,</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$code</span><span class="keyword">);<br />
</span><span class="default">$code</span><span class="keyword">=</span><span class="string">'?'</span><span class="keyword">.</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">).</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="string">'?'</span><span class="keyword">;<br />
eval(</span><span class="default">$code</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
using &lt; ?php within eval does not work, but &lt; ? does. in case there is html in the file loaded, the script doesn't remove the &lt; ?php and ? &gt;, but insted adds ? &gt; and &lt; ? around the code loaded from the file. it's simple and works very well. I also broke up the tags in the 3rd and 4th lines of code to keep from having problems if the lines are commented out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56460""></a>
  <div class="note">
   <strong class="user">sadi at unicornsoftbd dot com</strong>
   <a href="#56460" class="date">03-Sep-2005 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I m going to give you my recent exploration about eval. I think you dont need all those complex functions using regex to work HTML in your code. when ever you call eval(), php thinks that it is within &lt;? ?&gt; tags. so all the problem rises. to solve the problem just close your php tag at first of the HTML string, then write the HTML string and then start the php tag.<br />
this is some thing like:<br />
<span class="default">&lt;?php<br />
$teststr</span><span class="keyword">=</span><span class="string">"?&gt;&lt;html&gt;&lt;body&gt;this is the test&lt;/body&gt;&lt;/html&gt;&lt;?php"</span><span class="keyword">;<br />
eval(</span><span class="default">$teststr</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
i think this will work for you. at least this worked for me. if you find any problem with this please reply</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55920""></a>
  <div class="note">
   <strong class="user">zcox522 at gmail dot com</strong>
   <a href="#55920" class="date">17-Aug-2005 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you send headers after you call the eval() function, you may get this error:<br />
<br />
PHP Error: (2) Cannot modify header information - headers already sent by (output started at something...)<br />
<br />
In this case, surround your call to eval() with calls to some ob functions:<br />
<br />
<span class="default">&lt;?php<br />
$eval </span><span class="keyword">= </span><span class="string">"some code you want to execute"</span><span class="keyword">;<br />
<br />
</span><span class="default">ob_start</span><span class="keyword">();<br />
eval(</span><span class="default">$eval</span><span class="keyword">);<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55857""></a>
  <div class="note">
   <strong class="user">admiral [at] nuclearpixel [dot] com</strong>
   <a href="#55857" class="date">15-Aug-2005 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function will take any combination of HTML and (properly opened and closed)PHP that is given in a string, and return a value that is the HTML and the RESULT of that PHP code and return them both combined in the order that they were originally written.<br />
<br />
I tried using both the eval_html(gave me carp about using 's and "s in the HTML) and html_eval2(gave me the results of the PHP first, then all of the HTML afterwards) posted by the other users on this function's notes, but for some reason, neither of them would really work the way I had understood that they would work,(or in the case of some of my code, work at all)<br />
<br />
So I combined the best of what I saw in both, and created eval_html3<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">my_eval</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="string">'echo stripslashes("'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]).</span><span class="string">'");'</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">eval_html3</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">'&lt;?php ?&gt;'</span><span class="keyword">.</span><span class="default">$string</span><span class="keyword">.</span><span class="string">'&lt;?php ?&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">( </span><span class="string">'?&gt;'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">( array( </span><span class="string">'&lt;?php'</span><span class="keyword">, </span><span class="string">'&lt;?' </span><span class="keyword">), </span><span class="string">''</span><span class="keyword">, </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">"/\?&gt;(.*?)(&lt;\?php|&lt;\?)/"</span><span class="keyword">, </span><span class="string">"my_eval"</span><span class="keyword">, </span><span class="default">$string </span><span class="keyword">) ) );<br />
&nbsp;&nbsp;&nbsp; return eval(</span><span class="default">$string</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Good luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55608""></a>
  <div class="note">
   <strong class="user">jphansen at uga dot edu</strong>
   <a href="#55608" class="date">08-Aug-2005 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I used eval() to restore a user's session data. I stored $_SESSION to a field in a database as<br />
<br />
<span class="default">&lt;?php<br />
addslashes</span><span class="keyword">(</span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">))<br />
</span><span class="default">?&gt;<br />
</span><br />
To restore it, I executed this code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">eval(</span><span class="string">"\$_SESSION = </span><span class="default">$session</span><span class="string">;"</span><span class="keyword">);<br />
</span><span class="comment">// $session being the first line of code above<br />
</span><span class="default">?&gt;<br />
</span><br />
Voila! Session restored.<br />
<br />
Without eval(), $_SESSION = $session would have resulted in $_SESSION being a string instead of an array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55313""></a>
  <div class="note">
   <strong class="user">the dank</strong>
   <a href="#55313" class="date">29-Jul-2005 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
$foo1 </span><span class="keyword">= </span><span class="string">"the good,&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$foo2 </span><span class="keyword">= </span><span class="string">"the bad,&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$foo3 </span><span class="keyword">= </span><span class="string">"the ugly."</span><span class="keyword">;<br />
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;=</span><span class="default">3</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp;&nbsp; &nbsp; eval(</span><span class="string">"\$_SESSION['myVar</span><span class="default">$i</span><span class="string">'] = \$foo"</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">//use below to show what's in session:<br />
<br />
</span><span class="keyword">echo </span><span class="string">"&lt;h3&gt;SESSION&lt;/h3&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;table border=1 width=50%&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;tr bgcolor=\"#3399FF\"&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;td&gt;&lt;b&gt;&lt;font color=\"#FFFFFF\"&gt;Variable Name&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;"</span><span class="keyword">; <br />
echo </span><span class="string">"&lt;td&gt;&lt;b&gt;&lt;font color=\"#FFFFFF\"&gt;Value&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">; <br />
while(list(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">)) <br />
{ <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;tr&gt;&lt;td&gt;</span><span class="default">$key</span><span class="string">&lt;/td&gt;&lt;td&gt;&lt;b&gt;</span><span class="default">$val</span><span class="string">&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">; <br />
}<br />
echo </span><span class="string">"&lt;/table&gt;"</span><span class="keyword">;<br />
die();<br />
<br />
</span><span class="comment">/*---------------------------------------------------------<br />
Prints:<br />
myVar1&nbsp; &nbsp; the good,<br />
myVar2&nbsp; &nbsp; the bad,<br />
myVar3&nbsp; &nbsp; the ugly.<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55282""></a>
  <div class="note">
   <strong class="user">privat at timo-damm dot de</strong>
   <a href="#55282" class="date">29-Jul-2005 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using the html_eval() some notes above I experienced problems related to *dirty* html. This function is less critical:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">html_eval2</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">"/&lt;\?php(.*?)\?&gt;/"</span><span class="keyword">,</span><span class="string">"my_eval"</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">my_eval</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">) {<br />
&nbsp; return eval(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Timo</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54114""></a>
  <div class="note">
   <strong class="user">andrejkw</strong>
   <a href="#54114" class="date">23-Jun-2005 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use eval output as a variable without the user seeing the output, use this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
ob_start</span><span class="keyword">();<br />
eval(</span><span class="string">"whatever you want"</span><span class="keyword">);<br />
</span><span class="default">$eval_buffer </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
echo </span><span class="default">$eval_buffer</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Everything that eval produces will now be stored inside $eval_buffer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53960""></a>
  <div class="note">
   <strong class="user">Jesse</strong>
   <a href="#53960" class="date">18-Jun-2005 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a cool way to use eval is to convert strings into variable names.<br />
this is a subsitute for using arrays.<br />
look at this code:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$a</span><span class="keyword">&lt;=</span><span class="default">5</span><span class="keyword">; </span><span class="default">$a</span><span class="keyword">++){<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="string">"$"</span><span class="keyword">.</span><span class="string">"variable"</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span>this will create variables called variable1, variable2, and so on, that are equal to 1, 2, and so on.<br />
i recently used this to help a friend make a Flash game that sent variables like that to PHP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53706""></a>
  <div class="note">
   <strong class="user">1413 at blargh dot com</strong>
   <a href="#53706" class="date">09-Jun-2005 12:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note when using eval and expecting return values - the eval()'ed string must do the returning.&nbsp; Take the following example script:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">ReturnArray</span><span class="keyword">()<br />
{<br />
&nbsp; return array(</span><span class="string">"foo"</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">"bar"</span><span class="keyword">=&gt;</span><span class="default">2</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$test </span><span class="keyword">= eval(</span><span class="string">"ReturnArray();"</span><span class="keyword">);<br />
print(</span><span class="string">"Got back </span><span class="default">$test</span><span class="string"> ("</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">).</span><span class="string">")\n"</span><span class="keyword">);<br />
<br />
</span><span class="default">$test </span><span class="keyword">= eval(</span><span class="string">"return ReturnArray();"</span><span class="keyword">);<br />
print(</span><span class="string">"Got back </span><span class="default">$test</span><span class="string"> ("</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">).</span><span class="string">")\n"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You will get back:<br />
<br />
Got back&nbsp; (0)<br />
Got back Array (2)<br />
<br />
This ran me afoul for a little bit, but is the way eval() is supposed to work (eval is evaluating a new PHP script).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51766""></a>
  <div class="note">
   <strong class="user">jtraenkner</strong>
   <a href="#51766" class="date">10-Apr-2005 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using eval inside loops is very slow, so try avoiding code like<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">10</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="string">'do_something()'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If you absolutely have to, include the entire loop in eval:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">eval(</span><span class="string">'for($i=0;$i&lt;10;$i++) {'</span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'do_something();'</span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'}'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51376""></a>
  <div class="note">
   <strong class="user">tom</strong>
   <a href="#51376" class="date">28-Mar-2005 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Eval can't be used as a callback function so if you want to use the eval function name dynamically use this simple work around:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">$function_name </span><span class="keyword">== </span><span class="string">"eval"</span><span class="keyword">)<br />
{<br />
&nbsp;eval(</span><span class="default">$stuff</span><span class="keyword">);<br />
}<br />
else<br />
{<br />
&nbsp;</span><span class="default">$function_name</span><span class="keyword">(</span><span class="default">$stuff</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51313""></a>
  <div class="note">
   <strong class="user">Ben Grabkowitz</strong>
   <a href="#51313" class="date">26-Mar-2005 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The eval function becomes incredibly useful when dealing with static class members and variables.<br />
<br />
For instance:<br />
<br />
Lets say you have 3 classes; Foo, BarA and BarB, where BarA and BarB are children of Foo.<br />
<br />
Now lets also say that both BarA and BarB contain a static member function called getDataSource().<br />
<br />
To call getDataSource() you would have to use the syntax:<br />
<br />
<span class="default">&lt;?php<br />
BarA</span><span class="keyword">::</span><span class="default">getDataSource</span><span class="keyword">();<br />
</span><span class="default">BarB</span><span class="keyword">::</span><span class="default">getDataSource</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
But lets say you need to access getDataSource() from inside class Foo during an instance of either BarA or BarB.<br />
<br />
You can use eval to do something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">eval(</span><span class="string">'$dataSource=' </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">) . </span><span class="string">'::getDataSource();'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50421""></a>
  <div class="note">
   <strong class="user">francois at bonzon dot com</strong>
   <a href="#50421" class="date">27-Feb-2005 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An obvious security reminder, which I think wasn't yet mentioned here. Special care is required when variables entered by the user are passed to the eval() function. You should validate those user inputs, and really make sure they have the format you expect.<br />
<br />
E.g., if you evaluate math expressions with something like<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">eval(</span><span class="string">"\$result = </span><span class="default">$equation</span><span class="string">;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
without any check on the $equation variable, a bad user could enter in the $equation field<br />
<br />
""; echo file_get_contents('/etc/passwd')<br />
<br />
- or whatever PHP code he wants! - which would evaluate to<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $result </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; echo </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'/etc/passwd'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and seriously compromising your security!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49804""></a>
  <div class="note">
   <strong class="user">avenger at buynet dot com dot br</strong>
   <a href="#49804" class="date">08-Feb-2005 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a small code that uses 'eval' with a foreach (maybe 'for' loop), to fill variables. This is very useful in some hard situations:<br />
<br />
&lt;html&gt;&lt;title&gt;for loop&lt;/title&gt;&lt;body&gt;&lt;p align=center&gt;<br />
&nbsp;<span class="default">&lt;?php<br />
&nbsp; $thing </span><span class="keyword">= array(</span><span class="string">"a"</span><span class="keyword">,</span><span class="string">"b"</span><span class="keyword">,</span><span class="string">"c"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="string">"bah" </span><span class="keyword">; </span><span class="default">$b </span><span class="keyword">= </span><span class="string">"bleh2"</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">= </span><span class="string">"bluh3"</span><span class="keyword">;<br />
&nbsp; print(</span><span class="string">"Vars b4: </span><span class="default">$a</span><span class="string">, </span><span class="default">$b</span><span class="string">, </span><span class="default">$c</span><span class="string">. "</span><span class="keyword">);<br />
&nbsp; foreach ( </span><span class="default">$thing </span><span class="keyword">as </span><span class="default">$thingy </span><span class="keyword">) {<br />
&nbsp;&nbsp; print(</span><span class="string">"</span><span class="default">$thingy</span><span class="string">, "</span><span class="keyword">);<br />
&nbsp;&nbsp; eval(</span><span class="string">"\$</span><span class="default">$thingy</span><span class="string"> = \"</span><span class="default">$thingy</span><span class="string">\";"</span><span class="keyword">);<br />
&nbsp; };<br />
&nbsp; print(</span><span class="string">"vars aft: </span><span class="default">$a</span><span class="string">, </span><span class="default">$b</span><span class="string">, </span><span class="default">$c</span><span class="string">."</span><span class="keyword">);<br />
&nbsp;</span><span class="default">?&gt;<br />
</span>&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48378""></a>
  <div class="note">
   <strong class="user">arnico at c4 dot lv</strong>
   <a href="#48378" class="date">21-Dec-2004 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Dynamically loading php pages!<br />
In michael example ( 02-Sep-2004 05:16) is one big problem. Try to load php page with this content :<br />
-----------------------<br />
<span class="default">&lt;?php<br />
<br />
$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
if(</span><span class="default">$a </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">){<br />
<br />
</span><span class="default">?&gt;<br />
</span>&lt;br /&gt;ir?&lt;br /&gt;<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;<br />
</span>------------------------<br />
<br />
Ups? :) maybe easier way is to do something like that ? please comments :<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">eval_html</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\?&gt;(.*?)(&lt;\?php|&lt;\?)/si"</span><span class="keyword">, </span><span class="string">"echo \"\\1\";"</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&lt;?php"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"?&gt;"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; return eval(</span><span class="default">$string</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$filename </span><span class="keyword">= </span><span class="string">"page.php"</span><span class="keyword">;<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
<br />
echo </span><span class="default">eval_html</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The html source will be replaced with echo. and problem is gone :) or there are other problems ? please comments.<br />
<br />
P.S. sorry about my bad English</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46382""></a>
  <div class="note">
   <strong class="user">mahaixing at hotmail dot com</strong>
   <a href="#46382" class="date">08-Oct-2004 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using Dynamic Proxy design pattern we must create a class automaticly. Here is a sample code.<br />
<br />
<span class="default">&lt;?php<br />
$clazz </span><span class="keyword">= </span><span class="string">"class SomeClass { var \$value = 'somevalue'; function show() { echo get_class(\$this);}}"</span><span class="keyword">;<br />
<br />
eval(</span><span class="default">$clazz</span><span class="keyword">);<br />
<br />
</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">SomeClass</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Here output 'somevalue';<br />
</span><span class="keyword">echo </span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Here output 'someclass'<br />
</span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">show</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44760""></a>
  <div class="note">
   <strong class="user">evildictaitor at hotmail dot com</strong>
   <a href="#44760" class="date">15-Aug-2004 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when using eval() on heavy usage sites in PHP 4.0+ as it takes vastly longer to activate due to the limitations of the Zend engine.<br />
<br />
The Zend engine changes the PHP to a binary structure at the START of the file, and then parses it. Every time an eval is called, however, it has to reactivate the parsing procedure and convert the eval()'d code into usable binary format again.<br />
<br />
Basically, if you eval() code, it takes as long as calling a new php page with the same code inside.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44008""></a>
  <div class="note">
   
   <a href="#44008" class="date">12-Jul-2004 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Kepp the following Quote in mind:<br />
<br />
If eval() is the answer, you're almost certainly asking the<br />
wrong question. -- Rasmus Lerdorf, BDFL of PHP</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.die.html">die</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.exit.html">exit</a></div>
 <div class="up"><a href="ref.misc.html">Misc. Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
