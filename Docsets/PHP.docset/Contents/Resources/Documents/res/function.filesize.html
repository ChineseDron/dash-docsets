<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gets file size</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.fileperms.html">fileperms</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.filetype.html">filetype</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.filesize" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">filesize</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">filesize</span> &mdash; <span class="dc-title">Gets file size</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.filesize-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><b>filesize</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$filename</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Gets the size for the given file.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.filesize-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">filename</tt></i></span>
     <dd>

      <p class="para">
       Path to the file.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.filesize-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the size of the file in bytes, or <b><tt>FALSE</tt></b> (and generates an error
   of level <b><tt>E_WARNING</tt></b>) in case of an error.
  </p>
  <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">
    Because PHP&#039;s integer type is signed and many platforms use 32bit integers,
    some filesystem functions may return unexpected results for files which
    are larger than 2GB.
   </span></p></blockquote>
 </div>


 <div class="refsect1 examples" id="refsect1-function.filesize-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2176">
    <p><b>Example #1 <span class="function"><b>filesize()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;outputs&nbsp;e.g.&nbsp;&nbsp;somefile.txt:&nbsp;1024&nbsp;bytes<br /><br /></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">':&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">filesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'&nbsp;bytes'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.filesize-errors">
  <h3 class="title">Errors/Exceptions</h3>
  <p class="para">
Upon failure, an <b><tt>E_WARNING</tt></b> is emitted.
</p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.filesize-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">The results of this
function are cached. See <span class="function"><a href="function.clearstatcache.html" class="function">clearstatcache()</a></span> for
more details.</span></p></blockquote>
  <div class="tip"><b class="tip">Tip</b><p class="simpara">As of PHP 5.0.0, this function
can also be used with <em class="emphasis">some</em> URL wrappers.  Refer to
<a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a> to determine which wrappers support
<span class="function"><a href="function.stat.html" class="function">stat()</a></span> family of functionality.</p></div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.filesize-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.file-exists.html" class="function" rel="rdfs-seeAlso">file_exists()</a> - Checks whether a file or directory exists</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106935""></a>
  <div class="note">
   <strong class="user">yatsynych at gmail dot com</strong>
   <a href="#106935" class="date">19-Dec-2011 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">_format_bytes</span><span class="keyword">(</span><span class="default">$a_bytes</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1024</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$a_bytes </span><span class="keyword">.</span><span class="string">' B'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1048576</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) .</span><span class="string">' KiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1073741824</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1048576</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) . </span><span class="string">' MiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1099511627776</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1073741824</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) . </span><span class="string">' GiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1125899906842624</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1099511627776</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) .</span><span class="string">' TiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1152921504606846976</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1125899906842624</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) .</span><span class="string">' PiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1180591620717411303424</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1152921504606846976</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) .</span><span class="string">' EiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$a_bytes </span><span class="keyword">&lt; </span><span class="default">1208925819614629174706176</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1180591620717411303424</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) .</span><span class="string">' ZiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$a_bytes </span><span class="keyword">/ </span><span class="default">1208925819614629174706176</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) .</span><span class="string">' YiB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106760""></a>
  <div class="note">
   <strong class="user">webmaster at sebastiangrinke dot info</strong>
   <a href="#106760" class="date">04-Dec-2011 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here a little function which provides automated units^^<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">calc_size</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$unit</span><span class="keyword">=</span><span class="string">'a'</span><span class="keyword">,</span><span class="default">$length</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)){</span><span class="default">$size</span><span class="keyword">+=</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);}<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; while(</span><span class="default">$f </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$f</span><span class="keyword">)){</span><span class="default">$size</span><span class="keyword">+=</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$f</span><span class="keyword">);}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$f</span><span class="keyword">) AND </span><span class="default">$f</span><span class="keyword">!=</span><span class="string">'.' </span><span class="keyword">AND </span><span class="default">$f</span><span class="keyword">!=</span><span class="string">'..'</span><span class="keyword">){</span><span class="default">$size</span><span class="keyword">=</span><span class="default">calc_size</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);}<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">){return </span><span class="default">$size</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'b' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">4</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">,</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Byte"&gt;Byte&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'kb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">7</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Kilobyte"&gt;KiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'mb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">10</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Megabyte"&gt;MiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'gb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">13</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Gigabyte"&gt;GiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'tb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">16</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Terabyte"&gt;TiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'pb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">19</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Petabyte"&gt;PiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'eb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">21</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Exabyte"&gt;EiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'zb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &lt; </span><span class="default">24</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Zettabyte"&gt;ZiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'yb' </span><span class="keyword">XOR </span><span class="default">$unit</span><span class="keyword">==</span><span class="string">'a' </span><span class="keyword">AND </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) &gt; </span><span class="default">24</span><span class="keyword">){return </span><span class="default">number_format</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">),</span><span class="default">$length</span><span class="keyword">,</span><span class="string">','</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">).</span><span class="string">' &lt;span title="Yottabyte"&gt;YiB&lt;/span&gt;'</span><span class="keyword">;}<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106569""></a>
  <div class="note">
   <strong class="user">rommel at rommelsantor dot com</strong>
   <a href="#106569" class="date">19-Nov-2011 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Extremely simple function to get human filesize.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">human_filesize</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">, </span><span class="default">$decimals </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$sz </span><span class="keyword">= </span><span class="string">'BKMGTP'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$factor </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">) / </span><span class="default">3</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%.</span><span class="keyword">{</span><span class="default">$decimals</span><span class="keyword">}</span><span class="string">f"</span><span class="keyword">, </span><span class="default">$bytes </span><span class="keyword">/ </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">$factor</span><span class="keyword">)) . @</span><span class="default">$sz</span><span class="keyword">[</span><span class="default">$factor</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106296""></a>
  <div class="note">
   <strong class="user">Dojung Kim</strong>
   <a href="#106296" class="date">25-Oct-2011 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It could be useful for over 2GB files in linux system.<br />
Using awk, I could find real size of its file.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">filesize_n</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= @</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$size </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">system</span><span class="keyword">(</span><span class="string">'ls -al "'</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">.</span><span class="string">'" | awk \'BEGIN {FS=" "}{print $5}\''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">ob_get_clean</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105586""></a>
  <div class="note">
   <strong class="user">stachu540 at gmail dot com</strong>
   <a href="#105586" class="date">30-Aug-2011 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
That is for example how getting filesize with bytes ending.<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">FileSize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$setup </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$FZ </span><span class="keyword">= (</span><span class="default">$file </span><span class="keyword">&amp;&amp; @</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) ? </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) : </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$FS </span><span class="keyword">= array(</span><span class="string">"B"</span><span class="keyword">,</span><span class="string">"kB"</span><span class="keyword">,</span><span class="string">"MB"</span><span class="keyword">,</span><span class="string">"GB"</span><span class="keyword">,</span><span class="string">"TB"</span><span class="keyword">,</span><span class="string">"PB"</span><span class="keyword">,</span><span class="string">"EB"</span><span class="keyword">,</span><span class="string">"ZB"</span><span class="keyword">,</span><span class="string">"YB"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$setup </span><span class="keyword">&amp;&amp; </span><span class="default">$setup </span><span class="keyword">!== </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$FZ</span><span class="keyword">/</span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">$I</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">log</span><span class="keyword">(</span><span class="default">$FZ</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">))), (</span><span class="default">$i </span><span class="keyword">&gt;= </span><span class="default">1</span><span class="keyword">) ? </span><span class="default">2 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">) . </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$FS</span><span class="keyword">[</span><span class="default">$I</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$setup </span><span class="keyword">== </span><span class="string">'INT'</span><span class="keyword">) return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$FZ</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$FZ</span><span class="keyword">/</span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">$setup</span><span class="keyword">), (</span><span class="default">$setup </span><span class="keyword">&gt;= </span><span class="default">1</span><span class="keyword">) ? </span><span class="default">2 </span><span class="keyword">: </span><span class="default">0 </span><span class="keyword">). </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$FS</span><span class="keyword">[</span><span class="default">$setup</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104101""></a>
  <div class="note">
   <strong class="user">swimming at gmx dot de</strong>
   <a href="#104101" class="date">23-May-2011 12:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found the following to be a nice solution (if you are running Windows) for the &gt;4GB problem. Using the Windows internal Scripting.FileSystemObject you can get the file size using the following code:<br />
<br />
<span class="default">&lt;?php<br />
$filesystem </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">'Scripting.FileSystemObject'</span><span class="keyword">); <br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">$filesystem</span><span class="keyword">-&gt;</span><span class="default">GetFile</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">Size</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
The file size will be returned as integer for small files, automatically changing to float for bigger ones. The COM class is part of the PHP core.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103197""></a>
  <div class="note">
   <strong class="user">Alex Aulbach</strong>
   <a href="#103197" class="date">31-Mar-2011 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, that the official IEC-prefix for kilobyte, megabyte and so on are KiB, MiB, TiB and so on.<br />
<br />
See <a href="http://en.wikipedia.org/wiki/Tebibyte" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Tebibyte</a><br />
<br />
At first glance this may sound like "What the hell? Everybody knows, that we mean 1024 not 1000 and the difference is not too big, so what?". But in about 10 years, the size of harddisks (and files on them) reaches the petabyte-limit and then the difference between PB and PiB is magnificent.<br />
<br />
Better to get used to it now. :)<br />
<br />
(I added the same note a view days before in <a href="http://php.net/manual/en/function.memory-get-usage.php and found it might be also useful here" rel="nofollow" target="_blank">http://php.net/manual/en/function.memory-get-usage.php and found it might be also useful here</a>)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102135""></a>
  <div class="note">
   <strong class="user">arne_elster at web dot de</strong>
   <a href="#102135" class="date">28-Jan-2011 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function that determines a file's size only with PHP functions,<br />
for all files, also those &gt; 4 GB:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">fsize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// filesize will only return the lower 32 bits of<br />
&nbsp; // the file's size! Make it unsigned.<br />
&nbsp; </span><span class="default">$fmod </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">$fmod </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$fmod </span><span class="keyword">+= </span><span class="default">2.0 </span><span class="keyword">* (</span><span class="default">PHP_INT_MAX </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// find the upper 32 bits<br />
&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$myfile </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// feof has undefined behaviour for big files.<br />
&nbsp; // after we hit the eof with fseek,<br />
&nbsp; // fread may not be able to detect the eof,<br />
&nbsp; // but it also can't read bytes, so use it as an<br />
&nbsp; // indicator.<br />
&nbsp; </span><span class="keyword">while (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$myfile</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) === </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$myfile</span><span class="keyword">, </span><span class="default">PHP_INT_MAX</span><span class="keyword">, </span><span class="default">SEEK_CUR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$myfile</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// $i is a multiplier for PHP_INT_MAX byte blocks.<br />
&nbsp; // return to the last multiple of 4, as filesize has modulo of 4 GB (lower 32 bits)<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">$i </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) </span><span class="default">$i</span><span class="keyword">--;<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// add the lower 32 bit to our PHP_INT_MAX multiplier<br />
&nbsp; </span><span class="keyword">return ((float)(</span><span class="default">$i</span><span class="keyword">) * (</span><span class="default">PHP_INT_MAX </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">)) + </span><span class="default">$fmod</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101996""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#101996" class="date">21-Jan-2011 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you recently appended something to file, and closed it then this method will not show appended data:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// get contents of a file into a string<br />
</span><span class="default">$filename </span><span class="keyword">= </span><span class="string">"/usr/local/something.txt"</span><span class="keyword">;<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>You should insert a call to clearstatcache() before calling filesize()<br />
I've spent two hours to find that =/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101883""></a>
  <div class="note">
   <strong class="user">frank (at) haua dot net</strong>
   <a href="#101883" class="date">15-Jan-2011 06:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have a cli script running that use the filesize function on a ssh2_sftp connection. It has the &gt;2Gb limit issue, while it does not have that issue locally. I have managed to get around this by doing a "du -sb" command through ssh2_shell.<br />
<br />
The following function takes the ssh2_connect resource and the path as input. It may not be neat, but it solves the problem for the moment.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fSSHFileSize</span><span class="keyword">(</span><span class="default">$oConn</span><span class="keyword">, </span><span class="default">$sPath</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$oShell </span><span class="keyword">= @</span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$oConn</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">500</span><span class="keyword">, </span><span class="default">24</span><span class="keyword">, </span><span class="default">SSH2_TERM_UNIT_CHARS</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$oShell</span><span class="keyword">, </span><span class="string">"du -sb '"</span><span class="keyword">.</span><span class="default">$sPath</span><span class="keyword">.</span><span class="string">"'"</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$sLine </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$oShell</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aResult</span><span class="keyword">[] = </span><span class="default">$sLine</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$oShell</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iSize </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$aResult</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sTemp </span><span class="keyword">= </span><span class="default">$aResult</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$aResult</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sSize </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$sTemp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$sTemp</span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">9</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$sSize</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iTemp </span><span class="keyword">= (int)</span><span class="default">$sSize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$iTemp </span><span class="keyword">&gt; </span><span class="string">"2000000000"</span><span class="keyword">) </span><span class="default">$iSize </span><span class="keyword">= </span><span class="default">$iTemp</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$iSize</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100434""></a>
  <div class="note">
   <strong class="user">jasondblount (at gmail)</strong>
   <a href="#100434" class="date">15-Oct-2010 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Find filesize of any file ( &gt;2GB works fine )<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ffilesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$data </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Content-Length: (\d+)/'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (float)</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100097""></a>
  <div class="note">
   <strong class="user">joaoptm78 at gmail dot com</strong>
   <a href="#100097" class="date">24-Sep-2010 11:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
And this is my short and very clever simple function. Faster than some of the examples below.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">format_bytes</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$units </span><span class="keyword">= array(</span><span class="string">' B'</span><span class="keyword">, </span><span class="string">' KB'</span><span class="keyword">, </span><span class="string">' MB'</span><span class="keyword">, </span><span class="string">' GB'</span><span class="keyword">, </span><span class="string">' TB'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$size </span><span class="keyword">&gt;= </span><span class="default">1024 </span><span class="keyword">&amp;&amp; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$size </span><span class="keyword">/= </span><span class="default">1024</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">).</span><span class="default">$units</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You can add more units to the $units array and change the number 4 in "$i &lt; 4" accordingly.<br />
<br />
But if you want it really fast try this not-so-neat function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">format_bytes</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) {<br />
&nbsp;&nbsp; if (</span><span class="default">$bytes </span><span class="keyword">&lt; </span><span class="default">1024</span><span class="keyword">) return </span><span class="default">$bytes</span><span class="keyword">.</span><span class="string">' B'</span><span class="keyword">;<br />
&nbsp;&nbsp; elseif (</span><span class="default">$bytes </span><span class="keyword">&lt; </span><span class="default">1048576</span><span class="keyword">) return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$bytes </span><span class="keyword">/ </span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">).</span><span class="string">' KB'</span><span class="keyword">;<br />
&nbsp;&nbsp; elseif (</span><span class="default">$bytes </span><span class="keyword">&lt; </span><span class="default">1073741824</span><span class="keyword">) return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$bytes </span><span class="keyword">/ </span><span class="default">1048576</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">).</span><span class="string">' MB'</span><span class="keyword">;<br />
&nbsp;&nbsp; elseif (</span><span class="default">$bytes </span><span class="keyword">&lt; </span><span class="default">1099511627776</span><span class="keyword">) return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$bytes </span><span class="keyword">/ </span><span class="default">1073741824</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">).</span><span class="string">' GB'</span><span class="keyword">;<br />
&nbsp;&nbsp; else return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$bytes </span><span class="keyword">/ </span><span class="default">1099511627776</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">).</span><span class="string">' TB'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I guess you can do it in 1000 different ways :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99333""></a>
  <div class="note">
   <strong class="user">eric heudiard</strong>
   <a href="#99333" class="date">11-Aug-2010 07:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's very interesting but I can't stand the decimals for bytes and KB so here's another example :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$sizes </span><span class="keyword">= array(</span><span class="string">" Bytes"</span><span class="keyword">, </span><span class="string">" KB"</span><span class="keyword">, </span><span class="string">" MB"</span><span class="keyword">, </span><span class="string">" GB"</span><span class="keyword">, </span><span class="string">" TB"</span><span class="keyword">, </span><span class="string">" PB"</span><span class="keyword">, </span><span class="string">" EB"</span><span class="keyword">, </span><span class="string">" ZB"</span><span class="keyword">, </span><span class="string">" YB"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$size </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) { return(</span><span class="string">'n/a'</span><span class="keyword">); } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (</span><span class="default">round</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">/</span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">log</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)))), </span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">1 </span><span class="keyword">? </span><span class="default">2 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">) . </span><span class="default">$sizes</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]); }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98981""></a>
  <div class="note">
   <strong class="user">biolanor at googlemail dot com</strong>
   <a href="#98981" class="date">20-Jul-2010 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a short and very clever function to get filesizes.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$sizes </span><span class="keyword">= array(</span><span class="string">" Bytes"</span><span class="keyword">, </span><span class="string">" KB"</span><span class="keyword">, </span><span class="string">" MB"</span><span class="keyword">, </span><span class="string">" GB"</span><span class="keyword">, </span><span class="string">" TB"</span><span class="keyword">, </span><span class="string">" PB"</span><span class="keyword">, </span><span class="string">" EB"</span><span class="keyword">, </span><span class="string">" ZB"</span><span class="keyword">, </span><span class="string">" YB"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$size </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) { return(</span><span class="string">'n/a'</span><span class="keyword">); } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (</span><span class="default">round</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">/</span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">log</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)))), </span><span class="default">2</span><span class="keyword">) . </span><span class="default">$sizes</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]); }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98477""></a>
  <div class="note">
   <strong class="user">martinjohn dot sweeny at gmail dot com</strong>
   <a href="#98477" class="date">17-Jun-2010 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a quick function for getting a nicer filesize from a number:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">formatBytes</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">,</span><span class="default">$p </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * @author Martin Sweeny<br />
&nbsp;&nbsp; &nbsp; * @version 2010.0617<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * returns formatted number of bytes. <br />
&nbsp;&nbsp; &nbsp; * two parameters: the bytes and the precision (optional).<br />
&nbsp;&nbsp; &nbsp; * if no precision is set, function will determine clean<br />
&nbsp;&nbsp; &nbsp; * result automatically.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; **/<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$units </span><span class="keyword">= array(</span><span class="string">"B"</span><span class="keyword">,</span><span class="string">"kB"</span><span class="keyword">,</span><span class="string">"MB"</span><span class="keyword">,</span><span class="string">"GB"</span><span class="keyword">,</span><span class="string">"TB"</span><span class="keyword">,</span><span class="string">"PB"</span><span class="keyword">,</span><span class="string">"EB"</span><span class="keyword">,</span><span class="string">"ZB"</span><span class="keyword">,</span><span class="string">"YB"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$p </span><span class="keyword">&amp;&amp; </span><span class="default">$p </span><span class="keyword">!== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$units </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$u</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$b </span><span class="keyword">/ </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">,</span><span class="default">$k</span><span class="keyword">)) &gt;= </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">[</span><span class="string">"bytes"</span><span class="keyword">] = </span><span class="default">$b </span><span class="keyword">/ </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">,</span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">[</span><span class="string">"units"</span><span class="keyword">] = </span><span class="default">$u</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">[</span><span class="string">"bytes"</span><span class="keyword">],</span><span class="default">2</span><span class="keyword">) . </span><span class="string">" " </span><span class="keyword">. </span><span class="default">$r</span><span class="keyword">[</span><span class="string">"units"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$b </span><span class="keyword">/ </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">,</span><span class="default">$p</span><span class="keyword">)) . </span><span class="string">" " </span><span class="keyword">. </span><span class="default">$units</span><span class="keyword">[</span><span class="default">$p</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo </span><span class="default">formatBytes</span><span class="keyword">(</span><span class="default">81000000</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//returns 77.25 MB<br />
</span><span class="keyword">echo </span><span class="default">formatBytes</span><span class="keyword">(</span><span class="default">81000000</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">); </span><span class="comment">//returns 81,000,000 B<br />
</span><span class="keyword">echo </span><span class="default">formatBytes</span><span class="keyword">(</span><span class="default">81000000</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); </span><span class="comment">//returns 79,102 kB<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Feel free to email me if you can think of improvements!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97437""></a>
  <div class="note">
   <strong class="user">jbudpro at comcast dot net</strong>
   <a href="#97437" class="date">19-Apr-2010 03:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Get a real filesize value, return as a string, this way it will not have the same effect as filesize() returning an integer that will be limited by 32-bit php systems. Return can be cast to a (float) to work perfectly for files over 2GB<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// WINDOWS SERVERS:<br />
// str ntfs_filesize( str $filename );<br />
/*<br />
DESCRIPTION: returns the filesize of a large file in string format to... <br />
... prevent 32-bit integer walls using windows command line.<br />
*/<br />
</span><span class="keyword">function </span><span class="default">ntfs_filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for %v in (\""</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">.</span><span class="string">"\") do @echo %~zv<br />
&nbsp;&nbsp;&nbsp; "</span><span class="keyword">);<br />
}<br />
</span><span class="comment">// LINUX SERVERS:<br />
// str perl_filesize( str $filename );<br />
/*<br />
DESCRIPTION: returns the filesize of a large file in string format to... <br />
... prevent 32-bit integer walls&nbsp; using perl through linux command line.<br />
*/<br />
</span><span class="keyword">function </span><span class="default">perl_filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; perl -e 'printf \"%d\n\",(stat(shift))[7];' "</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">.</span><span class="string">"<br />
&nbsp;&nbsp;&nbsp; "</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// WARNING: For files over 2GB casting integers may give false values, to prevent this cast to a (float):<br />
<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">"C:/my6GBmovie.avi"</span><span class="keyword">; </span><span class="comment">// proper filesize: 6442450944 bytes<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">ntfs_filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">// output: string(10) "6442450944"<br />
</span><span class="default">var_dump</span><span class="keyword">((int)</span><span class="default">ntfs_filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)); </span><span class="comment">// output: int(2147483647)<br />
</span><span class="default">var_dump</span><span class="keyword">((float)</span><span class="default">ntfs_filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)); </span><span class="comment">// output: float(6442450944)<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94566""></a>
  <div class="note">
   <strong class="user">itsrool at gmail dot com</strong>
   <a href="#94566" class="date">12-Nov-2009 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My solution for calculating the directory size:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Get the directory size<br />
&nbsp;* @param directory $directory<br />
&nbsp;* @return integer<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">dirSize</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(new </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">(new </span><span class="default">RecursiveDirectoryIterator</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)) as </span><span class="default">$file</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size</span><span class="keyword">+=</span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">getSize</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92462""></a>
  <div class="note">
   <strong class="user">tmont</strong>
   <a href="#92462" class="date">25-Jul-2009 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's the best way (that I've found) to get the size of a remote file. Note that HEAD requests don't get the actual body of the request, they just retrieve the headers. So making a HEAD request to a resource that is 100MB will take the same amount of time as a HEAD request to a resource that is 1KB.<br />
<br />
<span class="default">&lt;?php<br />
$remoteFile </span><span class="keyword">= </span><span class="string">'<a href="http://us.php.net/get/php-5.2.10.tar.bz2/from/this/mirror" rel="nofollow" target="_blank">http://us.php.net/get/php-5.2.10.tar.bz2/from/this/mirror</a>'</span><span class="keyword">;<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$remoteFile</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">//not necessary unless the file redirects (like the PHP example we're using here)<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
if (</span><span class="default">$data </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp; echo </span><span class="string">'cURL failed'</span><span class="keyword">;<br />
&nbsp; exit;<br />
}<br />
<br />
</span><span class="default">$contentLength </span><span class="keyword">= </span><span class="string">'unknown'</span><span class="keyword">;<br />
</span><span class="default">$status </span><span class="keyword">= </span><span class="string">'unknown'</span><span class="keyword">;<br />
if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^HTTP\/1\.[01] (\d\d\d)/'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp; </span><span class="default">$status </span><span class="keyword">= (int)</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
}<br />
if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Content-Length: (\d+)/'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp; </span><span class="default">$contentLength </span><span class="keyword">= (int)</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
}<br />
<br />
echo </span><span class="string">'HTTP Status: ' </span><span class="keyword">. </span><span class="default">$status </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">$contentLength</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Result:<br />
<br />
HTTP Status: 302<br />
Content-Length: 8808759</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92418""></a>
  <div class="note">
   <strong class="user">Svetoslav Marinov</strong>
   <a href="#92418" class="date">23-Jul-2009 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an updated version of my previous filesize2bytes.<br />
The return type now it's really an int.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Converts human readable file size (e.g. 10 MB, 200.20 GB) into bytes.<br />
&nbsp;*<br />
&nbsp;* @param string $str<br />
&nbsp;* @return int the result is in bytes<br />
&nbsp;* @author Svetoslav Marinov<br />
&nbsp;* @author <a href="http://slavi.biz" rel="nofollow" target="_blank">http://slavi.biz</a><br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">filesize2bytes</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes_array </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'B' </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'KB' </span><span class="keyword">=&gt; </span><span class="default">1024</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'MB' </span><span class="keyword">=&gt; </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'GB' </span><span class="keyword">=&gt; </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'TB' </span><span class="keyword">=&gt; </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'PB' </span><span class="keyword">=&gt; </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#([KMGTP]?B)$#si'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">) &amp;&amp; !empty(</span><span class="default">$bytes_array</span><span class="keyword">[</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">*= </span><span class="default">$bytes_array</span><span class="keyword">[</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">round</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$bytes</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91477""></a>
  <div class="note">
   <strong class="user">nak5ive at DONT-SPAM-ME dot gmail dot com</strong>
   <a href="#91477" class="date">11-Jun-2009 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a quick way to convert bytes to a more readable format can be done using this function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">formatBytes</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">, </span><span class="default">$precision </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$units </span><span class="keyword">= array(</span><span class="string">'B'</span><span class="keyword">, </span><span class="string">'KB'</span><span class="keyword">, </span><span class="string">'MB'</span><span class="keyword">, </span><span class="string">'GB'</span><span class="keyword">, </span><span class="string">'TB'</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pow </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">$bytes </span><span class="keyword">? </span><span class="default">log</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) : </span><span class="default">0</span><span class="keyword">) / </span><span class="default">log</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pow </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$pow</span><span class="keyword">, </span><span class="default">count</span><span class="keyword">(</span><span class="default">$units</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">/= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">$pow</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">, </span><span class="default">$precision</span><span class="keyword">) . </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$units</span><span class="keyword">[</span><span class="default">$pow</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90913""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#90913" class="date">16-May-2009 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Shortest solution to get filesize of a remote website<br />
<br />
<span class="default">&lt;?php<br />
<br />
$content </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>"</span><span class="keyword">);<br />
<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"example-com.html"</span><span class="keyword">, </span><span class="string">"w+"</span><span class="keyword">);<br />
<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">);<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
<br />
echo </span><span class="default">size </span><span class="keyword">. </span><span class="string">': ' </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="string">'example-com.html'</span><span class="keyword">) . </span><span class="string">' bytes'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88787""></a>
  <div class="note">
   <strong class="user">hedora at web dot de</strong>
   <a href="#88787" class="date">07-Feb-2009 06:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
reliably, quick &amp; dirty:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getdirsize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">,</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"du -hs "</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">),</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$result</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]==</span><span class="default">$path </span><span class="keyword">? </span><span class="default">$result</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] : </span><span class="string">"error"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88516""></a>
  <div class="note">
   <strong class="user">bs_hck at bk dot ru</strong>
   <a href="#88516" class="date">27-Jan-2009 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Fix 4Gb limit. ( Now limit 8 Gb ;))<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">GetRealSize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return size in Mb<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$INT </span><span class="keyword">= </span><span class="default">4294967295</span><span class="keyword">;</span><span class="comment">//2147483647+2147483647+1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)==</span><span class="default">0</span><span class="keyword">) </span><span class="default">$size </span><span class="keyword">+= </span><span class="default">$INT</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$size</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$size </span><span class="keyword">+= </span><span class="default">$INT</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">/</span><span class="default">1024</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87163""></a>
  <div class="note">
   <strong class="user">7r6ivyeo at mail dot com</strong>
   <a href="#87163" class="date">21-Nov-2008 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use the CLI version of PHP on Windows Vista and work with large (~ 10G) Virtual Machine files.&nbsp; Here's how to get a NTFS file's size without the 4G limit:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">dos_filesize</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">exec</span><span class="keyword">(</span><span class="string">'FOR %A IN ("'</span><span class="keyword">.</span><span class="default">$fn</span><span class="keyword">.</span><span class="string">'") DO @ECHO %~zA'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'0'</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This should work on any Windows OS that provides DOS shell commands.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85768""></a>
  <div class="note">
   <strong class="user">revoke</strong>
   <a href="#85768" class="date">16-Sep-2008 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way for remote files -&gt; strlen(join('',file('<a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>)));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84130""></a>
  <div class="note">
   <strong class="user">Supermagnus</strong>
   <a href="#84130" class="date">30-Jun-2008 03:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getSizeFile</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)==</span><span class="string">'http'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">array_change_key_case</span><span class="keyword">(</span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">),</span><span class="default">CASE_LOWER</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">'HTTP/1.1 200 OK'</span><span class="keyword">) != </span><span class="default">0 </span><span class="keyword">) { </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">[</span><span class="string">'content-length'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">[</span><span class="string">'content-length'</span><span class="keyword">]; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else { </span><span class="default">$x </span><span class="keyword">= @</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$x</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
In case of you have a redirection in the server (like Redirect Permanent in the .htaccess)<br />
<br />
In this case we have for exemple:<br />
&nbsp;&nbsp;&nbsp; [content-length] =&gt; Array<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 294&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Size requested file<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 357556&nbsp; &nbsp;&nbsp; // Real Size redirected file<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81528""></a>
  <div class="note">
   <strong class="user">ronnie at logicalt dot com</strong>
   <a href="#81528" class="date">02-Mar-2008 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another workaround for the &gt;2GB "stat failed" in Linux is to call the systems stat as follows:<br />
<br />
$size = exec ('stat -c %s '. escapeshellarg ($file_path));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80959""></a>
  <div class="note">
   <strong class="user">jason dot whitehead dot tas at gmail dot com</strong>
   <a href="#80959" class="date">08-Feb-2008 03:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have created a handy function, using parts of code from kaspernj at gmail dot com and md2perpe at gmail dot com, which should get file sizes &gt; 4GB on Windows, Linux and Mac&nbsp; (at least).<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">getSize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$size </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">PHP_OS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) == </span><span class="string">'WIN'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(`</span><span class="string">stat -c%s </span><span class="default">$file</span><span class="keyword">`);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fsobj </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"Scripting.FileSystemObject"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="default">$fsobj</span><span class="keyword">-&gt;</span><span class="default">GetFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">Size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79023""></a>
  <div class="note">
   <strong class="user">webmaster at eclipse org</strong>
   <a href="#79023" class="date">07-Nov-2007 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On 64-bit platforms, this seems quite reliable for getting the filesize of files &gt; 4GB<br />
<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);<br />
</span><span class="default">$filesize </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78518""></a>
  <div class="note">
   <strong class="user">MagicalTux at gmail dot com</strong>
   <a href="#78518" class="date">15-Oct-2007 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
filesize() acts differently between platforms and distributions.<br />
<br />
I tried manually compiling PHP on a 32bit platform. Filesize() would fail on files &gt;2G.<br />
<br />
Then I compiled again, adding CFLAGS=`getconf LFS_CFLAGS` in front of configure.<br />
<br />
Then filesize() would success, but the result would be converted to a 32bit signed integer...<br />
<br />
However on 64bit systems, PHP's integers are 64bit signed, and this would work just well...<br />
<br />
So now the question is : should linux distributions (Debian, etc) define LFS_CFLAGS or not ? Doing so makes PHP be able to open/seek such files, but makes its behaviour buggy (stat() is supposed to fail if file size is &gt;32bit and appl does not support such integers)...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76466""></a>
  <div class="note">
   <strong class="user">md2perpe at gmail dot com</strong>
   <a href="#76466" class="date">17-Jul-2007 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way to get a filesize &gt; 2GB on Linux:<br />
<span class="default">&lt;?php<br />
$size </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(`</span><span class="string">stat -c%s </span><span class="default">$file_path</span><span class="keyword">`);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76005""></a>
  <div class="note">
   <strong class="user">Robin Leffmann</strong>
   <a href="#76005" class="date">26-Jun-2007 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a dodgy little snippet I made to find out how much disk space (in 1K-blocks) any chosen node - file or directory - occupies in the file system..<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">nodesize</span><span class="keyword">( </span><span class="default">$node </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">) ) return </span><span class="default">false</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$blah </span><span class="keyword">= </span><span class="default">exec</span><span class="keyword">( </span><span class="string">"/usr/bin/du -sk </span><span class="default">$node</span><span class="string">" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$blah</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$blah</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">) );<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The character I search for with strpos() is a tab, as this is what 'du' on OpenBSD uses to separate size and node in the output - this might be whitespaces in other *nixes/distributions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71098""></a>
  <div class="note">
   <strong class="user">Josh Finlay &lt;josh at glamourcastle dot com&gt;</strong>
   <a href="#71098" class="date">12-Nov-2006 12:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I know there has been alot of remote filesize snippets posted, but I'll post mine also.<br />
<br />
It supports HTTP/HTTPS/FTP/FTPS and detects which type it should use. It needs --enable-ftp for the FTP/FTPS functions.<br />
<br />
I hope this works for someone.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">remotefsize</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sch </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">PHP_URL_SCHEME</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$sch </span><span class="keyword">!= </span><span class="string">"http"</span><span class="keyword">) &amp;&amp; (</span><span class="default">$sch </span><span class="keyword">!= </span><span class="string">"https"</span><span class="keyword">) &amp;&amp; (</span><span class="default">$sch </span><span class="keyword">!= </span><span class="string">"ftp"</span><span class="keyword">) &amp;&amp; (</span><span class="default">$sch </span><span class="keyword">!= </span><span class="string">"ftps"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$sch </span><span class="keyword">== </span><span class="string">"http"</span><span class="keyword">) || (</span><span class="default">$sch </span><span class="keyword">== </span><span class="string">"https"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">"Content-Length"</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">))) { return </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">"Content-Length"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$sch </span><span class="keyword">== </span><span class="string">"ftp"</span><span class="keyword">) || (</span><span class="default">$sch </span><span class="keyword">== </span><span class="string">"ftps"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$server </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">PHP_URL_HOST</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">PHP_URL_PORT</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">PHP_URL_PATH</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">PHP_URL_USER</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pass </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">PHP_URL_PASS</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((!</span><span class="default">$server</span><span class="keyword">) || (!</span><span class="default">$path</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$port</span><span class="keyword">) { </span><span class="default">$port </span><span class="keyword">= </span><span class="default">21</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$user</span><span class="keyword">) { </span><span class="default">$user </span><span class="keyword">= </span><span class="string">"anonymous"</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$pass</span><span class="keyword">) { </span><span class="default">$pass </span><span class="keyword">= </span><span class="string">"phpos@"</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$sch</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"ftp"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ftpid </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"ftps"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ftpid </span><span class="keyword">= </span><span class="default">ftp_ssl_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$ftpid</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$login </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$ftpid</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$login</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ftpsize </span><span class="keyword">= </span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftpid</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$ftpid</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ftpsize </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ftpsize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68700""></a>
  <div class="note">
   <strong class="user">rico at ws5 dot org</strong>
   <a href="#68700" class="date">08-Aug-2006 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the size of files above 2GB you can use the linux-command filesize like this:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">real_filesize_linux</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"filesize </span><span class="default">$file</span><span class="string">"</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$ret</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$ret </span><span class="keyword">&lt;&gt; </span><span class="string">'0' </span><span class="keyword">) return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else return(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); <br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68209""></a>
  <div class="note">
   <strong class="user">kaspernj at gmail dot com</strong>
   <a href="#68209" class="date">18-Jul-2006 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to get the actual filesize for a size above 2 gb in Windows, you can use the COM-extensions in PHP.<br />
<br />
An example is as follows:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">knj_filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fsobj </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"Scripting.FileSystemObject"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$fsobj</span><span class="keyword">-&gt;</span><span class="default">GetFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= (</span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">Size</span><span class="keyword">) + </span><span class="default">1 </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$var</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"File does not exist.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
This will return the corrent filesize. And it is very useful with PHP-GTK applications, where you want to use the filesize for larger files.<br />
<br />
This example also works for files over a Windows-network. Try this example with the function:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">knj_filesize</span><span class="keyword">(</span><span class="string">"//mycomputer/music/Track1.mp3"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Happy hacking :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64450""></a>
  <div class="note">
   <strong class="user">core58 at mail dot ru</strong>
   <a href="#64450" class="date">14-Apr-2006 08:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
some notes and modifications to previous post.<br />
refering to RFC, when using HTTP/1.1 your request (either GET or POST or HEAD) must contain Host header string, opposite to HTTP/1.1 where Host ain't required. but there's no sure how your remote server would treat the request so you can add Host anyway (it won't be an error for HTTP/1.0).<br />
host value _must_ be a host name (not CNAME and not IP address).<br />
<br />
this function catches response, containing Location header and recursively sends HEAD request to host where we are moved until final response is met.<br />
(you can experience such redirections often when downloading something from php scripts or some hash links that use apache mod_rewrite. most all of dowloading masters handle 302 redirects correctly, so this code does it too (running recursively thru 302 redirections).)<br />
<br />
[$counter302] specify how much times your allow this function to jump if redirections are met. If initial limit (5 is default) expired -- it returns 0 (should be modified for your purposes whatever).0<br />
ReadHeader() function is listed in previous post<br />
(param description is placed there too).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">remote_filesize_thru</span><span class="keyword">( </span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">, </span><span class="default">$counter302 </span><span class="keyword">= </span><span class="default">5 </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">( </span><span class="string">"10.233.225.2"</span><span class="keyword">, </span><span class="default">8080 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">$socket </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// failed to open TCP socket connection<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // do something sensible here besides exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;br&gt;failed to open socket for [</span><span class="default">$ipAddress</span><span class="string">]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// just send HEAD request to server<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="string">"HEAD </span><span class="default">$url</span><span class="string"> HTTP/1.0\r\nConnection: Close\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// you may use HTTP/1.1 instead, then your request head string _must_ contain "Host: " header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$head </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// read the response header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">ReadHeader</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">$header </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handle empty response here the way you need...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">( </span><span class="string">"HTTP/1.1 404 Not Found" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// check for "Location" header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$locationMarker </span><span class="keyword">= </span><span class="string">"Location: "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$locationMarker </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$pos </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter302</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$counter302 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// redirect limit (5 by default) expired -- return some warning or do something sensible here<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"warning: too long redirection sequence"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Location is present -- we should determine target host and move there, like any downloading masters do...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // no need to use regex here<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$header</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$location </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$locationMarker </span><span class="keyword">), </span><span class="default">$end </span><span class="keyword">- </span><span class="default">$pos </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$locationMarker </span><span class="keyword">) ), </span><span class="string">"\\r\\n" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// extract pure host (without "<a href="http://" rel="nofollow" target="_blank">http://</a>")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$location </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ipa </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">( </span><span class="default">$host</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// move to Location<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">remote_filesize_thru</span><span class="keyword">( </span><span class="default">$ipa</span><span class="keyword">, </span><span class="default">$location</span><span class="keyword">, </span><span class="default">$counter302 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// try to acquire Content-Length within the response<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$regex </span><span class="keyword">= </span><span class="string">'/Content-Length:\s([0-9].+?)\s/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regex</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if there was a Content-Length field, its value<br />
&nbsp;&nbsp;&nbsp; // will now be in $matches[1]<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( isset( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64230""></a>
  <div class="note">
   <strong class="user">core58 at mail dot ru</strong>
   <a href="#64230" class="date">10-Apr-2006 05:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is "raw" version of remote_filesize() function.<br />
according to RFC, HTTP servers MUST implement at least GET, POST and HEAD requests, so the function just opens TCP socket connection, sends HEAD request and receives response, parsing length of the resource.<br />
[$ipAddress] is the ip address of remote server.<br />
[$url] is the name of file which size you want to determine.<br />
<br />
the code was tested under Apache 2.0.43 and IIS 6.0 and it works correctly in both cases.<br />
i wish the code can save someone's time :)<br />
<br />
example:<br />
$ipa = gethostbyname( "www.someserver.com" );<br />
$url = "/docs/somedocument.pdf";<br />
<br />
$fsize = remote_filesize2( $ipa, $url );<br />
<br />
==========================<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">ReadHeader</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">true </span><span class="keyword">&amp;&amp; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">20 </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// counter [$i] is used here to avoid deadlock while reading header string<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // it's limited by [20] here cause i really haven't ever met headers with string counter greater than 20<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // *<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">4096 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="default">$s</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">strcmp</span><span class="keyword">( </span><span class="default">$s</span><span class="keyword">, </span><span class="string">"\r\n" </span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">strcmp</span><span class="keyword">( </span><span class="default">$s</span><span class="keyword">, </span><span class="string">"\n" </span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$i </span><span class="keyword">&gt;= </span><span class="default">20 </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// suspicious header strings count was read<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // *<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$header</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">remote_filesize2</span><span class="keyword">( </span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="default">$url </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">( </span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="default">80 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">$socket </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// failed to open TCP socket connection<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // do something sensible here besides exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// just send HEAD request to server<br />
&nbsp;&nbsp;&nbsp; // *<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"HEAD </span><span class="default">$url</span><span class="string"> HTTP/1.0\r\nConnection: Close\r\n\r\n" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// read the response header<br />
&nbsp;&nbsp;&nbsp; // *<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">ReadHeader</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">$header </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">( </span><span class="string">"HTTP/1.1 404 Not Found" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// try to acquire Content-Length within the response<br />
&nbsp;&nbsp;&nbsp; // *<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$regex </span><span class="keyword">= </span><span class="string">'/Content-Length:\s([0-9].+?)\s/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regex</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if there was a Content-Length field, its value<br />
&nbsp;&nbsp;&nbsp; // will now be in $matches[1]<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( isset( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62926""></a>
  <div class="note">
   <strong class="user">mkamerma at science dot uva dot nl</strong>
   <a href="#62926" class="date">12-Mar-2006 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When read/writing binary files you often cannot rely on the feof() function being of much use, since it doesn't get triggered if the pointer is at the eof but hasn't tried to read one more byte. In this case you instead need to check if the file pointer is at filesize yet, but if you don't have the filename handy, you need to pluck it out fstat all the time. Two simple functions that would be nice to have natively in PHP:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">fpfilesize</span><span class="keyword">(&amp;</span><span class="default">$fp</span><span class="keyword">) { </span><span class="default">$stat </span><span class="keyword">= </span><span class="default">fstat</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); return </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">"size"</span><span class="keyword">]; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">fpeof</span><span class="keyword">(&amp;</span><span class="default">$fp</span><span class="keyword">) { return </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)==</span><span class="default">fpfilesize</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54698""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#54698" class="date">12-Jul-2005 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function quickly calculates the size of a directory:<br />
<a href="http://aidanlister.com/repos/v/function.dirsize.php" rel="nofollow" target="_blank">http://aidanlister.com/repos/v/function.dirsize.php</a><br />
<br />
You can convert filesizes to a human readable size using:<br />
<a href="http://aidanlister.com/repos/v/function.size_readable.php" rel="nofollow" target="_blank">http://aidanlister.com/repos/v/function.size_readable.php</a><br />
<br />
For a faster (unix only) implementation, see function.disk-total-space, note #34100<br />
<a href="http://www.php.net/manual/en/function.disk-total-space.php#34100" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.disk-total-space.php#34100</a><br />
<br />
Also of interest is this wikipedia article, discussing the difference between a kilobyte (1000) and a kibibyte (1024).<br />
<a href="http://en.wikipedia.org/wiki/Bytes" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Bytes</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47552""></a>
  <div class="note">
   <strong class="user">bkimble at ebaseweb dot com</strong>
   <a href="#47552" class="date">19-Nov-2004 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to the handy function Kris posted, here is an upgraded version that does basic http authentication as well.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
* (mixed)remote_filesize($uri,$user='',$pw='')<br />
* returns the size of a remote stream in bytes or<br />
* the string 'unknown'. Also takes user and pw<br />
* incase the site requires authentication to access<br />
* the uri<br />
*/<br />
</span><span class="keyword">function </span><span class="default">remote_filesize</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">,</span><span class="default">$user</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">,</span><span class="default">$pw</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// start output buffering<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// initialize curl with given uri<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// make sure we get the header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// make it a http HEAD request<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if auth is needed, do it here<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!empty(</span><span class="default">$user</span><span class="keyword">) &amp;&amp; !empty(</span><span class="default">$pw</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array(</span><span class="string">'Authorization: Basic ' </span><span class="keyword">.&nbsp; </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$pw</span><span class="keyword">));&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$okay </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get the output buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// clean the output buffer and return to previous<br />
&nbsp;&nbsp;&nbsp; // buffer settings<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// gets you the numeric value from the Content-Length<br />
&nbsp;&nbsp;&nbsp; // field in the http header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$regex </span><span class="keyword">= </span><span class="string">'/Content-Length:\s([0-9].+?)\s/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regex</span><span class="keyword">, </span><span class="default">$head</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if there was a Content-Length field, its value<br />
&nbsp;&nbsp;&nbsp; // will now be in $matches[1]<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="string">'unknown'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.fileperms.html">fileperms</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.filetype.html">filetype</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
