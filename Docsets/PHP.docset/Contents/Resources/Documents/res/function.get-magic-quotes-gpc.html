<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gets the current configuration setting of magic_quotes_gpc</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.get-loaded-extensions.html">get_loaded_extensions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.get-magic-quotes-runtime.html">get_magic_quotes_runtime</a></div>
 <div class="up"><a href="ref.info.html">PHP Options/Info Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.get-magic-quotes-gpc" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">get_magic_quotes_gpc</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">get_magic_quotes_gpc</span> &mdash; <span class="dc-title">Gets the current configuration setting of magic_quotes_gpc</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.get-magic-quotes-gpc-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><b>get_magic_quotes_gpc</b></span>
    ( <span class="methodparam">void</span>
   )</div>

  <p class="para rdfs-comment">
   Returns the current configuration setting of <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> 
  </p>
  <p class="para">
   Keep in mind that attempting to set <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">
   magic_quotes_gpc</a> at runtime will not work.
  </p>
  <p class="para">
   For more information about magic_quotes, see this
   <a href="security.magicquotes.html" class="link">security section</a>.
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.get-magic-quotes-gpc-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns 0 if magic_quotes_gpc is off, 1 otherwise. 
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.get-magic-quotes-gpc-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-459">
    <p><b>Example #1 <span class="function"><b>get_magic_quotes_gpc()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">get_magic_quotes_gpc</span><span style="color: #007700">();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'lastname'</span><span style="color: #007700">];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;O\'reilly<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">addslashes</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'lastname'</span><span style="color: #007700">]);&nbsp;</span><span style="color: #FF8000">//&nbsp;O\\\'reilly<br /><br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">get_magic_quotes_gpc</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$lastname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stripslashes</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'lastname'</span><span style="color: #007700">]);<br />}<br />else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$lastname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'lastname'</span><span style="color: #007700">];<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;If&nbsp;using&nbsp;MySQL<br /></span><span style="color: #0000BB">$lastname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$lastname</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">$lastname</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;O\'reilly<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;lastnames&nbsp;(lastname)&nbsp;VALUES&nbsp;('</span><span style="color: #0000BB">$lastname</span><span style="color: #DD0000">')"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.get-magic-quotes-gpc-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    If the directive <a href="sybase.configuration.html#ini.magic-quotes-sybase" class="link">
    magic_quotes_sybase</a> is ON it will completely override
    <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a>.  So even
    when <span class="function"><b>get_magic_quotes_gpc()</b></span> returns
    <b><tt>TRUE</tt></b> neither double quotes, backslashes or NUL&#039;s will
    be escaped.  Only single quotes will be escaped. In this
    case they&#039;ll look like: <em class="emphasis">&#039;&#039;</em>
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.get-magic-quotes-gpc-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.addslashes.html" class="function" rel="rdfs-seeAlso">addslashes()</a> - Quote string with slashes</span></li>
    <li class="member"><span class="function"><a href="function.stripslashes.html" class="function" rel="rdfs-seeAlso">stripslashes()</a> - Un-quotes a quoted string</span></li>
    <li class="member"><span class="function"><a href="function.get-magic-quotes-runtime.html" class="function" rel="rdfs-seeAlso">get_magic_quotes_runtime()</a> - Gets the current active configuration setting of magic_quotes_runtime</span></li>
    <li class="member"><span class="function"><a href="function.ini-get.html" class="function" rel="rdfs-seeAlso">ini_get()</a> - Gets the value of a configuration option</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="100353""></a>
  <div class="note">
   <strong class="user">rickm707 at gmail dot com</strong>
   <a href="#100353" class="date">10-Oct-2010 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For many people, including myself, the problem is not needing to remove escape characters, but simply to know if they are already in place.&nbsp; In my case, I WANT user input to be properly escaped, but I don't want to do it twice.&nbsp; In cases like this, here's my solution:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">conditional_escape </span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="comment">/* Automatic escaping is highly deprecated, but many sites do it<br />
&nbsp;&nbsp; &nbsp;&nbsp; anyway to protect themselves from stupid customers. */<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">())<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">/* Apache automatically escaped the string already. */<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="comment">/* Replace the following line with whatever function you prefer<br />
&nbsp;&nbsp; &nbsp; &nbsp; to call to escape a string. */<br />
&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">mysqli_real_escape_string </span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $username </span><span class="keyword">= </span><span class="default">conditional_escape </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'Username'</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">$password </span><span class="keyword">= </span><span class="default">conditional_escape </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'Password'</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">$email_address </span><span class="keyword">= </span><span class="default">conditional_escape </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'Email_Address'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97783""></a>
  <div class="note">
   <strong class="user">hetored at gmail dot com</strong>
   <a href="#97783" class="date">07-May-2010 02:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's what I came up with to remove magic quotes from request data.<br />
<br />
Replaces two single-quotes with one if magic_quotes_sybase are on, otherwise it just strips slashes.<br />
<br />
Note that the `foreach` style makes this work only with PHP 5 and above.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Strip magic quotes from request data.<br />
</span><span class="keyword">if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_magic_quotes_gpc'</span><span class="keyword">) &amp;&amp; </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Create lamba style unescaping function (for portability)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$quotes_sybase </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'magic_quotes_sybase'</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$unescape_function </span><span class="keyword">= (empty(</span><span class="default">$quotes_sybase</span><span class="keyword">) || </span><span class="default">$quotes_sybase </span><span class="keyword">=== </span><span class="string">'off'</span><span class="keyword">) ? </span><span class="string">'stripslashes($value)' </span><span class="keyword">: </span><span class="string">'str_replace("\'\'","\'",$value)'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stripslashes_deep </span><span class="keyword">= </span><span class="default">create_function</span><span class="keyword">(</span><span class="string">'&amp;$value, $fn'</span><span class="keyword">, </span><span class="string">'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_string($value)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $value = ' </span><span class="keyword">. </span><span class="default">$unescape_function </span><span class="keyword">. </span><span class="string">';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (is_array($value)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($value as &amp;$v) $fn($v, $fn);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; '</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Unescape data<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stripslashes_deep</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">, </span><span class="default">$stripslashes_deep</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stripslashes_deep</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">, </span><span class="default">$stripslashes_deep</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stripslashes_deep</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">, </span><span class="default">$stripslashes_deep</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stripslashes_deep</span><span class="keyword">(</span><span class="default">$_REQUEST</span><span class="keyword">, </span><span class="default">$stripslashes_deep</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95697""></a>
  <div class="note">
   <strong class="user">Alix Axel</strong>
   <a href="#95697" class="date">16-Jan-2010 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you who need a portable magic quotes antidote here is a solution that fixes both keys and values in multi-dimensional arrays:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">() === </span><span class="default">1</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_GET </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">, </span><span class="default">JSON_HEX_APOS</span><span class="keyword">)), </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_POST </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">, </span><span class="default">JSON_HEX_APOS</span><span class="keyword">)), </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_COOKIE </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">, </span><span class="default">JSON_HEX_APOS</span><span class="keyword">)), </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_REQUEST </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$_REQUEST</span><span class="keyword">, </span><span class="default">JSON_HEX_APOS</span><span class="keyword">)), </span><span class="default">true</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Look mum, no recursion! :P Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83534""></a>
  <div class="note">
   <strong class="user">louis at greynoise dot co dot uk</strong>
   <a href="#83534" class="date">30-May-2008 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">stripper</span><span class="keyword">(</span><span class="default">$stringvar</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">1 </span><span class="keyword">== </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stringvar </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$stringvar</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$stringvar</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage:<br />
<br />
<span class="default">&lt;?php<br />
$Body </span><span class="keyword">= </span><span class="default">stripper</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">-&gt;</span><span class="default">fields</span><span class="keyword">(</span><span class="string">'Body'</span><span class="keyword">));<br />
echo(</span><span class="default">$Body</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This checks if get_magic_quotes_gpc() is on and strips a string variable for output if its on. Useful if the dev server and live server are set up different.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82646""></a>
  <div class="note">
   <strong class="user">surya at c77 dot in</strong>
   <a href="#82646" class="date">20-Apr-2008 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@heiko dot richler at informatik dot fh-nuernberg dot de<br />
<br />
I think your stripslashes_deep function should like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">stripslashes_deep</span><span class="keyword">(&amp;</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'stripslashes_deep'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$value</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You missed the References.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82524""></a>
  <div class="note">
   <strong class="user">heiko dot richler at informatik dot fh-nuernberg dot de</strong>
   <a href="#82524" class="date">15-Apr-2008 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ dot dot dot dot dot alexander at gmail dot com<br />
<br />
I suggest replacing foreach by "stripslashes_deep":<br />
<br />
Example #2 Using stripslashes() on an array on <br />
&lt;<a href="http://www.php.net/manual/en/function.stripslashes.php&gt;:" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.stripslashes.php&gt;:</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">stripslashes_deep</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'stripslashes_deep'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$value</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This gives:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if((</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"get_magic_quotes_gpc"</span><span class="keyword">) &amp;&amp; </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">())&nbsp; &nbsp; || (</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'magic_quotes_sybase'</span><span class="keyword">) &amp;&amp; (</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'magic_quotes_sybase'</span><span class="keyword">))!=</span><span class="string">"off"</span><span class="keyword">)) ){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stripslashes_deep</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stripslashes_deep</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stripslashes_deep</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81675""></a>
  <div class="note">
   <strong class="user">dot  dot  dot  dot  dot alexander at gmail dot com</strong>
   <a href="#81675" class="date">09-Mar-2008 07:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a little correction:<br />
( Because of the ini_get function that may return a string value of "off" that evaluates to TRUE )<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (&nbsp; </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"get_magic_quotes_gpc"</span><span class="keyword">) &amp;&amp; </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (&nbsp; </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'magic_quotes_sybase'</span><span class="keyword">) &amp;&amp; ( </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'magic_quotes_sybase'</span><span class="keyword">)) != </span><span class="string">"off" </span><span class="keyword">)&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$_GET </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$_COOKIE </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81674""></a>
  <div class="note">
   <strong class="user">dot  dot  dot  dot  dot alexander at gmail dot com</strong>
   <a href="#81674" class="date">09-Mar-2008 06:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you don't need to enter the user input in a database, and you are annoyed by "those-damn-slashes-behind-the-apostrophes" (or quotes), that you are forced to strip manually for each entry, you will find this helpful: (&nbsp; Just put it so it gets executed before any manipulation to the GPC ( Get|Post|Cookie )&nbsp; )<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(&nbsp; ( </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"get_magic_quotes_gpc"</span><span class="keyword">) &amp;&amp; </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">() ) || </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'magic_quotes_sybase'</span><span class="keyword">)&nbsp; ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$_GET </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$_COOKIE </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76163""></a>
  <div class="note">
   <strong class="user">gwang at theniceagency dot com</strong>
   <a href="#76163" class="date">03-Jul-2007 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The magic_quotes_gpc = On setting in php.ini is an unfortunate flaw in php which is not a convenience but a source of many bugs and a performance penalty. Decent programmers all know that special characters such as single quotes need to be escaped in string values of an SQL statement.&nbsp; The magic_quotes_gpc = On setting wants to do this for programmers but fails to realize that post or get data usually are validated first. If the data are not valid, they are sent back to the browser for resubmission. In this case, the slashes added to the data are doubled after the next submission, thus causing bugs.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71573""></a>
  <div class="note">
   <strong class="user">slonmron_no_spam_please_ at yahoo dot com</strong>
   <a href="#71573" class="date">06-Dec-2006 06:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re: php at kaiundina dot de (03-Feb-2005 02:18)<br />
<br />
1. magic_quotes_gpc=on/off and magic_quotes_sybase=on/off<br />
<br />
I made test and your function worked right. <br />
These were the &lt;input ... /&gt; names I used:<br />
name="a"<br />
name="b.b b\b"<br />
name="c[c.1]"<br />
name="c[c 2]"<br />
name="c[c\3]"<br />
name="c.c c[c.' 4]"<br />
name="c ' c[c&amp;quot;4]"<br />
name="d&amp;quot;[d&amp;quot;1]"<br />
<br />
(I used &amp;quot; because I don't know other way to put " into the name)<br />
<br />
and the user-input value:<br />
a ' " \ \' \" \\ a<br />
<br />
2. &gt; 17) The chars '.', ' ' are always replaced by '_' when used in keys.<br />
<br />
This is true only for the top-level keys, such as "b.b b\b", "c.c c" and "c ' c" above. The second-level key "[c.' 4]" was not changed to [c_'_4] but was escaped acording to how magic_quites_XXX are set.<br />
<br />
Tested on PHP 4.4.0.<br />
<br />
These magic_quotes are really black magic :(<br />
<br />
It'll be good to make test against $_SESSION, but I can't do it today.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68042""></a>
  <div class="note">
   <strong class="user">venimus at gmail dot com</strong>
   <a href="#68042" class="date">11-Jul-2006 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you work with forms and databases you should use this concept:<br />
<br />
1.When inserting the user input in DB escape $_POST/$_GET with add_slashes() or similar (to match the speciffic database escape rules)<br />
<br />
$query='INSERT INTO users SET fullname="'.add_slashes($_POST['fullname']).'"';<br />
insert_into_db($query);<br />
<br />
2.When reading a previously submitted input from DB use html_special_chars to display an escaped result!<br />
<br />
read_db_row('SELECT fullname FROM users');<br />
echo '&lt;input type="text" name="fullname" value="'.html_special_chars($db_row['fullname']).'" /&gt;<br />
<br />
this way you safely store and work with the original(unescaped) data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49612""></a>
  <div class="note">
   <strong class="user">php at kaiundina dot de</strong>
   <a href="#49612" class="date">02-Feb-2005 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Escaping of key-strings in GPC-arrays behave different to the escaping of their values.<br />
<br />
First I expected that keys in submitted gpc-arrays are never escaped.<br />
Anyway. After I saw escaped keys, I assumed they're escaped according to the settings of magic quotes.<br />
... it's even worse...<br />
<br />
It took me over 2 days of testing to figure out the exact behavior and creating two functions (one for each php-version) that strips slashes reliably from any array submitted to a script. Hope this saves someones time and nerves.<br />
<br />
The following is true for $_GET- and $_POST-arrays. I hope other arrays affected by magic quotes behave equally.<br />
I did not test the behavior for cases where magic_quotes_sybase is set.<br />
<br />
== legend for possible case combinations ==<br />
Px = php version we're using<br />
&nbsp;&nbsp;&nbsp; P4 = php 4.3.9<br />
&nbsp;&nbsp;&nbsp; P5 = php 5.0.2<br />
<br />
MQ = MagicQuotes GPC<br />
&nbsp;&nbsp;&nbsp; +MQ = magic quotes enabled<br />
&nbsp;&nbsp;&nbsp; -MQ = magic quotes disabled<br />
<br />
TL = TopLevel key<br />
&nbsp;&nbsp;&nbsp; +TL = key is on top level (i.e. $_GET['myKey'])<br />
&nbsp;&nbsp;&nbsp; -TL = key is nested within another array (i.e. $_GET['myList']['myKey'])<br />
<br />
AK = ArrayKey<br />
&nbsp;&nbsp;&nbsp; +AK = the value of the key is another array (i.e. is_array($_GET['myKey']) == true)<br />
&nbsp;&nbsp;&nbsp; -AK = the value is a normal string (i.e. is_string($_GET['myKey']) == true)<br />
<br />
== legend for possible results ==<br />
KE = KeyEscaping<br />
&nbsp;&nbsp;&nbsp; +KE = control chars are prefixed with a backslash<br />
&nbsp;&nbsp;&nbsp; -KE = key is returned as submitted and needn't to be stripped<br />
<br />
VE = ValueEscaping (doesn't apply for array as value)<br />
&nbsp;&nbsp;&nbsp; +VE = control chars are prefixed with a backslash<br />
&nbsp;&nbsp;&nbsp; -VE = value is returned as submitted and needn't to be stripped<br />
<br />
== here we go - the following rules apply ==<br />
&nbsp;1) P4 +MQ +AK +TL --&gt; -KE<br />
&nbsp;2) P4 +MQ +AK -TL --&gt; +KE<br />
&nbsp;3) P4 +MQ -AK +TL --&gt; -KE +VE<br />
&nbsp;4) P4 +MQ -AK -TL --&gt; +KE +VE<br />
&nbsp;5) P4 -MQ +AK +TL --&gt; -KE<br />
&nbsp;6) P4 -MQ +AK -TL --&gt; -KE<br />
&nbsp;7) P4 -MQ -AK +TL --&gt; -KE -VE<br />
&nbsp;8) P4 -MQ -AK -TL --&gt; -KE -VE<br />
&nbsp;9) P5 +MQ +AK +TL --&gt; -KE<br />
10) P5 +MQ +AK -TL --&gt; +KE<br />
11) P5 +MQ -AK +TL --&gt; +KE +VE<br />
12) P5 +MQ -AK -TL --&gt; +KE +VE<br />
13) P5 -MQ +AK +TL --&gt; -KE<br />
14) P5 -MQ +AK -TL --&gt; -KE<br />
15) P5 -MQ -AK +TL --&gt; +KE -VE<br />
16) P5 -MQ -AK -TL --&gt; +KE -VE<br />
17) The chars '.', ' ' are always replaced by '_' when used in keys.<br />
<br />
Example (rule 15):<br />
When running under php 5.0.2 having magic quotes disabled, gpc-keys on top level containing strings are escaped while their associated values are not.<br />
<br />
== The following function will strip GPC-arrays for php 4.3.9 ==<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">transcribe</span><span class="keyword">(</span><span class="default">$aList</span><span class="keyword">, </span><span class="default">$aIsTopLevel </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gpcList </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$isMagic </span><span class="keyword">= </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$aList </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedKey </span><span class="keyword">= (</span><span class="default">$isMagic </span><span class="keyword">&amp;&amp; !</span><span class="default">$aIsTopLevel</span><span class="keyword">)?</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">):</span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedValue </span><span class="keyword">= </span><span class="default">transcribe</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedValue </span><span class="keyword">= (</span><span class="default">$isMagic</span><span class="keyword">)?</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">):</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gpcList</span><span class="keyword">[</span><span class="default">$decodedKey</span><span class="keyword">] = </span><span class="default">$decodedValue</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$gpcList</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
<br />
== The following function will strip GPC-arrays for php 5.0.2 ==<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">transcribe</span><span class="keyword">(</span><span class="default">$aList</span><span class="keyword">, </span><span class="default">$aIsTopLevel </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gpcList </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$isMagic </span><span class="keyword">= </span><span class="default">get_magic_quotes_gpc</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$aList </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedKey </span><span class="keyword">= (</span><span class="default">$isMagic </span><span class="keyword">&amp;&amp; !</span><span class="default">$aIsTopLevel</span><span class="keyword">)?</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">):</span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedValue </span><span class="keyword">= </span><span class="default">transcribe</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedKey </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedValue </span><span class="keyword">= (</span><span class="default">$isMagic</span><span class="keyword">)?</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">):</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gpcList</span><span class="keyword">[</span><span class="default">$decodedKey</span><span class="keyword">] = </span><span class="default">$decodedValue</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$gpcList</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage:<br />
<br />
<span class="default">&lt;?php<br />
$unstrippedGET </span><span class="keyword">= </span><span class="default">transcribe</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">);<br />
</span><span class="default">$unstrippedPOST </span><span class="keyword">= </span><span class="default">transcribe</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Maybe someone is willing to test those combinations for other php-versions and with magic_quotes_sybase set to 'on' - let me know.<br />
Sorry for this huge amount of text, but it's complete. I was unable to compress the decision table more than this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49027""></a>
  <div class="note">
   <strong class="user">stpierre-at-spamsucks.nebrwesleyan.edu</strong>
   <a href="#49027" class="date">14-Jan-2005 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've found that, when working with Oracle (9i at least), you'll want to turn on magic_quotes_sybase.&nbsp; I've read elsewhere that others have had the same experience.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47733""></a>
  <div class="note">
   <strong class="user">eltehaem at poczta dot onet dot pl</strong>
   <a href="#47733" class="date">26-Nov-2004 02:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note, that when magic_quotes_gpc is set not only $_POST, $_GET, $_REQUEST, $_COOKIE arrays values are slashed. Actually every string value in $GLOBALS array is slashed, ie. $GLOBALS['_SERVER']['PATH_INFO'] (or $_SERVER['PATH_INFO']).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.get-loaded-extensions.html">get_loaded_extensions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.get-magic-quotes-runtime.html">get_magic_quotes_runtime</a></div>
 <div class="up"><a href="ref.info.html">PHP Options/Info Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
