<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Get the index of the color of a pixel</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecolorallocatealpha.html">imagecolorallocatealpha</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecolorclosest.html">imagecolorclosest</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagecolorat" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolorat</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imagecolorat</span> &mdash; <span class="dc-title">Get the index of the color of a pixel</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecolorat-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><b>imagecolorat</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$image</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$x</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$y</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Returns the index of the color of the pixel at the
   specified location in the image specified by <i><tt class="parameter">image</tt></i>.
  </p>
  <p class="para">
   If PHP is compiled against GD library 2.0 or higher and the image is a
   truecolor image, this function returns the RGB value of that pixel as
   integer. Use bitshifting and masking to access the distinct red, green and blue
   component values:
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecolorat-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><i><tt class="parameter">
image</tt></i></span><dd>
<p class="para">An image resource, returned by one of the image creation functions,
such as <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>.</p></dd>
</dt>

    <dt>

     <span class="term"><i><tt class="parameter">x</tt></i></span>
     <dd>

      <p class="para">
       x-coordinate of the point.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">y</tt></i></span>
     <dd>

      <p class="para">
       y-coordinate of the point.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecolorat-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the index of the color.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecolorat-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2936">
    <p><b>Example #1 Access distinct RGB values</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #DD0000">"php.png"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$rgb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorat</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">15</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$rgb&nbsp;</span><span style="color: #007700">&gt;&gt;&nbsp;</span><span style="color: #0000BB">16</span><span style="color: #007700">)&nbsp;&amp;&nbsp;</span><span style="color: #0000BB">0xFF</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$g&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$rgb&nbsp;</span><span style="color: #007700">&gt;&gt;&nbsp;</span><span style="color: #0000BB">8</span><span style="color: #007700">)&nbsp;&amp;&nbsp;</span><span style="color: #0000BB">0xFF</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rgb&nbsp;</span><span style="color: #007700">&amp;&nbsp;</span><span style="color: #0000BB">0xFF</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$r</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$g</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
int(119)
int(123)
int(180)
</pre></div>
    </div>
   </div>
   <div class="example" id="example-2937">
    <p><b>Example #2 Human-readable RGB values using <span class="function"><a href="function.imagecolorsforindex.html" class="function">imagecolorsforindex()</a></span></b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #DD0000">"php.png"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$rgb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorat</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">15</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorsforindex</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$colors</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(4) {
  [&quot;red&quot;]=&gt;
  int(119)
  [&quot;green&quot;]=&gt;
  int(123)
  [&quot;blue&quot;]=&gt;
  int(180)
  [&quot;alpha&quot;]=&gt;
  int(127)
}
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagecolorat-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagecolorset.html" class="function" rel="rdfs-seeAlso">imagecolorset()</a> - Set the color for the specified palette index</span></li>
    <li class="member"><span class="function"><a href="function.imagecolorsforindex.html" class="function" rel="rdfs-seeAlso">imagecolorsforindex()</a> - Get the colors for an index</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103132""></a>
  <div class="note">
   <strong class="user">chandrachur at elegantsystems dot net</strong>
   <a href="#103132" class="date">28-Mar-2011 01:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a fun code for making images with white bg transparent. Well it can work with any bg but you need to adjust the color values accordingly. Works best with plain dual colors. I searched for this kind of code a lot but unable to find one ...see if this helps someone.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">transparentImage</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">){&nbsp; </span><span class="comment">//making images with white bg transparent<br />
</span><span class="default">$r1</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">;<br />
</span><span class="default">$g1</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">;<br />
</span><span class="default">$b1</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">;<br />
for(</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); ++</span><span class="default">$x</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); ++</span><span class="default">$y</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color</span><span class="keyword">=</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$color </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$color </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$color </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">270</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$r</span><span class="keyword">.</span><span class="default">$g</span><span class="keyword">.</span><span class="default">$b</span><span class="keyword">==(</span><span class="default">$r1</span><span class="keyword">+</span><span class="default">$i</span><span class="keyword">).(</span><span class="default">$g1</span><span class="keyword">+</span><span class="default">$i</span><span class="keyword">).(</span><span class="default">$b1</span><span class="keyword">+</span><span class="default">$i</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans_colour </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$trans_colour</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$src</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$image</span><span class="keyword">=</span><span class="string">'abc/abc.jpg'</span><span class="keyword">;<br />
</span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">$src</span><span class="keyword">=</span><span class="default">transparentImage</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); </span><span class="comment">//Lets make the jpegs transparent<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102328""></a>
  <div class="note">
   <strong class="user">Kae Cyphet</strong>
   <a href="#102328" class="date">08-Feb-2011 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting inconsistent results or results that dont make any sense when trying to retrieve a black pixel eg:<br />
<br />
(Red,Green,Blue)<br />
0,0,0<br />
0,0,0<br />
0,0,2<br />
0,0,4<br />
0,0,6<br />
0,0,7<br />
0,0,0<br />
0,0,10<br />
0,0,8<br />
0,0,9<br />
0,0,0<br />
0,0,12<br />
0,0,13<br />
0,0,0<br />
<br />
switch from using imagecreate() to imagecreatetruecolor()<br />
<br />
issue found when creating a graph where a pixel would increase in color based on the previous color and new data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99282""></a>
  <div class="note">
   <strong class="user">madtrader117 at gmail dot com</strong>
   <a href="#99282" class="date">08-Aug-2010 07:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function I made for finding the size of the black border surrounding some movie thumbnails where the movie itself has had black padding added in order to maintain aspect ratio.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; define</span><span class="keyword">(</span><span class="string">"DEBUG_OUT"</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$border_size </span><span class="keyword">= </span><span class="default">find_border_size</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$border_size</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; * $border = max(find_border_size("img.jpg"));<br />
&nbsp;&nbsp; &nbsp; * $thumb_size_x = 180+(2*$border);<br />
&nbsp;&nbsp; &nbsp; * $thumb_size_y = 240+(2*$border);<br />
&nbsp;&nbsp; &nbsp; * $thumb_size = $thumb_size_x . "x" . $thumb_size_y; (String to use in the -s param of ffmpeg)<br />
&nbsp;&nbsp; &nbsp; * $crop_cmd = "-croptop $border -cropbottom $border -cropright $border -cropleft $border";<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">find_border_size</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* The pad var is essentially a 'feather' value. Unless one of the RGB values rises<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * above $pad we are saying to continue. You can try different values but with 10 I<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * would still get a decent sized border due to the bleedover of the movie into<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * the hat.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pad </span><span class="keyword">= </span><span class="default">20</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">DEBUG_OUT</span><span class="keyword">) echo(</span><span class="string">"Error: </span><span class="default">$path</span><span class="string"> not found.\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">DEBUG_OUT</span><span class="keyword">) echo(</span><span class="string">"Opening: </span><span class="default">$path</span><span class="string"> ...\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$im</span><span class="keyword">) return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Let's start at 0, 0 and keep going till we hit a color */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">DEBUG_OUT</span><span class="keyword">) echo(</span><span class="string">"Image - Height: </span><span class="default">$height</span><span class="string"> / Width: </span><span class="default">$width</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Border Height(Y) */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$center_width </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$height</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$center_width</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">DEBUG_OUT</span><span class="keyword">) echo(</span><span class="string">"Height: (</span><span class="default">$center_width</span><span class="string">,</span><span class="default">$i</span><span class="string">) R: </span><span class="default">$r</span><span class="string"> / G: </span><span class="default">$g</span><span class="string"> / B: </span><span class="default">$b</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$r </span><span class="keyword">&gt;= </span><span class="default">$pad </span><span class="keyword">|| </span><span class="default">$g </span><span class="keyword">&gt;= </span><span class="default">$pad </span><span class="keyword">|| </span><span class="default">$b </span><span class="keyword">&gt;= </span><span class="default">$pad</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_y </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$border_y </span><span class="keyword">== </span><span class="default">$height</span><span class="keyword">) </span><span class="default">$border_y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Border Width(X) */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$center_height </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$width</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$center_height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">DEBUG_OUT</span><span class="keyword">) echo(</span><span class="string">"Width: (</span><span class="default">$i</span><span class="string">,</span><span class="default">$center_width</span><span class="string">) R: </span><span class="default">$r</span><span class="string"> / G: </span><span class="default">$g</span><span class="string"> / B: </span><span class="default">$b</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$r </span><span class="keyword">&gt;= </span><span class="default">$pad </span><span class="keyword">|| </span><span class="default">$g </span><span class="keyword">&gt;= </span><span class="default">$pad </span><span class="keyword">|| </span><span class="default">$b </span><span class="keyword">&gt;= </span><span class="default">$pad</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_x </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$border_x </span><span class="keyword">== </span><span class="default">$width</span><span class="keyword">) </span><span class="default">$border_x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* I am making the border a multiple of 2 since I am sending these values to FFMpeg */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$border_x </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_x </span><span class="keyword">/= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_x </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$border_x</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_x </span><span class="keyword">*= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$border_y </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_y </span><span class="keyword">/= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_y </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$border_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$border_y </span><span class="keyword">*= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">DEBUG_OUT</span><span class="keyword">) echo(</span><span class="string">"Border Width: </span><span class="default">$border_x</span><span class="string"> / Border Height: </span><span class="default">$border_y</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$border_x</span><span class="keyword">,</span><span class="default">$border_y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97957""></a>
  <div class="note">
   <strong class="user">black at scene-si dot org</strong>
   <a href="#97957" class="date">18-May-2010 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If an image is filled with a solid color (rgb 0,0,0) the average color will be 0,0,0, and the histogram will have the maximum values at r[0], g[0], and b[0]. Since we remove those values with the tolerance (+- 16), we are only left with colors outside of average.<br />
<br />
If the removed colors represent more than 90% of the image (we remove 6.25-12.5% of the histogram based on the average color), then we asume the image is blank.<br />
<br />
This detects solid filled images of any color, and with images of very little color variance (blank wall, blue sky with no clouds, nearly faded images, very low contrast and low color range images). The function is perfect for checking if a frame from a video is blank or not (in case you are generating thumbnails).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">isBlank</span><span class="keyword">(</span><span class="default">$gd_resource</span><span class="keyword">, </span><span class="default">$tolerance</span><span class="keyword">, </span><span class="default">$percent</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">) = array(</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$gd_resource</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$gd_resource</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hr </span><span class="keyword">= </span><span class="default">$hg </span><span class="keyword">= </span><span class="default">$hb </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$h</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">$w</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$gd_resource</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$gd_resource</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hr</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]] = </span><span class="default">issetor</span><span class="keyword">(</span><span class="default">$hr</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]],</span><span class="default">0</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hg</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">]] = </span><span class="default">issetor</span><span class="keyword">(</span><span class="default">$hg</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">]],</span><span class="default">0</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hb</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]] = </span><span class="default">issetor</span><span class="keyword">(</span><span class="default">$hb</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]],</span><span class="default">0</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rc </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$hr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gc </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$hg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bc </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$hb</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$rc</span><span class="keyword">/</span><span class="default">$count</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$gc</span><span class="keyword">/</span><span class="default">$count</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$bc</span><span class="keyword">/</span><span class="default">$count</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ra </span><span class="keyword">= </span><span class="default">range</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">-</span><span class="default">$tolerance</span><span class="keyword">), </span><span class="default">min</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">+</span><span class="default">$tolerance</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ga </span><span class="keyword">= </span><span class="default">range</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">-</span><span class="default">$tolerance</span><span class="keyword">), </span><span class="default">min</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">+</span><span class="default">$tolerance</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ba </span><span class="keyword">= </span><span class="default">range</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">-</span><span class="default">$tolerance</span><span class="keyword">), </span><span class="default">min</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">+</span><span class="default">$tolerance</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ra </span><span class="keyword">as </span><span class="default">$rx</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$hr</span><span class="keyword">[</span><span class="default">$rx</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ga </span><span class="keyword">as </span><span class="default">$gx</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$hg</span><span class="keyword">[</span><span class="default">$gx</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ba </span><span class="keyword">as </span><span class="default">$bx</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$hb</span><span class="keyword">[</span><span class="default">$bx</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red </span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$hr</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">) / </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$rc</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green </span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$hg</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">) / </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$gc</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue </span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$hb</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">) / </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$bc</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$red</span><span class="keyword">&lt;</span><span class="default">$percent </span><span class="keyword">&amp;&amp; </span><span class="default">$green</span><span class="keyword">&lt;</span><span class="default">$percent </span><span class="keyword">&amp;&amp; </span><span class="default">$blue</span><span class="keyword">&lt;</span><span class="default">$percent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Example;<br />
<br />
</span><span class="default">isBlank</span><span class="keyword">(</span><span class="default">$gd_resource</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">, </span><span class="default">0.1</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88954""></a>
  <div class="note">
   <strong class="user">tumbler</strong>
   <a href="#88954" class="date">14-Feb-2009 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With this example you can calculate the weather status :)<br />
Just put an image (webcam) in an img folder, and run this script.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $img </span><span class="keyword">= </span><span class="string">"img/clouds.gif"</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imgHand </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imgSize </span><span class="keyword">= </span><span class="default">GetImageSize</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imgWidth </span><span class="keyword">= </span><span class="default">$imgSize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imgHeight </span><span class="keyword">= </span><span class="default">$imgSize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'&lt;img src="'</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">.</span><span class="string">'"&gt;&lt;br&gt;&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$l </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$l </span><span class="keyword">&lt; </span><span class="default">$imgHeight</span><span class="keyword">; </span><span class="default">$l</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">$imgWidth</span><span class="keyword">; </span><span class="default">$c</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pxlCor </span><span class="keyword">= </span><span class="default">ImageColorAt</span><span class="keyword">(</span><span class="default">$imgHand</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,</span><span class="default">$l</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pxlCorArr </span><span class="keyword">= </span><span class="default">ImageColorsForIndex</span><span class="keyword">(</span><span class="default">$imgHand</span><span class="keyword">, </span><span class="default">$pxlCor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$htmlCor </span><span class="keyword">= </span><span class="default">DecHex</span><span class="keyword">(</span><span class="default">$pxlCorArr</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">]&amp;</span><span class="default">240</span><span class="keyword">) . </span><span class="default">DecHex</span><span class="keyword">(</span><span class="default">$pxlCorArr</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">]&amp;</span><span class="default">240</span><span class="keyword">) . </span><span class="default">DecHex</span><span class="keyword">(</span><span class="default">$pxlCorArr</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">]&amp;</span><span class="default">240</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grey</span><span class="keyword">[</span><span class="default">convert</span><span class="keyword">(</span><span class="default">$htmlCor</span><span class="keyword">)/</span><span class="default">16</span><span class="keyword">]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">16</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'greyvalue '</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">' : '</span><span class="keyword">.</span><span class="default">$grey</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;&lt;br&gt;Status: &lt;b&gt;'</span><span class="keyword">.</span><span class="default">status</span><span class="keyword">(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$grey</span><span class="keyword">)).</span><span class="string">'&lt;/b&gt;&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">convert</span><span class="keyword">(</span><span class="default">$color</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hexdec</span><span class="keyword">=</span><span class="default">HexDec</span><span class="keyword">(</span><span class="default">$color</span><span class="keyword">)&amp;</span><span class="default">240</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decbin</span><span class="keyword">=</span><span class="default">DecBin</span><span class="keyword">(</span><span class="default">$hexdec</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decbin </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="string">"00000000"</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">8 </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$decbin</span><span class="keyword">)) . </span><span class="default">$decbin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bindec </span><span class="keyword">= </span><span class="default">BinDec</span><span class="keyword">(</span><span class="default">$decbin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$bindec</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">status</span><span class="keyword">(</span><span class="default">$range</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$range </span><span class="keyword">&gt;= </span><span class="default">13</span><span class="keyword">) return </span><span class="string">"Heavy Clouds"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$range </span><span class="keyword">&gt; </span><span class="default">9 </span><span class="keyword">&amp;&amp; </span><span class="default">$range </span><span class="keyword">&lt; </span><span class="default">13</span><span class="keyword">) return </span><span class="string">"Cloudy"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$range </span><span class="keyword">&gt; </span><span class="default">4 </span><span class="keyword">&amp;&amp; </span><span class="default">$range </span><span class="keyword">&lt;=</span><span class="default">9</span><span class="keyword">) return </span><span class="string">"Light cloudy"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$range </span><span class="keyword">&lt;= </span><span class="default">4</span><span class="keyword">) return </span><span class="string">"Clear"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85849""></a>
  <div class="note">
   <strong class="user">Richard</strong>
   <a href="#85849" class="date">20-Sep-2008 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With the following functions you can not only convert a 24 bit RGB integer to its corresponding red, green, and blue values, but also 32 bit RGBA integers to its corresponding red, green, blue, and ALPHA values.<br />
<br />
Not only that, but I even threw in a function for converting those red, green, blue, and alpha values back into a 32 bit RGBA integer.<br />
<br />
Sample usage:<br />
<span class="default">&lt;?php<br />
$int </span><span class="keyword">= </span><span class="default">rgba2int</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">);<br />
echo </span><span class="default">$int </span><span class="keyword">. </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$rgba </span><span class="keyword">= </span><span class="default">int2rgba</span><span class="keyword">(</span><span class="default">$int</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$rgba</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
What it should output:<br />
285212671<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [r] =&gt; 255<br />
&nbsp;&nbsp;&nbsp; [g] =&gt; 255<br />
&nbsp;&nbsp;&nbsp; [b] =&gt; 255<br />
&nbsp;&nbsp;&nbsp; [a] =&gt; 16<br />
)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rgba2int</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; This function builds a 32 bit integer from 4 values which must be 0-255 (8 bits)<br />
&nbsp;&nbsp;&nbsp; Example 32 bit integer: 00100000010001000000100000010000<br />
&nbsp;&nbsp;&nbsp; The first 8 bits define the alpha<br />
&nbsp;&nbsp;&nbsp; The next 8 bits define the blue<br />
&nbsp;&nbsp;&nbsp; The next 8 bits define the green<br />
&nbsp;&nbsp;&nbsp; The next 8 bits define the red<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">$a </span><span class="keyword">&lt;&lt; </span><span class="default">24</span><span class="keyword">) + (</span><span class="default">$b </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$g </span><span class="keyword">&lt;&lt; </span><span class="default">8</span><span class="keyword">) + </span><span class="default">$r</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">int2rgba</span><span class="keyword">(</span><span class="default">$int</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= (</span><span class="default">$int </span><span class="keyword">&gt;&gt; </span><span class="default">24</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$int </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$int </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$int </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="string">'r'</span><span class="keyword">=&gt;</span><span class="default">$r</span><span class="keyword">, </span><span class="string">'g'</span><span class="keyword">=&gt;</span><span class="default">$g</span><span class="keyword">, </span><span class="string">'b'</span><span class="keyword">=&gt;</span><span class="default">$b</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">=&gt;</span><span class="default">$a</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82556""></a>
  <div class="note">
   <strong class="user">Scott Thompson (VBAssassin)</strong>
   <a href="#82556" class="date">16-Apr-2008 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've found this function very useful when wanting to manipulate an existing image. An example would be to simply flip an image (source code here: <a href="http://www.coderprofile.com/source-code/372/ " rel="nofollow" target="_blank">http://www.coderprofile.com/source-code/372/ </a>)<br />
<br />
The principle i use a lot is to scan through an image pixel by pixel performing some kind of action on that pixel... and then saving the newly created pixel on to a new canvas ready to display to the browser.<br />
<br />
The only problem i find is speed... so some kind of caching mechanism and dimensions limitation on images that are processed is recommended for high traffic use.<br />
<br />
Kind regards,<br />
Scott</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79316""></a>
  <div class="note">
   <strong class="user">p h o c i s [a-t] g m a i l c o m</strong>
   <a href="#79316" class="date">20-Nov-2007 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I believe GD has an issue with transparent mattes and alpha blending. It seems GD thinks that some images have a black matte transparency (meaning that the image is built on a black matte instead of transparent).<br />
<br />
And while "alan hogan dot com slash contact" solution does deal with this, the results seem to be... glitchy. you get different results each time you do it, and they are not always the best.<br />
<br />
So I made a different solution that, while it looks better on a white background and is consistent, still sort of mangles the image just a bit by merging all blended pixels with the transparent color.<br />
<br />
// Load image<br />
$img = imagecreatefrompng('my_broken_png.png');<br />
<br />
// Make matte canvas<br />
$matte = imagecreatetruecolor(16,16);<br />
$trans_color = imagecolorallocatealpha($matte,254,254,254,0);<br />
imagefill($matte, 0,0,$trans_color);<br />
<br />
// Put the old image on the matte<br />
imagecopy($matte,$img,0,0,0,0,16,16);<br />
<br />
// Turn the matte color into full alpha (blended pixels will not be affected)<br />
imagecolortransparent($matte,$trans_color);<br />
<br />
// Display image<br />
header('Content-Type: image/gif');&nbsp;&nbsp; <br />
imagegif($matte);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79116""></a>
  <div class="note">
   <strong class="user">alan hogan dot com slash contact</strong>
   <a href="#79116" class="date">12-Nov-2007 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As creamdog noted before, the alpha channel IS available from this function! (The manual should probably be updated to include this!)<br />
<br />
$rgba = imagecolorat($im,$x,$y);<br />
$alpha = ($rgba &amp; 0x7F000000) &gt;&gt; 24;<br />
<br />
$alpha will then contain the TRANSPARENCY (NOT OPACITY) level. So 127, the max, would be completely transparent, and 0 would be completely opaque.<br />
<br />
Using this information, it is possible to write a dithering png-to-gif function like the completely working simple one below:<br />
<br />
<span class="default">&lt;?php<br />
$im </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$pngRel</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0xfe</span><span class="keyword">, </span><span class="default">0x3</span><span class="keyword">, </span><span class="default">0xf4 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">= (</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">) &amp; </span><span class="default">0x7F000000</span><span class="keyword">) &gt;&gt; </span><span class="default">24</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//DITHER!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$alpha </span><span class="keyword">&gt; </span><span class="default">3 </span><span class="keyword">&amp;&amp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$alpha </span><span class="keyword">&gt;=</span><span class="default">127</span><span class="keyword">-</span><span class="default">3 </span><span class="keyword">|| <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">127</span><span class="keyword">))&gt;=(</span><span class="default">127</span><span class="keyword">-</span><span class="default">$alpha</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$transparentColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$gifRel</span><span class="keyword">);</span><span class="comment">//save<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/gif"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$gifRel</span><span class="keyword">); </span><span class="comment">//pass thru to browser<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77842""></a>
  <div class="note">
   <strong class="user">pocze_zsolt at hotmail dot com</strong>
   <a href="#77842" class="date">15-Sep-2007 04:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a histogram-stretching function to get a better contrast:<br />
<br />
function contrast_stretch( $img ) {<br />
&nbsp;&nbsp;&nbsp; $x = imagesx($img);<br />
&nbsp;&nbsp;&nbsp; $y = imagesy($img);<br />
<br />
&nbsp;&nbsp;&nbsp; $min=255.0;<br />
&nbsp;&nbsp;&nbsp; $max=0.0;<br />
<br />
&nbsp;&nbsp;&nbsp; for($i=0; $i&lt;$y; $i++) {<br />
&nbsp;&nbsp;&nbsp; for($j=0; $j&lt;$x; $j++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pos = imagecolorat($img, $j, $i);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $f = imagecolorsforindex($img, $pos);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $gst = $f["red"]*0.15 + $f["green"]*0.5 + $f["blue"]*0.35;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($gst&gt;$max) $max=$gst;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($gst&lt;$min) $min=$gst;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; $distance = $max-$min;<br />
<br />
&nbsp;&nbsp;&nbsp; for($i=0; $i&lt;$y; $i++) {<br />
&nbsp;&nbsp;&nbsp; for($j=0; $j&lt;$x; $j++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pos = imagecolorat($img, $j, $i);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $f = imagecolorsforindex($img, $pos);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $red = 255*($f["red"]-$min)/$distance;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $green = 255*($f["green"]-$min)/$distance;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $blue = 255*($f["blue"]-$min)/$distance;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($red&lt;0) $red = 0.0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif($red&gt;255) $red=255.0;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($green&lt;0) $green = 0.0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif($green&gt;255) $green=255.0;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($blue&lt;0) $blue = 0.0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif($blue&gt;255) $blue=255.0;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $color = imagecolorresolve($img, $red, $green, $blue);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($img, $j, $i, $color);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76819""></a>
  <div class="note">
   <strong class="user">markignore.atsymbol.ignorepnod.co.uk</strong>
   <a href="#76819" class="date">31-Jul-2007 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example given for returning the RGB values from the function (using &amp; 0xFF) didn't work for me for PNG or GIF images. If you have this problem, try the following (which works):<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $pixelrgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$cols </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pixelrgb</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$cols</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$cols</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$cols</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">];<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73657""></a>
  <div class="note">
   <strong class="user">Gromitt</strong>
   <a href="#73657" class="date">05-Mar-2007 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imagecolorat() will display a Notice if you attempt to query a pixel which is out of bounds, and will return false :<br />
<br />
<span class="default">&lt;?php<br />
<br />
$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'test.jpg'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output :<br />
<br />
Notice: imagecolorat(): -1,0 is out of bounds in /test.php on line 4<br />
bool(false)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71444""></a>
  <div class="note">
   
   <a href="#71444" class="date">29-Nov-2006 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//test if a Jpeg is greyscale or color <br />
<br />
function iscolor($pic_adress){<br />
<br />
&nbsp;&nbsp;&nbsp; <br />
// A Pixel is Greyscale if the r = B = G <br />
&nbsp;&nbsp;&nbsp; //example: colorpixel R=250, G=140 , B=19&nbsp; Greyscale Pixel R=110, G= 110, B=110 <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //we do a check of 10 Pixels to find out if the Picture is Greyscale<br />
&nbsp;&nbsp;&nbsp; $tocheck = 10;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $iscolor=false;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $temp= getimagesize($pic_adress);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $x= $temp[0];<br />
&nbsp;&nbsp;&nbsp; $y= $temp[1];<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $im= imagecreatefromjpeg($pic_adress);<br />
<br />
&nbsp;&nbsp;&nbsp; //now check out the Pixels&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; for( $i = 0 ; $i&lt; $tocheck &amp;&amp; !$iscolor; $i++){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Here a Random Pixel is chosen<br />
&nbsp;&nbsp;&nbsp; $color = imagecolorat($im,rand(0,$x),rand(0,$y));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //Problem color is an int<br />
&nbsp;&nbsp;&nbsp; //The Hex view on the number is RRGGBB<br />
&nbsp;&nbsp;&nbsp; // Here we get the blue part of the Pixel<br />
&nbsp;&nbsp;&nbsp; $blue = 0x0000ff &amp; $color;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $green = 0x00ff00 &amp; $color;<br />
&nbsp;&nbsp; //The Green part we have to push 8 bits to the right to get an Compareable result <br />
&nbsp;&nbsp;&nbsp; $green = $green &gt;&gt; 8;<br />
&nbsp;&nbsp;&nbsp; $red =0xff0000 &amp; $color;<br />
&nbsp;&nbsp;&nbsp; //red part needs to be pushed 16 bit<br />
&nbsp;&nbsp;&nbsp; $red = $red &gt;&gt; 16;<br />
&nbsp;&nbsp;&nbsp; // if one of the Pixels isnt Greyscale it breaks an you know this is a color picture<br />
&nbsp;&nbsp;&nbsp; if( $red!= $green || $green!= $blue){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $iscolor = true;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $iscolor;<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70783""></a>
  <div class="note">
   <strong class="user">Luciano Ropero</strong>
   <a href="#70783" class="date">27-Oct-2006 11:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made a function that calculates the average color of a given image resource and returns it in "#rrggbb" format (hex):<br />
<br />
function average($img) {<br />
&nbsp;&nbsp;&nbsp; $w = imagesx($img);<br />
&nbsp;&nbsp;&nbsp; $h = imagesy($img);<br />
&nbsp;&nbsp;&nbsp; $r = $g = $b = 0;<br />
&nbsp;&nbsp;&nbsp; for($y = 0; $y &lt; $h; $y++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($x = 0; $x &lt; $w; $x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rgb = imagecolorat($img, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $r += $rgb &gt;&gt; 16;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $g += $rgb &gt;&gt; 8 &amp; 255;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $b += $rgb &amp; 255;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $pxls = $w * $h;<br />
&nbsp;&nbsp;&nbsp; $r = dechex(round($r / $pxls));<br />
&nbsp;&nbsp;&nbsp; $g = dechex(round($g / $pxls));<br />
&nbsp;&nbsp;&nbsp; $b = dechex(round($b / $pxls));<br />
&nbsp;&nbsp;&nbsp; if(strlen($r) &lt; 2) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $r = 0 . $r;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(strlen($g) &lt; 2) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $g = 0 . $g;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(strlen($b) &lt; 2) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $b = 0 . $b;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return "#" . $r . $g . $b;<br />
}<br />
<br />
Although, I've noticed that you can also get a fairly good average color generating a 1px by 1px copy with imagecopyresampled (the pixel generated is colored with the average color).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70458""></a>
  <div class="note">
   <strong class="user">NuclearFlux</strong>
   <a href="#70458" class="date">17-Oct-2006 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
code part from robert:<br />
&nbsp;&nbsp; $output .= '&lt;div style="position:relative;float:left;width:' .<br />
&nbsp;&nbsp; $div_width . 'px;height:1px;background-color:' . <br />
&nbsp;&nbsp; hexcolor((($div_width &gt; 1)?<br />
&nbsp;&nbsp; $previous_color:$current_color)) . '"&gt;&lt;img src="bogus.gif"<br />
&nbsp;&nbsp; alt="" width="1" height="1" /&gt;&lt;/div&gt;';<br />
<br />
i've optimized this part so that no image is needed:<br />
<br />
&nbsp;&nbsp; $output .= '&lt;div<br />
&nbsp;&nbsp; style="position:relative;float:left;max-width:1px&gt;;<br />
&nbsp;&nbsp; max-height:1px;background-color:'.<br />
&nbsp;&nbsp; hexcolor((($div_width &gt; 1)?<br />
&nbsp;&nbsp; $previous_color:$current_color)).'"&gt;&amp;nbsp;&lt;/div&gt;';<br />
<br />
//sorry for my english, i'm a german xD</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69575""></a>
  <div class="note">
   <strong class="user">morten at nilsen dot com</strong>
   <a href="#69575" class="date">11-Sep-2006 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A better way of encoding a color value to #rrggbb:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; printf</span><span class="keyword">(</span><span class="string">'#%06x'</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
or<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $rgb </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'#%06x'</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64769""></a>
  <div class="note">
   <strong class="user">creamdog</strong>
   <a href="#64769" class="date">20-Apr-2006 04:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you look in the gd library for C in gd.h you have the following defined for truecolor images.<br />
<br />
#define gdTrueColorGetAlpha(c) (((c) &amp; 0x7F000000) &gt;&gt; 24)<br />
#define gdTrueColorGetRed(c) (((c) &amp; 0xFF0000) &gt;&gt; 16)<br />
#define gdTrueColorGetGreen(c) (((c) &amp; 0x00FF00) &gt;&gt; 8)<br />
#define gdTrueColorGetBlue(c) ((c) &amp; 0x0000FF) <br />
<br />
So in php you could just do it as so:<br />
<br />
$rgba = imagecolorat($im,$x,$y);<br />
$alpha = ($rgba &amp; 0x7F000000) &gt;&gt; 24;<br />
$red = ($rgba &amp; 0xFF0000) &gt;&gt; 16;<br />
$green = ($rgba &amp; 0x00FF00) &gt;&gt; 8;<br />
$blue = ($rgba &amp; 0x0000FF);<br />
<br />
And there you have what you would need if you have a truecolor image with an alpha channel.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59797""></a>
  <div class="note">
   <strong class="user">robert at future-vision dot nl</strong>
   <a href="#59797" class="date">15-Dec-2005 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Look mom, no tables :)<br />
<br />
I made some changes to the code from 'hazard AT krankteil DOTTILLYDO de' so the function would output a div that displays the image.<br />
<br />
As for the size of the outputted file I can say the original png file was lots smaller, but maybe its a nice feature for small buttons or such.<br />
<br />
The way you can use it is the same as the code from 'hazard AT krankteil DOTTILLYDO de'.<br />
<br />
litle note: each div contains a bogus image. When this is not in IE will screw up the output.<br />
<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; function hexcolor($c) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $r = ($c &gt;&gt; 16) &amp; 0xFF;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $g = ($c &gt;&gt; 8) &amp; 0xFF;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $b = $c &amp; 0xFF;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return '#'.str_pad(dechex($r), 2, '0', STR_PAD_LEFT).str_pad(dechex($g), 2, '0', STR_PAD_LEFT).str_pad(dechex($b), 2, '0', STR_PAD_LEFT);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function png2div($filename) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatefrompng($filename);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $width = imagesx($img);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $height = imagesy($img);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $div_width = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $previous_color = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $output = '&lt;div style="position:relative;width:' . $width . 'px;height:'. $height .'px;"&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($y = 0;$y &lt; $height;++$y){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for($x = 0;$x &lt; $width;++$x){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $current_color = ImageColorAt($img, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($current_color == $previous_color &amp;&amp; $x &lt; $width-1){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ++$div_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $output .= '&lt;div style="position:relative;float:left;width:' . $div_width . 'px;height:1px;background-color:' . hexcolor((($div_width &gt; 1)? $previous_color:$current_color)) . '"&gt;&lt;img src="bogus.gif" alt="" width="1" height="1" /&gt;&lt;/div&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $previous_color = $current_color;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $div_width = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ob_flush();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $output .= '&lt;/div&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $output;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58693""></a>
  <div class="note">
   <strong class="user">hazard AT krankteil DOTTILLYDO de</strong>
   <a href="#58693" class="date">12-Nov-2005 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I saw this png to table code.. and i had written one before =)<br />
<br />
My code does nearly the same as the one posted.. but it will compress the table with the help of colspan :)<br />
<br />
<a href="http://hazard.krankteil.de/stuff/pngtable/imgtest.php" rel="nofollow" target="_blank">http://hazard.krankteil.de/stuff/pngtable/imgtest.php</a><br />
<br />
Code:<br />
<a href="http://hazard.krankteil.de/stuff/pngtable/imgtest.phps" rel="nofollow" target="_blank">http://hazard.krankteil.de/stuff/pngtable/imgtest.phps</a><br />
<a href="http://hazard.krankteil.de/stuff/pngtable/image.phps" rel="nofollow" target="_blank">http://hazard.krankteil.de/stuff/pngtable/image.phps</a><br />
<br />
It's senseless? Well maybe but kinda cool :) Try 5 or 10 as second argument for pngtable() =)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58215""></a>
  <div class="note">
   <strong class="user">T. Dekker</strong>
   <a href="#58215" class="date">27-Oct-2005 12:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In GD 2.x there is support for true color images complete with an alpha channel. GD 2.x has a 7-bit (0-127) alpha channel.<br />
<br />
While most people are used to an 8-bit (0-255) alpha channel, it is actually quite handy that GD's is 7-bit (0-127). Each pixel is represented by a 32-bit signed integer, with the four 8-bit bytes arranged like this:<br />
<br />
&nbsp;High Byte &lt;--&gt; Low Byte<br />
{Alpha Channel} {Red} {Green} {Blue}<br />
<br />
For a signed integer, the leftmost bit, or the highest bit, is used to indicate whether the value is negative, thus leaving only 31 bits of actual information. PHP's default integer value is a signed long into which we can store a single GD palette entry. Whether that integer is positive or negative tells us whether antialiasing is enabled for that palette entry.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56427""></a>
  <div class="note">
   <strong class="user">swimgod</strong>
   <a href="#56427" class="date">02-Sep-2005 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this function i made will compare two($start-$finish) images and change the pixels with diffrent colors in the "finish" image<br />
then displays them both next to each other in one image<br />
<br />
another feature is "display" which will echo text<br />
"50% on<br />
50% off"-% count(if the number is lower then 1 it will go into one decamil count<br />
<br />
or type "2" will be<br />
"10023 on<br />
3000 off"-pixel count<br />
<br />
one last feature is "color" <br />
which you define in an array<br />
$color = array("r" =&gt; "244","g" =&gt; "122","b" =&gt; "100");<br />
<br />
to finish up the discrpition im gonna show this "map" of my function<br />
compare($start, $finish[, $color[, $display[, $type]]])<br />
image-url($start) - base image URL<br />
image-url($finish) - compare image URL<br />
array($color) - array with keys "r", "g", "b" r being RED 0-255 g being GREEN 0-255 b being BLUE 0-255<br />
bool($display) - 1 OR TRUE will return text stats from compare<br />
int($type) - 1 OR 0 | 1 being % results | 0 being pixel results<br />
<br />
&lt;?<br />
function compare($start, $finish, $color, $display, $type){<br />
<br />
$im = ImageCreateFrompng($start);<br />
$im2 = ImageCreateFrompng($finish);<br />
$img['x'] = imagesx($im);<br />
$img['y'] = imagesy($im);<br />
$img2['x'] = imagesx($im2);<br />
$img2['y'] = imagesy($im2);<br />
if(($img['x'] == $img2['x']) &amp;&amp; ($img['y'] == $img2['y'])){<br />
<br />
//get and set image hieght and width<br />
$i = array("width" =&gt;&nbsp; $img['x']*2, "height" =&gt; $img['y']);<br />
$im3 = imagecreatetruecolor($i['width'], $i['height']);<br />
if($color){ <br />
$color = imagecolorallocate($im3, $color['r'], $color['g'], $color['b']);<br />
}else{<br />
<br />
$color = imagecolorallocate($im3, 255, 255, 255);<br />
}<br />
for($y = $img['y'];$y &gt; 0; $y--){<br />
for($x = $img['x'];$x &gt; 0; $x--){<br />
if(ImageColorAt($im, $x, $y) == ImageColorAt($im2, $x, $y)){<br />
$on = $on+1;<br />
$rgb = ImageColorAt($im, $x, $y);<br />
Imagesetpixel($im3, $img['x']+$x, $y, $rgb);<br />
}else{<br />
$off = $off+1;<br />
imagesetpixel($im3, $img['x']+$x, $y , $color);<br />
}<br />
}<br />
}<br />
if($display == true){<br />
if(($type == "1") || (!$type)){<br />
$off2 = (round(($off / $on)*10));<br />
if(($off2 == 0) &amp;&amp; ($off &gt; 0)){<br />
$off2 = round(($off / $on)*10)*10;<br />
}<br />
$on2 = (100-$off2);<br />
$off2 .="%";<br />
$on2 .="%";<br />
}else{<br />
$off2 = $off;<br />
$on2 = $on;<br />
}<br />
echo $off2 ." off&lt;br&gt;". $on2 ." on";<br />
}else{<br />
imagecopy($im3, $im, 0, 0, 0, 0, $img['x'], $img['y']);<br />
@header("Content-type: image/png");<br />
imagepng($im3);<br />
imagedestroy($im3);<br />
}<br />
imagedestroy($im);<br />
imagedestroy($im2);<br />
return TRUE;<br />
}else{<br />
return False;<br />
}<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56243""></a>
  <div class="note">
   <strong class="user">Super Moi</strong>
   <a href="#56243" class="date">28-Aug-2005 08:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a contribution for change tint.<br />
<br />
function colorize($path_image, $red, $green, $blue)<br />
{<br />
&nbsp;&nbsp; &nbsp;&nbsp; $im = imagecreatefrompng($path_image);<br />
&nbsp;&nbsp;&nbsp; $pixel = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $n_im = imagecreatetruecolor(imagesx($im),imagesy($im));<br />
&nbsp;&nbsp;&nbsp; $fond = imagecolorallocatealpha($n_im, 255, 255, 255, 0);<br />
&nbsp;&nbsp;&nbsp; imagefill($n_im, 0, 0, $fond);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; for($y=0;$y&lt;imagesy($n_im);$y++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($x=0;$x&lt;imagesx($n_im);$x++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rgb = imagecolorat($im, $x, $y);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pixel = imagecolorsforindex($im, $rgb);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $r = min(round($red*$pixel['red']/169),255);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $g = min(round($green*$pixel['green']/169),255);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $b = min(round($blue*$pixel['blue']/169),255);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $a = $pixel['alpha'];&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo('red : '.$pixel['red'].' =&gt; '.$r.', green : '.$pixel['green'].' =&gt; '.$g.', blue : '.$pixel['blue'].' =&gt; '.$b.', alpha : '.$pixel['alpha'].' =&gt; '.$a.'&lt;br&gt;');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pixelcolor = imagecolorallocatealpha($n_im, $r, $g, $b, $a);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagealphablending($n_im, TRUE);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($n_im, $x, $y, $pixelcolor);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; imagepng($n_im,'test.png');<br />
&nbsp;&nbsp; &nbsp; &nbsp; imagedestroy($n_im);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53109""></a>
  <div class="note">
   <strong class="user">bpgordon at gmail dot com</strong>
   <a href="#53109" class="date">23-May-2005 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(the previous post was mistyped; please delete)<br />
<br />
The following code converts a png image to an html table made up of colored 1x1 cells. Put the path (relative to the location of the script) to the image to be converted in the query, like this: <a href="http://yoursite.com/conv.php?image.png" rel="nofollow" target="_blank">http://yoursite.com/conv.php?image.png</a><br />
Remember that you can only use a remote path if remote fopen is enabled.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">print </span><span class="string">"&lt;table border=0 cellpadding=0 cellspacing=0&gt;&lt;tr&gt;"</span><span class="keyword">;<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"QUERY_STRING"</span><span class="keyword">]);<br />
</span><span class="default">$xdim </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">$ydim </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt;= </span><span class="default">$xdim</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt;= </span><span class="default">$ydim</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
</span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
</span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
print </span><span class="string">"&lt;td width=\"1\" height=\"1\" style=\"background-color: rgb(</span><span class="default">$r</span><span class="string">, </span><span class="default">$g</span><span class="string">, </span><span class="default">$b</span><span class="string">);\"&gt;&lt;/td&gt;"</span><span class="keyword">;<br />
}<br />
print </span><span class="string">"&lt;/tr&gt;&lt;tr&gt;"</span><span class="keyword">;<br />
}<br />
print </span><span class="string">"&lt;/tr&gt;&lt;/table&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53060""></a>
  <div class="note">
   <strong class="user">bpgordon at gmail dot com</strong>
   <a href="#53060" class="date">22-May-2005 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following code converts a png image to an html table made up of colored 1x1 cells. Put the path (relative to the location of the script) to the image to be converted in the query, like this: <a href="http://yoursite.com/conv.php?image.png" rel="nofollow" target="_blank">http://yoursite.com/conv.php?image.png</a><br />
Remember that you can only use a remote path if remote fopen is enabled.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">print </span><span class="string">"&amp;lt;table border=0 cellpadding=0 cellspacing=0&amp;gt;&amp;lt;tr&amp;gt;"</span><span class="keyword">;<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"QUERY_STRING"</span><span class="keyword">]);<br />
</span><span class="default">$xdim </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">$ydim </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&amp;</span><span class="default">lt</span><span class="keyword">;= </span><span class="default">$xdim</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&amp;</span><span class="default">lt</span><span class="keyword">;= </span><span class="default">$ydim</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
</span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
</span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&amp;</span><span class="default">gt</span><span class="keyword">;&amp;</span><span class="default">gt</span><span class="keyword">; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&amp;</span><span class="default">gt</span><span class="keyword">;&amp;</span><span class="default">gt</span><span class="keyword">; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
print </span><span class="string">"&amp;lt;td width=\"1\" height=\"1\" style=\"background-color: rgb(</span><span class="default">$r</span><span class="string">, </span><span class="default">$g</span><span class="string">, </span><span class="default">$b</span><span class="string">);\"&amp;gt;&amp;lt;/td&amp;gt;"</span><span class="keyword">;<br />
}<br />
print </span><span class="string">"&amp;lt;/tr&amp;gt;&amp;lt;tr&amp;gt;"</span><span class="keyword">;<br />
}<br />
print </span><span class="string">"&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52252""></a>
  <div class="note">
   <strong class="user">sys NO SPAM coder at gmail dot NOSPAM dot com</strong>
   <a href="#52252" class="date">26-Apr-2005 03:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just for fun: another snippet for drawing images using html only X)<br />
<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&lt;style&gt;<br />
&lt;!--<br />
body {<br />
font-family: courier new, courier;<br />
font-size: 7pt;<br />
background: #000000;<br />
color: #000000;<br />
}<br />
--&gt;<br />
&lt;/style&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
&lt;font color="#000000"&gt;<br />
<span class="default">&lt;?php<br />
<br />
$im </span><span class="keyword">= </span><span class="default">ImageCreateFromPng</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'img'</span><span class="keyword">]);<br />
<br />
</span><span class="default">$lastcolor</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);</span><span class="default">$y</span><span class="keyword">++)<br />
{<br />
&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);</span><span class="default">$x</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pixel </span><span class="keyword">= </span><span class="default">ImageColorAt</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$lastcolor </span><span class="keyword">!= </span><span class="default">$pixel</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">'&lt;/font&gt;&lt;font color="#%06x"&gt;'</span><span class="keyword">, </span><span class="default">$pixel</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$lastcolor </span><span class="keyword">= </span><span class="default">$pixel</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"*"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span>&lt;/font&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49166""></a>
  <div class="note">
   
   <a href="#49166" class="date">18-Jan-2005 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Optimal:<br />
<span class="default">&lt;?php<br />
$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
</span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">);<br />
</span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">255</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">255</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>As you see, you can also use decimal values (faster).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46674""></a>
  <div class="note">
   <strong class="user">jed at jed dot bz</strong>
   <a href="#46674" class="date">19-Oct-2004 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my various play stages with photomosaics I ended up writing this function that works with GD 2. The conversion from RGB to HSL is straightforward and there are a number of papers on it on our beloved Internet; however, this function simply finds the lightness value for a pixel and works exactly the same as imagecolorat(). <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* Computes the lightness of a pixel. Lightness is used in HSL notation, as well<br />
&nbsp;* as in various operations on images. This function returns a normalized value<br />
&nbsp;* for lightness between 0 and 1, inclusive (0.0 being black, 1.0 being white).<br />
&nbsp;*<br />
&nbsp;* double imagelightnessat(resource img, int x, int y)<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; img&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; An open image resource to operate on (true color or palette)<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; x, y&nbsp; &nbsp; &nbsp; &nbsp; The coordinates of the pixel to work on<br />
&nbsp;*<br />
&nbsp;* by Jed Smith &lt;?php $u = "jed"; $d = "bz"; printf("&lt;%s@%s.%s&gt;", $u, $u, $d) ?&gt;<br />
&nbsp;*/ <br />
</span><span class="keyword">function </span><span class="default">imagelightnessat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"imagelightnessat(): supplied argument is not a valid "<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Image resource"</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0.0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= @</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">imageistruecolor</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red </span><span class="keyword">= (</span><span class="default">$c </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green </span><span class="keyword">= (</span><span class="default">$c </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue </span><span class="keyword">= </span><span class="default">$c </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$n </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Because RGB isn't normalized in GD, we divide by 510 here.<br />
&nbsp;&nbsp; &nbsp; *&nbsp; Lightness = (Max(RGB) + Min(RGB)) / 2<br />
&nbsp;&nbsp; &nbsp; * But that's assuming red, green, and blue are 0 through 1 inclusive.<br />
&nbsp;&nbsp; &nbsp; * Red, green, and blue are actually 0-255 (255 + 255 = 510).<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lightness </span><span class="keyword">= (double)((</span><span class="default">$m </span><span class="keyword">+ </span><span class="default">$n</span><span class="keyword">) / </span><span class="default">510.0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$lightness</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40284""></a>
  <div class="note">
   <strong class="user">mumig at poczta dot onet dot pl</strong>
   <a href="#40284" class="date">27-Feb-2004 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imagecolorat() works differently for png's with true color and for paletted png's - for true color it returns value of color, for paletted it returns index number and you have to use&nbsp; imagecolorsforindex() to get rgb color value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32893""></a>
  <div class="note">
   <strong class="user">geat AT zoom DOT co DOT uk</strong>
   <a href="#32893" class="date">10-Jun-2003 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The HTML image renderer didn't work for me for some reason, but here's a version that does...<br />
<br />
echo '&lt;table border="0" cellspacing="0" cellpadding="0"&gt;';<br />
$im = ImageCreateFromJPEG("IMAGE NAME");<br />
$width = imagesx($im);<br />
$height = imagesy($im);<br />
for ($cy=0;$cy&lt;$height;$cy++) {<br />
&nbsp; echo '&lt;tr&gt;';<br />
&nbsp; for ($cx=0;$cx&lt;$width;$cx++) {<br />
&nbsp;&nbsp;&nbsp; $rgb = ImageColorAt($im, $cx, $cy);<br />
&nbsp;&nbsp;&nbsp; $col = imagecolorsforindex($im, $rgb); <br />
&nbsp;&nbsp;&nbsp; printf('&lt;td width="2" height="2" bgcolor=#%02x%02x%02x&gt;&lt;/td&gt;', $col["red"], $col["green"], $col["blue"]);<br />
&nbsp; }<br />
echo '&lt;/tr&gt;';<br />
}<br />
echo '&lt;/table&gt;';</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32464""></a>
  <div class="note">
   
   <a href="#32464" class="date">28-May-2003 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just for fun, here is a little snippet that "paints" a image in html only. Try it out with very small images, as this is a real browser-killer. mozilla &gt; 120mb ram, ie &gt; 100mb with a 300x200 image :-)<br />
<br />
$file = "image.png";<br />
$im = imagecreatefrompng($file);<br />
$size_arr = getimagesize($file);<br />
<br />
echo "&lt;table width=".$size_arr[0]." height=".$size_arr[1]." cellpadding=0 cellspacing=0 border=0&gt;";<br />
for ($y=0; $y&lt;$size_arr[1]; $y++) {<br />
&nbsp;&nbsp;&nbsp; echo "&lt;tr&gt;";<br />
&nbsp;&nbsp;&nbsp; for ($x=0; $x&lt;$size_arr[0]; $x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $rgb = ImageColorAt($im, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; printf("&lt;td width=1 bgcolor=%06x&gt;&lt;img width=1&gt;&lt;/td&gt;", $rgb);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo "&lt;/tr&gt;";<br />
}<br />
echo "&lt;/table&gt;";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28690""></a>
  <div class="note">
   <strong class="user">lachy at kennedia dot com</strong>
   <a href="#28690" class="date">20-Jan-2003 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that if you don not have GD 2.0.1+ then the alpha value will not be available.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28115""></a>
  <div class="note">
   <strong class="user">ceresATdivxmaniaDOTit</strong>
   <a href="#28115" class="date">02-Jan-2003 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get RGB values of a pixel in a truecolor image:<br />
<br />
&lt;?<br />
$image=imageCreateFromJPEG('image.jpg');<br />
$x = 10;<br />
$y = 15;<br />
$colorindex = imagecolorat($image,$x,$y);<br />
$colorrgb = imagecolorsforindex($image,$colorindex);<br />
<br />
echo "RGB values of the pixel at position $x - $y are: $colorrgb['red'] $colorrgb['green'] $colorrgb['blue'] \n Apha value is: $colorrgb['alpha']";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22953""></a>
  <div class="note">
   <strong class="user">pete at spamisbad_holidian dot com</strong>
   <a href="#22953" class="date">05-Jul-2002 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a truecolor image and absolutely need to get the actual color of a pixel, it seems like you could create a 16x16 indexed color image from a part of the True Color image containing the pixel(s) in question. Then you should be able to guarantee that the indexed sample has the indentical colors to the True Color image. you can then use this function to get the color index of a pixel in the sample. <br />
<br />
Obviously, this would be an intensive way to get pixel colors, especially for a large image, but as far as I can tell, it's one of the very few ways to do it right now.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecolorallocatealpha.html">imagecolorallocatealpha</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecolorclosest.html">imagecolorclosest</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
