<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Get the index of the closest color to the specified color</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecolorat.html">imagecolorat</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecolorclosestalpha.html">imagecolorclosestalpha</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagecolorclosest" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolorclosest</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imagecolorclosest</span> &mdash; <span class="dc-title">Get the index of the closest color to the specified color</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecolorclosest-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><b>imagecolorclosest</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$image</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$red</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$green</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$blue</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Returns the index of the color in the palette of the image which
   is &quot;closest&quot; to the specified <acronym title="Red-Green-Blue">RGB</acronym> value.
  </p>
  <p class="para">
   The &quot;distance&quot; between the desired color and each color in the
   palette is calculated as if the <acronym title="Red-Green-Blue">RGB</acronym> values
   represented points in three-dimensional space.
  </p>
  <p class="para">If you created the image from a file, only colors used in the image are resolved. Colors present only in the palette are not resolved.</p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecolorclosest-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><i><tt class="parameter">
image</tt></i></span><dd>
<p class="para">An image resource, returned by one of the image creation functions,
such as <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>.</p></dd>
</dt>

    <dt>

     <span class="term"><i><tt class="parameter">red</tt></i></span>
     <dd>

      <p class="para">Value of red component.</p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">green</tt></i></span>
     <dd>

      <p class="para">Value of green component.</p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">blue</tt></i></span>
     <dd>

      <p class="para">Value of blue component.</p>
     </dd>

    </dt>

   </dl>

   The colors parameters are integers between 0 and 255 or hexadecimals
   between 0x00 and 0xFF.
  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecolorclosest-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the index of the closest color, in the palette of the image, to
   the specified one
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecolorclosest-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2938">
    <p><b>Example #1 Search for a set of colors in an image</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Start&nbsp;with&nbsp;an&nbsp;image&nbsp;and&nbsp;convert&nbsp;it&nbsp;to&nbsp;a&nbsp;palette-based&nbsp;image<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #DD0000">'figures/imagecolorclosest.png'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagetruecolortopalette</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Search&nbsp;colors&nbsp;(RGB)<br /></span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">254</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">145</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">154</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">153</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">145</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">188</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">153</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">90</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">145</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">137</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">92</span><span style="color: #007700">)<br />);<br /><br /></span><span style="color: #FF8000">//&nbsp;Loop&nbsp;through&nbsp;each&nbsp;search&nbsp;and&nbsp;find&nbsp;the&nbsp;closest&nbsp;color&nbsp;in&nbsp;the&nbsp;palette.<br />//&nbsp;Return&nbsp;the&nbsp;search&nbsp;number,&nbsp;the&nbsp;search&nbsp;RGB&nbsp;and&nbsp;the&nbsp;converted&nbsp;RGB&nbsp;match<br /></span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorclosest</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorsforindex</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"(</span><span style="color: #007700">{</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #DD0000">'red'</span><span style="color: #007700">]}</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #DD0000">'green'</span><span style="color: #007700">]}</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #DD0000">'blue'</span><span style="color: #007700">]}</span><span style="color: #DD0000">)"</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"#</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">:&nbsp;Search&nbsp;(</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]</span><span style="color: #DD0000">);&nbsp;Closest&nbsp;match:&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #DD0000">.\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
#0: Search (254, 145, 154); Closest match: (252, 150, 148).
#1: Search (153, 145, 188); Closest match: (148, 150, 196).
#2: Search (153, 90, 145); Closest match: (148, 90, 156).
#3: Search (255, 137, 92); Closest match: (252, 150, 92).
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagecolorclosest-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagecolorexact.html" class="function" rel="rdfs-seeAlso">imagecolorexact()</a> - Get the index of the specified color</span></li>
    <li class="member"><span class="function"><a href="function.imagecolorclosestalpha.html" class="function" rel="rdfs-seeAlso">imagecolorclosestalpha()</a> - Get the index of the closest color to the specified color + alpha</span></li>
    <li class="member"><span class="function"><a href="function.imagecolorclosesthwb.html" class="function" rel="rdfs-seeAlso">imagecolorclosesthwb()</a> - Get the index of the color which has the hue, white and blackness</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106433""></a>
  <div class="note">
   <strong class="user">info at codeworx dot ch</strong>
   <a href="#106433" class="date">09-Nov-2011 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function that compares two HEX colors for similarity. This can be useful if you want to detect colors that are not different enough to see for the naked eye. It returns a bool: TRUE if the colors are similar to each other (within tolerance) or FALSE if they are different enough.<br />
I tested a few colors and came up with a tolerance of 35 (rgb value - should be between 0 and 255) but you can change that tolerance by passing a third parameter to the function.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">compareColors </span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">$col2</span><span class="keyword">, </span><span class="default">$tolerance</span><span class="keyword">=</span><span class="default">35</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$col1Rgb </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"r" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"g" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"b" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$col2Rgb </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"r" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"g" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"b" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col2</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] &gt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] - </span><span class="default">$tolerance </span><span class="keyword">&amp;&amp; </span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] &lt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] + </span><span class="default">$tolerance</span><span class="keyword">) &amp;&amp; (</span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] &gt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] - </span><span class="default">$tolerance </span><span class="keyword">&amp;&amp; </span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] &lt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] + </span><span class="default">$tolerance</span><span class="keyword">) &amp;&amp; (</span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] &gt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] - </span><span class="default">$tolerance </span><span class="keyword">&amp;&amp; </span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] &lt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] + </span><span class="default">$tolerance</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54254""></a>
  <div class="note">
   <strong class="user">MagicalTux at FF dot st</strong>
   <a href="#54254" class="date">28-Jun-2005 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A way to get each time an answer :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagegetcolor</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">) return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">) return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">imagecolorclosest</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If the *exact* color is found in the image, it will be returned. If we don't have the exact color, we try to allocate it. If we can't allocate it, we return the closest color in the image.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36489""></a>
  <div class="note">
   <strong class="user">Vikrant Korde &lt;vakorde at hotmail dot com&gt;</strong>
   <a href="#36489" class="date">11-Oct-2003 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This functuion is useful when you are dealing with previously present images like .png, .jpg, etc. You can use this function for writing a text on the image.<br />
<br />
For me the function imagecolorallocate() was returning the -1 value. after lot of RnD and site search i found a function use of imagecolorclosest(). This solved my problem of writing the text on the image with customised color. <br />
<br />
Actually previously it was writing on the image but the color was not distinct. It was using the same color as of that background image. <br />
<br />
The following code segment was fine with me.<br />
<br />
header ("Content-type: image/jpeg"); <br />
$im = imagecreatefromjpeg("BlankButton.jpg");<br />
$white = imageColorClosest($im, 255,255,255);<br />
// this is for TTF fonts<br />
imagettftext ($im, 20, 0, 16, 30, $white, "/usr/X11R6/lib/X11/fonts/TTF/luximb.ttf", "Vikrant"); <br />
<br />
//this is for notmal font<br />
imagestring($im, 4, 0,0,"Korde", $white);<br />
imagejpeg($im,"",150); <br />
imagedestroy ($im);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecolorat.html">imagecolorat</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecolorclosestalpha.html">imagecolorclosestalpha</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
