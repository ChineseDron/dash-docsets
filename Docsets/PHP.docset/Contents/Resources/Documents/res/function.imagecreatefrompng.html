<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Create a new image from file or URL</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecreatefromjpeg.html">imagecreatefromjpeg</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecreatefromstring.html">imagecreatefromstring</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagecreatefrompng" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecreatefrompng</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imagecreatefrompng</span> &mdash; <span class="dc-title">Create a new image from file or URL</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecreatefrompng-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><b>imagecreatefrompng</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$filename</tt></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><b>imagecreatefrompng()</b></span> returns an image identifier
   representing the image obtained from the given filename.
  </p>
  <div class="tip"><b class="tip">Tip</b><p class="simpara">A URL can be used as a
filename with this function if the <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">fopen wrappers</a> have been enabled.
See <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span> for more details on how to specify the
filename. See the <a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a> for links to information
about what abilities the various wrappers have, notes on their usage,
and information on any predefined variables they may
provide.</p></div>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecreatefrompng-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">filename</tt></i></span>
     <dd>

      <p class="para">
       Path to the PNG image.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecreatefrompng-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">Returns an image resource identifier on success, <b><tt>FALSE</tt></b> on errors.</p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecreatefrompng-examples">
  <h3 class="title">Examples</h3>
  <div class="example" id="example-2965">
   <p><b>Example #1 Example to handle an error during loading of a PNG</b></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">LoadPNG</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Attempt&nbsp;to&nbsp;open&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;See&nbsp;if&nbsp;it&nbsp;failed&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">$im</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Create&nbsp;a&nbsp;blank&nbsp;image&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$im&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$bgc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tc&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$bgc</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Output&nbsp;an&nbsp;error&nbsp;message&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Error&nbsp;loading&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tc</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$im</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$img&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LoadPNG</span><span style="color: #007700">(</span><span style="color: #DD0000">'bogus.image'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above example will output
something similar to:</p></div>
   <div class="mediaobject">
    
    <div class="imageobject">
     <img src="images/21009b70229598c6a80eef8b45bf282b-imagecreatefrompng.png" alt="imagecreatefrompng() example" width="150" height="30" />
    </div>
   </div>
  </div>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecreatefrompng-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><b class="warning">Warning</b><p class="para">Windows versions of PHP
prior to PHP 4.3.0 do not support access of remote files via this function,
even if <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">allow_url_fopen</a> is enabled.
</p></div>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="100185""></a>
  <div class="note">
   <strong class="user">flood at itnews-bg dot com</strong>
   <a href="#100185" class="date">29-Sep-2010 03:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey,<br />
<br />
I just want to add for those of you who're having problem creating thumbs from png files - when you're using the "imagepng()" function put it in a variable. If you don't put it you'll probably be wondering why you're page will offer you to download itself rather than resizing it.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">resizeFile</span><span class="keyword">(</span><span class="default">$fileInfo</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uploadedfile </span><span class="keyword">= </span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'full'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$image</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'ext'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$extension</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'full'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$size </span><span class="keyword">&gt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">maxSize </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'You have exceeded the size limit!'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uploadedfile </span><span class="keyword">= </span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'full'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromstring</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">130</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newheight </span><span class="keyword">= (</span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">) * </span><span class="default">$newwidth</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filenameThumb </span><span class="keyword">= </span><span class="string">"images/thumbs/" </span><span class="keyword">. </span><span class="default">$fileInfo</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$extension </span><span class="keyword">== (</span><span class="string">"jpg" </span><span class="keyword">|| </span><span class="string">"jpeg"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$filenameThumb</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if(</span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"png"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Disallow png display - this will create an image but won't display it!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmpPng </span><span class="keyword">= </span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$filenameThumb</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$filenameThumb</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Fatal error."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90364""></a>
  <div class="note">
   <strong class="user">admin at wdfa dot co dot uk</strong>
   <a href="#90364" class="date">17-Apr-2009 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using imagecreatepng with alpha blending you will lose the blending.<br />
<br />
To over come this use something like the following<br />
<span class="default">&lt;?php<br />
$dstimage</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">$srcimage</span><span class="keyword">=</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dstimage</span><span class="keyword">,</span><span class="default">$srcimage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Where $width and $height are the width and height of the $src image.<br />
<br />
This will create a true colour image then copy the png image to this true colour image and retain alpha blending.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90082""></a>
  <div class="note">
   <strong class="user">CPHaxer</strong>
   <a href="#90082" class="date">05-Apr-2009 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This PHP-Script checks a Picture of a Sky and tells you how Cloudy it is.<br />
<br />
The best thing is, if you enter the Path to a Webcam Picture, which is often updated and where its Webcam is showing [ONLY] the Sky.<br />
<br />
BTW: At the Blue_Color Array you can enter the RGB-Values of a Pixel of your Sky. Its optional, but if you enter it, the Analisations will be more prectise.<br />
<br />
The Percession Variable controls which Pixels get scanned.<br />
If you have large Pictures, enter a high Number there.<br />
<br />
<a href="http://pastebin.com/f582d5286" rel="nofollow" target="_blank">http://pastebin.com/f582d5286</a><br />
<br />
PS: Sorry I need to give you Pastebin Link. The Note is to big else :s</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85754""></a>
  <div class="note">
   <strong class="user">luxian.m [at] gmail [dot] com</strong>
   <a href="#85754" class="date">16-Sep-2008 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget about imagealphablending() and imagesavealpha() if you're working with [semi]transparent png.<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="string">'semitransparent.png'</span><span class="keyword">; </span><span class="comment">// path to png image<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">// open image<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">// setting alpha blending on<br />
</span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">// save alphablending setting (important)<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78290""></a>
  <div class="note">
   <strong class="user">anders jenbo pc dk</strong>
   <a href="#78290" class="date">05-Oct-2007 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some testing shows that i am able to load images that are 0.8Mpixels with a 8MB memory limit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78256""></a>
  <div class="note">
   <strong class="user">anders jenbo pc dk</strong>
   <a href="#78256" class="date">04-Oct-2007 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function seams to take up twise the memory when running then the final alocated size.<br />
Memory limit is set to 8M but i get and error saying it tryed to alocate 2288640 and a memory check just befor the function runs sayes that it it at 3106120 witch is only 5.1M, if i change the order of the program and load the png befor the additional 3M is used i have no issues.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73546""></a>
  <div class="note">
   <strong class="user">marcos at assl-site dot net</strong>
   <a href="#73546" class="date">28-Feb-2007 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the same problem as jboyd1189 at yahoo dot com but I solve d it allocating more memory dynamically.<br />
<br />
Usually the memory_limit var on php.ini is set to 8M. Unfortunately, the required amount of memory to manage a PNG image about 1000x1000 could be bigger !<br />
<br />
The approach I used to solve the problem is:<br />
<br />
1-Calculate the memory required by the image<br />
2-Set the new memory_limit value <br />
3-Create the PNG image and thumbnail<br />
4-Restore the original value<br />
<br />
1-The following value works for me:<br />
$required_memory = Round($width * $height * $size['bits']);<br />
<br />
Note that for JPEG the requirements are not the same:<br />
<a href="http://es2.php.net/manual/en/function.imagecreatefromjpeg.php#60241" rel="nofollow" target="_blank">http://es2.php.net/manual/en/function.imagecreatefromjpeg.php#60241</a><br />
<br />
2-Use somthing like: <br />
$new_limit=memory_get_usage() + $required_memory;<br />
ini_set("memory_limit", $new_limit);<br />
<br />
4-ini_restore ("memory_limit");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71091""></a>
  <div class="note">
   <strong class="user">dane.tschi _AT_ NOSPAM gmx [dot] at</strong>
   <a href="#71091" class="date">11-Nov-2006 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem with PNG files.<br />
My source files were PNG-8 files and i wanted to add some drawings to the Image with alpha blending, but it was not possible only by doing imagecolorallocatealpha() and imagefilledellipse() for example.<br />
I noticed that it was only working for PNG-24 images, but i don't want to use them, because they are to big for my website, but PNG-8 files would be much greater.<br />
My result is that the image has to be converted to PNG-24 after loading and converted back to PNG-8 before saving/output.<br />
This is the script:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Load Image and get it's size<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="string">"png8image.png"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"png8image.png"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Convert the Image to PNG-24<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im_tc </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$im_tc</span><span class="keyword">,</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Now do what ever you want, all alpha-operation do work<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha </span><span class="keyword">(</span><span class="default">$im_tc</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">75</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagefilledellipse </span><span class="keyword">(</span><span class="default">$im_tc</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//And now convert it back to PNG-8<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im_result </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$im_result</span><span class="keyword">,</span><span class="default">$im_tc</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im_tc</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//And save it<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im_result</span><span class="keyword">,</span><span class="string">"png8image.png"</span><span class="keyword">);&nbsp; &nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67854""></a>
  <div class="note">
   <strong class="user">jboyd1189 at yahoo dot com</strong>
   <a href="#67854" class="date">05-Jul-2006 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having a terrible time with the imagecreatefrompng function as it was working perfectly for one image and not at all for another.&nbsp; After many hours of frustration, I discovered that the problem was the image size (number of pixels).&nbsp; It appears that the maximum number of pixels this function will process is 1,040,000.&nbsp; So, be sure that the pixel resolution of the image (eg. 1040 x 1000) does not exceed this value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66878""></a>
  <div class="note">
   <strong class="user">alext82 at hotmail dot com</strong>
   <a href="#66878" class="date">31-May-2006 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having trouble with <br />
$black = imagecolorallocate($im, 0, 0, 0);<br />
, as it would always display grey letters.<br />
<br />
this solved it however:<br />
<br />
$black = imagecolorresolve($im, 0, 0, 0);<br />
<br />
this regarding this function.<br />
<br />
imagettftext($im, 11, 7, 55, 60, $black, $font, $string);<br />
<br />
I hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65458""></a>
  <div class="note">
   <strong class="user">hendrikjan dot vanmeerveld at gmail dot com</strong>
   <a href="#65458" class="date">01-May-2006 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another usefull note for those using ImageCreateFromPng:<br />
PHP and GD do not recognize grayscale/alpha images.<br />
<br />
So if you use grayscale images with transparency between 0% and 100%, then save the image as RGB.<br />
<br />
At least this is true for PHP Version 4.4.2-1 and in 5.1.2-1 with pictures made with GIMP 2.2.8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56495""></a>
  <div class="note">
   <strong class="user">ketay [AT] comcast [DOT] net</strong>
   <a href="#56495" class="date">05-Sep-2005 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A correction... If you are to set it to FALSE, then not only does it add the transparency to wherever you put it, but it takes the transparency out of the TTF files. Setting it to TRUE however, keeps your transparency both in your PNG file, and in any TTF text you make apply to the image.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47083""></a>
  <div class="note">
   <strong class="user">rf at i---i dot org</strong>
   <a href="#47083" class="date">02-Nov-2004 03:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
***CORRECTION*** to 07-Jun-2004 01:14 <br />
imageAlphaBlending must be false, NOT TRUE<br />
<br />
$imgPng = imageCreateFromPng($strImagePath);<br />
imageAlphaBlending($imgPng, false); &lt;&lt;&lt;FALSE<br />
imageSaveAlpha($imgPng, true);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43024""></a>
  <div class="note">
   
   <a href="#43024" class="date">07-Jun-2004 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to load a translucent png-24 image but are finding an absence of transparency (like it's black), you need to enable alpha channel AND save the setting. I'm new to GD and it took me almost two hours to figure this out.<br />
<br />
<span class="default">&lt;?php<br />
$imgPng </span><span class="keyword">= </span><span class="default">imageCreateFromPng</span><span class="keyword">(</span><span class="default">$strImagePath</span><span class="keyword">);<br />
</span><span class="default">imageAlphaBlending</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">imageSaveAlpha</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Output image to browser */<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">imagePng</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42852""></a>
  <div class="note">
   <strong class="user">csaba at alum dot mit dot edu</strong>
   <a href="#42852" class="date">31-May-2004 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a another case of someone (IE) thinking they know better than you what you want.&nbsp; If you are of a mind to generate a complicated (read takes a long time) image incrementally, you might do it by having an IFRAME which calls to the image generating PHP script.&nbsp; That munches for a bit, saves the file, returns to the client (remembering we're in the iframe so the user doesn't see all this) (with appropriate state information in &lt;input type=hidden ...&gt; fields) which kicks off an &lt;body onLoad='docInit()' ...&gt; whose purpose is to set the src attribute of the png image to the saved file (so the user sees the changes), and then resubmit the iframe (the image isn't in the iframe so the iframe can be hidden) to repeat the process.&nbsp; Very nifty.<br />
<br />
However, IE 6 has decided that it is far better to use a cached version of an image even on a local machine, where it can readily see that it changed, rather than to go to the source.&nbsp; And, since it's a file, you can't so easily set headers on it.&nbsp; This means that your incremental updates may not show any updates.<br />
<br />
I solved this by (1) having Apache rewrite every .png request to a single .php file:<br />
RewriteRule ^(.*).png$ pngPassThru.php?file=$1.png [QSA,L,NC]<br />
<br />
(2) All pngPassThru.php does is to return the .png file with "don't cache me" headers.&nbsp; Avoid leading/trailing spaces in pngPassThru.php.&nbsp; The headers might be simplified - I've collected them from various sources and am not sure which ones could be eliminated.&nbsp; But this is working for me on IE 6:<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Expires: Mon, 26 Jul 1997 05:00:00 GMT"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Last-Modified: " </span><span class="keyword">. </span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">"D, d M Y H:i:s"</span><span class="keyword">) . </span><span class="string">" GMT"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Cache-Control: no-store, no-cache, must-revalidate"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Cache-Control: post-check=0, pre-check=0"</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Pragma: no-cache"</span><span class="keyword">);<br />
</span><span class="default">$file</span><span class="keyword">=@</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">];<br />
</span><span class="default">$size</span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: </span><span class="default">$size</span><span class="string"> bytes"</span><span class="keyword">); <br />
</span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Csaba Gabor</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41944""></a>
  <div class="note">
   <strong class="user">aniakovas at yahoo dot co dot uk</strong>
   <a href="#41944" class="date">27-Apr-2004 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey guys,<br />
<br />
It has been my experience that the image type of a png file is best set to:-<br />
<br />
image/x-png<br />
<br />
This may be a peculiarity of the server I'm working on, which is running Apache/FreeBSD<br />
<br />
Ania</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26569""></a>
  <div class="note">
   <strong class="user">polak_sg at hotmail dot com</strong>
   <a href="#26569" class="date">05-Nov-2002 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
don't forget to write the header into your function file!!<br />
header ("Content-type: image/png");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25776""></a>
  <div class="note">
   <strong class="user">wyvern at greywyvern.com</strong>
   <a href="#25776" class="date">05-Oct-2002 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure when coding image serving scripts that you avoid using the full "<a href="http://" rel="nofollow" target="_blank">http://</a>" URL of the image whenever possible.&nbsp; Use "../imagename" etc.<br />
<br />
Loading URL's from your own site will double your used bandwidth, as the script grabbing the image will count against it as well as sending it to the browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19416""></a>
  <div class="note">
   <strong class="user">robross at comcast dot net</strong>
   <a href="#19416" class="date">26-Feb-2002 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This color table issue is actually a bit more complicated.<br />
<br />
From my testing, it would appear that whatever colors you have specified in the color table for your picture in the first nth number of spots, those colors will automatically be given to the first "n" colors you attempt to use in your CreateImagefromPNG.<br />
<br />
So, for example, if you need to create dynamic black and red text in your image, the first three spots in the color table for your background image should be white, black and red (in this order).<br />
<br />
This can be a pain, but it is the only way to ensure that your images look as intended in all browsers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13044""></a>
  <div class="note">
   <strong class="user">netfiend at mediaone dot net</strong>
   <a href="#13044" class="date">23-May-2001 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've noticed a couple of things with the ImageCreateFromPng function that may be useful if your having problems.&nbsp; <br />
<br />
1st thing I noticed is that the PNG file you are creating from needs to be indexed and less than 256 colors.&nbsp; <br />
<br />
Secondly, you need to reduce the color depth by 1 for each color you plan on generating in php...&nbsp; I.E.&nbsp; if you plan on drawing 50 different colors on the screen with php you need to allocate space for them by reducing the origional image's color depth to 205 colors (I was pulling my hair out on this one for a while because the wrong colors were showing up in the output).&nbsp; <br />
<br />
Also, if you are saving the image as a PNG you need to allocate the 1st color as white.. The reason for this is that Internet Explorer seems to interpret the first color in an indexed PNG as white no matter what color it is... (Figured this out when all my pretty black text was turning up as white in I.E. and was normal in Netscape; allocated the first color in the image as white and the problem went away.) <br />
<br />
-- hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecreatefromjpeg.html">imagecreatefromjpeg</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecreatefromstring.html">imagecreatefromstring</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
