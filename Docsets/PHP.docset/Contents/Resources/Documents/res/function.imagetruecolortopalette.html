<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Convert a true color image to a palette image</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagesy.html">imagesy</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagettfbbox.html">imagettfbbox</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagetruecolortopalette" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagetruecolortopalette</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5)</p><p class="refpurpose"><span class="refname">imagetruecolortopalette</span> &mdash; <span class="dc-title">Convert a true color image to a palette image</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagetruecolortopalette-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><b>imagetruecolortopalette</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$image</tt></span>
   , <span class="methodparam"><span class="type">bool</span> <tt class="parameter">$dither</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$ncolors</tt></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><b>imagetruecolortopalette()</b></span> converts a truecolor image
   to a palette image. The code for this function was originally drawn from
   the Independent JPEG Group library code, which is excellent. The code
   has been modified to preserve as much alpha channel information as
   possible in the resulting palette, in addition to preserving colors as
   well as possible. This does not work as well as might be hoped. It is
   usually best to simply produce a truecolor output image instead, which
   guarantees the highest output quality.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagetruecolortopalette-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><i><tt class="parameter">
image</tt></i></span><dd>
<p class="para">An image resource, returned by one of the image creation functions,
such as <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>.</p></dd>
</dt>

    <dt>

     <span class="term"><i><tt class="parameter">dither</tt></i></span>
     <dd>

      <p class="para">
       Indicates if the image should be dithered - if it is <b><tt>TRUE</tt></b> then
       dithering will be used which will result in a more speckled image but
       with better color approximation.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">ncolors</tt></i></span>
     <dd>

      <p class="para">
       Sets the maximum number of colors that should be retained in the palette.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagetruecolortopalette-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <b><tt>TRUE</tt></b> on success or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagetruecolortopalette-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-3030">
    <p><b>Example #1 Converting a true color image to a palette-based image</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;true&nbsp;color&nbsp;image<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Convert&nbsp;to&nbsp;palette-based&nbsp;with&nbsp;no&nbsp;dithering&nbsp;and&nbsp;255&nbsp;colors<br /></span><span style="color: #0000BB">imagetruecolortopalette</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Save&nbsp;the&nbsp;image<br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'./paletteimage.png'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagetruecolortopalette-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">This function requires GD 2.0.1 or later (2.0.28 or later is recommended).</span></p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="85857""></a>
  <div class="note">
   <strong class="user">djcassis(a)gmail.com</strong>
   <a href="#85857" class="date">21-Sep-2008 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;&gt; zmorris at zsculpt dot com<br />
<br />
I don't have the imageColorMatch() function on my server, but I could slighty improve the quality of the GIF/PNG image by converting it first to 256 colors, then to true colors and finally to the desired number of colors.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$dither </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
</span><span class="default">$colors </span><span class="keyword">= </span><span class="default">64</span><span class="keyword">;<br />
<br />
</span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">imageCreateFromJpeg</span><span class="keyword">(</span><span class="string">'example.jpg'</span><span class="keyword">);<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesX</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesY</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
</span><span class="default">imageTrueColorToPalette</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$dither</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imageCreateTrueColor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">imageCopy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">imageDestroy</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
</span><span class="default">imageTrueColorToPalette</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$dither</span><span class="keyword">, </span><span class="default">$colors</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Final $image will still have less than 64 colors, but more than if it was directly converted to 64 colors, and they match the JPEG image more.<br />
<br />
Dunno why true colors to palette conversions are such a problem...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66766""></a>
  <div class="note">
   <strong class="user">burninleo at gmx dot net</strong>
   <a href="#66766" class="date">28-May-2006 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If You know which palette to use (e.g. 255 colors greyscale) You may achieve better results using the following way:<br />
<br />
1. Create new image<br />
2. Apply palette<br />
3. imagecopy() the content<br />
<br />
This is especially helpful if you created a greyscale picture in trucolor-mode (to use antialiasing for example) but need to send it as palette (to use transparency in Internet Explorer).<br />
<br />
The following example will *not* create great results from "real" truecolor images but works well on grey truecolor images:<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">function </span><span class="default">imageTruecolorToGrayscale</span><span class="keyword">(&amp;</span><span class="default">$image</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$copy </span><span class="keyword">= </span><span class="default">$image</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dx </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dy </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$dx</span><span class="keyword">, </span><span class="default">$dy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// 254 Colors + 1 reserved for transparency<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$transparency </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max </span><span class="keyword">= </span><span class="default">255</span><span class="keyword">; </span><span class="default">$dd </span><span class="keyword">= </span><span class="default">254</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$dd</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$max </span><span class="keyword">* </span><span class="default">$i </span><span class="keyword">/ (</span><span class="default">$dd</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$copy</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dx</span><span class="keyword">, </span><span class="default">$dy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$copy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$transparency</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62309""></a>
  <div class="note">
   <strong class="user">will at fnatic dot com</strong>
   <a href="#62309" class="date">24-Feb-2006 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a basic palette to true color function<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">imagepalettetotruecolor</span><span class="keyword">(&amp;</span><span class="default">$img</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">imageistruecolor</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img1 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">,</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">$img1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44803""></a>
  <div class="note">
   <strong class="user">zmorris at zsculpt dot com</strong>
   <a href="#44803" class="date">16-Aug-2004 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes this function gives ugly/dull colors (especially when ncolors &lt; 256).&nbsp; Here is a replacement that uses a temporary image and ImageColorMatch() to match the colors more accurately.&nbsp; It might be a hair slower, but the file size ends up the same:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function&nbsp; &nbsp; </span><span class="default">ImageTrueColorToPalette2</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$dither</span><span class="keyword">, </span><span class="default">$ncolors </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">( </span><span class="default">$image </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">( </span><span class="default">$image </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$colors_handle </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">( </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageCopyMerge</span><span class="keyword">( </span><span class="default">$colors_handle</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageTrueColorToPalette</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$dither</span><span class="keyword">, </span><span class="default">$ncolors </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageColorMatch</span><span class="keyword">( </span><span class="default">$colors_handle</span><span class="keyword">, </span><span class="default">$image </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">( </span><span class="default">$colors_handle </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42999""></a>
  <div class="note">
   <strong class="user">php at roelvanmastbergen dot nl</strong>
   <a href="#42999" class="date">06-Jun-2004 09:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The palette created by this function often looks quite awful (at least it did on all of my test images). A better way to convert your true-colour images is by first making a resized copy of them with imagecopyresampled() to a 16x16 pixel destination. The resized image then contains only 256 pixels, which is exactly the number of colours you need. These colours usually look a lot better than the ones generated by imagetruecolortopalette().<br />
<br />
The only disadvantage to this method I have found is that different-coloured details in the original image are lost in the conversion.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37672""></a>
  <div class="note">
   <strong class="user">jemore at nospaM dot m6net dot fr</strong>
   <a href="#37672" class="date">22-Nov-2003 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you open a truecolor image (with imageCreateFromPng for example), and you save it directly to GIF format with imagegif, you can have a 500 internal server error. You must use imageTrueColorToPalette to reduce to 256 colors before saving the image in GIF format.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34179""></a>
  <div class="note">
   <strong class="user">darkelder at php dot net</strong>
   <a href="#34179" class="date">17-Jul-2003 01:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
TrueColor images should be converted to Palette images with this function. So, if you want to use imagecolorstotal() function [ <a href="http://php.net/manual/en/function.imagecolorstotal.php ] , you should first convert the image to a palette image with imagetruecolortopalette(" rel="nofollow" target="_blank">http://php.net/manual/en/function.imagecolorstotal.php ] , you should first convert the image to a palette image with imagetruecolortopalette(</a>);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagesy.html">imagesy</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagettfbbox.html">imagettfbbox</a></div>
 <div class="up"><a href="ref.image.html">GD and Image Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
