<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Computes hash</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mhash-keygen-s2k.html">mhash_keygen_s2k</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="book.openssl.html">OpenSSL</a></div>
 <div class="up"><a href="ref.mhash.html">Mhash Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mhash" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mhash</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mhash</span> &mdash; <span class="dc-title">Computes hash</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mhash-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>mhash</b></span>
    ( <span class="methodparam"><span class="type">int</span> <tt class="parameter">$hash</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$data</tt></span>
   [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$key</tt></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><b>mhash()</b></span> applies a hash function specified by
   <i><tt class="parameter">hash</tt></i> to the <i><tt class="parameter">data</tt></i>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mhash-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">hash</tt></i></span>
     <dd>

      <p class="para">
       The hash ID. One of the <b><tt>MHASH_hashname</tt></b> constants.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">data</tt></i></span>
     <dd>

      <p class="para">
       The user input, as a string.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">key</tt></i></span>
     <dd>

      <p class="para">
       If specified, the function will return the resulting HMAC instead.
       HMAC is keyed hashing for message authentication, or simply a message
       digest that depends on the specified key. Not all algorithms 
       supported in mhash can be used in HMAC mode.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mhash-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the resulting hash (also called digest) or HMAC as a string, or
   <b><tt>FALSE</tt></b> on error.
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="88335""></a>
  <div class="note">
   <strong class="user">hm2k at php dot net</strong>
   <a href="#88335" class="date">20-Jan-2009 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mhash support now appears in the Pear PHP_Compat package, for support without building PHP with mhash.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72746""></a>
  <div class="note">
   <strong class="user">numien(at)deathwyrm(dot)com</strong>
   <a href="#72746" class="date">31-Jan-2007 05:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
---Quote---<br />
pack("H*", md5($str)) == mhash(MHASH_MD5, $str)<br />
pack("H*", sha1($str)) == mhash(MHASH_SHA1, $str)<br />
---/Quote---<br />
<br />
That's an awfully inefficient way of doing things. You can just put ", true" after md5 or sha1 to get binary output instead of having it convert it to hex then back.<br />
<br />
Easier way:<br />
md5($str, true) == mhash(MHASH_MD5, $str)<br />
sha1($str, true) == mhash(MHASH_SHA1, $str)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53571""></a>
  <div class="note">
   <strong class="user">marcel446 at yahoo dot com</strong>
   <a href="#53571" class="date">06-Jun-2005 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case you did not observe, the function of Lance is independent of hash fuction used to get HMAC , so if one use sha1() function from php instead md5() will get sha1 HMAC.<br />
Just try .<br />
Thanks again Lance</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51086""></a>
  <div class="note">
   <strong class="user">robbie [at] averill [dot] co [dot] nz</strong>
   <a href="#51086" class="date">18-Mar-2005 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This confused me a bit when I first read the documetation for mhash. The functions that accept a hash accept them as an INTEGER not a STRING. In this case, MHASH_MD5 = 1. It is a constant, not a string.<br />
<br />
Just thought I'd point that out, so if anyone is confused they can read that. That's the use of mhash_get_hash_name(). You input the constant (which is an integer) and it returns the hash name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47076""></a>
  <div class="note">
   <strong class="user">fernan at ispwest dot com</strong>
   <a href="#47076" class="date">02-Nov-2004 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks a lot to Lance for showing how to create mhash without installing the perl extension for mhash.<br />
<br />
I have been asking my webhosting administrator to recompile Perl with mhash extension, but do not want to do it. As a result, our company can't get credit card authorization because they require fingerprint which uses the function mhash. Now, it's working fine.<br />
<br />
Thanks a lot, Lance.....<br />
<br />
Fernan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43762""></a>
  <div class="note">
   <strong class="user">jerry d0t wilborn at fast d0t net</strong>
   <a href="#43762" class="date">02-Jul-2004 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in responce to lance's post:<br />
<br />
the function comes back with a hex representation of the hmac, if you wish to convert to what mhash returns natively (binary) use:&nbsp; pack("H*", hmac(variables...));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33872""></a>
  <div class="note">
   <strong class="user">lance_rushing at hot* spamfree *mail dot com</strong>
   <a href="#33872" class="date">09-Jul-2003 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget php has two built in hashing algorithms:<br />
<br />
md5(), and sha1()<br />
<br />
So if you are using: mhash(MHASH_MD5, $str) or mhash(MHASH_SHA1, $str) you could use md5($str) or sha1($str).<br />
<br />
** But remember that md5() and sha1() produce HEX output while mhash() produces a BIN output.&nbsp; So:<br />
<br />
md5($str) == bin2hex(mhash(MHASH_MD5, $str))<br />
sha1($str) == bin2hex(mhash(MHASH_SHA1, $str))<br />
<br />
AND<br />
<br />
pack("H*", md5($str)) == mhash(MHASH_MD5, $str)<br />
pack("H*", sha1($str)) == mhash(MHASH_SHA1, $str)<br />
<br />
(Just remember to pack() or bin2hex() your output to get the output you need)<br />
<br />
-Lance</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27225""></a>
  <div class="note">
   <strong class="user">lance_rushing at hot* spamfree *mail dot com</strong>
   <a href="#27225" class="date">27-Nov-2002 08:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want to Create a md5 HMAC, but don't have hmash installed?<br />
<br />
Use this:<br />
<br />
function hmac ($key, $data)<br />
{<br />
&nbsp;&nbsp;&nbsp; // RFC 2104 HMAC implementation for php.<br />
&nbsp;&nbsp;&nbsp; // Creates an md5 HMAC.<br />
&nbsp;&nbsp;&nbsp; // Eliminates the need to install mhash to compute a HMAC<br />
&nbsp;&nbsp;&nbsp; // Hacked by Lance Rushing<br />
<br />
&nbsp;&nbsp;&nbsp; $b = 64; // byte length for md5<br />
&nbsp;&nbsp;&nbsp; if (strlen($key) &gt; $b) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $key = pack("H*",md5($key));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $key&nbsp; = str_pad($key, $b, chr(0x00));<br />
&nbsp;&nbsp;&nbsp; $ipad = str_pad('', $b, chr(0x36));<br />
&nbsp;&nbsp;&nbsp; $opad = str_pad('', $b, chr(0x5c));<br />
&nbsp;&nbsp;&nbsp; $k_ipad = $key ^ $ipad ;<br />
&nbsp;&nbsp;&nbsp; $k_opad = $key ^ $opad;<br />
<br />
&nbsp;&nbsp;&nbsp; return md5($k_opad&nbsp; . pack("H*",md5($k_ipad . $data)));<br />
}<br />
<br />
-----<br />
To test:<br />
Run this on a server _with_ mhash installed:<br />
<br />
$key = 'Jefe';<br />
$data = "what do ya want for nothing?";<br />
echo hmac($key, $data);<br />
echo "&amp;lt;br&amp;gt;\n";<br />
echo bin2hex (mhash(MHASH_MD5, $data, $key));<br />
<br />
should produce:<br />
<br />
750c783e6ab0b503eaa86e310a5db738<br />
750c783e6ab0b503eaa86e310a5db738<br />
<br />
Happy hashing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24598""></a>
  <div class="note">
   <strong class="user">shimon_d at hotmail dot com</strong>
   <a href="#24598" class="date">22-Aug-2002 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
password security:<br />
when you hash passwords to save them in cookie , url ,etc' my sugsession is to hash them with date <br />
becouse of evry body can view server log or any other loged info and reuse the hash<br />
<br />
ie.: to re call a url eg. admin.php?user=root&amp;passhash=5rft346tert<br />
in this example the password keepped in secret but what stopping me to reuse the url<br />
<br />
hash("secret") // bad security<br />
hash("secret".date("Ymg")) // better security<br />
// the hash good only for today</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17843""></a>
  <div class="note">
   <strong class="user">luc at 2113 dot ch</strong>
   <a href="#17843" class="date">28-Dec-2001 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Netscape messaging / directory server 4+ uses SHA-1 <br />
to store password in the ldap database (slapd).<br />
The password is first SHA-1 hashed then base64 encoded:<br />
<br />
$pwd = "secret";<br />
$hash = "{SHA}".base64_encode( mHash(MHASH_SHA1, $pwd));<br />
echo "Hash: ". $hash ;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17385""></a>
  <div class="note">
   <strong class="user">paulj at 5emedia dot net</strong>
   <a href="#17385" class="date">06-Dec-2001 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many digest algorithms (especially MD5) are less secure if you are hashing data that is smaller than the algorithm's output.&nbsp; I recommend either hashing a secret key/salt with the original data to increase it's security.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12729""></a>
  <div class="note">
   
   <a href="#12729" class="date">02-May-2001 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using RedHat 7.1, after compile/install, I had to add the line <br />
<br />
/usr/local/lib <br />
<br />
to /etc/ld.so.conf and run ldconfig to make this work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mhash-keygen-s2k.html">mhash_keygen_s2k</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="book.openssl.html">OpenSSL</a></div>
 <div class="up"><a href="ref.mhash.html">Mhash Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
