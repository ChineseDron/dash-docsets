<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Return current Unix timestamp with microseconds</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.localtime.html">localtime</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mktime.html">mktime</a></div>
 <div class="up"><a href="ref.datetime.html">Date/Time Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.microtime" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">microtime</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">microtime</span> &mdash; <span class="dc-title">Return current Unix timestamp with microseconds</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.microtime-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><b>microtime</b></span>
    ([ <span class="methodparam"><span class="type">bool</span> <tt class="parameter">$get_as_float</tt><span class="initializer"> = false</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><b>microtime()</b></span> returns the current Unix timestamp with
   microseconds. This function is only available on operating systems that
   support the gettimeofday() system call.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.microtime-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">get_as_float</tt></i></span>
     <dd>

      <p class="para">
       If used and set to <b><tt>TRUE</tt></b>, <span class="function"><b>microtime()</b></span> will return a
       <span class="type"><a href="language.types.float.html" class="type float">float</a></span> instead of a <span class="type"><a href="language.types.string.html" class="type string">string</a></span>, as described in
       the return values section below.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.microtime-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   By default, <span class="function"><b>microtime()</b></span> returns a <span class="type"><a href="language.types.string.html" class="type string">string</a></span> in
   the form &quot;msec sec&quot;, where <i>sec</i> is the current time
   measured in the number of seconds since the Unix epoch (0:00:00 January 1,
   1970 GMT), and <i>msec</i> is the number of microseconds that
   have elapsed since <i>sec</i> expressed in seconds.
  </p>
  <p class="para">
   If <i><tt class="parameter">get_as_float</tt></i> is set to <b><tt>TRUE</tt></b>, then
   <span class="function"><b>microtime()</b></span> returns a <span class="type"><a href="language.types.float.html" class="type float">float</a></span>, which
   represents the current time in seconds since the Unix epoch accurate to the
   nearest microsecond.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.microtime-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.0.0</td>
       <td align="left">
        The <i><tt class="parameter">get_as_float</tt></i> parameter was added.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.microtime-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-658">
    <p><b>Example #1 Timing script execution with <span class="function"><b>microtime()</b></span></b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;Simple&nbsp;function&nbsp;to&nbsp;replicate&nbsp;PHP&nbsp;5&nbsp;behaviour<br />&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span style="color: #0000BB">$usec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sec</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;((float)</span><span style="color: #0000BB">$usec&nbsp;</span><span style="color: #007700">+&nbsp;(float)</span><span style="color: #0000BB">$sec</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$time_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Sleep&nbsp;for&nbsp;a&nbsp;while<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$time_start</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-659">
    <p><b>Example #2 Timing script execution in PHP 5</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$time_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Sleep&nbsp;for&nbsp;a&nbsp;while<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$time_start</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.microtime-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.time.html" class="function" rel="rdfs-seeAlso">time()</a> - Return current Unix timestamp</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="104053""></a>
  <div class="note">
   <strong class="user">langpavel at phpskelet dot org</strong>
   <a href="#104053" class="date">19-May-2011 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this for measure duration of script execution. This function should be defined (and of couse first call made) as soon as possible.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* get execution time in seconds at current point of call in seconds<br />
&nbsp;* @return float Execution time at this point of call<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">get_execution_time</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$microtime_start </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0.0</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$microtime_start</span><span class="keyword">; <br />
}<br />
</span><span class="default">get_execution_time</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
However it is true that result depends of gettimeofday() call. ([jamie at bishopston dot net] wrote this &amp; I can confirm)<br />
If system time change, result of this function can be unpredictable (much greater or less than zero).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101875""></a>
  <div class="note">
   <strong class="user">Harald Hanek</strong>
   <a href="#101875" class="date">15-Jan-2011 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As float with more accuracy.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getmicrotime</span><span class="keyword">(</span><span class="default">$e </span><span class="keyword">= </span><span class="default">7</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$u</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">bcadd</span><span class="keyword">(</span><span class="default">$u</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">, </span><span class="default">$e</span><span class="keyword">);<br />
}<br />
echo </span><span class="default">getmicrotime</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101628""></a>
  <div class="note">
   <strong class="user">jamie at bishopston dot net</strong>
   <a href="#101628" class="date">30-Dec-2010 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All these timing scripts rely on microtime which relies on gettimebyday(2)<br />
<br />
This can be inaccurate on servers that run ntp to syncronise the servers<br />
time.<br />
<br />
For timing, you should really use clock_gettime(2) with the<br />
CLOCK_MONOTONIC flag set.<br />
<br />
This returns REAL WORLD time, not affected by intentional clock drift.<br />
<br />
This may seem a bit picky, but I recently saw a server that's clock was an<br />
hour out, and they'd set it to 'drift' to the correct time (clock is speeded<br />
up until it reaches the correct time)<br />
<br />
Those sorts of things can make a real impact.<br />
<br />
Any solutions, seeing as php doesn't have a hook into clock_gettime?<br />
<br />
More info here: <a href="http://tinyurl.com/28vxja9" rel="nofollow" target="_blank">http://tinyurl.com/28vxja9</a><br />
<br />
<a href="http://blog.habets.pp.se/2010/09/" rel="nofollow" target="_blank">http://blog.habets.pp.se/2010/09/</a><br />
gettimeofday-should-never-be-used-to-measure-time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101561""></a>
  <div class="note">
   <strong class="user">Robin Leffmann</strong>
   <a href="#101561" class="date">24-Dec-2010 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While doing some experiments on using microtime()'s output for an entropy generator I found that its microsecond value was always quantified to the nearest hundreds (i.e. the number ends with 00), which affected the randomness of the entropy generator. This output pattern was consistent on three separate machines, running OpenBSD, Mac OS X and Windows.<br />
&nbsp;<br />
The solution was to instead use gettimeofday()'s output, as its usec value followed no quantifiable pattern on any of the three test platforms.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100084""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100084" class="date">23-Sep-2010 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
that related to the prescedence of the . operator<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># normal prescedence<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">.&nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">- </span><span class="default">2&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># ((te . 1) - 2 ) . st ==&gt; -2st<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">.&nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">+ </span><span class="default">2&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># ((te . 1) + 2 ) . st ==&gt;&nbsp; 2st<br />
<br />
# modified prescedence<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">. ( </span><span class="default">1 </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">) . </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># te . ( 1 - 2 ) . st ==&gt; te-1st<br />
</span><span class="default">$d </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">. ( </span><span class="default">1 </span><span class="keyword">+ </span><span class="default">2 </span><span class="keyword">) . </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># te . ( 1 + 2 ) . st ==&gt; te3st<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d </span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99524""></a>
  <div class="note">
   <strong class="user">Paul</strong>
   <a href="#99524" class="date">21-Aug-2010 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Something I noticed:<br />
If you directly echo the time difference between start and the end you'll get a negative value most of the time. If you calculate first this will work correctly:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//This will produce in negative value:<br />
</span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">--){<br />
echo </span><span class="default">$i</span><span class="keyword">;<br />
}<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
<br />
echo </span><span class="string">'Took:'</span><span class="keyword">.</span><span class="default">$end</span><span class="keyword">-</span><span class="default">$start</span><span class="keyword">.</span><span class="string">' seconds'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">//This will produce a correct value<br />
</span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">--){<br />
echo </span><span class="default">$i</span><span class="keyword">;<br />
}<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
</span><span class="default">$parseTime </span><span class="keyword">= </span><span class="default">$end</span><span class="keyword">-</span><span class="default">$start</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'Took:'</span><span class="keyword">.</span><span class="default">$parseTime</span><span class="keyword">.</span><span class="string">' seconds'</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99307""></a>
  <div class="note">
   <strong class="user">Andris</strong>
   <a href="#99307" class="date">10-Aug-2010 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a class which allows to time execution of php scripts very easily. You can even time multiple separate blocks and then get the total time at the end. <br />
<br />
The class is pretty long so I won't post it here, but here's the link:<br />
<a href="http://codeaid.net/php/calculate-script-execution-time-(php-class" rel="nofollow" target="_blank">http://codeaid.net/php/calculate-script-execution-time-(php-class</a>)<br />
<br />
An quick usage example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// calculate the time it takes to run fx()<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">start</span><span class="keyword">(); <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fx</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">stop</span><span class="keyword">(); <br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fy</span><span class="keyword">();<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// calculate the time it takes to run fz()<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fz</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">stop</span><span class="keyword">();<br />
}<br />
&nbsp;<br />
print </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">get</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98950""></a>
  <div class="note">
   <strong class="user">leonardonobre at ibest dot com dot br</strong>
   <a href="#98950" class="date">16-Jul-2010 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Convert date type MySQL to Brazilian (i.e: 2010-07-23 to 23/07/2010);<br />
<br />
<span class="default">&lt;?php<br />
$date_brazilian </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d"</span><span class="keyword">,</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">data_inicial</span><span class="keyword">]));<br />
</span><span class="default">?&gt;<br />
</span><br />
The var $_REQUEST[data_inicial] = 23/07/2010 and convert to microtime (Unix TimeStamp) and the function date convert to format "Y-m-d".<br />
<br />
L̩o</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93828""></a>
  <div class="note">
   <strong class="user">strata_ranger at hotmail dot com</strong>
   <a href="#93828" class="date">01-Oct-2009 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another version of a stopwatch-style function, this one with the following features:<br />
- Can evaluate any function (callback) with any arbitrary arguments<br />
- Can specify the # of iterations to run<br />
<br />
The obvious caveat is of course to take the return value with a grain of salt, especially since this one doesn't run in the tightest loop possible.&nbsp; A little eval() work could probably fix that, but in the meantime calling this function with no arguments will make it establish a reference point (using pi() ) to measure subsequent calls against -- sort of like hitting the "zero" button on a food scale.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">stopwatch</span><span class="keyword">()<br />
</span><span class="comment">// stopwatch([$limit], [$callback], [$args ... ])<br />
// $limit - # of iterations to run<br />
// $callback - function to time<br />
// $args - arguments for function<br />
//<br />
</span><span class="keyword">{<br />
&nbsp; static </span><span class="default">$zero </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; static </span><span class="default">$limit </span><span class="keyword">= </span><span class="default">99999</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">() + Array(</span><span class="default">null</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// Check for # iterations, assign for future calls<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">is_integer</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) </span><span class="default">$max </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">), </span><span class="default">999999</span><span class="keyword">); else </span><span class="default">$max </span><span class="keyword">= </span><span class="default">$limit</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$max </span><span class="keyword">!= </span><span class="default">$limit</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$limit </span><span class="keyword">= </span><span class="default">$max</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zero </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; if (isset(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">); else </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp; if (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Use a very small function as a reference point<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$callback </span><span class="keyword">= </span><span class="string">'pi'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zero </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp; }&nbsp; <br />
<br />
&nbsp; </span><span class="comment">// Ensure a valid callback<br />
&nbsp; </span><span class="keyword">if (!</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">)) return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$name </span><span class="keyword">== </span><span class="default">__FUNCTION__</span><span class="keyword">) return </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="comment">// The actual loop<br />
&nbsp; </span><span class="default">$st </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp; for(</span><span class="default">$cx</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;&nbsp; </span><span class="default">$cx</span><span class="keyword">&lt;</span><span class="default">$max</span><span class="keyword">;&nbsp; </span><span class="default">$cx</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">// Final calculations<br />
&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] -= </span><span class="default">$st</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] -= </span><span class="default">$st</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp; <br />
&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$zero</span><span class="keyword">)) </span><span class="comment">// Use previous reference point<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] -= </span><span class="default">$zero</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] -= </span><span class="default">$zero</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp; }<br />
&nbsp; elseif (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$zero</span><span class="keyword">)) </span><span class="comment">// or establish a new one<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zero </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; if (</span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt; </span><span class="default">0</span><span class="keyword">) </span><span class="comment">// Ensure microseconds are always positive<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]++; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]--;<br />
&nbsp; } <br />
<br />
&nbsp; </span><span class="comment">// Done<br />
&nbsp; </span><span class="keyword">return </span><span class="string">"</span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]</span><span class="string"> + </span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]</span><span class="string">s"</span><span class="keyword">;&nbsp; <br />
}<br />
<br />
function </span><span class="default">faster</span><span class="keyword">()<br />
{<br />
&nbsp; return;<br />
}<br />
<br />
function </span><span class="default">slower</span><span class="keyword">()<br />
{<br />
&nbsp; return </span><span class="default">fmod</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="string">"&lt;p&gt;Comparing two functions...&lt;/p&gt;"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="string">'faster'</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="string">'slower'</span><span class="keyword">));<br />
<br />
echo </span><span class="string">"&lt;p&gt;Comparing 100,000 iterations of two functions..."</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="default">100000</span><span class="keyword">, </span><span class="string">'faster'</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="string">'slower'</span><span class="keyword">));<br />
<br />
echo </span><span class="string">"&lt;p&gt;Run a single function 500 times...&lt;/p&gt;"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="default">500</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="string">'max'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">));<br />
<br />
echo </span><span class="string">"&lt;p&gt;Run a single function 555,555 times...&lt;/p&gt;"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="default">555555</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="string">'max'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">));<br />
<br />
echo </span><span class="string">"&lt;p&gt;Fail sanity test...&lt;/p&gt;"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">stopwatch</span><span class="keyword">(</span><span class="string">'stopwatch'</span><span class="keyword">)); </span><span class="comment">// Attempt to time itself!<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93568""></a>
  <div class="note">
   <strong class="user">bleakwind at gmail dot com</strong>
   <a href="#93568" class="date">16-Sep-2009 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Check Program runtime:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">bwruntime<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$timestart</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$digits</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">bwruntime</span><span class="keyword">(</span><span class="default">$digits </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">digits&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$digits</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">totaltime</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timefinish&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">digits </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$runtime_float&nbsp; </span><span class="keyword">= </span><span class="default">$timefinish</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$runtime_float&nbsp; </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$timefinish</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">digits</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$runtime </span><span class="keyword">= (</span><span class="default">$timefinish</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) + </span><span class="default">$runtime_float</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$runtime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92659""></a>
  <div class="note">
   <strong class="user">thawootah</strong>
   <a href="#92659" class="date">02-Aug-2009 04:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want to make sure your script doesn't time out on large updates? Say you're doing a poor mans cron job or working with large amounts of data in loop and the user begins to hang too long. Instead of them giving up and leaving you can break the loop when it reaches a set time and still display data. <br />
<br />
Here's a simple handy dandy loop timer rounded to second.<br />
<span class="default">&lt;?php<br />
$starttime </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">));<br />
</span><span class="default">$totaltime&nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$maxtime </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">; </span><span class="comment">//seconds<br />
</span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">20</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {&nbsp; </span><span class="comment">/// 20 loops 1 sec each<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000000</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$totaltime </span><span class="keyword">&lt; </span><span class="default">$maxtime</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currenttime </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totaltime </span><span class="keyword">= </span><span class="default">$totaltime </span><span class="keyword">+ (</span><span class="default">$currenttime </span><span class="keyword">-</span><span class="default">$starttime</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//update and continue<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo&nbsp; </span><span class="default">$i</span><span class="keyword">.</span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// stop updating or display not updated data.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91566""></a>
  <div class="note">
   <strong class="user">gomodo at free dot fr</strong>
   <a href="#91566" class="date">17-Jun-2009 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Need a mini benchmark ?<br />
Use microtime with this (very smart) benchmark function :<br />
<br />
mixed mini_bench_to(array timelist[, return_array=false])<br />
return a mini bench result<br />
<br />
-the timelist first key must be 'start'<br />
-default return a resume string, or array if return_array= true :<br />
'total_time' (ms) in first row<br />
details (purcent) in next row<br />
<br />
example :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">unset(</span><span class="default">$t</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// if previous used<br />
<br />
//-- zone to bench<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">$tab_test</span><span class="keyword">=array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">);<br />
</span><span class="default">$fact</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'init_values'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
foreach (</span><span class="default">$tab_test </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fact</span><span class="keyword">=</span><span class="default">$fact</span><span class="keyword">*</span><span class="default">$value</span><span class="keyword">;<br />
}<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'loop_fact'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="string">"fact = "</span><span class="keyword">.</span><span class="default">$fact</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="comment">//-- END zone to bench<br />
<br />
</span><span class="keyword">echo </span><span class="string">"---- string result----\n"</span><span class="keyword">;<br />
</span><span class="default">$str_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">);<br />
echo </span><span class="default">$str_result_bench</span><span class="keyword">; </span><span class="comment">// string return<br />
</span><span class="keyword">echo </span><span class="string">"---- tab result----\n"</span><span class="keyword">;<br />
</span><span class="default">$tab_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$tab_result_bench</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>this example return:<br />
<br />
---- string result----<br />
total time : 0.0141 ms<br />
start -&gt; init_values : 51.1 %<br />
init_values -&gt; loop_fact : 48.9 %<br />
---- tab result----<br />
array (<br />
&nbsp; 'total_time' =&gt; 0.0141,<br />
&nbsp; 'start -&gt; init_values' =&gt; 51.1,<br />
&nbsp; 'init_values -&gt; loop_fact' =&gt; 48.9,<br />
)<br />
<br />
The function to include :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">, </span><span class="default">$arg_ra</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tttime</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">((</span><span class="default">end</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">)-</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">])*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="string">'total_time'</span><span class="keyword">]=</span><span class="default">$tttime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$aff</span><span class="keyword">=</span><span class="string">"total time : "</span><span class="keyword">.</span><span class="default">$tttime</span><span class="keyword">.</span><span class="string">"ms\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="string">'start'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$arg_t </span><span class="keyword">as </span><span class="default">$cle</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$cle</span><span class="keyword">!=</span><span class="string">'start'</span><span class="keyword">)&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prcnt_t</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(((</span><span class="default">round</span><span class="keyword">((</span><span class="default">$val</span><span class="keyword">-</span><span class="default">$prv_val</span><span class="keyword">)*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)/</span><span class="default">$tttime</span><span class="keyword">)*</span><span class="default">100</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">]=</span><span class="default">$prcnt_t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aff</span><span class="keyword">.=</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">.</span><span class="string">' : '</span><span class="keyword">.</span><span class="default">$prcnt_t</span><span class="keyword">.</span><span class="string">" %\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="default">$cle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) return </span><span class="default">$ar_aff</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$aff</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90216""></a>
  <div class="note">
   <strong class="user">singh206 at gmail dot com</strong>
   <a href="#90216" class="date">10-Apr-2009 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">StopWatch </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$total</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$time</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">total </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">clock</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">+ (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">elapsed</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">total</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">reset</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">total</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$stopwatch </span><span class="keyword">= new </span><span class="default">StopWatch</span><span class="keyword">();<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000000</span><span class="keyword">);<br />
echo </span><span class="string">"Checkpoint 1: "</span><span class="keyword">.</span><span class="default">$stopwatch</span><span class="keyword">-&gt;</span><span class="default">clock</span><span class="keyword">().</span><span class="string">" seconds&lt;br /&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000000</span><span class="keyword">);<br />
echo </span><span class="string">"Checkpoint 2: "</span><span class="keyword">.</span><span class="default">$stopwatch</span><span class="keyword">-&gt;</span><span class="default">clock</span><span class="keyword">().</span><span class="string">" seconds&lt;br /&gt;"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"Total Elapsed: "</span><span class="keyword">.</span><span class="default">$stopwatch</span><span class="keyword">-&gt;</span><span class="default">elapsed</span><span class="keyword">().</span><span class="string">" seconds&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86870""></a>
  <div class="note">
   <strong class="user">SimonB</strong>
   <a href="#86870" class="date">07-Nov-2008 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple way to measure the clients connection speed (assuming the server is able to supply fast enough). It measures how much data is transfered in one second and reports the result.<br />
<br />
I needed to measure this to offer sensible defaults for selecting live streams at different bitrates for a webcasting application.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">measure_kbps</span><span class="keyword">()<br />
{<br />
&nbsp; </span><span class="comment">//Return the unix timestamp + microseconds<br />
&nbsp; </span><span class="keyword">function </span><span class="default">micro_time</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timearray </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$timearray</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">$timearray</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">//Prepare a 1kB chunk to send<br />
&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">1023</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$chunk</span><span class="keyword">.=</span><span class="string">'A'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$chunk</span><span class="keyword">.=</span><span class="string">'\n'</span><span class="keyword">;<br />
&nbsp; </span><span class="comment">//Hide what happens next<br />
&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;!-- "</span><span class="keyword">;<br />
&nbsp; </span><span class="comment">//Keep sending 1 kB chunks for 1 second<br />
&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$count</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$starttime </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
&nbsp; do<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$chunk</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$endtime </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totaltime </span><span class="keyword">= </span><span class="default">$endtime </span><span class="keyword">- </span><span class="default">$starttime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totaltime </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$totaltime</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">);<br />
&nbsp; } while (</span><span class="default">$totaltime </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">" --&gt;\n"</span><span class="keyword">;<br />
&nbsp; </span><span class="comment">//Return how many kb were sent<br />
&nbsp; </span><span class="keyword">return (</span><span class="default">$count </span><span class="keyword">* </span><span class="default">8</span><span class="keyword">);<br />
}<br />
</span><span class="default">$kbps</span><span class="keyword">=</span><span class="default">measure_kbps</span><span class="keyword">();<br />
</span><span class="default">$mbps</span><span class="keyword">=</span><span class="default">$kbps </span><span class="keyword">/ </span><span class="default">1024</span><span class="keyword">;<br />
if (</span><span class="default">$mbps </span><span class="keyword">&gt; </span><span class="default">1 </span><span class="keyword">) echo </span><span class="string">"Your speed is </span><span class="default">$mbps</span><span class="string"> Mbps.&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp; else echo </span><span class="string">"Your speed is </span><span class="default">$kbps</span><span class="string"> Kbps.&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85719""></a>
  <div class="note">
   <strong class="user">christ dot boris at nospam gmail dot com</strong>
   <a href="#85719" class="date">13-Sep-2008 12:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, I made a function to get the generation page time :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">gentime</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$a </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$a </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else return (string)(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">)-</span><span class="default">$a</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
(You can add a round() to the return value if you want)<br />
<br />
Use :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># you should include your libraries/conf files here (including the gentime function)<br />
</span><span class="default">gentime</span><span class="keyword">();<br />
<br />
</span><span class="comment"># your source code here<br />
<br />
</span><span class="keyword">echo </span><span class="string">'Generated in '</span><span class="keyword">.</span><span class="default">gentime</span><span class="keyword">().</span><span class="string">' seconds.'<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84395""></a>
  <div class="note">
   <strong class="user">pascalxusPLEASENOSPAM at yahoo dot com</strong>
   <a href="#84395" class="date">12-Jul-2008 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to find out whether echo would be quicker in small chunks or one large chunk to test the theory mentioned in the previous post.&nbsp; The following experiment shows that there is no significant performance difference, in terms of execution time elapsed, between the two methods of using echo.&nbsp; I ran two test cases, one with a string that is 100000 bytes long and another with a string length of 1000000.&nbsp; The source code follows below.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">echobig</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$bufferSize </span><span class="keyword">= </span><span class="default">8192</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$splitString </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$bufferSize</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$splitString </span><span class="keyword">as </span><span class="default">$chunk</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$chunk</span><span class="keyword">;<br />
}<br />
<br />
global </span><span class="default">$dat</span><span class="keyword">;<br />
</span><span class="default">$dat </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
function </span><span class="default">testit</span><span class="keyword">()<br />
{<br />
global </span><span class="default">$dat</span><span class="keyword">;<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
for( </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">&lt;= </span><span class="default">1000000</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">+= </span><span class="default">1 </span><span class="keyword">) </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"a"</span><span class="keyword">;<br />
<br />
</span><span class="default">$u1</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">echobig</span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">);<br />
</span><span class="default">$u2</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">$data</span><span class="keyword">;<br />
</span><span class="default">$u3</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="default">$diff </span><span class="keyword">= </span><span class="default">$u2 </span><span class="keyword">- </span><span class="default">$u1</span><span class="keyword">;<br />
</span><span class="default">$diff2</span><span class="keyword">= </span><span class="default">$u3 </span><span class="keyword">- </span><span class="default">$u2</span><span class="keyword">;<br />
</span><span class="default">$dat </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$diff2</span><span class="string"> </span><span class="default">$diff</span><span class="string">&nbsp; &nbsp; </span><span class="default">$u2</span><span class="string">&nbsp; </span><span class="default">$u1</span><span class="string">\r\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while( </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">5 </span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">testit</span><span class="keyword">(); </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
}<br />
<br />
global </span><span class="default">$dat</span><span class="keyword">;<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">( </span><span class="string">"../Data/results.txt"</span><span class="keyword">, </span><span class="string">"w" </span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$dat </span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You can run the above experiment yourself or you can look at my test data.&nbsp; I got some test data here:&nbsp; <a href="http://www.codesplunk.com/examples/echo.html" rel="nofollow" target="_blank">http://www.codesplunk.com/examples/echo.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83642""></a>
  <div class="note">
   <strong class="user">kpsimoulis [at] genatec</strong>
   <a href="#83642" class="date">05-Jun-2008 12:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is very useful for putting a start and end point in your page to find out where is the delay.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="comment">// My source code here<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$end</span><span class="keyword">.</span><span class="string">"-"</span><span class="keyword">.</span><span class="default">$start</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.(</span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start</span><span class="keyword">). </span><span class="string">" seconds"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If you try this example above (without any source code between the start and the end point). You will get an ugly value, something like:<br />
1212690530.4132-1212690530.4132=8.1062316894531E-6 seconds<br />
<br />
You will wonder why you get this because both numbers seem to be equal. Well this is because there is a hidden precision that we are not able to see.<br />
<br />
To solve this problem I made a new function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">my_microtime</span><span class="keyword">(</span><span class="default">$precision </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">),</span><span class="default">4</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="comment">// My source code here<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$end</span><span class="keyword">.</span><span class="string">"-"</span><span class="keyword">.</span><span class="default">$start</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">((</span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">). </span><span class="string">" seconds"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
It would be useful if they add another parameter for precision in this function or at least another boolean that will not include the hidden precision.<br />
You can read more about the hidden precision in <a href="http://php.net/float" rel="nofollow" target="_blank">http://php.net/float</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83527""></a>
  <div class="note">
   <strong class="user">Peter Kehl</strong>
   <a href="#83527" class="date">30-May-2008 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function allows you to easily calculate time difference between two points in time without losing the precision.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**&nbsp; &nbsp; Calculate a precise time difference.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @param string $start result of microtime()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @param string $end result of microtime(); if NULL/FALSE/0/'' then it's now<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @return flat difference in seconds, calculated with minimum precision loss<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">microtime_diff</span><span class="keyword">( </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">=</span><span class="default">NULL </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">$end </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$start_usec</span><span class="keyword">, </span><span class="default">$start_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$end_usec</span><span class="keyword">, </span><span class="default">$end_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$diff_sec</span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$end_sec</span><span class="keyword">) - </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$start_sec</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$diff_usec</span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$end_usec</span><span class="keyword">) - </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$start_usec</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">floatval</span><span class="keyword">( </span><span class="default">$diff_sec </span><span class="keyword">) + </span><span class="default">$diff_usec</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83504""></a>
  <div class="note">
   <strong class="user">luke at lucanos dot com</strong>
   <a href="#83504" class="date">28-May-2008 04:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than using the list() function, etc. I have found the following code to be a bit cleaner and simpler:<br />
<span class="default">&lt;?php<br />
$theTime </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">( </span><span class="default">explode</span><span class="keyword">( </span><span class="string">' ' </span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">() ) );<br />
echo </span><span class="default">$theTime</span><span class="keyword">;<br />
</span><span class="comment"># Displays "1212018372.3366"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69035""></a>
  <div class="note">
   <strong class="user">admin at emuxperts dot net</strong>
   <a href="#69035" class="date">20-Aug-2006 07:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This little function comes in handy if you want a single integer when your server doesn't have php &gt;= 5.0<br />
<br />
It returns seconds passed unix epoch to the microsecond. Or microseconds since unix epoch.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//A hack for PHP &lt; 5.0<br />
</span><span class="keyword">function </span><span class="default">utime</span><span class="keyword">(</span><span class="default">$inms</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utime </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^(.*?) (.*?)$/"</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">(), </span><span class="default">$match</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utime </span><span class="keyword">= </span><span class="default">$match</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] + </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$inms</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utime </span><span class="keyword">*=&nbsp; </span><span class="default">1000000</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$utime</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//Example:<br />
</span><span class="keyword">print </span><span class="default">utime</span><span class="keyword">();<br />
</span><span class="comment">//Returns:<br />
//1156127104.746352 Seconds<br />
<br />
//Example two:<br />
</span><span class="keyword">print </span><span class="default">utime</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="comment">//Returns:<br />
//1156127104746352 Microseconds<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66187""></a>
  <div class="note">
   <strong class="user">EdorFaus</strong>
   <a href="#66187" class="date">16-May-2006 12:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Of the methods I've seen here, and thought up myself, to convert microtime() output into a numerical value, the microtime_float() one shown in the documentation proper(using explode,list,float,+) is the slowest in terms of runtime.<br />
<br />
I implemented the various methods, ran each in a tight loop 1,000,000 times, and compared runtimes (and output). I did this 10 times to make sure there wasn't a problem of other things putting a load spike on the server. I'll admit I didn't take into account martijn at vanderlee dot com's comments on testing accuracy, but as I figured the looping code etc would be the same, and this was only meant as a relative comparison, it should not be necessary.<br />
<br />
The above method took on average 5.7151877 seconds, while a method using substr and simply adding strings with . took on average 3.0144226 seconds. rsalazar at innox dot com dot mx's method using preg_replace used on average 4.1819633 seconds. This shows that there are indeed differences, but for normal use noone is going to notice it.<br />
<br />
Note that the substr method mentioned isn't quite the one given anonymously below, but one I made based on it:<br />
<span class="default">&lt;?php<br />
$time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">();<br />
</span><span class="default">$timeval</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">).</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Also worth noting is that the microtime_float() method gets faster, and no less accurate, if the (float) conversions are taken out and the variables are simply added together.<br />
<br />
Any of the methods that used + or array_sum ended up rounding the result to 2 digits after the decimal point, while (most of) the ones using preg_replace or substr and . kept all the digits.<br />
<br />
For accurate timing, since floating-point arithmetic would lose precision, I stored microtime results as-is and calculated time difference with this function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">microtime_used</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">$after</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; +(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
For further information, the script itself, etc, see <a href="http://edorfaus.xepher.net/div/convert-method-test.php" rel="nofollow" target="_blank">http://edorfaus.xepher.net/div/convert-method-test.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59052""></a>
  <div class="note">
   <strong class="user">radek at pinkbike com</strong>
   <a href="#59052" class="date">24-Nov-2005 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A lot of the comments here suggest adding in the following way:&nbsp; (float)$usec + (float)$sec<br />
Make sure you have the float precision high enough as with the default precision of 12, you are only precise to the 0.01 seconds.&nbsp; <br />
Set this in you php.ini file.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; precision&nbsp; &nbsp; =&nbsp; 16</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53969""></a>
  <div class="note">
   <strong class="user">vladson at pc-labs dot info</strong>
   <a href="#53969" class="date">19-Jun-2005 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I like to use bcmath for it<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">micro_time</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">bcadd</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">6</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$time_stop </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
<br />
</span><span class="default">$time_overall </span><span class="keyword">= </span><span class="default">bcsub</span><span class="keyword">(</span><span class="default">$time_stop</span><span class="keyword">, </span><span class="default">$time_start</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br />
echo </span><span class="string">"Execution time - </span><span class="default">$time_overall</span><span class="string"> Seconds"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50300""></a>
  <div class="note">
   <strong class="user">php at washboardabs dot net</strong>
   <a href="#50300" class="date">24-Feb-2005 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interesting quirk (tested in PHP 5.0.3): You can get very wacky results from microtime when it is called in the destructor of an object at the end of a script. These times vary enormously and can be in the *past*, when compared to microtime calls in the body of the script.<br />
<br />
As a case example, I played with a timer object that measured microtime when it was created at the start of the script, and measured microtime again at the end of the script using __destruct(); and then printed the total execution time (end time - start time) at the bottom of the page. On short scripts, this would often give a negative time!<br />
<br />
This quirk does not appear if microtime is measured with an automatic shutdown function (using <span class="default">&lt;?PHP register_shutdown_function</span><span class="keyword">(</span><span class="string">'myfunc'</span><span class="keyword">) </span><span class="default">?&gt;</span>. Incidentally, the automatic shutdown functions are called after output buffers are flushed but before object destructors are called.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10075""></a>
  <div class="note">
   <strong class="user">mcq at supergamez dot hu</strong>
   <a href="#10075" class="date">11-Dec-2000 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to measure runtime of some code, and the result is really relevant, then keep in mind the followings:<br />
1. you should only measure the time the code runs. This means if you use functions to make a double from microtime, then get begin time, run the code, get end time, and only _after_ this do conversion and computing. This is relevant for short cycles.<br />
2. if runtime is very small, you can put the code in a loop and run it for 100 or 1000 times. The more you run it the more accurate the value will be. Do not forget to divide the runtime by the times you ran it.<br />
3. if you are measuring a loop, then you do not actually measure the runtime of one cycle. Some caching may occur which means you will not get one cycle's runtime. For a short code, this can eventually result in big differences. Use looping only if the code is long and comlicated.<br />
4. your runtime will be highly affected by the load of the server, which may be effected by many things - so, always run your runtime measuering multiple times, and, when comparing two methods, for e.g., then measure their runtimes one after the other, so I mean do not use values from yesterday, the circumstances may strongly affect your measuring.<br />
<br />
Trapeer</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.localtime.html">localtime</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mktime.html">mktime</a></div>
 <div class="up"><a href="ref.datetime.html">Date/Time Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
