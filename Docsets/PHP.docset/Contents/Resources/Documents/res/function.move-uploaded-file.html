<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Moves an uploaded file to a new location</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mkdir.html">mkdir</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.parse-ini-file.html">parse_ini_file</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.move-uploaded-file" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">move_uploaded_file</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.3, PHP 5)</p><p class="refpurpose"><span class="refname">move_uploaded_file</span> &mdash; <span class="dc-title">Moves an uploaded file to a new location</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.move-uploaded-file-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><b>move_uploaded_file</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$filename</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$destination</tt></span>
   )</div>

  <p class="para rdfs-comment">
   This function checks to ensure that the file designated by
   <i><tt class="parameter">filename</tt></i> is a valid upload file (meaning
   that it was uploaded via PHP&#039;s HTTP POST upload mechanism). If
   the file is valid, it will be moved to the filename given by
   <i><tt class="parameter">destination</tt></i>.
  </p>
  <p class="para">
   This sort of check is especially important if there is any chance
   that anything done with uploaded files could reveal their
   contents to the user, or even to other users on the same
   system.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.move-uploaded-file-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">filename</tt></i></span>
     <dd>

      <p class="para">
       The filename of the uploaded file.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">destination</tt></i></span>
     <dd>

      <p class="para">
       The destination of the moved file.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.move-uploaded-file-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <b><tt>TRUE</tt></b> on success.
  </p>
  <p class="para">
   If <i><tt class="parameter">filename</tt></i> is not a valid upload file,
   then no action will occur, and
   <span class="function"><b>move_uploaded_file()</b></span> will return
   <b><tt>FALSE</tt></b>.
  </p>
  <p class="para">
   If <i><tt class="parameter">filename</tt></i> is a valid upload file, but
   cannot be moved for some reason, no action will occur, and
   <span class="function"><b>move_uploaded_file()</b></span> will return
   <b><tt>FALSE</tt></b>. Additionally, a warning will be issued.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.move-uploaded-file-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2209">
    <p><b>Example #1 Uploading multiple files</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$uploads_dir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/uploads'</span><span style="color: #007700">;<br />foreach&nbsp;(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"error"</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$error&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">UPLOAD_ERR_OK</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tmp_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"tmp_name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmp_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$uploads_dir</span><span style="color: #DD0000">/</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.move-uploaded-file-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    <span class="function"><b>move_uploaded_file()</b></span> is both <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe mode</a>
    and <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a>
    aware. However, restrictions are placed only on the
    <i><tt class="parameter">destination</tt></i> path as to allow the moving
    of uploaded files in which <i><tt class="parameter">filename</tt></i> may conflict
    with such restrictions. <span class="function"><b>move_uploaded_file()</b></span> ensures
    the safety of this operation by allowing only those files uploaded
    through PHP to be moved.
   </p>
  </p></blockquote>
  <div class="warning"><b class="warning">Warning</b>
   <p class="para">
    If the destination file already exists, it will be overwritten.
   </p>
  </div>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.move-uploaded-file-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.is-uploaded-file.html" class="function" rel="rdfs-seeAlso">is_uploaded_file()</a> - Tells whether the file was uploaded via HTTP POST</span></li>
    <li class="member"><span class="function"><a href="function.rename.html" class="function" rel="rdfs-seeAlso">rename()</a> - Renames a file or directory</span></li>
    <li class="member">See <a href="features.file-upload.html" class="link">Handling file uploads</a> for a simple usage example</li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105026""></a>
  <div class="note">
   <strong class="user">matthias dot dailey at gmail dot com</strong>
   <a href="#105026" class="date">22-Jul-2011 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The destination directory must exist; move_uploaded_file() will not automatically create it for you.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103791""></a>
  <div class="note">
   <strong class="user">labsy at seznam dot org</strong>
   <a href="#103791" class="date">03-May-2011 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note for PHP on Windows IIS platform:<br />
PHP does obviously not like directory traversing among partitions, so if you set upload_tmp_dir to be on different partition as php-cgi.exe or php.exe is, upload_tmp_dir will NOT be accessible for file uploads! You will get ERROR 6 on any attempt to upload file, and file size will be 0.<br />
Resolution is to have upload_tmp_dir set to a path under PHP install folder.<br />
...and make sure this folder (and also session_save_path folder) has at least read/write permissions granted to AppPool owner (usually NETWORK SERVICE) and IIS web user (by default IUSR_).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103190""></a>
  <div class="note">
   <strong class="user">wilcobeekhuizen at gmail dot com</strong>
   <a href="#103190" class="date">30-Mar-2011 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When uploading a file with a very long filename, for example 255 characters, move_uploaded_file fails. The longest file I've succesfully uploaded has a 247 character filename. So, although you can create a 250 character filename locally the server may not be able to move it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102975""></a>
  <div class="note">
   <strong class="user">alex at alx dot bz</strong>
   <a href="#102975" class="date">17-Mar-2011 11:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've run into this problem of move_uploaded_file not functioning several times, and always troubleshoot for a good 30 minutes until I find the SAME problem (because I never learn).<br />
<br />
Always specify the proper enctype in the HTML form:<br />
<br />
enctype='multipart/form-data'<br />
<br />
I'm running Apache, on Linux, so take that into consideration, but I always assume (wrongly) that it is a permissions issue first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101648""></a>
  <div class="note">
   <strong class="user">jsimon at redventures dot com</strong>
   <a href="#101648" class="date">01-Jan-2011 09:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Because of the way in which move_uploaded_file works, it can be difficult to debug without the proper error settings. If you are noticing that move_uploaded_file is not doing what you're expecting, and you are only getting a return value of false, try setting the error reporting at the top of your script.<br />
<br />
error_reporting(E_ALL);<br />
ini_set("display_errors", 1); <br />
<br />
This will ensure you are receiving any notices or warnings that you were missing before.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99456""></a>
  <div class="note">
   <strong class="user">Ray.Paseur sometimes uses Gmail</strong>
   <a href="#99456" class="date">18-Aug-2010 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can only move the uploaded file once.&nbsp; You can use copy() if you need the file in more than one place.<br />
<span class="default">&lt;?php </span><span class="comment">// RAY_temp_upload_example.php<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;pre&gt;" </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">// IF A FILE HAS BEEN UPLOADED<br />
</span><span class="keyword">if (!empty(</span><span class="default">$_FILES</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// SHOW THE UPLOADED FILES<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// TRY TO MOVE THE FILE TWICE - SECOND MOVE RETURNS FALSE<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">], </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">])) echo </span><span class="string">"CANNOT MOVE </span><span class="keyword">{</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">]}</span><span class="string">" </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">], </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">])) echo </span><span class="string">"CANNOT MOVE </span><span class="keyword">{</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">]}</span><span class="string">" </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// SHOW THE UPLOADED FILES AFTER THE MOVE - NO VISIBLE CHANGE<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// END OF PHP, PUT UP THE HTML FORM TO GET THE FILE<br />
</span><span class="default">?&gt;<br />
</span>&lt;!-- The data encoding type, enctype, MUST be specified as below --&gt;<br />
&lt;form enctype="multipart/form-data" method="POST"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="hidden" name="MAX_FILE_SIZE" value="300000" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;!-- Name of input element determines name in $_FILES array --&gt;<br />
&nbsp;&nbsp;&nbsp; Send this file: &lt;input name="userfile" type="file" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit" value="Send File" /&gt;<br />
&lt;/form&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96216""></a>
  <div class="note">
   <strong class="user">brentwientjes at NOSPAM dot comcast dot net</strong>
   <a href="#96216" class="date">15-Feb-2010 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have for a couple of years been stymed to understand how to effectively load images (of more than 2MB) and then create thumbnails.&nbsp; My note below on general file uploading was an early hint of some of the system default limitations and I have recently discovered the final limit&nbsp; I offer this as an example of the various missing pieces of information to successfully load images of more than 2MB and then create thumbnails.&nbsp; This particular example assumes a picture of a user is being uploaded and because of browser caching needs a unique number at the end to make the browser load a new picture for review at the time of upload.&nbsp; The overall calling program I am using is a Flex based application which calls this php file to upload user thumbnails.<br />
<br />
The secret sauce is:<br />
<br />
1.&nbsp; adjust server memory size, file upload size, and post size<br />
2.&nbsp; convert image to standard formate (in this case jpg) and scale<br />
<br />
The server may be adjusted with the .htaccess file or inline code.&nbsp; This example has an .htaccess file with file upload size and post size and then inline code for dynamic system memory.<br />
<br />
htaccess file:<br />
php_value post_max_size 16M<br />
php_value upload_max_filesize 6M<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">//&nbsp; $img_base = base directory structure for thumbnail images<br />
//&nbsp; $w_dst = maximum width of thumbnail<br />
//&nbsp; $h_dst = maximum height of thumbnail<br />
//&nbsp; $n_img = new thumbnail name<br />
//&nbsp; $o_img = old thumbnail name<br />
</span><span class="keyword">function </span><span class="default">convertPic</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">, </span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">, </span><span class="default">$n_img</span><span class="keyword">, </span><span class="default">$o_img</span><span class="keyword">)<br />
&nbsp; {</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="string">'100M'</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//&nbsp; handle large images<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$n_img</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; remove old images if present<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$o_img</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$new_img </span><span class="keyword">= </span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$n_img</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$file_src </span><span class="keyword">= </span><span class="default">$img_base</span><span class="keyword">.</span><span class="string">"img.jpg"</span><span class="keyword">;&nbsp; </span><span class="comment">//&nbsp; temporary safe image storage<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; list(</span><span class="default">$w_src</span><span class="keyword">, </span><span class="default">$h_src</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// create new dimensions, keeping aspect ratio<br />
&nbsp;&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">$w_src</span><span class="keyword">/</span><span class="default">$h_src</span><span class="keyword">;<br />
&nbsp;&nbsp; if (</span><span class="default">$w_dst</span><span class="keyword">/</span><span class="default">$h_dst </span><span class="keyword">&gt; </span><span class="default">$ratio</span><span class="keyword">) {</span><span class="default">$w_dst </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$h_dst</span><span class="keyword">*</span><span class="default">$ratio</span><span class="keyword">);} else {</span><span class="default">$h_dst </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$w_dst</span><span class="keyword">/</span><span class="default">$ratio</span><span class="keyword">);}<br />
<br />
&nbsp;&nbsp; switch (</span><span class="default">$type</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; {case </span><span class="default">1</span><span class="keyword">:&nbsp;&nbsp; </span><span class="comment">//&nbsp;&nbsp; gif -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:&nbsp;&nbsp; </span><span class="comment">//&nbsp;&nbsp; jpeg -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:&nbsp; </span><span class="comment">//&nbsp;&nbsp; png -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">$img_dst </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">);&nbsp; </span><span class="comment">//&nbsp; resample<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">, </span><span class="default">$w_src</span><span class="keyword">, </span><span class="default">$h_src</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$new_img</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//&nbsp; save new image<br />
<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);&nbsp; </span><span class="comment">//&nbsp; clean up image storage<br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
</span><span class="default">$p_id </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">uid</span><span class="keyword">];<br />
</span><span class="default">$ver </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">ver</span><span class="keyword">];<br />
</span><span class="default">$delver </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">delver</span><span class="keyword">];<br />
</span><span class="default">convertPic</span><span class="keyword">(</span><span class="string">"your/file/structure/"</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">.</span><span class="default">$p_id</span><span class="keyword">.</span><span class="string">"v"</span><span class="keyword">.</span><span class="default">$ver</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">.</span><span class="default">$p_id</span><span class="keyword">.</span><span class="string">"v"</span><span class="keyword">.</span><span class="default">$delver</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95084""></a>
  <div class="note">
   <strong class="user">wyverald at gmail dot com</strong>
   <a href="#95084" class="date">12-Dec-2009 09:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another note concerning the following 2 warnings:<br />
<br />
-<br />
Warning: move_uploaded_file(/dest/inat/ion.ext) [function.move-uploaded-file]: failed to open stream: No such file or directory in /upload/handler.php on line X<br />
<br />
Warning: move_uploaded_file() [function.move-uploaded-file]: Unable to move '/temp/file/name' to '/dest/inat/ion.ext' in /upload/handler.php on line X<br />
-<br />
<br />
You would think that something is wrong about '/temp/file/name'... while actually, the real cause could be that the directory '/dest/inat' does not exist. Create this directory and the problem will likely get fixed.<br />
<br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94597""></a>
  <div class="note">
   <strong class="user">gotrunko at hotmail dot com</strong>
   <a href="#94597" class="date">13-Nov-2009 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can upload many files whitout parameters in the declaration.<br />
If one of them can not be uploaded, the function returns false and deletes all files that have been sent<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">uploadFiles</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$num_args </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arg_list </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$valReturn </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$unlinkElement </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$arg_list </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) AND </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">] == </span><span class="default">0 </span><span class="keyword">AND isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &gt; </span><span class="default">0 </span><span class="keyword">AND </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &lt; </span><span class="default">500000</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$typeAccepted </span><span class="keyword">= array(</span><span class="string">"image/jpeg"</span><span class="keyword">, </span><span class="string">"image/gif"</span><span class="keyword">, </span><span class="string">"image/png"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">],</span><span class="default">$typeAccepted</span><span class="keyword">)) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] , </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] , </span><span class="string">'.'</span><span class="keyword">) +</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">.= (</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="string">"-"</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])).</span><span class="string">"."</span><span class="keyword">.</span><span class="default">$extension</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">.= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">],</span><span class="default">$destination</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$unlinkElement</span><span class="keyword">[] = </span><span class="default">$destination</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">== </span><span class="default">$num_args</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$valReturn </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$unlinkElement </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$valReturn</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
To use this function you must specify an array with min two parameters like that. <br />
NAME is an optional parameter !<br />
uploadFiles(array("FILES","DESTINATION","NAME"));<br />
<br />
<span class="default">&lt;?php<br />
<br />
$file_one </span><span class="keyword">= array(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file_one'</span><span class="keyword">],</span><span class="default">$destination</span><span class="keyword">,</span><span class="default">$name_one</span><span class="keyword">);<br />
</span><span class="default">$file_two </span><span class="keyword">= array(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file_two'</span><span class="keyword">],</span><span class="default">$destination</span><span class="keyword">); </span><span class="comment">//The name will be the same that $_FILES[]['name']<br />
<br />
</span><span class="keyword">if(</span><span class="default">uploadFiles</span><span class="keyword">(</span><span class="default">$file_one</span><span class="keyword">,</span><span class="default">$file_two</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"true"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"false"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94141""></a>
  <div class="note">
   <strong class="user">chatchaw at tot dot co dot th</strong>
   <a href="#94141" class="date">19-Oct-2009 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use move_uploaded_file function to upload a file with utf-8&nbsp; filename to linux system, you probably check your result by browsing to see the file in the target directory so please make sure that your terminal emulator or your samba configuration is set the character encoding to utf-8 otherwise&nbsp; your file will be shown as ?????? (unreadable character).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94126""></a>
  <div class="note">
   <strong class="user">brentwientjes at NOSPAM dot comast dot net</strong>
   <a href="#94126" class="date">18-Oct-2009 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have looked at a lot of the file upload code listed below and other php documentation and have developed hopefully a robust single file upload routine.&nbsp; I will later update with a multi file upload.&nbsp; I have modestly tested the code.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//&nbsp; 5MB maximum file size<br />
</span><span class="default">$MAXIMUM_FILESIZE </span><span class="keyword">= </span><span class="default">5 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">;<br />
</span><span class="comment">//&nbsp; Valid file extensions (images, word, excel, powerpoint)<br />
</span><span class="default">$rEFileTypes </span><span class="keyword">= <br />
&nbsp; </span><span class="string">"/^\.(jpg|jpeg|gif|png|doc|docx|txt|rtf|pdf|xls|xlsx|<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ppt|pptx){1}$/i"</span><span class="keyword">;<br />
</span><span class="default">$dir_base </span><span class="keyword">= </span><span class="string">"/your/file/location/"</span><span class="keyword">;<br />
<br />
</span><span class="default">$isFile </span><span class="keyword">= </span><span class="default">is_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
if (</span><span class="default">$isFile</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">//&nbsp; do we have a file?<br />
&nbsp;&nbsp; </span><span class="keyword">{</span><span class="comment">//&nbsp; sanatize file name<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; - remove extra spaces/convert to _, <br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; - remove non 0-9a-Z._- characters,<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; - remove leading/trailing spaces<br />
&nbsp;&nbsp;&nbsp; //&nbsp; check if under 5MB, <br />
&nbsp;&nbsp;&nbsp; //&nbsp; check file extension for legal file types<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$safe_filename </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="string">"/\s+/"</span><span class="keyword">, </span><span class="string">"/[^-\.\w]+/"</span><span class="keyword">), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="string">"_"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &lt;= </span><span class="default">$MAXIMUM_FILESIZE </span><span class="keyword">&amp;&amp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$rEFileTypes</span><span class="keyword">, </span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$safe_filename</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {</span><span class="default">$isMove </span><span class="keyword">= </span><span class="default">move_uploaded_file </span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir_base</span><span class="keyword">.</span><span class="default">$safe_filename</span><span class="keyword">);}<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; } <br />
</span><span class="default">?&gt;<br />
</span><br />
I use $isFile and $isMove later in the code for error recording.<br />
<br />
Make sure your system has the appropriate file loading limits. This caused a lot of headeaches trying to figure out why some files loaded and some did not.&nbsp;&nbsp; In my case I have an .htaccess file in the root of the web site with:<br />
<br />
php_value post_max_size 16M<br />
php_value upload_max_filesize 6M<br />
<br />
You may also need to extend the execution time depending upon the amount of data being transferred.<br />
<br />
(sorry if spacing of code is a little off.&nbsp; it was hard to make the note editor like the code style.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93143""></a>
  <div class="note">
   <strong class="user">dt at NOSPAM dot windsor-county dot com</strong>
   <a href="#93143" class="date">25-Aug-2009 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Easiest way to find the extension of an uploaded file is to use:<br />
<br />
<span class="default">&lt;?php<br />
$extension</span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92369""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92369" class="date">21-Jul-2009 11:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$file_extension = pathinfo($path, PATHINFO_EXTENSION);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88601""></a>
  <div class="note">
   <strong class="user">omgmain at gmail dot com</strong>
   <a href="#88601" class="date">30-Jan-2009 08:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function should run perfectly, but just in case there are errors, this should help.<br />
1 : Check that the syntax is correct. Remember, lines end with ;<br />
2 : Make sure that the file you're moving exists, and that the place you're writing to is...well, writable. Sometimes, for instance with mac, they make the file so that it can only be accessed by the system, and you. You need to make it available for everyone.<br />
3 : Make sure that the file size of the file you're uploading is under the max upload size. You can change the allowed file size on the php.ini file. The default value is 2M (M as in Megabytes). Also make sure that uploading is allowed<br />
---<br />
If you don't have any errors, then give yourself a pat on the back. BUT, to make your script more secure, put in your file:<br />
str_replace('.', '', $_FILES['file name']['name']);<br />
str_replace('/', '', $_FILES['file name']['name']);<br />
Replace file name with the file name, and you're good to go!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88183""></a>
  <div class="note">
   <strong class="user">nuabaranda at web dot de</strong>
   <a href="#88183" class="date">14-Jan-2009 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using PHP on Windows and trying to use move_uploaded_file() on a file with special non-ascii characters like german umlauts they get converted bytewise thus destroying them resulting in a wrong CP1251 Windows filename.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88066""></a>
  <div class="note">
   <strong class="user">Johan GENNESSON (php at genjo dot fr)</strong>
   <a href="#88066" class="date">08-Jan-2009 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sedativchunk post a method to find the extension of the file uploaded; but if the extension is more than 3 characters it won't work :<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $file_type </span><span class="keyword">= </span><span class="string">'hello.world.JPEG'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_type_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$file_type</span><span class="keyword">) - </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$file_type</span><span class="keyword">, </span><span class="default">$file_type_length</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//Will return PEG<br />
</span><span class="default">?&gt;<br />
</span><br />
Instead you can use :<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">strrchr</span><span class="keyword">(</span><span class="string">'hello.world.JPEG'</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//Will return .JPEG<br />
</span><span class="default">?&gt;<br />
</span><br />
Best regards<br />
Johan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87787""></a>
  <div class="note">
   <strong class="user">sedativchunk at gmail dot com</strong>
   <a href="#87787" class="date">21-Dec-2008 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been having alot of problems validating files on upload. The main problem I was having was matching up the type of file uploaded with the allowed file types, as when you use $_FILES['userfile']['type'], the variable contains the MIME type, which can change consistently from browser to browser.<br />
<br />
A better method for simply finding the file type is to get the extension of the file by the file name. Here is an example of getting a file type and matching it to an allowed file type (then uploading it and doing some other validation):<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Declare variables<br />
&nbsp;&nbsp;&nbsp; // Get the basic file information<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$userfile </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_size </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_temp </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_err </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="string">'images/'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Create a new file name<br />
&nbsp;&nbsp;&nbsp; // This is so if other files on the server have the same name, it will be renamed<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$randomizer </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0000</span><span class="keyword">, </span><span class="default">9999</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_name </span><span class="keyword">= </span><span class="default">$randomizer</span><span class="keyword">.</span><span class="default">$userfile</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Get the file type<br />
&nbsp;&nbsp;&nbsp; // Using $_FILES to get the file type is sometimes inaccurate, so we are going<br />
&nbsp;&nbsp;&nbsp; // to get the extension ourselves from the name of the file<br />
&nbsp;&nbsp;&nbsp; // This also eliminates having to worry about the MIME type<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_type </span><span class="keyword">= </span><span class="default">$userfile</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_type_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$file_type</span><span class="keyword">) - </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_type </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$file_type</span><span class="keyword">, </span><span class="default">$file_type_length</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$userfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;div style="font-weight: bold; padding: 6px;"&gt;File Uploaded&nbsp; Information&lt;/div&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;ul&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;Original File Name: ' </span><span class="keyword">.</span><span class="default">$userfile</span><span class="keyword">. </span><span class="string">'&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;New File Name: ' </span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">. </span><span class="string">'&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;File Type: ' </span><span class="keyword">.</span><span class="default">$file_type</span><span class="keyword">.</span><span class="string">'&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;File Size: ' </span><span class="keyword">.</span><span class="default">$file_size</span><span class="keyword">. </span><span class="string">'&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;File Temporary Name: ' </span><span class="keyword">.</span><span class="default">$file_temp</span><span class="keyword">. </span><span class="string">'&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;li&gt;Fille Error: ' </span><span class="keyword">. </span><span class="default">$file_err</span><span class="keyword">. </span><span class="string">'&lt;/li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/ul&gt;'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// limit the size of the file to 200KB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$file_size </span><span class="keyword">&gt; </span><span class="default">25600</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'FILE SIZE TO LARGE&lt;BR /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Set allowed file types<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Set case of all letters to lower case<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file_type </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$file_type</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="string">'jpeg'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="string">'jpg'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="string">'gif'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="string">'png'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Search the array for the allowed file type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$file_type</span><span class="keyword">, </span><span class="default">$files</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;b&gt;File allowed!&lt;/b&gt;&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;b&gt;ILLEGAL FILE TYPE&lt;/b&gt;&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="comment">// Check for errors and upload the file<br />
</span><span class="default">$error_count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$file_error</span><span class="keyword">);<br />
if(</span><span class="default">$error_count </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$error_count</span><span class="keyword">; ++</span><span class="default">$i</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$file_temp</span><span class="keyword">, </span><span class="string">'images/' </span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">.</span><span class="string">''</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;h3&gt;Upload Successful!&lt;/h3&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;h3&gt;ERROR&lt;/h3&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;h3&gt;No file has been selected.&lt;/h3&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
In this script, I am looking for image types JPG, PNG, and GIF. You could easily add other types of files ex.<br />
$files[] = "docx";<br />
$files[] = "txt";<br />
<br />
I am running into some trouble getting PNG's to upload properly, but this is the best method for validating the file type I believe.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87208""></a>
  <div class="note">
   <strong class="user">Antoine</strong>
   <a href="#87208" class="date">24-Nov-2008 12:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had exactly than" tnp at shaman dot co dot uk" : move_uploaded_file() is either asynchronous or uses some kind of virtual filesystem. But you may encounter big problems when trying to access a file just uploaded, especially is you tried to change the name.<br />
If you have problems where the uploaded file seems unaccessible, try to use copy() instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86332""></a>
  <div class="note">
   <strong class="user">Dan Delaney</strong>
   <a href="#86332" class="date">13-Oct-2008 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those using PHP on Windows and IIS, you SHOULD set the "upload_tmp_dir" value in php.ini to some directory around where your websites directory is, create that directory, and then set the same permissions on it that you have set for your websites directory. Otherwise, when you upload a file and it goes into C:\WINDOWS\Temp, then you move it to your website directory, its permissions will NOT be set correctly. This will cause you problems if you then want to manipulate that file with something like ImageMagick's convert utility.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85371""></a>
  <div class="note">
   <strong class="user">Mark Kazemier</strong>
   <a href="#85371" class="date">27-Aug-2008 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have the same problem as the person two comments below me. When I use the move_uploaded_file function the permissions for the file are set to 0600. No matter what configurations you set.<br />
<br />
I searched the internet and I found more people with the same problems, but no solutions. I set the umask of apache to 013 and still the files were set to 0600. <br />
<br />
The copy function solves the problem. Another way to solve this problem is using the chmod function after uploading.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85286""></a>
  <div class="note">
   <strong class="user">agan0052 at hotmail dot com</strong>
   <a href="#85286" class="date">23-Aug-2008 12:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">if(isset(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'uploaded'</span><span class="keyword">])){<br />
</span><span class="default">$target </span><span class="keyword">= </span><span class="string">"galleries/"</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'uploaded'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]) ;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
<br />
if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'uploaded'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">],</span><span class="default">$target</span><span class="keyword">)) echo </span><span class="string">"OK!"</span><span class="keyword">;</span><span class="comment">//$chmod o+rw galleries<br />
<br />
</span><span class="keyword">}<br />
else{<br />
&nbsp;echo </span><span class="string">"&lt;form enctype='multipart/form-data' action='CodeTool.php' method='POST'&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"File:&lt;input name='uploaded' type='file'/&gt;&lt;input type='submit' value='Upload'/&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"&lt;/form&gt;"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85149""></a>
  <div class="note">
   <strong class="user">Florian S. in H. an der E. [.de]</strong>
   <a href="#85149" class="date">17-Aug-2008 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
move_uploaded_file (on my setup) always makes files 0600 ("rw- --- ---") and owned by the user running the webserver (owner AND group).<br />
Even though the directory has a sticky bit set to the group permissions!<br />
I couldn't find any settings to change this via php.ini or even using "umask()".<br />
<br />
I want my regular user on the server to be able to "tar cjf" the directory .. which would fail on files totally owned by the webserver-process-user;<br />
the "copy(from, to)" function obeys the sticky-bit though!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84896""></a>
  <div class="note">
   <strong class="user">milan dot matejcek at seznam dot cz</strong>
   <a href="#84896" class="date">04-Aug-2008 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * function for upload file<br />
&nbsp;&nbsp; &nbsp; * @version 5.8.2008<br />
&nbsp;&nbsp; &nbsp; * @author Milan Matejcek<br />
&nbsp;&nbsp; &nbsp; * @param $GLOBALS&nbsp; &nbsp; &nbsp; &nbsp; $files&nbsp; &nbsp; &nbsp; &nbsp; -$_FILES[], array with keys error, size, type etc.<br />
&nbsp;&nbsp; &nbsp; * @param string&nbsp; &nbsp; &nbsp; &nbsp; $dir_out&nbsp; &nbsp; -dir, where save file without filename<br />
&nbsp;&nbsp; &nbsp; * @param string&nbsp; &nbsp; &nbsp; &nbsp; $up_file&nbsp; &nbsp; -regular string for MIME type<br />
&nbsp;&nbsp; &nbsp; * @param int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $max_size&nbsp; &nbsp; -maximum size [B]<br />
&nbsp;&nbsp; &nbsp; * @param bool|string&nbsp; &nbsp; $f_name&nbsp; &nbsp; &nbsp; &nbsp; -true&nbsp; &nbsp; =new automatic filename<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; -false&nbsp; &nbsp; =original filename<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; -string&nbsp; &nbsp; =forexample picture.jpg, you will write only 'picture'<br />
&nbsp;&nbsp; &nbsp; * @return string&nbsp; &nbsp; &nbsp; &nbsp; -filename<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">upload_file</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$dir_out</span><span class="keyword">, </span><span class="default">$up_file</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$max_size</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">, </span><span class="default">$f_name</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'error'</span><span class="keyword">] == </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"~</span><span class="default">$up_file</span><span class="string">~"</span><span class="keyword">, </span><span class="default">$files</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">])){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$max_size </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$max_size&nbsp; &nbsp; </span><span class="keyword">=</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] &gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$files</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] &lt;= </span><span class="default">$max_size</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="default">array_reverse</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$files</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$koncovka&nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$f_name </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]&nbsp; &nbsp; =</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">()),</span><span class="default">0</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">).</span><span class="default">$koncovka</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }elseif (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$f_name</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]&nbsp; &nbsp; =</span><span class="default">$f_name</span><span class="keyword">.</span><span class="default">$koncovka</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }</span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * $files['name'] =$files['name'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename&nbsp; &nbsp; </span><span class="keyword">=</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m&nbsp; &nbsp; </span><span class="keyword">=@</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$dir_out</span><span class="keyword">.</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$m </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//soubor se nepodarilo nahrat<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'num'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">4</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'text'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="string">'selhala move_uploaded_file'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//file is big<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'num'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">5</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'text'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="string">'soubor je moc velky'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//false MIME type<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'num'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">6</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'text'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="string">'neodpovidajici typ souboru, kontrola na '</span><span class="keyword">.</span><span class="default">$up_file</span><span class="keyword">.</span><span class="string">' vysledek '</span><span class="keyword">.</span><span class="default">$files</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$_File['error'] return 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'num'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">7</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'text'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="string">'selhalo nahrani souboru na server'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$filename</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82065""></a>
  <div class="note">
   <strong class="user">jphansen at uga dot edu</strong>
   <a href="#82065" class="date">26-Mar-2008 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was getting error code 1 (<a href="http://www.php.net/manual/en/features.file-upload.errors.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/features.file-upload.errors.php</a>), indicating that the file exceeded upload_max_filesize. To fix this, run <span class="default">&lt;?php ini_set</span><span class="keyword">(</span><span class="string">"upload_max_filesize"</span><span class="keyword">, </span><span class="string">"100M"</span><span class="keyword">); </span><span class="default">?&gt;</span> (then restart apache) changing the second argument to your limit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80404""></a>
  <div class="note">
   <strong class="user">rasponline at gmail dot com</strong>
   <a href="#80404" class="date">14-Jan-2008 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Basic difference between Copy() and move_uploaded_file() function i have noted is that, Copy function upload the file from any source to any destination on the server!!!!<br />
While move_uploaded_file() can moved the uploaded file from temp server location to any destination on the server!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77661""></a>
  <div class="note">
   <strong class="user">iim dot vxk at gmail dot com</strong>
   <a href="#77661" class="date">07-Sep-2007 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when you get this 2 Warnings - paths are a real sample - ::<br />
<br />
-<br />
move_uploaded_file(/uploads/images/sample.png) [function.move-uploaded-file]: failed to open stream: No such file or directory in /scripts/php/system/upload-file.php on line X<br />
-<br />
<br />
and<br />
<br />
-<br />
move_uploaded_file() [function.move-uploaded-file]: Unable to move '/tmp/somefilename' to '/uploads/images/sample.png' in /scripts/php/system/upload-file.php on line X<br />
-<br />
<br />
probably the path '/uploads/images/sample.png' is incomplete, in my case the complet path is "/home/x-user/public_html/uploads/images/sample.png"<br />
<br />
you can use getcwd() to know the current working directory.<br />
<br />
:)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77579""></a>
  <div class="note">
   <strong class="user">tnp at shaman dot co dot uk</strong>
   <a href="#77579" class="date">04-Sep-2007 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I may well also report this as a bug, but in the meantime I'll document what I have seen so far.<br />
<br />
What I wanted to do, was take the uploaded temporary filename and pass it to MySql as part of a load_file&nbsp; injection into a BLOB to store the file contents.<br />
My first attempt was of an indexed array..<br />
<br />
$filename=$_FILES[$index]["name"]; <br />
$filesize= $_FILES[$index]["size"];<br />
$tmpname=$_FILES[$index]["tmp_name"];<br />
<br />
followed by:-<br />
<br />
$query=sprintf("insert into project_files set project_id='%s',current='yes',date='%s' ,user='%d', size='%d', description='%s', name='%s', content=LOAD_FILE('%s')", <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $project_id,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; date('Y-m-d'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $employee_id,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $filesize,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $filedescription,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $filename,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tmpname);<br />
mysql_query($query);<br />
<br />
This gave me an empty content field. Zero bytes.<br />
<br />
I took the echo $query string and applied it to MtySql interpreter. With a suitable filename it worked..well after fixing a few database perms..but no joy from PHP still.<br />
<br />
I found this page and tried adding:-<br />
<br />
move_uploaded_file($tmpname)"/tmp/foo"); <br />
$tmpname-"/tmp/foo";<br />
<br />
before setting up the query.<br />
<br />
That was worse. The browser just hung on me.<br />
<br />
Then I tried<br />
copy($tmpname,"/tmp/foo");<br />
$tmpname="/tmp/foo";<br />
<br />
That worked!?*&amp;^<br />
<br />
My CONJECTURE is that PHP has a meta file-system running, and the environment the program sees is NOT reflected into the OS (Debian etch, in this case) until it closes and flushes its buffers. <br />
<br />
Copy() does in fact seem to result in a real disk write, but move_uploaded_file() does not, so when the name was passed to Mysqld, it didn't exist, or had zero content or maybe with a large file truncated content.<br />
<br />
I can see the point of this: faster response for web browsers who get the program HTTP output over with before it settles down to its housekeeping, but in this case it's a bit of a disaster.<br />
<br />
What is needed is a way to force the buffers to flush if that is what is going on...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76558""></a>
  <div class="note">
   <strong class="user">bdeguire at yahoo dot com</strong>
   <a href="#76558" class="date">20-Jul-2007 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For Windows users: Note that your file attributes from the temporary upload folder ("upload_tmp_dir" in php.ini) are copied to the destination folder (because the file is *moved*, not copied).<br />
<br />
I ran into a problem when using Microsoft Indexing Server. For it to work, you must activate the attribute "For fast searching,&nbsp; allow Indexing Server to index this folder". However, you must not only activate this attribute on the *final* destination folder, but ALSO on the temporary upload folder. So when the file is move from the temp location to the final location, the attributes are kept.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76452""></a>
  <div class="note">
   <strong class="user">nlgordon at iastate dot edu</strong>
   <a href="#76452" class="date">16-Jul-2007 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a helpful comment.&nbsp; If you have open_basedir set then you must set upload_tmp_dir to somewhere within the open_basedir.&nbsp; Otherwise the file upload will be denied.&nbsp; move_uploaded_file might be open_basedir aware, but the rest of the upload process isn't.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75654""></a>
  <div class="note">
   <strong class="user">bogusred</strong>
   <a href="#75654" class="date">10-Jun-2007 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a directory in a *nix environment where you store all of your file uploads and your php script only seems to work when permissions for that directory are set to 777, here's how to fix it so that you can have the security benefits of 755 while still allowing your php scripts to work, including the move_uploaded_file().<br />
<br />
through shell access, navigate to the directory that contains your uploads folder and run the following 2 commands:<br />
chown -R nobody uploaddir<br />
chmod -R 755 uploaddir<br />
<br />
Replace 'uploaddir' with the name of your uploads directory. The first command changes the owner of the directory and files to 'nobody' which is what php operates under. The second changes the folder and files to only allow user access to writing. This is much more secure.<br />
<br />
Hopefully this will help someone out there who had the same problem as me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75451""></a>
  <div class="note">
   <strong class="user">masahigo at gmail dot com</strong>
   <a href="#75451" class="date">30-May-2007 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a great resource concerning uploads with PHP:<br />
<br />
<a href="http://www.radinks.com/upload/config.php" rel="nofollow" target="_blank">http://www.radinks.com/upload/config.php</a><br />
<br />
They explain and tell how to optimize PHP installation to handle large file uploads. Helped me a lot!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74933""></a>
  <div class="note">
   <strong class="user">info at arpadh dot hu</strong>
   <a href="#74933" class="date">04-May-2007 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Values upload_max_filesize and post_max_size (ie. php.ini values) cannot be modified in runtime with ini_set() function.<br />
If you are using Apache web server, use .htaccess files with an IfModule replacing values corresponding to your file size and PHP version:<br />
<br />
&lt;IfModule mod_php4.c&gt;<br />
php_value upload_max_filesize 50M<br />
php_value post_max_size 50M<br />
&lt;/IfModule&gt;<br />
<br />
- means 50MB upload limit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74602""></a>
  <div class="note">
   <strong class="user">booc0mtaco at gmail dot com</strong>
   <a href="#74602" class="date">19-Apr-2007 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also, make sure that the setting for the post_max_size allows for a proper file size range.<br />
<br />
post_max_size = 128M ; Expands the size of POST data for file uploads</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74067""></a>
  <div class="note">
   <strong class="user">guy at neonxero dot net</strong>
   <a href="#74067" class="date">22-Mar-2007 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I could be wrong, but I usualy use <br />
<br />
$uploadext = strtolower(strrchr($imagename,"."));<br />
<br />
to find the file extension when uploading, as opposed to explode().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73859""></a>
  <div class="note">
   
   <a href="#73859" class="date">13-Mar-2007 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To allow bigger upload file size, edit in php.ini and change:<br />
<br />
upload_max_filesize =350M ; Maximum allowed size for uploaded files.<br />
post_max_size =360M ; Maximum size of POST data that PHP will accept.<br />
<br />
max_execution_time =5000 ; Maximum execution time of each script, in seconds<br />
<br />
In adition, you must change the server configuration as well. <br />
For apache server, edit httpd.conf.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73698""></a>
  <div class="note">
   <strong class="user">Harmor</strong>
   <a href="#73698" class="date">06-Mar-2007 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the dot only dot storm at gmail dot com wrote:<br />
&gt;<br />
&gt; In addition to the file extension checking. A simply way<br />
&gt; of getting the extension (regardless of size):<br />
&gt; <br />
&gt; $efilename = explode('.', $filename);<br />
&gt; $ext = $efilename[count($efilename) - 1];<br />
&gt;<br />
<br />
How about:<br />
<br />
$ext = end(explode('.',$filename));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73677""></a>
  <div class="note">
   <strong class="user">dev at rising9 dot com</strong>
   <a href="#73677" class="date">06-Mar-2007 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Can you explain more, how i can change the max memory size varible for the large file can work with move_uploaded_file()?<br />
Thanks a lot!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72861""></a>
  <div class="note">
   
   <a href="#72861" class="date">03-Feb-2007 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you find that large files do not upload in PHP even though you've changed the max_upload_size , this is because you need to change the max memory size varible too. The entire file is loaded into memory before it is saved to disk.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70856""></a>
  <div class="note">
   <strong class="user">Nibinaear</strong>
   <a href="#70856" class="date">01-Nov-2006 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to change the filename used by the user then use this code (static name). This example uploads a pdf magazine to a website and always overwrites the file that is there. Use if you are dealing with a small number of files or people who know what they're doing!<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">if(!empty(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"magfile"</span><span class="keyword">])) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$uploaddir </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">].</span><span class="string">"/dainsider/magazines/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$uploaddir</span><span class="keyword">.=</span><span class="string">"magazine.pdf"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Copy the file to some permanent location<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"magfile"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">], </span><span class="default">$uploaddir</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"Magazine Updated!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"There was a problem when uploding the new file, please contact "</span><span class="keyword">.</span><span class="default">$admin_email</span><span class="keyword">.</span><span class="string">" about this."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69555""></a>
  <div class="note">
   <strong class="user">shacker at birdhouse dot org</strong>
   <a href="#69555" class="date">10-Sep-2006 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're dealing with files uploaded through some external FTP source and need to move them to a final destination, searching php.net for "mv" or "move" won't get you what you want. You want the rename() function. <br />
<br />
<a href="http://www.php.net/manual/en/function.rename.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.rename.php</a><br />
<br />
(move_uploaded_file() won't work, since the POST vars won't be present.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69096""></a>
  <div class="note">
   <strong class="user">Rob Szarka</strong>
   <a href="#69096" class="date">22-Aug-2006 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently the warning above might better be written "If the destination file already exists, it will be overwritten ... regardless of the destination file's permissions."<br />
<br />
In other words, move_uploaded_file() executes as if it's root, not the user under which the web server is operating or the owner of the script that's executing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64799""></a>
  <div class="note">
   <strong class="user">sergeygrinev at mail dot ru</strong>
   <a href="#64799" class="date">20-Apr-2006 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
small typo:<br />
<br />
$fulldest = $dest.$newfilename;<br />
<br />
show be<br />
<br />
$fulldest = $dest.$filename;<br />
<br />
or you would have infinite loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64418""></a>
  <div class="note">
   <strong class="user">Zarel</strong>
   <a href="#64418" class="date">13-Apr-2006 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
nouncad at mayetlite dot com posted a function that uploaded a file, and would rename it if it already existed, to filename[n].ext<br />
<br />
It only worked for files with extensions exactly three letters long, so I fixed that (and made a few other improvements while I was at it).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Usage: uploadfile($_FILE['file']['name'],'temp/',$_FILE['file']['tmp_name'])<br />
</span><span class="keyword">function </span><span class="default">uploadfile</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$tmp_name</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$origin </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$fulldest </span><span class="keyword">= </span><span class="default">$dest</span><span class="keyword">.</span><span class="default">$origin</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">$origin</span><span class="keyword">;<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$fulldest</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fileext </span><span class="keyword">= (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)===</span><span class="default">false</span><span class="keyword">?</span><span class="string">''</span><span class="keyword">:</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">)-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$fileext</span><span class="keyword">)).</span><span class="string">'['</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">.</span><span class="default">$fileext</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fulldest </span><span class="keyword">= </span><span class="default">$dest</span><span class="keyword">.</span><span class="default">$newfilename</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmp_name</span><span class="keyword">, </span><span class="default">$fulldest</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64018""></a>
  <div class="note">
   <strong class="user">jessy dot diamondman at gmail dot com</strong>
   <a href="#64018" class="date">05-Apr-2006 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am pretty new, and am having upload problems myself, but I think I can help out ffproberen2 at dodgeit dot com with his premission denied errors. I had these two, and I had to change the upload directory, not the tmp_upload_dir or what ever it is called. The move_uploaded_file meathod takes an upload location as the last parameter. I am running a bundled package of Apache, Php, mySQL and so on, and on mine, specifing a directory of '' will upload it into C:\Program Files\xampp\apache (my PC is my experimental server, I will get linux, but got to obtain it and internet cuts off after 196mb so can't download it) even though php file is in C:\Program Files\xampp\htdocs\xampp\jessyexum\upload_client.php. <br />
<br />
This is a code that I found and then modified, hope it can help. It dosn't always upload every file type giving me an error #2.<br />
<br />
<span class="default">&lt;?php<br />
$uploaddir </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$uploadfile </span><span class="keyword">= </span><span class="default">$uploaddir </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]);<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$uploadfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp; echo </span><span class="string">"File is valid, and was successfully uploaded.\n"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp; echo </span><span class="string">"Possible file upload attack!\n"</span><span class="keyword">;<br />
}<br />
echo </span><span class="string">'Here is some more debugging info:'</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
print </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64002""></a>
  <div class="note">
   <strong class="user">ffproberen2 at dodgeit dot com</strong>
   <a href="#64002" class="date">05-Apr-2006 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On windows I made the directory writable, by changing the Apache httpd.conf file.<br />
<br />
The problem I had, was with the upload directory. The move_uploaded_file produced an error like: failed to open stream: Permission denied.<br />
<br />
I changed my php.ini to specify an upload directory:<br />
&nbsp; upload_tmp_dir = "d:/temp/php/uploads/"<br />
<br />
and I added the following in the Apache hpptd.conf file:<br />
<br />
&nbsp; &lt;Directory "D:/temp/php/uploads"&gt;<br />
&nbsp;&nbsp;&nbsp; Options None<br />
&nbsp;&nbsp;&nbsp; AllowOverride None<br />
&nbsp;&nbsp;&nbsp; Order allow,deny<br />
&nbsp;&nbsp;&nbsp; Allow from all<br />
&nbsp; &lt;/Directory&gt;<br />
<br />
restarted Apache, and the upload succeeded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61968""></a>
  <div class="note">
   <strong class="user">j dot m dot thomas at NOSPAM dot blueyonder dot co dot uk</strong>
   <a href="#61968" class="date">16-Feb-2006 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To retrieve the file extension, and various other information about the path, it is easiest to use the pathinfo function.<br />
<br />
<span class="default">&lt;?php<br />
$path_parts </span><span class="keyword">= </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="string">'/www/htdocs/index.html'</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$path_parts</span><span class="keyword">[</span><span class="string">'dirname'</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">$path_parts</span><span class="keyword">[</span><span class="string">'basename'</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">$path_parts</span><span class="keyword">[</span><span class="string">'extension'</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Would produce:<br />
<br />
/www/htdocs<br />
index.html<br />
html<br />
<br />
<a href="http://uk.php.net/manual/en/function.pathinfo.php" rel="nofollow" target="_blank">http://uk.php.net/manual/en/function.pathinfo.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61427""></a>
  <div class="note">
   <strong class="user">adam at darkhousemedia dot com</strong>
   <a href="#61427" class="date">02-Feb-2006 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To retrieve the file extension, I think this example makes more sense than the one below.&nbsp; <br />
<br />
$ext = explode(".", $file);<br />
$ext = array_pop($ext);<br />
<br />
It doesn't have to count() the array and then subtract 1 to point to the proper array element, it simply isolates the last element of the array, and discards everything else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61333""></a>
  <div class="note">
   <strong class="user">calamitoso at gmail dot com</strong>
   <a href="#61333" class="date">31-Jan-2006 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to separate (for example) images from other file types among the uploaded files you can check the MIME type also (thus making the file extension check unnecessary)<br />
<br />
$temp = strpos($_FILES["pic"]["type"], "image");<br />
if ($rep===FALSE){<br />
&nbsp;&nbsp; //the strpos function will return a boolean "false" ONLY if the needle string is not found within the haystack<br />
&nbsp;&nbsp; echo "is not an image";<br />
}else{<br />
&nbsp;&nbsp; echo "is an image";<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60521""></a>
  <div class="note">
   <strong class="user">mancow at macfilez dot net</strong>
   <a href="#60521" class="date">09-Jan-2006 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To nouncad at mayetlite dot com,<br />
<br />
That function will work fine for files with a 3-character file extension.&nbsp; However, it is worth noting that there are valid, registered file extensions that are longer than 3 characters.&nbsp; For example, a JPEG file can be denoted by *.jpg (and others), but it can also have *.jpeg as a valid extension.&nbsp; Check out <a href="http://www.filext.com/ for a good reference of file extensions." rel="nofollow" target="_blank">http://www.filext.com/ for a good reference of file extensions.</a><br />
<br />
The best bet to me would be parsing the uploaded file's name ($_FILES['uploadedfile']['name']) based on the presence of dots.&nbsp; Another wrench in the gears:&nbsp; a file can have dots in the filename.&nbsp; That's easy enough to handle -- just explode() the file name and hope that the last element in the array it gives you is the file extension (you can always validate it if you're so inclined).&nbsp; Then just piece it together in a string accordingly by stepping through the array (don't forget to add those dots back to where they were!), appending a guaranteed unique string of characters (or enumerate it like you were doing, keeping track via a loop), and finally tacking on the file extension.<br />
<br />
You may have other mechanisms for verifying a file's extension, such as a preg_match on the whole name, using something like "/\\.(gif|jpg|jpeg|png|bmp)$/i" (more can, of course, be added if you so desire) for the most common types of images found on the web.<br />
<br />
For blindly guaranteeing an uploaded file will be uniquely named, this seems like a fantastic way to go.&nbsp; Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59808""></a>
  <div class="note">
   <strong class="user">AT-HE (at_he AT hotm4il DOT com)</strong>
   <a href="#59808" class="date">15-Dec-2005 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
---------<br />
Note that post_max_size also needs to be considered, by default it is 8M. I raised my upload_max_filesize to 20M and was wondering why 10M uploads weren't working...<br />
<br />
r: It could be because of your max execution time.<br />
----------<br />
<br />
try changing the value of both post_max_size and upload_max_filesize</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59730""></a>
  <div class="note">
   <strong class="user">nouncad at mayetlite dot com</strong>
   <a href="#59730" class="date">14-Dec-2005 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Great!! my first note here...<br />
<br />
This function upload a file.<br />
If file exist, create a copy as "filename[n].ext"<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">subirFichero</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">, </span><span class="default">$destinoDir</span><span class="keyword">, </span><span class="default">$ftemporal</span><span class="keyword">) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$origen </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destinoFull </span><span class="keyword">= </span><span class="default">$destinoDir</span><span class="keyword">.</span><span class="default">$origen</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$frand </span><span class="keyword">= </span><span class="default">$origen</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$destinoFull </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file_name&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">)-</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file_extension&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">)-</span><span class="default">4</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$origen</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$frand </span><span class="keyword">= </span><span class="default">$file_name</span><span class="keyword">.</span><span class="string">"[</span><span class="default">$i</span><span class="string">]"</span><span class="keyword">.</span><span class="default">$file_extension</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destinoFull </span><span class="keyword">= </span><span class="default">$destinoDir</span><span class="keyword">.</span><span class="default">$frand</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$ftemporal</span><span class="keyword">, </span><span class="default">$destinoFull</span><span class="keyword">))&nbsp; &nbsp; return </span><span class="default">$frand</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"0"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58541""></a>
  <div class="note">
   <strong class="user">ineedmynetwork.com</strong>
   <a href="#58541" class="date">07-Nov-2005 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Microsoft returns image/pjpeg not image/jpg when using $_FILES['imageName']['type'];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58540""></a>
  <div class="note">
   <strong class="user">albert</strong>
   <a href="#58540" class="date">07-Nov-2005 12:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
move_uploaded_file()'s return codes are not allways obious !<br />
<br />
Unable to move '/var/tmp/phpuuAVJv' to '/home/me/website.com/upload/images/hello.png'<br />
<br />
will apear if your disk is full, or the webserver (www user) exeeded it's disk qouta. (probably some others)<br />
<br />
i dont know if its a bug (just not iplemented) or a feature (to hide from 3rd parties details about the system or about the specific error) ?<br />
<br />
it happend to me that after several months of successful operation, the disk filled up and qouta exeeded.<br />
<br />
it took me long time, finding out why all the sudden my scripts didnt work properly anymore.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58464""></a>
  <div class="note">
   
   <a href="#58464" class="date">04-Nov-2005 03:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[quote]<br />
Note that post_max_size also needs to be considered, by default it is 8M. I raised my upload_max_filesize to 20M and was wondering why 10M uploads weren't working... <br />
[/quote]<br />
<br />
It could be because of your max execution time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58260""></a>
  <div class="note">
   
   <a href="#58260" class="date">28-Oct-2005 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that post_max_size also needs to be considered, by default it is 8M. I raised my upload_max_filesize to 20M and was wondering why 10M uploads weren't working...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57959""></a>
  <div class="note">
   <strong class="user">jest3r at mtonic dot net</strong>
   <a href="#57959" class="date">19-Oct-2005 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that move_uploaded_file use the GROUP permissions of the parent directory of the tmp file location, whereas a simple "copy" uses the group of the apache process. This could create a security nighmare if your tmp file location is owned by root:wheel</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56533""></a>
  <div class="note">
   <strong class="user">mikelone</strong>
   <a href="#56533" class="date">06-Sep-2005 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the user try to upload a too bigger file then the upload procedure will fail even if u have established an error message.<br />
How to avoid this problem? there's my solution:<br />
<br />
(max_file_size = 2,50 MB)<br />
<br />
$fsize = $_FILES["userfile"]["size"];<br />
<br />
if($fsize == 0 || $fsize &gt; 2621000) exit("keep the filesize under 2,50MB!!");<br />
<br />
When the size is bigger than the MAX_FILE_SIZE field, the value of $fsize is equal to 0 (zero) ......</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55200""></a>
  <div class="note">
   <strong class="user">espiao at gmail dot com</strong>
   <a href="#55200" class="date">27-Jul-2005 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/**<br />
&nbsp;* This function moves the archives and directoryes of a directory of<br />
&nbsp;* origin for a directory destination being able replace them or not.<br />
&nbsp;**/<br />
<br />
function mvdir($oldDir, $newDir, $replaceFiles = true) {<br />
<br />
&nbsp;&nbsp;&nbsp; if ($oldDir == $newDir) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("Destination directory is equal of origin.");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!($tmpDir = opendir($oldDir))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("It was not possible to open origin directory.");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (!is_dir($newDir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("It was not possible to open destination directory.");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; while (($file = readdir($tmpDir)) !== false) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (($file != ".") &amp;&amp; ($file !== "..")) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $oldFileWithDir = $oldDir . $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newFileWithDir = $newDir . $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_dir($oldFileWithDir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @mkdir($newFileWithDir."/", 0777);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @mvdir($oldFileWithDir."/", $newFileWithDir."/", $replaceFiles);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @rmdir($oldFileWithDir);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (file_exists($newFileWithDir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!$replaceFiles) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($oldFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($newFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @copy($oldFileWithDir, $newFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @chmod($newFileWithDir, 0777);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($oldFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
/**<br />
&nbsp;* This is an example of move with replace files on destination folder if <br />
&nbsp;* exists files with the same names on destionatio folder<br />
&nbsp;**/<br />
mvdir("/var/www/example/", "/var/www/other_folder/");<br />
<br />
/**<br />
&nbsp;* This is an example of move without replace files on destination<br />
&nbsp;* folder if&nbsp; exists files with the same names on destionatio folder<br />
&nbsp;**/<br />
mvdir("/var/www/example/", "/var/www/other_folder/", false);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52954""></a>
  <div class="note">
   <strong class="user">Darrell</strong>
   <a href="#52954" class="date">18-May-2005 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
move_uploaded_file apparently uses the root of the Apache installation (e.g. "Apache Group\Apache2" under Windows) as the upload location if relative pathnames are used.<br />
<br />
For example, <br />
$ftmp = $_FILES['userfile']['tmp_name'];<br />
$fname = $_FILES['userfile']['name'];<br />
move_uploaded_file($ftmp, $fname);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
moves the file to <br />
"Apache Group\Apache2\$fname";<br />
<br />
In contrast, other file/directory related functions use the current directory of the php script as the offset for relative pathnames.&nbsp; So, for example, if the command<br />
<br />
mkdir('tmp');<br />
<br />
is called from 'Apache Group\Apache2\htdocs\testpages\upload.php', the result is to create<br />
'Apache Group\Apache2\htdocs\testpages\tmp'<br />
<br />
On the other hand, if 'mkdir' is called just before 'move_uploaded_file', the behavior changes.&nbsp; The commands, <br />
<br />
mkdir('tmp');<br />
move_uploaded_file($ftmp, $fname);<br />
<br />
used together result in <br />
<br />
"Apache Group\Apache2\htdocs\testpages\tmp\$fname"<br />
<br />
being created.&nbsp; Wonder if this is a bug or a feature.<br />
<br />
Darrell</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51579""></a>
  <div class="note">
   <strong class="user">andrew@euperia,com</strong>
   <a href="#51579" class="date">04-Apr-2005 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Instead of using chdir or chmod 0777 a safer alternative to move_uploaded_files is to use PHP's ftp functions to move the file into a web dir.<br />
<br />
1. Make ftp connection to 127.0.0.1 with the correct username and password.<br />
2. ftp_chdir to the required directory.<br />
3. ftp_put ($_FILES['myfile']['tmp_name'], $finalfilename);<br />
4. ftp quit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50843""></a>
  <div class="note">
   <strong class="user">richardNO at SPAMbesite dot nl</strong>
   <a href="#50843" class="date">11-Mar-2005 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Creating the dir with mkdir from php is a security risk too. Everyone who can run a php script on the server can write a script to mess with the dir.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50464""></a>
  <div class="note">
   <strong class="user">user at php dot net</strong>
   <a href="#50464" class="date">01-Mar-2005 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Giving the directory 777 permission is not a good idea for security reasons, it would be better to create the directory using "mkdir()".<br />
<br />
That will make php user (usually "nobody") the owner of the directory, and permissions will not be a problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50055""></a>
  <div class="note">
   <strong class="user">Michel S</strong>
   <a href="#50055" class="date">16-Feb-2005 09:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I once had a problem with this function. File was uploaded correctly, but I still had to chmod the file afterwards. It could not be used otherwise.<br />
<br />
Michel S</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48264""></a>
  <div class="note">
   <strong class="user">allan666 at NOSPAM dot gmail dot com</strong>
   <a href="#48264" class="date">16-Dec-2004 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On the Fedora Core 3 Linux distribution, you may get a "failed to open stream: Permission denied in ..." message. I fact changing the permission of the directory will not work (even if you set to 0777). It is because of the new SELinux kernel that allow apache user to write only in /tmp dir (I think). In order to solve the problem you must to disable the SELinux (at least for apache service) to allow the server to write in other directories. To do that, run the system-config-securitylevel app and disable the SE to apache service. Reboot your system and continue your work. Hope it helps!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43798""></a>
  <div class="note">
   <strong class="user">php at f00n dot com</strong>
   <a href="#43798" class="date">04-Jul-2004 01:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are building an intranet framework and use NAT/Routing heed the following advice.<br />
<br />
If you want to move uploaded files to an FTP server you cannot use the ftp wrapper (ie. '<a href="ftp://user:pass@ftpserver/" rel="nofollow" target="_blank">ftp://user:pass@ftpserver/</a>') as part of your move_uploaded_file() action.&nbsp; This is due to the wrapper only using passive mode with ftp.<br />
<br />
The only workaround is using the ftp functions (may not be compiled by default with *nix but is by default with windows).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42949""></a>
  <div class="note">
   <strong class="user">froid_nordik at sympatico dot ca</strong>
   <a href="#42949" class="date">04-Jun-2004 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure the directory you are moving the file to exists before using this command.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40569""></a>
  <div class="note">
   <strong class="user">sauron at nospam on morannon dot org</strong>
   <a href="#40569" class="date">08-Mar-2004 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An extension only does not really tell you what type of file it really is. I can easily rename a .jpg file to a .zip file and make the server think it is a ZIP file with webmaster kobrasrealm's code.<br />
<br />
A better way is to use the Linux utility "file" to determine the file type. Although I'm aware that some users might use Windows on their webservers, I thought it's worth&nbsp; mentioning the utility here. Using the backtick operators and preg_matches on the output, you can easily determine the file type safely, and fix the extension when necessary.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40320""></a>
  <div class="note">
   <strong class="user">mail at johan dot it</strong>
   <a href="#40320" class="date">28-Feb-2004 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning: If you save a md5_file hash in a database to keep record of uploaded files, which is usefull to prevent users from uploading the same file twice, be aware that after using move_uploaded_file the md5_file hash changes! And you are unable to find the corresponding hash and delete it in the database, when a file is deleted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38079""></a>
  <div class="note">
   <strong class="user">mina86 at tlen dot pl</strong>
   <a href="#38079" class="date">07-Dec-2003 03:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey! Why not using strrchr() to get file&nbsp; extension:<br />
<span class="default">&lt;?php $ext </span><span class="keyword">= </span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">], </span><span class="string">'.'</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>or to get it without '.' at the begining:<br />
<span class="default">&lt;?php $ext </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">], </span><span class="string">'.'</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
If you want to update file without any strang characters you can use:<br />
<span class="default">&lt;?php<br />
move_uploaded_file</span><span class="keyword">(<br />
&nbsp; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"file"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">], <br />
&nbsp; </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^a-z0-9_\-\.]/i'</span><span class="keyword">, </span><span class="string">'_'</span><span class="keyword">, </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"file"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">])<br />
);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37512""></a>
  <div class="note">
   <strong class="user">wolke74 at web dot de</strong>
   <a href="#37512" class="date">18-Nov-2003 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
French and English filenames --- as it is not forbidden -- often have an apostrophy, for instance "That's advertisement paper.doc" or "Les aventures d'Alice dans le pays du miracle.doc". However, uploading such files can run into trouble. <br />
<br />
So you can write, if the posted file had been marked by myfile .<br />
<br />
if(!move_uploaded_file($_FILES["myfile"]["tmp_name"], <br />
rawurlencode($mydir.$_FILES["myfile"]["name"]))<br />
{<br />
&nbsp;&nbsp; &nbsp; echo "Something is wrong with the file"; <br />
&nbsp;&nbsp; &nbsp;&nbsp; exit; <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37285""></a>
  <div class="note">
   
   <a href="#37285" class="date">08-Nov-2003 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example to find file extension bellow is quite confusing and its using to much code for a much simpler solution. Which is in example:<br />
<br />
$file_parts = pathinfo('dir/' . $_FILES['file']['name']);<br />
$file_extension = strtolower($file_parts['extension']);<br />
<br />
The 'dir/' part is only to get a valid path.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mkdir.html">mkdir</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.parse-ini-file.html">parse_ini_file</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
