<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Open a connection to a MySQL Server</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mysql-close.html">mysql_close</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysql-create-db.html">mysql_create_db</a></div>
 <div class="up"><a href="ref.mysql.html">MySQL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mysql-connect" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_connect</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_connect</span> &mdash; <span class="dc-title">Open a connection to a MySQL Server</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-connect-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><b>mysql_connect</b></span>
    ([ <span class="methodparam"><span class="type">string</span> <tt class="parameter">$server</tt><span class="initializer"> = ini_get(&quot;mysql.default_host&quot;)</span></span>
   [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$username</tt><span class="initializer"> = ini_get(&quot;mysql.default_user&quot;)</span></span>
   [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$password</tt><span class="initializer"> = ini_get(&quot;mysql.default_password&quot;)</span></span>
   [, <span class="methodparam"><span class="type">bool</span> <tt class="parameter">$new_link</tt><span class="initializer"> = false</span></span>
   [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$client_flags</tt><span class="initializer"> = 0</span></span>
  ]]]]] )</div>

  <p class="para rdfs-comment">
   Opens or reuses a connection to a MySQL server. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-connect-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">server</tt></i></span>
     <dd>

      <p class="para">
       The MySQL server. It can also include a port number. e.g. 
       &quot;hostname:port&quot; or a path to a local socket e.g. &quot;:/path/to/socket&quot; for 
       the localhost.
      </p>
      <p class="para">
       If the PHP directive <a href="mysql.configuration.html#ini.mysql.default-host" class="link">
       mysql.default_host</a> is undefined (default), then the default 
       value is &#039;localhost:3306&#039;. In <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL safe mode</a>, this parameter is ignored
       and value &#039;localhost:3306&#039; is always used.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">username</tt></i></span>
     <dd>

      <p class="para">
       The username. Default value is defined by <a href="mysql.configuration.html#ini.mysql.default-user" class="link">mysql.default_user</a>. In
       <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL safe mode</a>, this parameter is ignored and the name of the user that
       owns the server process is used.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">password</tt></i></span>
     <dd>

      <p class="para">
       The password. Default value is defined by <a href="mysql.configuration.html#ini.mysql.default-password" class="link">mysql.default_password</a>. In
       <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL safe mode</a>, this parameter is ignored and empty password is used.
      </p>
     </dd>

    </dt>
   
    <dt>

     <span class="term"><i><tt class="parameter">new_link</tt></i></span>
     <dd>

      <p class="para">
       If a second call is made to <span class="function"><b>mysql_connect()</b></span>
       with the same arguments, no new link will be established, but
       instead, the link identifier of the already opened link will be
       returned. The <i><tt class="parameter">new_link</tt></i> parameter modifies this 
       behavior and makes <span class="function"><b>mysql_connect()</b></span> always open 
       a new link, even if <span class="function"><b>mysql_connect()</b></span> was called 
       before with the same parameters.
       In <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL safe mode</a>, this parameter is ignored.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">client_flags</tt></i></span>
     <dd>

      <p class="para">
       The <i><tt class="parameter">client_flags</tt></i> parameter can be a combination 
       of the following constants:
       128 (enable <i>LOAD DATA LOCAL</i> handling),
       <b><tt>MYSQL_CLIENT_SSL</tt></b>,
       <b><tt>MYSQL_CLIENT_COMPRESS</tt></b>, 
       <b><tt>MYSQL_CLIENT_IGNORE_SPACE</tt></b> or
       <b><tt>MYSQL_CLIENT_INTERACTIVE</tt></b>.
       Read the section about <a href="mysql.constants.html#mysql.client-flags" class="xref">MySQL client constants</a> for further information.
       In <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL safe mode</a>, this parameter is ignored.
      </p>
     </dd>

    </dt>
 
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-connect-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a MySQL link identifier on success or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.mysql-connect-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">4.3.0</td>
       <td align="left">
        Added the <i><tt class="parameter">client_flags</tt></i> parameter.
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">4.2.0</td>
       <td align="left">
        Added the <i><tt class="parameter">new_link</tt></i> parameter.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysql-connect-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-1500">
    <p><b>Example #1 <span class="function"><b>mysql_connect()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1501">
    <p><b>Example #2 <span class="function"><b>mysql_connect()</b></span> example using <i>hostname:port</i> syntax</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;we&nbsp;connect&nbsp;to&nbsp;example.com&nbsp;and&nbsp;port&nbsp;3307<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'example.com:3307'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;we&nbsp;connect&nbsp;to&nbsp;localhost&nbsp;at&nbsp;port&nbsp;3307<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'127.0.0.1:3307'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1502">
    <p><b>Example #3 <span class="function"><b>mysql_connect()</b></span> example using  &quot;:/path/to/socket&quot; syntax</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;we&nbsp;connect&nbsp;to&nbsp;localhost&nbsp;and&nbsp;socket&nbsp;e.g.&nbsp;/tmp/mysql.sock<br /><br />//&nbsp;variant&nbsp;1:&nbsp;omit&nbsp;localhost<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">':/tmp/mysql'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;variant&nbsp;2:&nbsp;with&nbsp;localhost<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost:/tmp/mysql.sock'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-connect-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Whenever you specify &quot;localhost&quot; or
    &quot;localhost:port&quot; as server, the MySQL client library will
    override this and try to connect to a local socket (named pipe on
    Windows). If you want to use TCP/IP, use &quot;127.0.0.1&quot;
    instead of &quot;localhost&quot;. If the MySQL client library tries to
    connect to the wrong local socket, you should set the correct path as
    <a href="mysql.configuration.html#ini.mysql.default-host" class="xref"></a> in your PHP configuration and leave the server field
    blank.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    The link to the server will be closed as soon as the execution of
    the script ends, unless it&#039;s closed earlier by explicitly calling
    <span class="function"><a href="function.mysql-close.html" class="function">mysql_close()</a></span>.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    You can suppress the error message on failure by prepending 
    a <a href="language.operators.errorcontrol.html" class="link">@</a>
    to the function name.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Error &quot;Can&#039;t create TCP/IP socket (10106)&quot; usually means that the <a href="ini.core.html#ini.variables-order" class="link">variables_order</a> configure directive
    doesn&#039;t contain character <i>E</i>. On Windows, if the
    environment is not copied the <i>SYSTEMROOT</i> environment
    variable won&#039;t be available and PHP will have problems loading Winsock.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-connect-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-pconnect.html" class="function" rel="rdfs-seeAlso">mysql_pconnect()</a> - Open a persistent connection to a MySQL server</span></li>
    <li class="member"><span class="function"><a href="function.mysql-close.html" class="function" rel="rdfs-seeAlso">mysql_close()</a> - Close MySQL connection</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="104284""></a>
  <div class="note">
   <strong class="user">bimal at sanjaal dot com</strong>
   <a href="#104284" class="date">05-Jun-2011 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Portable connections: If you migrate your source code from one to different servers and you would like to avoid re-configuration on a new serve, user the $_SERVER['SERVER_NAME'] flag as:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">switch(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_NAME'</span><span class="keyword">])<br />
{<br />
case </span><span class="string">'server1.example.com'</span><span class="keyword">:<br />
&nbsp; </span><span class="default">mysqlconnect</span><span class="keyword">(</span><span class="string">'host1'</span><span class="keyword">, </span><span class="string">'user1'</span><span class="keyword">, </span><span class="string">'password1'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'db1'</span><span class="keyword">);<br />
&nbsp; break;<br />
case </span><span class="string">'server2.example.com'</span><span class="keyword">:<br />
&nbsp; </span><span class="default">mysqlconnect</span><span class="keyword">(</span><span class="string">'host2'</span><span class="keyword">, </span><span class="string">'user2'</span><span class="keyword">, </span><span class="string">'password2'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'db2'</span><span class="keyword">);<br />
&nbsp; break;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This makes a conditional connection to mysql database. It automatically chooses the correct server according to the server name from where your script runs.<br />
<br />
Hopefully, you like this portable configuration.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103536""></a>
  <div class="note">
   <strong class="user">avinc@live,hk</strong>
   <a href="#103536" class="date">18-Apr-2011 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My situation: "I could connect to MySQL from the PHP via Apache and MySQL via the MySQL console, and could not connect via the PHP"<br />
<br />
But, PHP only can connect to MySQL using mysql_connect("localhost", "root", "password");<br />
<br />
"Its selinux not allowing apache to make remote connections"<br />
<br />
Solution:<br />
setsebool -P httpd_can_network_connect=1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103082""></a>
  <div class="note">
   <strong class="user">J_S_Fink at yahoo dot com</strong>
   <a href="#103082" class="date">24-Mar-2011 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a singleton class to manage a single Database connection.&nbsp; The Open method uses constant values as defautls, read from an ini file through an initializer script loaded at the top of each web page.&nbsp; You can also override the default values by manually entering your own (in case you need to switch servers or database names mid-script).<br />
<br />
The qry function takes a prepared statement and will return the first row, first associative row, first cell, or entire result set based on the second parameter (entire result if omitted).<br />
<br />
Usage:<br />
$DB = DB::Open();<br />
$result = $DB-&gt;qry(" {SQL Statement} ;");<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">abstract class </span><span class="default">Database_Object<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected static </span><span class="default">$DB_Name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected static </span><span class="default">$DB_Open</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected static </span><span class="default">$DB_Conn</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$database</span><span class="keyword">, </span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$hostport</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Name </span><span class="keyword">= </span><span class="default">$database</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Conn </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$hostname </span><span class="keyword">. </span><span class="string">":" </span><span class="keyword">. </span><span class="default">$hostport</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Conn</span><span class="keyword">) { die(</span><span class="string">'Critical Stop Error: Database Error&lt;br /&gt;' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">()); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Name</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Conn</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private function </span><span class="default">__clone</span><span class="keyword">() {}<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mysql_close(self::$DB_Conn);&nbsp; &lt;-- commented out due to current shared-link close 'feature'.&nbsp; If left in, causes a warning that this is not a valid link resource.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; final class </span><span class="default">DB </span><span class="keyword">extends </span><span class="default">Database_Object<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public static function </span><span class="default">Open</span><span class="keyword">(</span><span class="default">$database </span><span class="keyword">= </span><span class="default">DB_NAME</span><span class="keyword">, </span><span class="default">$hostname </span><span class="keyword">= </span><span class="default">DB_HOST</span><span class="keyword">, </span><span class="default">$hostport </span><span class="keyword">= </span><span class="default">DB_PORT</span><span class="keyword">, </span><span class="default">$username </span><span class="keyword">= </span><span class="default">DB_USER</span><span class="keyword">, </span><span class="default">$password </span><span class="keyword">= </span><span class="default">DB_PASS</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Open</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Open </span><span class="keyword">= new </span><span class="default">self</span><span class="keyword">(</span><span class="default">$database</span><span class="keyword">, </span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$hostport</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Open </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Open </span><span class="keyword">= new </span><span class="default">self</span><span class="keyword">(</span><span class="default">$database</span><span class="keyword">, </span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$hostport</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Open</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">qry</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$return_format </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$DB_Conn</span><span class="keyword">) OR die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$return_format</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$query</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$query</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">$query</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$query</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$query</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102534""></a>
  <div class="note">
   <strong class="user">fano_linux at hotmail dot com</strong>
   <a href="#102534" class="date">19-Feb-2011 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hope to help someone with this solution.<br />
<br />
Recently I had many problems with updating and inserting records into mysql in more than one connection. The scenario: multiple connections to remote MySQL, and PHP CLI (php-gtk).<br />
When not initiated a transaction to update a record when another user attempted to update the same record the script crashed and no longer came up as the connection was resumed.<br />
<br />
Solution, for each change or insert start and end the transaction with mysql;<br />
BEGIN and COMMIT;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102131""></a>
  <div class="note">
   <strong class="user">Harouk</strong>
   <a href="#102131" class="date">28-Jan-2011 06:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you encounter speed problems using this command to a distant server, you can add the line "skip-name-resolve" in your my.cnf to fix it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100896""></a>
  <div class="note">
   <strong class="user">i dot linker at gmail dot com</strong>
   <a href="#100896" class="date">13-Nov-2010 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MySQL connection string regexp:<br />
~mysql://([^:@/]*):?([^@/]*)@?([^/]*)/?([^/]*)~</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99489""></a>
  <div class="note">
   <strong class="user">gratcypalma at gmail dot com</strong>
   <a href="#99489" class="date">19-Aug-2010 11:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here my class connection. i created to help my work.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">DBConfig </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$host</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$user</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$pass</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$db</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$db_link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$conn </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$persistant </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$error </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">config</span><span class="keyword">(){ </span><span class="comment">// class config<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">persistant </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">conn</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">=</span><span class="string">'localhost'</span><span class="keyword">,</span><span class="default">$user</span><span class="keyword">=</span><span class="string">'root'</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">=</span><span class="string">'pass'</span><span class="keyword">,</span><span class="default">$db</span><span class="keyword">=</span><span class="string">'database'</span><span class="keyword">){ </span><span class="comment">// connection function<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">host </span><span class="keyword">= </span><span class="default">$host</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user </span><span class="keyword">= </span><span class="default">$user</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pass </span><span class="keyword">= </span><span class="default">$pass</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Establish the connection.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">persistant</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db_link </span><span class="keyword">= </span><span class="default">mysql_pconnect</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pass</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db_link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pass</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db_link</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (empty(</span><span class="default">$db</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db </span><span class="keyword">= </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db_link</span><span class="keyword">); </span><span class="comment">// select db<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$db</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">conn </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">close</span><span class="keyword">() { </span><span class="comment">// close connection<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">conn</span><span class="keyword">){ </span><span class="comment">// check connection<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">persistant</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">conn </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db_link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">conn </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">=</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){ </span><span class="comment">//Choose error type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (empty(</span><span class="default">$type</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$type</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;strong&gt;Database could not connect&lt;/strong&gt; "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$type</span><span class="keyword">==</span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;strong&gt;mysql error&lt;/strong&gt; " </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$type</span><span class="keyword">==</span><span class="default">3</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;strong&gt;error &lt;/strong&gt;, Proses has been stopped"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;strong&gt;error &lt;/strong&gt;, no connection !!!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// example to use<br />
<br />
</span><span class="default">$DB </span><span class="keyword">= new </span><span class="default">DBConfig</span><span class="keyword">();<br />
</span><span class="default">$DB </span><span class="keyword">-&gt; </span><span class="default">config</span><span class="keyword">();<br />
</span><span class="default">$DB </span><span class="keyword">-&gt; </span><span class="default">conn</span><span class="keyword">();<br />
</span><span class="comment">// mysql command<br />
// mysql_query and others..<br />
</span><span class="default">$DB </span><span class="keyword">-&gt; </span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97657""></a>
  <div class="note">
   <strong class="user">tpl99 at yandex dot ru</strong>
   <a href="#97657" class="date">30-Apr-2010 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Whenever you open two connections to a single database,<br />
you are likely not to get any error when selecting not existing db.<br />
<br />
<span class="default">&lt;?php<br />
$db1 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( ... );<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'existing_db'</span><span class="keyword">,</span><span class="default">$db1</span><span class="keyword">);<br />
<br />
</span><span class="default">$db2 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( ... );<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'not_existing_db'</span><span class="keyword">, </span><span class="default">$db2</span><span class="keyword">);<br />
<br />
</span><span class="default">mysql_query</span><span class="keyword">(... , </span><span class="default">$db2</span><span class="keyword">);<br />
</span><span class="comment">//will return no errors and the query wouldn't be executed.<br />
</span><span class="default">?&gt;<br />
</span><br />
Pay attention and you may save few hours of debugging.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97019""></a>
  <div class="note">
   <strong class="user">chris at chriswpage dot com</strong>
   <a href="#97019" class="date">28-Mar-2010 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
TA point to especially note from the above documentation is that the mysql client library has special behavior around "localhost", in that it will use a socket file instead of TCP/IP.&nbsp; Socket files, while faster, only work if the php script is on the same machine as the database.<br />
<br />
I found this difficult to overcome when I split off a database server from a server that had a handful of hosted clients all referencing "localhost".&nbsp; After significant effort, and failing with my knowledge of socat and autossh tunnelling as mentioned as a workaround to setup a forward from the socket file to TCP/IP in a mysql forum.&nbsp; I finally resorted to using DNS to reference the DB and no longer provide "localhost".&nbsp; It was a pain to update clients, but live and learn.<br />
<br />
I tend to work in distributed environments, and now make it a sort of rule of thumb/best practice to use DNS instead of hard coding "localhost" or "x.x.x.x".<br />
<br />
Hope this helps others out there.<br />
<br />
Chris Page</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96824""></a>
  <div class="note">
   <strong class="user">abelcheung at gmail dot com</strong>
   <a href="#96824" class="date">17-Mar-2010 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that named pipe on Windows is unusable since PHP 5.3, and TCP connection shall be used even in localhost.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94927""></a>
  <div class="note">
   <strong class="user">sholland at napervillegi dot com</strong>
   <a href="#94927" class="date">02-Dec-2009 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting an error "Can't assign requested address" you may have a problem with the mysql port.&nbsp; I had just moved my server to Mac OS X 10.6 and mysql_connect was giving this error.&nbsp; Going into the /etc/php.ini file and setting the default port number to 3306 fixed the problem.&nbsp; <br />
<br />
mysql.default_port = 3306<br />
<br />
The php.ini file suggests that PHP will select the port by using the $MYSQL_TCP_PORT or the mysql-tcp entry in /etc/services, but in this case it is not so.&nbsp; /etc/services on my machine has 3306 listed, but it didn't get picked up.<br />
<br />
This is sort of a bug report, in that the documented feature isn't working.&nbsp; Please don't delete this until the community decides how to address the problem.&nbsp; This is one of those hair pulling exercises to get fixed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94316""></a>
  <div class="note">
   <strong class="user">Bruce Kirkpatrick</strong>
   <a href="#94316" class="date">28-Oct-2009 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Windows Vista or above, an entry in the Windows/System32/drivers/etc/hosts file causes mysql_connect() connections to "localhost" to timeout and never connect.&nbsp; This happens on php 5.3 and above since it now uses mysql native driver which has changed it connection behavior compared to libmysql.dll in previous versions.&nbsp; It is not a PHP bug, but definitely a configuration issue for users on new windows systems.<br />
<br />
To get around this, you must remove the entry like this:<br />
::1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; localhost<br />
<br />
and make sure you still have:<br />
127.0.0.1&nbsp; &nbsp; &nbsp;&nbsp; localhost<br />
<br />
Also, you could change the code to connect to the ip instead, but that is inconvenient if you have many web sites.<br />
<br />
This issue occurs on Windows Vista, Windows 7 and Windows Server 2008.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93476""></a>
  <div class="note">
   <strong class="user">david dot schueler at wapkamera dot de</strong>
   <a href="#93476" class="date">11-Sep-2009 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting MySQL Errors like #2006: MySQL server has gone away, and you are using mysql_connect() and pcntl_fork() then make shure that you are reconnecting to the mysql server with each created child which you fork()ed.<br />
<br />
I pulled my hair out for many days because i was using the same mysql connection for each child and was getting that "MySQL server has gone away" errors.<br />
<br />
Here is a simple example:<br />
<span class="default">&lt;?php<br />
$link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_user</span><span class="keyword">, </span><span class="default">$db_pass</span><span class="keyword">);<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$db_database</span><span class="keyword">,</span><span class="default">$link</span><span class="keyword">));<br />
<br />
</span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();<br />
if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br />
&nbsp; </span><span class="comment">// Error forking child<br />
</span><span class="keyword">elseif (</span><span class="default">$pid</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Parent will be here<br />
</span><span class="keyword">} else {<br />
&nbsp; </span><span class="comment">// The child has to esablish a *new* mysql connection.<br />
&nbsp; // if you use mysql_connect without the 4th parameter<br />
&nbsp; // then it will use the connection from the parent. But<br />
&nbsp; // if the child dies, the connection will be unaviable in<br />
&nbsp; // the parent too.<br />
&nbsp; // So, note the "true" as 4th parameter.<br />
&nbsp; </span><span class="default">$newlink </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_user</span><span class="keyword">, </span><span class="default">$db_pass</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$db_database</span><span class="keyword">,</span><span class="default">$newlink</span><span class="keyword">));<br />
&nbsp; </span><span class="comment">// ...<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92601""></a>
  <div class="note">
   <strong class="user">sedativchunk at gmail dot com</strong>
   <a href="#92601" class="date">30-Jul-2009 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a connection class I created for one of my websites for a MYSQL connection. Feel free to use it on one of your applications anyone! It's MYSQL with OOP in mind and works similar to ASP.net methods for connecting to a database. The benefit of this class is easy management of multiple MYSQL connections. <br />
<br />
The class:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Connection<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$db_connection </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Database connection string<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$db_server </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Database server<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$db_database </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// The database being connected to<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$db_username </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// The database username<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$db_password </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// The database password<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$CONNECTED </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Determines if connection is established<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /** NewConnection Method<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * This method establishes a new connection to the database. */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">NewConnection</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">, </span><span class="default">$database</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Assign variables<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global </span><span class="default">$db_connection</span><span class="keyword">, </span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_database</span><span class="keyword">, </span><span class="default">$db_username</span><span class="keyword">, </span><span class="default">$db_password</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db_server </span><span class="keyword">= </span><span class="default">$server</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db_database </span><span class="keyword">= </span><span class="default">$database</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db_username </span><span class="keyword">= </span><span class="default">$username</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db_password </span><span class="keyword">= </span><span class="default">$password</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Attempt connection<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">try<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create connection to MYSQL database<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Fourth true parameter will allow for multiple connections to be made<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db_connection </span><span class="keyword">= </span><span class="default">mysql_connect </span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db </span><span class="keyword">(</span><span class="default">$database</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$db_connection</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'MySQL Connection Database Error: ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$CONNECTED </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/** Open Method<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * This method opens the database connection (only call if closed!) */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">Open</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$db_connection</span><span class="keyword">, </span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_database</span><span class="keyword">, </span><span class="default">$db_username</span><span class="keyword">, </span><span class="default">$db_password</span><span class="keyword">, </span><span class="default">$CONNECTED</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$CONNECTED</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; try<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db_connection </span><span class="keyword">= </span><span class="default">mysql_connect </span><span class="keyword">(</span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_username</span><span class="keyword">, </span><span class="default">$db_password</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db </span><span class="keyword">(</span><span class="default">$db_database</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$db_connection</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'MySQL Connection Database Error: ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$CONNECTED </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">GetMessage</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"Error: No connection has been established to the database. Cannot open connection."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/** Close Method<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * This method closes the connection to the MySQL Database */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">Close</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$db_connection</span><span class="keyword">, </span><span class="default">$CONNECTED</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$CONNECTED</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$db_connection</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$CONNECTED </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"Error: No connection has been established to the database. Cannot close connection."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91965""></a>
  <div class="note">
   <strong class="user">cory dot mawhorter  gmail.com</strong>
   <a href="#91965" class="date">02-Jul-2009 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hopefully this saves someone some grief.<br />
<br />
My dev computer is windows and runs wampserver.&nbsp; I have frequent problems with PHP being unable to connect to MySQL after periods of extreme DB activity.<br />
<br />
Long story short, it was because I was not running mysql via named-pipes and Windows was running out of available ports to serve PHP.&nbsp; Apparently, on windows, you have 5000 ports to work with and once they are opened, they remain so for 120 seconds before being released.&nbsp; This causes problems with mysql/networking because a new port is requested for each connection.<br />
<br />
You can read more about the problem at:<br />
(Link too long and had to be broken up)<br />
<a href="http://dev.mysql.com/doc/refman/5.0/en" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.0/en</a><br />
/can-not-connect-to-server.html#can-not-connect-to-server-on-windows<br />
?&gt;<br />
<br />
Since mysql is on localhost, I can just enable named-pipes (which is how you should have mysql setup if you don't need networking) to get around the problem instead of the workaround listed on that page.<br />
<br />
For details, see:<br />
<a href="http://dev.mysql.com/tech-resources" rel="nofollow" target="_blank">http://dev.mysql.com/tech-resources</a><br />
/articles/securing_mysql_windows.html</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86645""></a>
  <div class="note">
   <strong class="user">Contact at LinuxIntro dot com</strong>
   <a href="#86645" class="date">27-Oct-2008 09:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you connect and expect to use a stored procedure,you must pass a special flag to MySQL via the connect command, otherwise you will not get the results returned, and it will result in this error:<br />
PROCEDURE AlexGrim.GetStats_ForumCategories can't return a result set in the given context<br />
<br />
To fix this, change you connection string, adding ",false,65536" as the last 2 fields:<br />
$this-&gt;con = mysql_connect($this-&gt;h,$this-&gt;u,$this-&gt;p,false,65536);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85539""></a>
  <div class="note">
   <strong class="user">bmagilavy at avalon-internet dot com</strong>
   <a href="#85539" class="date">04-Sep-2008 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you trying to connect to a remote server, here are a few things that can go wrong. Perhaps this list will save someone some time:<br />
<br />
1. You may need to get in touch with the remote server's tech support: <br />
<br />
&nbsp;a. to ensure that you can get through its firewall. It is not necessarily enough to have your server number listed in the recipient site's cpanel remote access host list. It depends on how the server company has things set up;<br />
<br />
&nbsp;b. to find out what port number they are using for database connections, which may not be the default used by mysql_connect;<br />
<br />
&nbsp;c. If you are using ODBC, the host to which you are trying to connect may or may not have any ODBC drivers installed; and<br />
<br />
&nbsp;d. If you are working from a dynamic IP, they may be set up to accommodate it, or you may have to use a proxy. See <a href="http://forge.mysql.com/wiki/MySQL_Proxy ." rel="nofollow" target="_blank">http://forge.mysql.com/wiki/MySQL_Proxy .</a><br />
<br />
2. If you are working from a shared server yourself, the server number you were sent in the sign-up letter is probably NOT the server number you should be using to connect to a remote database. You need the server number of the machine on which your site is sitting, not your virtual account server number on that machine. You can get this from your own tech support.<br />
<br />
I am grateful to Jonathan Jones at Bluehost for this analysis.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85255""></a>
  <div class="note">
   <strong class="user">pascalxusNOSPAM at yahoo dot com</strong>
   <a href="#85255" class="date">22-Aug-2008 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just wanted to share a common wrapper that I use for executing one line SQL statements.&nbsp; Its an easy wrapper to use that takes care of the connection open/close.&nbsp; Optionally, the mysql_connect can be replaced with mysql_pconnect for persistent connections.<br />
<br />
&nbsp; function executeQuery( $query, $db, $nocon )<br />
&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $nocon != "nocon" )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( $db != "" ) connect( $db );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else connect( "pascal_crm" );<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $result= mysql_query( $query );<br />
&nbsp;&nbsp; &nbsp;&nbsp; $err&nbsp;&nbsp; = mysql_error();<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $err != "" ) echo "error=$err&nbsp; ";<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $nocon != "nocon" )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; mysql_close();<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $result;<br />
&nbsp; }<br />
<br />
Here's a related mysql_pconnect trivia question:<br />
<a href="http://www.codesplunk.com/nr/questions/php17.html" rel="nofollow" target="_blank">http://www.codesplunk.com/nr/questions/php17.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84675""></a>
  <div class="note">
   <strong class="user">Boris K</strong>
   <a href="#84675" class="date">24-Jul-2008 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Coderlit and angelo,<br />
<br />
this may be the solution:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!isset(</span><span class="default">$g_link</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">GetMyConnection</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'dbuser'</span><span class="keyword">, </span><span class="string">'dbpass'</span><span class="keyword">) or die(</span><span class="string">'Could not connect to mysql server.' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'wordpress'</span><span class="keyword">, </span><span class="default">$g_link</span><span class="keyword">) or die(</span><span class="string">'Could not select database.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">CleanUpDB</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">!= </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$g_link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83706""></a>
  <div class="note">
   <strong class="user">coderlit  at  G  dot  mail\ dot com</strong>
   <a href="#83706" class="date">08-Jun-2008 08:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The note from angelo [at] mandato &lt;dot&gt; com is a good way to reuse the msyql connection, like mysql connection pooling.<br />
<br />
However, you need to remove the $g_link = false; in the file. Other wise,&nbsp; everytime you include this file, the mysql connection is set to false, and you have to call the mysql_connect again to connect to the sql server, even though you may have already have live mysql connection ready for use.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//need to remove this line to resue the connection resource<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">GetMyConnection</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'dbuser'</span><span class="keyword">, </span><span class="string">'dbpass'</span><span class="keyword">) or die(</span><span class="string">'Could not connect to mysql server.' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'wordpress'</span><span class="keyword">, </span><span class="default">$g_link</span><span class="keyword">) or die(</span><span class="string">'Could not select database.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">CleanUpDB</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">!= </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$g_link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82040""></a>
  <div class="note">
   <strong class="user">arithmetric at gmail dot com</strong>
   <a href="#82040" class="date">25-Mar-2008 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to open multiple, separate MySQL connections with the same MySQL user, password, and hostname, you must set $new_link = TRUE to prevent mysql_connect from using an existing connection.<br />
<br />
For example, you are opening two separate connections to two different databases (but on the same host, and with the same user and password):<br />
<br />
$db1 = mysql_connect($dbhost, $dbuser, $dbpass);<br />
$rv = mysql_select_db($dbname1, $db1);<br />
$db2 = mysql_connect($dbhost, $dbuser, $dbpass);<br />
$rv = mysql_select_db($dbname2, $db2);<br />
<br />
At this point, both $db1 and $db2 will have selected the database named by $dbname2.<br />
<br />
The workaround is to require that the second MySQL connection is new:<br />
<br />
$db1 = mysql_connect($dbhost, $dbuser, $dbpass);<br />
$rv = mysql_select_db($dbname1, $db1);<br />
$db2 = mysql_connect($dbhost, $dbuser, $dbpass, TRUE);<br />
$rv = mysql_select_db($dbname2, $db2);<br />
<br />
Now, $db1 should have selected $dbname1, and $db2 should have selected $dbname2.<br />
<br />
This has been documented on the mysql_select_db page as well.<br />
<br />
Note: This occurs only when the server, username, and password parameters are identical for each mysql_connect statement.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81554""></a>
  <div class="note">
   <strong class="user">aeolianmeson at blitzeclipse dot com</strong>
   <a href="#81554" class="date">03-Mar-2008 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Recently, I saw an obscure problem where I could connect to MySQL from the PHP via Apache and MySQL via the MySQL console, and could not connect via the PHP-CLI. This was in Windows (XP). I usually use MySQLi extension, but also tried MySQL, and both refused to work.<br />
<br />
I restarted the service multiple times, and the PHP-CLI still would not connect.<br />
<br />
This eventually cleared up.<br />
<br />
I made sure to stop the service. Then, I downloaded a zipped binary-package from dev.mysql.com and started the server a few times from the commandline (mysqld/mysqld-nt, where mysqld-nt is tuned specifically for Windows) and stopped it ("mysqladmin shutdown"). I was then able to successfully connect from the PHP-CLI ("php -r "mysql_connect('localhost', 'root', ''); ").<br />
<br />
Making sure it was stopped, I started the regular server from the commandline, and that was then successful. I then stopped it and started it via the Services panel, and everything still worked.<br />
<br />
I'm assuming that when the service was restarted initially, there was a component that had died and refused to be shutdown even though the service appeared to be stopped, but shutting it down via mysqladmin killed everything entirely.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81028""></a>
  <div class="note">
   <strong class="user">dan at novapulsar dot com</strong>
   <a href="#81028" class="date">11-Feb-2008 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[EDIT by danbrown AT php DOT net: The issue this user is illustrating is a common problem when dealing with multiple databases from PHP.&nbsp; Note his comments at the end of the code for an explanation.]<br />
<br />
<br />
Looks like I learned this the hard way:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//establish connection to master db server<br />
</span><span class="default">mysql_connect </span><span class="keyword">(</span><span class="default">DB_HOST</span><span class="keyword">, </span><span class="default">DB_USER</span><span class="keyword">, </span><span class="default">DB_PASSWORD</span><span class="keyword">);<br />
</span><span class="default">mysql_select_db </span><span class="keyword">(</span><span class="default">DB_NAME</span><span class="keyword">);<br />
<br />
</span><span class="comment">//establish connection to read-only slave cluster<br />
</span><span class="default">$objMySQL_Read </span><span class="keyword">= </span><span class="default">mysql_connect </span><span class="keyword">(</span><span class="default">SLAVE_DB_HOST</span><span class="keyword">, </span><span class="default">SLAVE_DB_USER</span><span class="keyword">, </span><span class="default">SLAVE_DB_PASSWORD</span><span class="keyword">);<br />
</span><span class="default">mysql_select_db </span><span class="keyword">(</span><span class="default">DB_NAME</span><span class="keyword">, </span><span class="default">$objMySQL_Read</span><span class="keyword">);<br />
<br />
</span><span class="default">$strSQL </span><span class="keyword">= </span><span class="string">"SELECT col1,col2 FROM "&nbsp; </span><span class="keyword">. </span><span class="default">DB_NAME </span><span class="keyword">. </span><span class="string">"." </span><span class="keyword">. </span><span class="string">"tbl1 WHERE 1=1"</span><span class="keyword">;<br />
<br />
</span><span class="default">$objRS </span><span class="keyword">= </span><span class="default">mysql_query </span><span class="keyword">(</span><span class="default">$strSQL</span><span class="keyword">, </span><span class="default">$objMySQL_Read</span><span class="keyword">); </span><span class="comment">//returns data from slaves<br />
<br />
</span><span class="default">$strSQL </span><span class="keyword">= </span><span class="string">"INSERT INTO " </span><span class="keyword">. </span><span class="default">DB_NAME </span><span class="keyword">. </span><span class="string">"." </span><span class="keyword">. </span><span class="string">"tbl1 (col1,col2) VALUES (val1,val2)"</span><span class="keyword">;<br />
<br />
</span><span class="default">mysql_query </span><span class="keyword">(</span><span class="default">$strSQL</span><span class="keyword">);<br />
<br />
</span><span class="comment">//expected behavior, to insert the last statement into the master db, since it doesn't reference the read-only resource explicitly. instead, it inserts the record into the last connection, even though it shouldn't, since the last connection is not a global/anonymous connection like the first one, it's $objMySQL_Read.<br />
<br />
//you'll get out of sync db's across your cluster unless you explicitly define all connection resources<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80024""></a>
  <div class="note">
   <strong class="user">Steve</strong>
   <a href="#80024" class="date">24-Dec-2007 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The too many connections issue can be due to several problems.<br />
<br />
1. you are using pconnect. This can tie up many connections and is not really needed for MySQL as new connections are really fast.<br />
<br />
2. Apache children are hanging around for too long - combine this with pconnect and you have recipe for disaster.<br />
<br />
Suggestions: reduce the amount of time apache child processes stay connected to the client and how many connections before they are killed off. And don't use pconnect.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78638""></a>
  <div class="note">
   <strong class="user">Ignacio Casinelli Esviza</strong>
   <a href="#78638" class="date">20-Oct-2007 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes, I want that MySQL service start automatically when my app need it. This is specially true if you work in a development PC and/or in an small intranet environment.<br />
<br />
You can do something like this: if the mysql_connect() function returns FALSE, try to force the initialization of the MySQL service!<br />
<br />
For example, under Windows:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$link </span><span class="keyword">= @</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">,</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">);<br />
if (empty(</span><span class="default">$link</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"%SystemRoot%\\system32\\net.exe start mysql"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$link </span><span class="keyword">= @</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$servidor</span><span class="keyword">,</span><span class="default">$usuario</span><span class="keyword">,</span><span class="default">$clave</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
In Linux of course you can try "/etc/init.d/mysqld start" but you will need special permissions.<br />
<br />
Regards.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78187""></a>
  <div class="note">
   <strong class="user">Peter Robinett</strong>
   <a href="#78187" class="date">02-Oct-2007 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The use of mysql connections can become tricky with objects. I am using mysql_connect() in a database class I wrote and the class destructor calls mysql_close. Because I have several of these database objects, mysql_connect reuses existing connections. This is fine except when the script reaches the end of execution and PHP's garabage collection calls all the objects' __destruct() functions. mysql_close() throws a warning that the connection is invalid, in my case for one object. This is happening with objects which use an existing connection, as the connection has already been closed. I solved the problem by forcing mysql_connect() to create a new connection each time. This is not efficient but is sufficient for my purposes for now.<br />
<br />
I wouldn't say this is a bug per-se, but it's something to look out for. I imagine using mysqli is the ultimate solution...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77063""></a>
  <div class="note">
   <strong class="user">aichi</strong>
   <a href="#77063" class="date">13-Aug-2007 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All constants from MySQL source:<br />
<br />
#define CLIENT_LONG_PASSWORD 1 /* new more secure passwords */<br />
#define CLIENT_FOUND_ROWS 2 /* Found instead of affected rows */<br />
#define CLIENT_LONG_FLAG 4 /* Get all column flags */<br />
#define CLIENT_CONNECT_WITH_DB 8 /* One can specify db on connect */<br />
#define CLIENT_NO_SCHEMA 16 /* Don't allow database.table.column */<br />
#define CLIENT_COMPRESS 32 /* Can use compression protocol */<br />
#define CLIENT_ODBC 64 /* Odbc client */<br />
#define CLIENT_LOCAL_FILES 128 /* Can use LOAD DATA LOCAL */<br />
#define CLIENT_IGNORE_SPACE 256 /* Ignore spaces before '(' */<br />
#define CLIENT_PROTOCOL_41 512 /* New 4.1 protocol */<br />
#define CLIENT_INTERACTIVE 1024 /* This is an interactive client */<br />
#define CLIENT_SSL 2048 /* Switch to SSL after handshake */<br />
#define CLIENT_IGNORE_SIGPIPE 4096 /* IGNORE sigpipes */<br />
#define CLIENT_TRANSACTIONS 8192 /* Client knows about transactions */<br />
#define CLIENT_RESERVED 16384 /* Old flag for 4.1 protocol */<br />
#define CLIENT_SECURE_CONNECTION 32768 /* New 4.1 authentication */<br />
#define CLIENT_MULTI_STATEMENTS 65536 /* Enable/disable multi-stmt support */<br />
#define CLIENT_MULTI_RESULTS 131072 /* Enable/disable multi-results */<br />
#define CLIENT_REMEMBER_OPTIONS (((ulong) 1) &lt;&lt; 31)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77000""></a>
  <div class="note">
   <strong class="user">martin</strong>
   <a href="#77000" class="date">09-Aug-2007 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MYSQL_CLIENT_SSL is not working, use MySQLi and mysqli-&gt;ssl_set()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74375""></a>
  <div class="note">
   <strong class="user">jslakva at gmail dot com</strong>
   <a href="#74375" class="date">08-Apr-2007 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if between first and second call with same arguments there was another call with another argument, initial connection link is not reused, but new connection is created instead, regardless of new_link argument.<br />
<br />
for example, here only one single link will be opened and then reused:<br />
<span class="default">&lt;?php<br />
$link1 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">$link2 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and here _three_ separate links will be opened:<br />
<span class="default">&lt;?php<br />
$link1 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">$link3 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"127.0.0.1"</span><span class="keyword">);<br />
</span><span class="default">$link2 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
so if you wanted to switch between connections just by call to mysql_connect, and rely on its internal link caching, you can be wasting your database connections.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73983""></a>
  <div class="note">
   <strong class="user">angelo [at] mandato &lt;dot&gt; com</strong>
   <a href="#73983" class="date">19-Mar-2007 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The post from 'Graham_Rule at ed dot ac dot uk' should include the following WARNING:<br />
<br />
WARING: THE VALUES OF THESE DIRECTIVES WILL BE EXPOSED IF ANY OF THE CODE INCLUDES THE phpinfo() FUNCTION.<br />
<br />
The phpinfo() function will print these values clear as day.&nbsp; I highly suggest against this method of storing MySQL authentication information.<br />
<br />
I recommend creating connect and cleanup functions in a separate include file.&nbsp; If security is a concern, locate the include file outside of your web root folder.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">GetMyConnection</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">'host.name'</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">) or die(</span><span class="string">'Could not connect to server.' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'database_name'</span><span class="keyword">, </span><span class="default">$g_link</span><span class="keyword">) or die(</span><span class="string">'Could not select database.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">CleanUpDB</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">!= </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$g_link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
Simply include your connnection.php file in your script and anywhere you use the mysql_query() function include a call to the GetMyConnection() function.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT ..."</span><span class="keyword">, </span><span class="default">GetMyConnection</span><span class="keyword">() );<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71703""></a>
  <div class="note">
   <strong class="user">sky dot sama dot remove dot dots at Gmail dot com</strong>
   <a href="#71703" class="date">12-Dec-2006 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case anyone else is getting "Client does not support authentication protocol requested by server; consider upgrading MySQL client" error. The problem is the new password hashing method used by MySQL &gt;= 4.1 mentioned below.<br />
<br />
Either update your PHP to v5 where the new password hashing is supported or use old_password() in MySQL 4.1.<br />
<br />
FROM: <a href="http://www.digitalpeer.com/id/mysql " rel="nofollow" target="_blank">http://www.digitalpeer.com/id/mysql </a><br />
<br />
UPDATE mysql.user SET password=old_password("youroldhashpassword") WHERE user ='youruserid' and host ='yourhost'<br />
<br />
then do<br />
<br />
FLUSH PRIVILEGES</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71079""></a>
  <div class="note">
   <strong class="user">Graham_Rule at ed dot ac dot uk</strong>
   <a href="#71079" class="date">10-Nov-2006 01:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to get at multiple MySQL databases from PHP while continuing to hide the user credentials in Apache configuration files.<br />
<br />
(This builds on my solution to the problem of hiding such credentials that I posted in May 2003 at <a href="http://uk2.php.net/manual/en/function.mysql-connect.php#32035" rel="nofollow" target="_blank">http://uk2.php.net/manual/en/function.mysql-connect.php#32035</a>)<br />
<br />
&lt;Directory /var/www/html/multidatabase&gt;<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_user&nbsp; &nbsp; &nbsp; &nbsp; "username1&nbsp; &nbsp; &nbsp; username2"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_password&nbsp; &nbsp; "secret&nbsp; private"<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_host&nbsp; &nbsp; &nbsp; "localhost&nbsp; server.example.com"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&lt;/Directory&gt;<br />
<br />
Note that the quotes are necessary to prevent the parser complaining about seeing too many parameters for php_value.<br />
<br />
Given this setup in Apache, our script can fetch the composite value<br />
&nbsp;&nbsp;&nbsp; $hostnames = @ini_get('mysql.default_host');&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Split it into its component parts<br />
&nbsp;&nbsp;&nbsp; $hostnames = preg_split("/[\s]+/", $hostnames);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Then use the values in this array as if we had hard-coded:<br />
&nbsp;&nbsp;&nbsp; $hostnames[0] = "localhost";&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $hostnames[1] = "server.example.com"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Similar code may be written to fetch the usernames and passwords.<br />
<br />
(One 'gotcha' with the mysql_error() function is that it will not give a sensible error report if there is a failure to open a second or subsequent connection.&nbsp; It uses the last successfully opened connection as the basis for its message!)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71078""></a>
  <div class="note">
   <strong class="user">Graham_Rule at ed dot ac dot uk</strong>
   <a href="#71078" class="date">10-Nov-2006 01:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The addition of entries to httpd.conf to stop .inc files being served by Apache is certainly useful and to be recommended.<br />
<br />
But it doesn't change the fact that these files have to be readable by Apache so that the PHP processor can get at them.<br />
<br />
As long as your don't have multiple, possibly untrusted, users on your machine then that's OK.&nbsp; But when you are running a large multi-user service with thousands of users its always possible that one of them will look at your .inc files and take a note of the passwords you have in them.&nbsp; They could even copy them into their own scripts and modify your databases!<br />
<br />
Even if local users are trusted, there is always the possibility of a rogue script (PHP or some nastier language) being installed by an ignorant user.&nbsp; That script might then read your .inc files (whether or not they are in the web publishing tree) and expose your password.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71046""></a>
  <div class="note">
   <strong class="user">brinca at substancia dot com</strong>
   <a href="#71046" class="date">09-Nov-2006 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you prefer to use a hostname instead of an ip on your connection string in a script (to be able to change the ip at will), but don't want the overhead of dns lookups, just add it to your /etc/hosts file (in windows: %WINDIR%/system32/drivers/etc/hosts).<br />
<br />
For example, add the following to your hosts file (changing the bogus ip to your server's real ip):<br />
<br />
123.123.123.123&nbsp;&nbsp; mysqlserver1<br />
<br />
Note: On linux, make sure you have "order: hosts,bind" on your /etc/host.conf file.<br />
<br />
On a script, make the mysql connection like so:<br />
<br />
&lt;?<br />
&nbsp; $sid = mysql_connect ("mysqlserver1", "user", "pass");<br />
?&gt;<br />
<br />
Note: this sample is in php, but it can be any other programming language (just type "ping mysqlserver1" on a prompt, on your server)<br />
<br />
And there you have it! If your server ever gets assigned a different ip, just update the hosts file with the new one (every script will work as-is, even if under different hostnames).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66893""></a>
  <div class="note">
   <strong class="user">rui dot batista at netcabo dot pt</strong>
   <a href="#66893" class="date">31-May-2006 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ever wonder what "default username" is?<br />
<span class="default">&lt;?php<br />
$link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">() or die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT SESSION_USER(), CURRENT_USER();"</span><span class="keyword">);<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
echo </span><span class="string">"SESSION USER: "</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
echo </span><span class="string">"CURRENT USER: "</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>Both are ODBC@localhost in my win2k install, so my advice for windows is:<br />
- create a MySQL user named ODBC with no password<br />
- add localhost to ODBC user [right-click ODBC]<br />
- set schema previleges to ODBC@localhost<br />
- use mysql_connect() with no parms, or do not use ;)<br />
This turns to work also with odbc_connect:<br />
odbc_connect("myDSN", "", "")</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65827""></a>
  <div class="note">
   <strong class="user">Mario</strong>
   <a href="#65827" class="date">08-May-2006 09:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP (5.1.2) stores connections according to script name and remote host, apparently. If the same script is requested by the same browser in two different tabs (Firefox for this test) and requests a non-persistent connection using the same user and password, the connection will be shared.<br />
<br />
Ran into this while testing a script for concurrent usage using "LOCK TABLES" queries... and found that one tab's script was blocking until the other finished. No blocking occurred when different machines loaded the same script at the same time. Very interesting.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54160""></a>
  <div class="note">
   
   <a href="#54160" class="date">25-Jun-2005 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
connect to mysql via named pipe under windows :<br />
<br />
in my.ini, add this:<br />
<br />
[mysqld]<br />
enable-named-pipe<br />
<br />
then connect to the server, then connect to mysql using<br />
<br />
mysql_connect('.')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46921""></a>
  <div class="note">
   <strong class="user">camitz at NOSPAM dot example dot com</strong>
   <a href="#46921" class="date">27-Oct-2004 01:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A description about the problem with the password hashing and how to adress them can be found at <a href="http://dev.mysql.com/doc/mysql/en/Password_hashing.html" rel="nofollow" target="_blank">http://dev.mysql.com/doc/mysql/en/Password_hashing.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45029""></a>
  <div class="note">
   <strong class="user">chaoscontrol_hq at yahoo dot com</strong>
   <a href="#45029" class="date">23-Aug-2004 02:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In MySQL4.1 and later, the default password hashing format has changed making it incompatible with 3.x clients.<br />
I found out mysql_connect() works on server versions &gt;= 4.1 when your MySQL user password is blank because password authentication isn't done in that case, otherwise you need to use another connection method (e.g. mysqli).<br />
Also if you are using old MySQL tables on a new server (i.e. the passwords are stored in the old format), then the server will use the old auth method automatically and this function should work in all cases.<br />
Hopefully this will help someone, it had me confused for a while because some of the users on my 4.1 server could connect and some couldn't.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37029""></a>
  <div class="note">
   <strong class="user">martinnitram at excite dot com</strong>
   <a href="#37029" class="date">31-Oct-2003 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to use load data local infile function from mysql (at mysql 4.0.16, php 4.3.3), set fifth parameter of mysql_connect() to CLIENT_LOCAL_FILES(128), which based on MYSQL C API ( also mysql server support load file, check by "show variables like 'local_infile' ")<br />
<br />
Thank&nbsp; 'phpweb at eden2 dot com' to point this out</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33510""></a>
  <div class="note">
   <strong class="user">phpweb at eden2 dot com</strong>
   <a href="#33510" class="date">27-Jun-2003 11:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
client_flags can be things other than MYSQL_CLIENT_COMPRESS, MYSQL_CLIENT_IGNORE_SPACE and MYSQL_CLIENT_INTERACTIVE.<br />
<br />
I presume that mysql_connect() just passes through to the C MySQL API, which provides these constants:<br />
<br />
#define CLIENT_LONG_PASSWORD&nbsp; &nbsp; 1&nbsp; &nbsp; /* new more secure passwords */<br />
#define CLIENT_FOUND_ROWS&nbsp; &nbsp; 2&nbsp; &nbsp; /* Found instead of affected rows */<br />
#define CLIENT_LONG_FLAG&nbsp; &nbsp; 4&nbsp; &nbsp; /* Get all column flags */<br />
#define CLIENT_CONNECT_WITH_DB&nbsp; &nbsp; 8&nbsp; &nbsp; /* One can specify db on connect */<br />
#define CLIENT_NO_SCHEMA&nbsp; &nbsp; 16&nbsp; &nbsp; /* Don't allow database.table.column */<br />
#define CLIENT_COMPRESS&nbsp; &nbsp; &nbsp; &nbsp; 32&nbsp; &nbsp; /* Can use compression protocol */<br />
#define CLIENT_ODBC&nbsp; &nbsp; &nbsp; &nbsp; 64&nbsp; &nbsp; /* Odbc client */<br />
#define CLIENT_LOCAL_FILES&nbsp; &nbsp; 128&nbsp; &nbsp; /* Can use LOAD DATA LOCAL */<br />
#define CLIENT_IGNORE_SPACE&nbsp; &nbsp; 256&nbsp; &nbsp; /* Ignore spaces before '(' */<br />
#define CLIENT_CHANGE_USER&nbsp; &nbsp; 512&nbsp; &nbsp; /* Support the mysql_change_user() */<br />
#define CLIENT_INTERACTIVE&nbsp; &nbsp; 1024&nbsp; &nbsp; /* This is an interactive client */<br />
#define CLIENT_SSL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2048&nbsp; &nbsp;&nbsp; /* Switch to SSL after handshake */<br />
#define CLIENT_IGNORE_SIGPIPE&nbsp;&nbsp; 4096&nbsp; &nbsp;&nbsp; /* IGNORE sigpipes */<br />
#define CLIENT_TRANSACTIONS&nbsp; &nbsp; 8192&nbsp; &nbsp; /* Client knows about transactions */<br />
<br />
Not all of these may work or be meaningful, but CLIENT_FOUND_ROWS does, at least.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32035""></a>
  <div class="note">
   <strong class="user">Graham_Rule at ed dot ac dot uk</strong>
   <a href="#32035" class="date">14-May-2003 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another solution to the security problems of putting usernames and passwords into scripts. I haven't found this documented anywhere else so thought I'd suggest it for the online documentation. ........<br />
<br />
Don't put passwords for mysql into scripts which may be read by any user on the machine.&nbsp; Instead put them into an Apache configuration file and make sure that it is not world-readable. (Apache reads its main config files as root.)<br />
<br />
For example, add this to your httpd.conf (and chmod it to 600 or 660) then tell your apache to reload itself (apachectl graceful).<br />
<br />
&lt;Directory /var/www/html/mydatabase&gt;<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_user fred<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_password secret<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_host server.example.com<br />
&lt;/Directory&gt;<br />
<br />
Then all you need in your PHP code is<br />
<br />
$handle = mysql_connect() or die(mysql_error());<br />
<br />
The passwords etc will only be picked up by scripts running in the named directory (or a sub-directory).&nbsp; The same may be done for virtualhosts etc.<br />
<br />
If you don't want to keep reloading your Apache server then you ay test things putting the php_value directives into a (world readable) .htaccess file. (Clearly not for production use.)<br />
<br />
If you need to debug the values that are being supplied (or not) then use this snippet:<br />
<br />
@syslog(LOG_DEBUG, "Using user=".ini_get("mysql.default_user").<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; " pass=".ini_get("mysql.default_password").<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; " host=".ini_get("mysql.default_host"));<br />
<br />
(This assumes that you are not running in 'safe_mode' and that you are on a unix of some sort.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30243""></a>
  <div class="note">
   <strong class="user">amn -at- frognet.net</strong>
   <a href="#30243" class="date">11-Mar-2003 10:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case you didn't know. You can use mysql_connect in a function to connect to a database and the connection is a super-global... meaning you can use mysql_query in other functions or in no function at all and PHP will use the connection that you opened. This is a handy bit of knowledge that helps if you have a large site with lots of scripts. If you create one function to connect to a db, and call that function in all your scripts, it makes for easier code maintenance since you only have to update one line of code to change your mysql connection instead of updating all your scripts individually.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mysql-close.html">mysql_close</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysql-create-db.html">mysql_create_db</a></div>
 <div class="up"><a href="ref.mysql.html">MySQL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
