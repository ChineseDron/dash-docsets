<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Get the ID generated in the last query</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mysql-info.html">mysql_info</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysql-list-dbs.html">mysql_list_dbs</a></div>
 <div class="up"><a href="ref.mysql.html">MySQL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mysql-insert-id" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_insert_id</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_insert_id</span> &mdash; <span class="dc-title">Get the ID generated in the last query</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-insert-id-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><b>mysql_insert_id</b></span>
    ([ <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$link_identifier</tt></span>
  ] )</div>

  <p class="para rdfs-comment">
   Retrieves the ID generated for an AUTO_INCREMENT column by the previous 
   query (usually INSERT).
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-insert-id-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><i><tt class="parameter">
link_identifier</tt></i></span><dd>
<p class="para">The MySQL connection. If the
link identifier is not specified, the last link opened by
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> is assumed. If no such link is found, it
will try to create one as if <span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> was called
with no arguments. If no connection is found or established, an
<b><tt>E_WARNING</tt></b> level error is generated.</p></dd>

</dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-insert-id-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   The ID generated for an AUTO_INCREMENT column by the previous 
   query on success, <i>0</i> if the previous
   query does not generate an AUTO_INCREMENT value, or <b><tt>FALSE</tt></b> if
   no MySQL connection was established.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysql-insert-id-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-1532">
    <p><b>Example #1 <span class="function"><b>mysql_insert_id()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br /></span><span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'mydb'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;mytable&nbsp;(product)&nbsp;values&nbsp;('kossu')"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Last&nbsp;inserted&nbsp;record&nbsp;has&nbsp;id&nbsp;%d\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysql_insert_id</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-insert-id-notes">
  <h3 class="title">Notes</h3>
  <div class="caution"><b class="caution">Caution</b>
   <p class="para">
    <span class="function"><b>mysql_insert_id()</b></span> will convert the return type of the
    native MySQL C API function <i>mysql_insert_id()</i> to a type
    of <i>long</i> (named <span class="type"><a href="language.types.integer.html" class="type int">int</a></span> in PHP). If your
    AUTO_INCREMENT column has a column type of BIGINT (64 bits) the
    conversion may result in an incorrect value. Instead, use the internal
    MySQL SQL function LAST_INSERT_ID() in an SQL query. For more information
    about PHP&#039;s maximum integer values, please see the
    <a href="language.types.integer.html" class="link">integer</a> documentation.
   </p>
  </div>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Because <span class="function"><b>mysql_insert_id()</b></span> acts on the last performed
    query, be sure to call <span class="function"><b>mysql_insert_id()</b></span> immediately 
    after the query that generates the value.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    The value of the MySQL SQL function
    <i>LAST_INSERT_ID()</i> always contains the most
    recently generated AUTO_INCREMENT value, and is not reset
    between queries.
  </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-insert-id-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-query.html" class="function" rel="rdfs-seeAlso">mysql_query()</a> - Send a MySQL query</span></li>
    <li class="member"><span class="function"><a href="function.mysql-info.html" class="function" rel="rdfs-seeAlso">mysql_info()</a> - Get information about the most recent query</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="97184""></a>
  <div class="note">
   <strong class="user">jayon</strong>
   <a href="#97184" class="date">07-Apr-2010 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if trying to insert a generated random id use mysql's UUID() to generate a unique key for you, there should be a lot less problems with it.<br />
<br />
<span class="default">&lt;?php<br />
$query </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">( </span><span class="string">"INSERT INTO `users`"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"(`id`&nbsp; &nbsp; ,`username`)"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"VALUES"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"(UUID(),'%s'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">)<br />
&nbsp; );<br />
<br />
if( !</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) )<br />
{</span><span class="comment">/*insert failed*/</span><span class="keyword">}<br />
<br />
</span><span class="default">$id </span><span class="keyword">= </span><span class="default">mysql_insert_id</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95584""></a>
  <div class="note">
   <strong class="user">dave</strong>
   <a href="#95584" class="date">10-Jan-2010 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a lot of incorrect info here on "don't use AI" and "using max is equivalent".&nbsp; Then you have people improperly advising you to use psuedo-random numbers<br />
<br />
If you're really worried about the AI field not returning because of the inherent race conditions, just do a select statement based on the vars you just input.&nbsp; If your vars are not unique, DON'T use these psuedo-random numbers.&nbsp; When you have enough iterations, the probability that the one of these randoms becomes a duplicate gets pretty high.<br />
<br />
Instead, just use the unix timestamp.&nbsp; However, don't use UNIX_TIMESTAMP() in your query, because if you do, when you run your select statement right after, there's a possibility that you'll end up with a different timestamp.<br />
<br />
Since date() continues to count up during the execution of the script, simply store date(U) into a variable or definition.&nbsp; Then insert and select based on that.&nbsp; Assuming you're not using mysql procedures:<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="default">UNIX_TIMESTAMP</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">'U'</span><span class="keyword">));<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"insert into table values('', 'a', 'b', 'c', 'd', '"</span><span class="keyword">.</span><span class="default">UNIX_TIMESTAMP</span><span class="keyword">.</span><span class="string">"'"</span><span class="keyword">);<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"select id from table where a_col = 'a' and b_col = 'b' and c_col = 'c' and d_col = 'd' and temp_id = 'UNIX_TIMESTAMP'"</span><span class="keyword">);<br />
...<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94511""></a>
  <div class="note">
   <strong class="user">mmurphy at cpmsnational dot com</strong>
   <a href="#94511" class="date">09-Nov-2009 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If mysql_insert_id() returns 0 or null, check that you have also included the link identifier. It is optional but if you have more than one database connection then this is necessary. <br />
<br />
ex: mysql_insert_id($conn)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93745""></a>
  <div class="note">
   <strong class="user">bargainbatman at gmail dot com</strong>
   <a href="#93745" class="date">25-Sep-2009 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I thought this would be relevant to all the people using mysqli and looking for the ID after INSERT command :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">insert_join</span><span class="keyword">(</span><span class="default">$catid</span><span class="keyword">, </span><span class="default">$disc_id</span><span class="keyword">) {<br />
</span><span class="comment">// insert a new item into the database<br />
&nbsp;&nbsp; </span><span class="default">$conn </span><span class="keyword">= </span><span class="default">db_connect</span><span class="keyword">();<br />
&nbsp;&nbsp; </span><span class="comment">// insert new item<br />
&nbsp;&nbsp; </span><span class="default">$demande </span><span class="keyword">= </span><span class="string">"insert into categories_disc values ('', '"</span><span class="keyword">.</span><span class="default">$catid</span><span class="keyword">.</span><span class="string">"', '"</span><span class="keyword">.</span><span class="default">$disc_id</span><span class="keyword">.</span><span class="string">"')"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$resultat </span><span class="keyword">= </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$demande</span><span class="keyword">);<br />
&nbsp;&nbsp; if (!</span><span class="default">$resultat</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">insert_id</span><span class="keyword">; </span><span class="comment">// function will now return the ID instead of true. <br />
</span><span class="keyword">}<br />
<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Then, on the other side, let us call this function as follows :<br />
<br />
<span class="default">&lt;?php<br />
$cat_id </span><span class="keyword">= </span><span class="default">insert_join</span><span class="keyword">(</span><span class="default">$catid</span><span class="keyword">, </span><span class="default">$disc_id</span><span class="keyword">);<br />
if(</span><span class="default">$cat_id </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;p&gt;Category stuff was added to the database as follows : &lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;hr&gt;ID de la category : "</span><span class="keyword">.</span><span class="default">$cat_id</span><span class="keyword">.</span><span class="string">"&lt;/p&gt;&lt;hr&gt;"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93622""></a>
  <div class="note">
   <strong class="user">RPaseur at NationalPres dot org</strong>
   <a href="#93622" class="date">18-Sep-2009 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently the value returned by mysql_insert_id() may be correct for BIGINT auto_increment keys below the value of INT, but it may wrap to negative when the BIGINT auto_increment passes the largest signed value of INT.&nbsp; A timebomb for very large tables...<br />
<br />
PHP 5.2.10, MySQL 5.0.81, assume the connection and selection...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// CREATE A TABLE AND ALTER IT TO A HIGH INDEX NUMBER<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"CREATE TEMPORARY TABLE noise ( id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY ) ENGINE=MEMORY"</span><span class="keyword">;<br />
if (!</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">)) die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"ALTER TABLE noise AUTO_INCREMENT = 2147483646"</span><span class="keyword">;<br />
if (!</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">)) die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
<br />
</span><span class="comment">// INSERT DATA TO ADD TO THE AUTO_INCREMENT INDEX<br />
</span><span class="default">$kount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while (</span><span class="default">$kount </span><span class="keyword">&lt; </span><span class="default">3</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"INSERT INTO noise () VALUES ()"</span><span class="keyword">;<br />
&nbsp;&nbsp; if (!</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">)) die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; </span><span class="default">$nid </span><span class="keyword">= </span><span class="default">mysql_insert_id</span><span class="keyword">(</span><span class="default">$dbcx</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$nid</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$kount</span><span class="keyword">++;<br />
}<br />
<br />
</span><span class="comment">// PRODUCES THIS<br />
// int(2147483646)<br />
// int(2147483647)<br />
// int(-2147483648)<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90952""></a>
  <div class="note">
   <strong class="user">Ultimater at gmail dot com</strong>
   <a href="#90952" class="date">18-May-2009 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an elegant way to INSERT using UPDATE syntax.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">insert_update</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">,</span><span class="default">$fields</span><span class="keyword">,</span><span class="default">$id</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$id</span><span class="keyword">===</span><span class="default">NULL</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">=</span><span class="string">"INSERT INTO </span><span class="default">$table</span><span class="string"> (id) VALUES(NULL);UPDATE </span><span class="default">$table</span><span class="string"> SET </span><span class="default">$fields</span><span class="string"> WHERE id = LAST_INSERT_ID()"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">=</span><span class="string">"UPDATE </span><span class="default">$table</span><span class="string"> SET </span><span class="default">$fields</span><span class="string"> WHERE id = </span><span class="default">$id</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$sql</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage:<br />
<br />
<span class="default">&lt;?php<br />
$table</span><span class="keyword">=</span><span class="string">"`members`"</span><span class="keyword">;<br />
</span><span class="default">$fields</span><span class="keyword">=</span><span class="string">"`username` = 'Ultimater',`userlevel` = 'member'"</span><span class="keyword">;<br />
if(!</span><span class="default">$profile_exists</span><span class="keyword">)<br />
{<br />
</span><span class="comment">//insert a record<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">=</span><span class="default">insert_update</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">,</span><span class="default">$fields</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
}else{<br />
</span><span class="comment">//update a record<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">=</span><span class="default">insert_update</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">,</span><span class="default">$fields</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84616""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#84616" class="date">22-Jul-2008 02:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If i can't get a good increment.<br />
I use this function<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_new_id</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">){<br />
&nbsp;</span><span class="default">$select </span><span class="keyword">= </span><span class="string">'select max(`id`) +1as `id` from `'</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">'`&nbsp; where `id` != &lt;some big id&gt;'</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$query </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$select</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">mysql_fetch_object</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;return </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">id</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84376""></a>
  <div class="note">
   <strong class="user">neep03 at zonnet dot nl</strong>
   <a href="#84376" class="date">10-Jul-2008 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I solved the problem by inserting a "unique" code, like md5 or session_id.<br />
First you insert the date in de database and in the next step you look for de used id.<br />
Just a part of the php script.<br />
<br />
<span class="default">&lt;?php<br />
$code&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">());&nbsp; </span><span class="comment">// a random 32 digits code is generated<br />
</span><span class="default">$name&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$POST_</span><span class="keyword">[</span><span class="default">name</span><span class="keyword">];<br />
</span><span class="default">$email&nbsp; </span><span class="keyword">= </span><span class="default">$POST_</span><span class="keyword">[</span><span class="default">email</span><span class="keyword">];<br />
<br />
</span><span class="comment">// first step<br />
</span><span class="default">$mysql_id </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dbhost</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$dbuser</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$dbpass</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"INSERT into database (code,name,email) VALUES('</span><span class="default">$code</span><span class="string">','</span><span class="default">$name</span><span class="string">','</span><span class="default">$email</span><span class="string">')"</span><span class="keyword">;<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_db_query</span><span class="keyword">(</span><span class="string">"</span><span class="default">$db</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$sql</span><span class="string">"</span><span class="keyword">,</span><span class="default">$mysql_id</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; include(</span><span class="string">"error.php"</span><span class="keyword">);<br />
<br />
</span><span class="comment">//second step<br />
</span><span class="default">$mysql_id </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dbhost</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$dbuser</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$dbpass</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"select * from database where code='</span><span class="default">$code</span><span class="string">' "</span><span class="keyword">;&nbsp; </span><span class="comment">// select the record with the above generated md5 code<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_db_query</span><span class="keyword">(</span><span class="string">"</span><span class="default">$db</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$sql</span><span class="string">"</span><span class="keyword">,</span><span class="default">$mysql_id</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; include(</span><span class="string">"error.php"</span><span class="keyword">);<br />
<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">);<br />
<br />
</span><span class="default">$id </span><span class="keyword">= </span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]; </span><span class="comment">// this is de used id genereted by auto_increment for this input<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84265""></a>
  <div class="note">
   <strong class="user">thomas at tgohome dot com</strong>
   <a href="#84265" class="date">06-Jul-2008 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful, because this operates on the last performed query, it includes UPDATEs and SELECTs as 'queries'. For example, this is what I set up.<br />
<br />
INSERT post into database<br />
UPDATE child forums with insert ID (insert ID is correct)<br />
Insert ID = 0 because of last query<br />
Send the user to their post - but fail because the insert ID is zero. <br />
<br />
So store it in a variable like $insert_id instead of querying it every time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83942""></a>
  <div class="note">
   <strong class="user">icethenet at NOSPAM dot hotmail dot com</strong>
   <a href="#83942" class="date">19-Jun-2008 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Other methods seem to have problems with missing records in auto increment sometimes you will have records 1 2 5 6 most functions would return the value of 5 for next auto increment when indeed it would be 7. This is the only way I found to make this work so I can use my customer number and the record number to provide a truly unique customer number that is also useful. <br />
<br />
$next_increment = 0;<br />
$qShowStatus = "SHOW TABLE STATUS LIKE 'your_table'";<br />
$qShowStatusResult = mysql_query($qShowStatus) or die(mysql_error());<br />
$row = mysql_fetch_assoc($qShowStatusResult);<br />
$next_increment = $row['Auto_increment'];<br />
echo $next_increment;<br />
<br />
then you can do something like this <br />
echo&nbsp; $next_increment ."-". rand();<br />
<br />
My first post: I hope this is useful to someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83851""></a>
  <div class="note">
   <strong class="user">erik.something@GMAIL DOT COM</strong>
   <a href="#83851" class="date">15-Jun-2008 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have come up with an unorthodox solution for this problem. Im sure its not the fastest but its surely the safest.<br />
<br />
In sql I have made a column to be "unique" and instead of fetching the last Id generated by auto_increment I make a random number and I store that number in the before created column. Example:<br />
<br />
id ____ rand_nr ____ name<br />
1&nbsp; ____ 345432 ____ Richard<br />
2&nbsp; ____ 598675 ____ Joe<br />
3&nbsp; ____ 926374 ____ Patrick<br />
<br />
This way I know exactly what number coresponds to the row inserted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83550""></a>
  <div class="note">
   <strong class="user">dane514 AT gmail DOT COM</strong>
   <a href="#83550" class="date">30-May-2008 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I may have solved the problems that a number of you have brought to everyone's attention. Here is a simple function that will always return the correct ID of the afffecting row (i.e., the row that will soon be inserted into)--no matter how many consecutive users are online and updating/inserting into the same table that you are also inserting/updating. <br />
<br />
Retrieving the ID of the row soon-to-be-affected was imperative to my current project, and the various COUNT() solutions just did not cut it.<br />
<br />
Use this before any insert/update statement to retrieve the ID of the row to be inserted into:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_current_insert_id</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$q </span><span class="keyword">= </span><span class="string">"SELECT LAST_INSERT_ID() FROM </span><span class="default">$table</span><span class="string">"</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mysql_num_rows</span><span class="keyword">(</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">)) + </span><span class="default">1</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
It would be great to read any discussions if anyone considers this function problematic.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82928""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#82928" class="date">02-May-2008 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"Why on earth are you all arguing about the best way to get the next auto_increment value? The whole point is that it increments automatically. The name should be a give away."<br />
<br />
Because you need the same last id value in another table. So you need a way to identify it, in order to use it in the next query. This way its easier than using a new query to get the id like ORDER BY id DESC LIMIT 1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82367""></a>
  <div class="note">
   <strong class="user">elinor dot hurst at REMOVETHIS dot gmail dot com</strong>
   <a href="#82367" class="date">08-Apr-2008 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I don't get all the fuss around this.<br />
<br />
I read:<br />
"The value of mysql_insert_id() is affected only by statements issued within the current client connection. It is not affected by statements issued by other clients."<br />
<br />
See: <a href="http://dev.mysql.com/doc/refman/5.0/es/mysql-insert-id.html" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.0/es/mysql-insert-id.html</a><br />
<br />
I can't really see what's inaccurate about that.<br />
<br />
"In the case of a multiple-row INSERT statement, mysql_insert_id() returns the first automatically generated AUTO_INCREMENT value; if no such value is generated, it returns the last last explicit value inserted into the AUTO_INCREMENT column."<br />
<br />
I must be missing something here but why would you insert multiple rows and then only handle the last one with some favoured behaviour? You could just as well insert them one at a time and then handle each row separately with the latest id.<br />
<br />
I can't see what's wrong with that.<br />
<br />
However I can see what's wrong with simply using max(my_table.id_column) because of the concurrent access issues this would imply.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81351""></a>
  <div class="note">
   <strong class="user">Alfred Nony Mouse</strong>
   <a href="#81351" class="date">23-Feb-2008 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's nothing inherently wrong with using auto-increment fields. There's also nothing wrong with the main competetive idea, which is for the database to supply a primitive sequence of non-repeating identifiers, typically integers. This is rather like which side of the road you drive on.<br />
<br />
The bigger problem is when people don't understand what they are doing with database access. It's like driving a car without really knowing the rules of the road. Such people wind up making bad decisions without realizing it, and then, eventually, something breaks.<br />
<br />
Databases are complex beasts, and worth taking the time to really understand. Learn about the implications and limitations of different approaches to solving problems. Then, you will be prepared to pick a solution based on what has to work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81264""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81264" class="date">20-Feb-2008 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Why on earth are you all arguing about the best way to get the next auto_increment value? The whole point is that it increments automatically. The name should be a give away.<br />
<br />
Don't calculate the next id, just leave the field blank and let the database issue the id itself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81129""></a>
  <div class="note">
   <strong class="user">venimus at gmail dot com</strong>
   <a href="#81129" class="date">14-Feb-2008 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the most accurate NEXT auto_increment id use this function<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mysql_next_id</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'SHOW TABLE STATUS LIKE "'</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rows </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$rows</span><span class="keyword">[</span><span class="string">'auto_increment'</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Any other methods of predicting the next autogenerated id will fail in certain cases.<br />
Most of the programmers try to get the MAX(id)+1 (or sort the table backwards and get the first id) but this will cease to work when you delete the last record.<br />
<br />
However in a race condition even this function may fail if other users insert records in the time between calling this function and using the return value. You may use LOCK TABLES to prevent such a case.<br />
<br />
Anyway, the best advice I can give you is to RECONSIDER YOUR LOGIC TO AVOID USING AUTO_INCREMENT.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81112""></a>
  <div class="note">
   <strong class="user">venimus at gmail dot com</strong>
   <a href="#81112" class="date">14-Feb-2008 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using 'SELECT MAX(id)+1...' will not return the next auto_increment id. This function is totaly unreliable by two reasons.<br />
1. In race conditions there is no guarantee that other user will not insert new record while your function have done its work. This will render your "generated" last_id obsolete. It is rare case but it happens.<br />
2. Most of all, if the last record(s) in the table is deleted the max id will no longer match the auto_increment value, because auto_increment never repeats numbers, it increases whenever an insert statement is completed and does not decrease if you erase the last record!!! <br />
<br />
e.g. If you have this table with the last record deleted:<br />
id name<br />
1. car<br />
2. plane<br />
3. truck - [erased]<br />
<br />
auto_increment is 4<br />
but MAX(id) is 2!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78439""></a>
  <div class="note">
   <strong class="user">benfoldsforever</strong>
   <a href="#78439" class="date">11-Oct-2007 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just wanted to re-iterate previous comment on receiving NULL or 0 return statement from calling mysql_insert_id() after insert statement.<br />
<br />
If you have multiple mysql connections (i.e. mysql_connect() or mysqli_connect()) on the page you will need to specify the the connection you are using when calling this function!<br />
<br />
I.e.<br />
mysql_insert_id($MY_CONN);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77943""></a>
  <div class="note">
   <strong class="user">bonatoque at yahoo.com</strong>
   <a href="#77943" class="date">20-Sep-2007 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that, in case of a very first INSERT, mysql_insert_id() returns 0. My guess is that MySQL does not trigger auto increment if the table is empty. Once an entry is present, it works as expected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77059""></a>
  <div class="note">
   <strong class="user">louis at intoplay dot com</strong>
   <a href="#77059" class="date">13-Aug-2007 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If mysql_insert_id() returns 0 or null, check your auto increment field is not being set by your sql query, also if you have multiple db connections like I did, the solution is to create a seperate db connection for this query.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76815""></a>
  <div class="note">
   <strong class="user">foros (_AT_) anthalia.com</strong>
   <a href="#76815" class="date">31-Jul-2007 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Forget about using MAX to get the last inserted id. Race conditions like other users inserting between your SELECT MAX(.. and your INSERT may render your id unusable.<br />
<br />
The WAY to get the id is by using mysql_insert_id() or the mysql SQL function LAST_INSERT_ID(). <br />
<br />
Take care, if using mysql_insert_id() you should provide the resource returned by the mysql_connect, not the resultset returned by mysql_query.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76504""></a>
  <div class="note">
   <strong class="user">guelphdad at yahoo dot com</strong>
   <a href="#76504" class="date">18-Jul-2007 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
and the primary reason to use neither of those last two solutions is both could result in race conditions when there is more than a single user with access to the database. when you use MAX or ORDER BY DESC LIMIT 1 you will retrieve the maximum value from the table, at that moment. That doesn't mean another user doesn't do an insertion in the primary and secondary table BEFORE you do your insertion in the secondary table. You have thus inserted a row with a correct id into the second table. Always use last_insert_id()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76213""></a>
  <div class="note">
   <strong class="user">daiguo</strong>
   <a href="#76213" class="date">05-Jul-2007 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To: Ben AT alfreido.com<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">previous_id</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$id_column</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$table </span><span class="keyword">&amp;&amp; </span><span class="default">$id_column</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT MAX("</span><span class="keyword">.</span><span class="default">$id_column</span><span class="keyword">.</span><span class="string">") AS maxid FROM "</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stuff </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$stuff</span><span class="keyword">[</span><span class="string">'maxid'</span><span class="keyword">];<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use MySQL's built-in function MAX(). It's faster because any min/max algorithm is faster than sorting entire table.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75746""></a>
  <div class="note">
   <strong class="user">Ben AT alfreido.com</strong>
   <a href="#75746" class="date">13-Jun-2007 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I realise this isn't the best way of doing it, but if use auto_increment in your tables, which just increases by one every time you add a row, you can get the last used id simply by quering the database, selecting the id column and ordering it descendingly and pulling out the first row returned. The added bonus is you can do it anytime, instead of just after an INSERT query.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">previous_id</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$id_column</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$table </span><span class="keyword">&amp;&amp; </span><span class="default">$id_column</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT " </span><span class="keyword">. </span><span class="default">$id_column </span><span class="string">" FROM " </span><span class="keyword">. </span><span class="default">$table </span><span class="keyword">. </span><span class="string">"<br />
&nbsp;&nbsp;&nbsp; ORDER BY " </span><span class="keyword">. </span><span class="default">$id_column </span><span class="keyword">. </span><span class="string">" DESC<br />
&nbsp;&nbsp;&nbsp; LIMIT 1"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stuff </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$stuff</span><span class="keyword">[</span><span class="default">$id_column</span><span class="keyword">];<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Just change $table to the table name, and $id_column to the column which auto increments.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71949""></a>
  <div class="note">
   <strong class="user">Typer85 at gmail dot com</strong>
   <a href="#71949" class="date">25-Dec-2006 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please be warned that this function, like almost every other MySQL function, requires that the same database resource link that was used to insert the data into the database be used to get the last auto increment value.<br />
<br />
If you close the database connection after inserting data, then open one up again and then attempt to get the last auto increment value, you will get an incorrect value since all resources related to the last insert query were cleaned up after the connection was closed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71215""></a>
  <div class="note">
   <strong class="user">Bob M.</strong>
   <a href="#71215" class="date">16-Nov-2006 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a problem with the function below submitted by rudolflai<br />
<br />
In that mysql_autoid function, what happens when between the time you've retrieved the id and the time you do something with it (like INSERT a new record) another new record has been inserted into the database in the interim?<br />
<br />
Better make sure you LOCK the tables you're working on before you use the function and don't UNLOCK until after you've done something with the id returned.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70805""></a>
  <div class="note">
   <strong class="user">buana95 att yahoo dott com</strong>
   <a href="#70805" class="date">29-Oct-2006 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's not true that mysql_insert_id() only returns the ID generated for an AUTO_INCREMENT column by the previous INSERT query.<br />
<br />
We can use LAST_INSERT_ID() statement that will return value for mysql_insert_id().<br />
<br />
Example:<br />
<br />
$sql = "UPDATE `mytable` SET `mytable_id`= LAST_INSERT_ID(`mytable_id` + 1) WHERE ...;<br />
<br />
@mysql_query($sql);<br />
$last_id = mysql_insert_id();<br />
<br />
LAST_INSERT_ID() statement will affect mysql_insert_id().<br />
<br />
Regards,<br />
Buana</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69753""></a>
  <div class="note">
   <strong class="user">mariano at uvcms dot com</strong>
   <a href="#69753" class="date">19-Sep-2006 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When used in transactions, mysql_insert_id() MUST be called before committing. Otherwise, it will return unpredictable results.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69716""></a>
  <div class="note">
   <strong class="user">squezy16 at hotmail dot com</strong>
   <a href="#69716" class="date">17-Sep-2006 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the problem of the LAST_INSERT_ID function is that it may return an old Auto_Increment number if the INSERT did not have the time to run properly while the mysql_insert_id always returns the good value. I tried to insert a row imidiatly followed by a select LAST_INSERT_ID and it kept on returning me the LAST_INSERT_ID before my insert statement.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69569""></a>
  <div class="note">
   <strong class="user">rudolflai at gmail dot com</strong>
   <a href="#69569" class="date">11-Sep-2006 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
Below is a snippet for retriving the next insert id from a mysql table. It functions like the auto_increment option in phpMyAdmin. Hope you find it helpful. =]<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">function </span><span class="default">mysql_autoid</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">,</span><span class="default">$table</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">'SELECT MAX('</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="string">') AS last_id FROM '</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">[</span><span class="default">last_id</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">; <br />
}<br />
<br />
</span><span class="comment">/// usage mysql_autoid('nID','news');<br />
<br />
</span><span class="default">?&gt;</span> <br />
<br />
Cheers,<br />
Rudolf</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65848""></a>
  <div class="note">
   <strong class="user">james dot baxter at nospamplease dot com</strong>
   <a href="#65848" class="date">08-May-2006 05:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Have had many people coming to me with issues regarding last_insert_id and mysql_insert_id() etc<br />
<br />
This is a very simple solution that caters for most. As you can see it gets the last auto inc from the field, in this case, ID.<br />
<br />
mysql_query("LOCK TABLES art WRITE");<br />
<br />
mysql_query("INSERT INTO table (....) VALUES (....)");<br />
<br />
$result = mysql_query("SELECT MAX(ID) AS LAST_ID FROM table");<br />
<br />
$result = mysql_fetch_array($result);<br />
<br />
mysql_query("UNLOCK TABLES");<br />
<br />
echo "Last ID#" . $result[LAST_ID];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61340""></a>
  <div class="note">
   <strong class="user">john k.</strong>
   <a href="#61340" class="date">31-Jan-2006 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when using "insert ignore". If the unique index already exists, the record will not be added, but it WILL give you the id of the next auto_increment value even though it didn't create it.<br />
<br />
<span class="default">&lt;?php<br />
$sql </span><span class="keyword">= </span><span class="string">"insert ignore into sometable set num=10"</span><span class="keyword">;<br />
</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">) or die();<br />
echo </span><span class="default">mysql_affected_rows</span><span class="keyword">().</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">mysql_insert_id</span><span class="keyword">().</span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// same record, database is unique on 'num'<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"insert ignore into sometable set num=10"</span><span class="keyword">;<br />
</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">) or die();<br />
echo </span><span class="default">mysql_affected_rows</span><span class="keyword">().</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">mysql_insert_id</span><span class="keyword">().</span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
would give:<br />
1<br />
116372<br />
<br />
0<br />
116373</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59718""></a>
  <div class="note">
   <strong class="user">heiligkind at yahoo dot de</strong>
   <a href="#59718" class="date">14-Dec-2005 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you insert a data row by using the ON DUPLICATE KEY UPDATE clause in an INSERT-statement, the mysql_insert_id() function will return not the same results as if you directly use LAST_INSERT_ID() in MySQL.<br />
<br />
See the following example:<br />
<br />
&lt;?<br />
&nbsp;&nbsp; // insert a datarow, primary key is auto_increment<br />
&nbsp;&nbsp; // value is a unique key<br />
&nbsp;&nbsp; $query = "INSERT INTO test (value) VALUES ('test')";<br />
&nbsp;&nbsp; mysql_query( $query );<br />
<br />
&nbsp;&nbsp; echo 'LAST_INSERT_ID: ',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mysql_query( "SELECT LAST_INSERT_ID()" ),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; '&lt;br&gt;mysql_insert_id: ',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mysql_insert_id();<br />
<br />
?&gt;<br />
<br />
This will print:<br />
<br />
LAST_INSERT_ID: 1<br />
mysql_insert_id: 1<br />
<br />
In this case the function returns the same as the MySQL-Statement.<br />
But see the insert on an existing key:<br />
<br />
&lt;?<br />
&nbsp;&nbsp; $query = "INSERT INTO test (value) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; VALUES ('test')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ON DUPLICATE KEY UPDATE value = 'test2'";<br />
&nbsp;&nbsp; mysql_query( $query );<br />
<br />
&nbsp;&nbsp; echo 'LAST_INSERT_ID: ',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mysql_query( "SELECT LAST_INSERT_ID()" ),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; '&lt;br&gt;mysql_insert_id: ',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mysql_insert_id();<br />
<br />
?&gt;<br />
<br />
This will print:<br />
<br />
LAST_INSERT_ID: 2<br />
mysql_insert_id: 1<br />
<br />
By using the ON DUPLICATE KEY UPDATE clause, only the old datarow will be modified, if the INSERT statement causes a duplicate entry, but the LAST_INSERT_ID() function returns the next auto_increment value for the primary key, which is by the way not set as the next auto_increment value in the database.<br />
<br />
The mysql_insert_id() function returns the primary key of the old (and changed) data row. For me this is the right operation method, because the LAST_INSERT_ID() function returns a value which is not referenced to a data row at all.<br />
<br />
Greets from Munich.<br />
<br />
heiligkind</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59445""></a>
  <div class="note">
   <strong class="user">Soroushl at gmail dot com</strong>
   <a href="#59445" class="date">06-Dec-2005 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As mentioned by frumler at the-beach dot no_spam dot net<br />
<br />
the LAST_INSERT_ID works like a charm when inserting values into tables.<br />
<br />
I'm not sure why anyone would need mysql_insert_id() when LAST_INSERT_ID is readily available.<br />
<br />
example:<br />
<br />
Say you have a table called "transaction" and a table called "accounts".&nbsp; Obviously each account must be created using a transaction, so every time a record is created in the accounts table, a record must be created in the transaction table containing the same account_id(auto_increment) that was just created by mysql.<br />
<br />
Here's a simple way to do this:<br />
<br />
<span class="default">&lt;?php<br />
$account_query</span><span class="keyword">=</span><span class="string">"INSERT INTO accounts (account_id,type) VALUES (NULL,'saving')"</span><span class="keyword">;<br />
</span><span class="default">$transaction_query</span><span class="keyword">=</span><span class="string">"INSERT INTO transactions(transaction_id,account_id) VALUES (NULL,LAST_INSERT_ID)"</span><span class="keyword">;<br />
<br />
</span><span class="default">$a_query</span><span class="keyword">=</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$account_query</span><span class="keyword">);<br />
</span><span class="default">$t_query</span><span class="keyword">=</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$transaction_query</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59313""></a>
  <div class="note">
   
   <a href="#59313" class="date">02-Dec-2005 10:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take care of setting an empty value for the AUTO_INCREMENT Field else you never get a value except zero returned from mysq_insert_id() ....<br />
<br />
Ciao Ephraim</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56415""></a>
  <div class="note">
   <strong class="user">bholbrook at servillian dot com</strong>
   <a href="#56415" class="date">01-Sep-2005 01:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My apologies for the error below (that was modified out of a class) - as you cannot define a constant as an array.<br />
<br />
replace the line:<br />
<br />
&lt;?<br />
<br />
define("ID",...);<br />
<br />
?&gt;<br />
<br />
with<br />
<br />
&lt;?<br />
<br />
$mysql_id = mysql_query("...");<br />
<br />
?&gt;<br />
<br />
$mysql_id is now an array in which the first element $mysql_id[0] holds the last inserted id.<br />
<br />
Apologies if anyone struggled over that one... esp. the noobs.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56329""></a>
  <div class="note">
   <strong class="user">bholbrook at servillian dot com</strong>
   <a href="#56329" class="date">30-Aug-2005 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An effective way to retrieve the last insert id without fail or having two queries inserted at the same time causing an unexpected number being returned.<br />
<br />
&lt;?<br />
<br />
mysql_query("LOCK TABLES apc_forms WRITE");<br />
mysql_query("SET AUTOCOMMIT = 0");<br />
mysql_query("INSERT INTO apc_forms (form_title, form_event_id, form_expirey) VALUES ('title',1,'2005-10-10')");<br />
define('ID',mysql_query("SELECT LAST_INSERT_ID()"));<br />
mysql_query("COMMIT");<br />
mysql_query("UNLOCK TABLES");<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54995""></a>
  <div class="note">
   <strong class="user">athies at gmail dot com</strong>
   <a href="#54995" class="date">21-Jul-2005 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a quick note. mysql_insert_id() does work with REPLACE.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52650""></a>
  <div class="note">
   <strong class="user">ed at is-cool dot net</strong>
   <a href="#52650" class="date">08-May-2005 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware, mysql_insert_id() only returns the value of the last syntaxically correct insert statement.<br />
<br />
If your code has a problem and the insert is not understood by the server then the value of the last working insert command is returned.<br />
<br />
Put something else in place such as "select count( id ) from table" before and after the mysql_insert_id() call to ensure that a row was inserted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50170""></a>
  <div class="note">
   <strong class="user">relic at daimi dot au dot dk</strong>
   <a href="#50170" class="date">20-Feb-2005 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A bit more on return values:<br />
mysql_insert_id() returns 0 if you haven't actually manipulated anything yet.<br />
<br />
Also, it returns 0 even if the DB connection is lost[0] between inserting and calling mysql_insert_id() - so you can always count on getting an integer.<br />
<br />
[0] By 'lost' I mean e.g. a DB crash. Actually closing the open link and then trying to communicate with the DB will of course result in an error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50023""></a>
  <div class="note">
   <strong class="user">brodseba AT brodseba DOT com</strong>
   <a href="#50023" class="date">15-Feb-2005 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's possible to do the same with M$ Server.<br />
<br />
function odbc_insert_id()<br />
{<br />
&nbsp; $query = "SELECT @@IDENTITY AS ID;";<br />
&nbsp; $result = odbc_exec($this-&gt;m_rConnectionID, $query);<br />
&nbsp; $row = odbc_fetch_object($result);<br />
&nbsp; return $row-&gt;ID;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47317""></a>
  <div class="note">
   <strong class="user">sander [ad] deltaserv [d0t] nl</strong>
   <a href="#47317" class="date">10-Nov-2004 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to: sly at noiretblanc dot org:<br />
<br />
Make sure that auto_increment has an capital A as the first letter, otherwise it WON'T work! So you have to spell it as Auto_increment... And then it works fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46160""></a>
  <div class="note">
   <strong class="user">Baak</strong>
   <a href="#46160" class="date">30-Sep-2004 11:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I believe the "resource link" being referred to is not what is returned from mysql_query() but the $link returned from mysql_connect(). mysql_insert_id() will just use the most recent connection if there is no explicit $link being used.<br />
<br />
So the above example in the manual page itself should behave the same with mysql_insert_id($link) at the end instead of the mysql_insert_id() they used. If you had multiple connections, the $link might come in handy.<br />
<br />
Also in reading the mysql manual itself, there is some enlightening information on the fact that this does appear to be totally safe to use because it is on a per-connection basis.<br />
<br />
Here's the relevant quote from the manual on LAST_INSERT_ID() which is located here: <a href="http://dev.mysql.com/doc/mysql/en/Information_functions.html" rel="nofollow" target="_blank">http://dev.mysql.com/doc/mysql/en/Information_functions.html</a><br />
<br />
"The last ID that was generated is maintained in the server on a per-connection basis. This means the value the function returns to a given client is the most recent AUTO_INCREMENT value generated by that client. The value cannot be affected by other clients, even if they generate AUTO_INCREMENT values of their own. This behavior ensures that you can retrieve your own ID without concern for the activity of other clients, and without the need for locks or transactions."<br />
<br />
Sounds safe to me. I couldn't imagine this would be done any other way *but* on a per-connection basis, otherwise chaos would ensue. The only way to test it would be to perform a multi-thread type test. Perhaps someone is up for it and wants to post their results somewhere? :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43529""></a>
  <div class="note">
   <strong class="user">Steve Bond</strong>
   <a href="#43529" class="date">24-Jun-2004 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use this function after doing an INSERT ... SELECT to insert multiple rows at once, you get the autonumber ID of the *first* row added by the INSERT.<br />
<br />
e.g. if there are 4 records in table 'init' that have column 'type' = 2<br />
I want to add these 4 records to table 'game'<br />
Table game has an autonumber column 'game_id' that is currently at 32.<br />
<br />
If I do this query:<br />
<br />
INSERT INTO game (type, players, rounds)<br />
SELECT type, players, rounds FROM init<br />
WHERE type = 2<br />
<br />
Then mysql_insert_id() will return 33, not 36.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40239""></a>
  <div class="note">
   <strong class="user">Wayne Theisinger</strong>
   <a href="#40239" class="date">26-Feb-2004 03:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to treylane at example dot com.<br />
<br />
It is very very very important that you put in an "or die" or some other form of error handling.<br />
<br />
Some scripts can fail invisibly and insert invalid data throughout your whole database because of mysql_insert_id<br />
inserting the last successful insertid rather than reporting that the last attempt failed.<br />
<br />
example of an or die statement.<br />
<br />
$result = mysql_query($sql)<br />
or die("Invalid query: " . mysql_error());<br />
$EventID = mysql_insert_id();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39821""></a>
  <div class="note">
   <strong class="user">dtez</strong>
   <a href="#39821" class="date">11-Feb-2004 04:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
any zerofills on your id get chopped off on this function because it returns an int.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37404""></a>
  <div class="note">
   <strong class="user">sly at noiretblanc dot org</strong>
   <a href="#37404" class="date">13-Nov-2003 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the NEXT insert id use the mysql query SHOW TABLE STATUS LIKE 'tablename' and get the field auto_increment...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31521""></a>
  <div class="note">
   <strong class="user">treylane at example dot com</strong>
   <a href="#31521" class="date">24-Apr-2003 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be obvious, but it tripped me up - be careful when using last_insert_id() with persistent connections - running last_insert_id() after a failed update/insert/etc will return the last insert id of the last successful update/insert made by that CONNECTION rather than 0 for the number of rows updated by the previous non-working query, and who knows what the last query run on that connection was.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27720""></a>
  <div class="note">
   <strong class="user">jameszhou2001 at yahoo dot ca</strong>
   <a href="#27720" class="date">16-Dec-2002 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a reminder, mysql_insert_id() should be called after 'mysql_affected_rows()', but BEFORE 'mysql_query("COMMIT")'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14566""></a>
  <div class="note">
   <strong class="user">frumler at the-beach dot no_spam dot net</strong>
   <a href="#14566" class="date">03-Aug-2001 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to use the ID that was generated for one table and insert it into a second table, you can use SQL statements like this: <br />
<br />
INSERT INTO foo (auto,text)<br />
&nbsp;&nbsp;&nbsp; VALUES(NULL,'text');&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # generate ID by inserting NULL<br />
INSERT INTO foo2 (id,text)<br />
&nbsp;&nbsp;&nbsp; VALUES(LAST_INSERT_ID(),'text');&nbsp; # use ID in second table<br />
<br />
...found here:<br />
<a href="http://www.mysql.com/doc/en/Getting_unique_ID.html" rel="nofollow" target="_blank">http://www.mysql.com/doc/en/Getting_unique_ID.html</a><br />
<br />
It works even without inserting the NULL value for some reason ;)<br />
The following is great for monitoring:<br />
&nbsp;&nbsp;&nbsp; $new_id = mysql_insert_id();<br />
&nbsp;&nbsp;&nbsp; print "New id: $new_id\n";<br />
<br />
Hope it helps you all, cheers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="2649""></a>
  <div class="note">
   <strong class="user">vksgeneric at hotmail dot com</strong>
   <a href="#2649" class="date">09-Dec-1999 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can't do an INSERT DELAYED and expect to get anything but zero, for it runs in a separate thread, and mysql_insert_id() is tied to the current thread.<br />
Vlad</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mysql-info.html">mysql_info</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysql-list-dbs.html">mysql_list_dbs</a></div>
 <div class="up"><a href="ref.mysql.html">MySQL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
