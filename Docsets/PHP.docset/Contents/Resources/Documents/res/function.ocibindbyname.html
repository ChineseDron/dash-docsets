<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Alias of oci_bind_by_name</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="oldaliases.oci8.html">OCI8 Obsolete Aliases and Functions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.ocicancel.html">ocicancel</a></div>
 <div class="up"><a href="oldaliases.oci8.html">OCI8 Obsolete Aliases and Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.ocibindbyname" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ocibindbyname</h1>
  <p class="verinfo">(PHP 4, PHP 5, PECL OCI8 &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">ocibindbyname</span> &mdash; <span class="dc-title">Alias of <span class="function"><a href="function.oci-bind-by-name.html" class="function">oci_bind_by_name()</a></span></span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.ocibindbyname-description">
  <h3 class="title">Description</h3>
  <div class="warning"><b class="warning">Warning</b>
<p class="simpara">This alias has been <em class="emphasis">DEPRECATED</em> as of PHP 5.4.0.  Relying
on this alias is highly discouraged.</p></div>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="80523""></a>
  <div class="note">
   <strong class="user">hardipetit at yahoo dot fr</strong>
   <a href="#80523" class="date">20-Jan-2008 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ javier_8 :<br />
<br />
You just have to unset $Value :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">20</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp; </span><span class="default">$ParamName </span><span class="keyword">= </span><span class="string">':FIELD'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$Value </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'FIELD'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$ParamName</span><span class="keyword">, </span><span class="default">$Value</span><span class="keyword">);<br />
&nbsp; unset(</span><span class="default">$Value</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Thanks for pointing this out...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76864""></a>
  <div class="note">
   <strong class="user">javier_8 at NOSPAM dot hotmail dot com</strong>
   <a href="#76864" class="date">02-Aug-2007 02:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Probably a common error using oci_bind_by_name:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">20</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp; </span><span class="default">$ParamName </span><span class="keyword">= </span><span class="string">':FIELD'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$Value </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'FIELD'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$ParamName</span><span class="keyword">, </span><span class="default">$Value</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This is wrong and you'll get the error: <br />
ORA-01461: can bind a LONG value only for insert into a LONG column<br />
It's because oci_bind_by_name apparently works with placeholders, if you assign all the binds to the address of "$value", then all of the values will be the same.<br />
You must do this instead:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">20</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp; </span><span class="default">$ParamName </span><span class="keyword">= </span><span class="string">':FIELD'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$ParamName</span><span class="keyword">, </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'FIELD'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">]);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So oci_bind_by_name links the parameter with the memory space of POST['FIELD1'], POST['FIELD2'], POST['FIELD3']...<br />
Hope it helps (It took some time to figure this out, and I found no help on the net for this issue).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46061""></a>
  <div class="note">
   <strong class="user">md AT opencube DOT org</strong>
   <a href="#46061" class="date">28-Sep-2004 06:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I changed the Method below - all without comments:<br />
<br />
function getBindVars($statement){<br />
&nbsp;&nbsp;&nbsp; $regExp = "/(:[_a-z0-9]+)/i";<br />
&nbsp;&nbsp;&nbsp; $statement = preg_replace('/\'[^\']*?\'/i', "", $statement);<br />
&nbsp;&nbsp;&nbsp; //&nbsp; --- Kommentare raus:<br />
&nbsp;&nbsp;&nbsp; $statement = preg_replace('/--[^(\n)]*?\n/i', "", $statement."\n");<br />
&nbsp;&nbsp;&nbsp; // /* */ Kommentare raus:<br />
&nbsp;&nbsp;&nbsp; $statement = preg_replace('/(\/\*)([^\*]|[^\*](\*)[^\/])+?(\*\/)/i', "", $statement);<br />
&nbsp;&nbsp;&nbsp; $statement = preg_replace('/[^s]el([^t](t)[^s])+?(ts)/i', "", $statement);<br />
&nbsp;&nbsp;&nbsp; $test = preg_match_all($regExp, $statement, $return);<br />
&nbsp;&nbsp;&nbsp; if (isset($return[1]) &amp;&amp; count($return[1]) &gt; 0)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return($return[1]);<br />
&nbsp;&nbsp;&nbsp; else return array();<br />
}<br />
<br />
for this statement:<br />
<br />
$testStatement = " select * from /* Komm \n* :v_comment /asdf */ elements := [asdf]||test where\n elements_id = :v_test;".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "(:value-1) ':text[not]text'||:test123 --test 'diesen:auch_nicht' :v_not\n asdf";<br />
<br />
we get this Array:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; :v_test<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; :value<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; :test123<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45721""></a>
  <div class="note">
   
   <a href="#45721" class="date">16-Sep-2004 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi all,<br />
<br />
I wrote a little function to get all the bind variables of a statement. I use this for a tool that creates a formular to execute different statements the user can select:<br />
<br />
function getBindVars($statement){<br />
&nbsp;&nbsp;&nbsp; $regExp = "/[^'](:[_a-z0-9]+)/i";<br />
&nbsp;&nbsp;&nbsp; $test = preg_match_all($regExp, $statement, $return);<br />
&nbsp;&nbsp;&nbsp; if (isset($return[1]) &amp;&amp; count($return[1]) &gt; 0)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return($return[1]);<br />
&nbsp;&nbsp;&nbsp; else return array();<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45067""></a>
  <div class="note">
   <strong class="user">jriley at gamesville dot com</strong>
   <a href="#45067" class="date">24-Aug-2004 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To select a value from DUAL, use a&nbsp; length of -1.&nbsp; DUAL is defined as a table of VARCHAR2(1).<br />
<br />
ex:<br />
$stmt = OCIParse($conn,&nbsp; "select&nbsp; :VAR from DUAL");<br />
ocibindbyname($stm, ":VAR", &amp;$Var, -1);<br />
<br />
For a query using LIKE,&nbsp; put the percent signs in the variable definition and skip the single quotes you would normally put around the regex in SQL. <br />
<br />
ex:<br />
<br />
$ename = "%{$ename}%"; <br />
$stmt = OCIParse($conn,&nbsp; "select empno from emp where ename like :ename");<br />
OCIBindByName($stmt, ":ename", $ename, 32);<br />
<br />
Adding single quotes around :ename in $query will cause an<br />
"ORA-01036: illegal variable name/number" error.&nbsp; Adding them in $ename will add&nbsp; single quotes to the search string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44398""></a>
  <div class="note">
   <strong class="user">david dot gaia dot kano at dartmouth dot edu</strong>
   <a href="#44398" class="date">04-Aug-2004 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a new twist I just discovered (at least with PHP 4.3.5). While it is true that doing something like this works:<br />
<br />
----------<br />
$dataArray = array("name" =&gt; "david", "sport" =&gt; "rock climbing");<br />
$lengths = array("name" =&gt; 25, "sport" =&gt; 100);<br />
<br />
// imagine the ociparse here<br />
<br />
foreach($dataArray as $col =&gt; $val) {<br />
&nbsp;&nbsp;&nbsp; ocibindbyname($statement, $col, $dataArray[$val], $lengths[$col])<br />
}<br />
<br />
ociexecute($statement);<br />
<br />
$dataArray["name"] = "jane";<br />
$dataArray["sport"] = "kayaking";<br />
<br />
ociexecute($statement);<br />
---------<br />
The following ADDITIONAL lines of code would not:<br />
<br />
--------<br />
<br />
function getDataArray() {<br />
&nbsp;&nbsp;&nbsp; $ret["name"] = "susan";<br />
&nbsp;&nbsp;&nbsp; $ret["sport"] = "walking";<br />
&nbsp;&nbsp;&nbsp; return($ret);<br />
}<br />
<br />
$dataArray = getDataArray();<br />
<br />
ociexecute($statement);<br />
<br />
--------<br />
<br />
As far as I can tell, the last execute would attempt to insert using the same data as the second execute. In other words when reassigning the whole associative array rather than just each member in the array, the binds do not work as expected. I think this is also a problem when the array has never been assigned to anything yet, when you do the binds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40599""></a>
  <div class="note">
   <strong class="user">yepster at hotmail dot com</strong>
   <a href="#40599" class="date">09-Mar-2004 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get ora-01460 you might want to check whether the OCIBindByName was done with -1 on a date field, which on bind time (not execute time) was bound to a php variable with size 0. (e.g.: $var=""; bind var to date with length -1; loop; $var=realdate; execute will give ora-01460 -&gt; unreasonable or unimplemented conversion). Changing the initial $var to a good length, or do the bind with the right size of your date in string format representation instead of -1 will solve it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37792""></a>
  <div class="note">
   <strong class="user">adamb-php at agitate dot org dot uk</strong>
   <a href="#37792" class="date">27-Nov-2003 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use dba_tab_columns or user_tab_columns to get the sizes of the columns into which you are inserting data with OCIBindByName, be aware that a DATE type column is returned as 7 which is the size of it when it is stored in oracle's internal format.&nbsp; The problem arises when you are in fact inserting dates using the TO_DATE function as your bound data could be something like "28/04/1972 12:22.13" which is larger than the width specified in the bind statement and will get you the ever so helpful OCI error message of:<br />
<br />
ORA-01461: can bind a LONG value only for insert into a LONG column</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29916""></a>
  <div class="note">
   <strong class="user">aidan.peiser at shopsmart dot com</strong>
   <a href="#29916" class="date">28-Feb-2003 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have made two function to add and update a table with a CLOB field in it.all you have to do is pass the correct data through the function and it should work...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*the table sql looks like this:<br />
<br />
create table MY_PAGE (pageid varchar2(20),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pagename varchar2(50),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pageurl varchar2(100),&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; edited date,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bodymessage clob);<br />
<br />
create sequence mypage_sequence minvalue 1 nocache;<br />
*/<br />
<br />
</span><span class="keyword">function </span><span class="default">updatePageData</span><span class="keyword">(</span><span class="default">$select</span><span class="keyword">,</span><span class="default">$pagename</span><span class="keyword">,</span><span class="default">$pageurl</span><span class="keyword">,</span><span class="default">$document</span><span class="keyword">) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$conn</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$current_time</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"YmdHis"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"update MY_PAGE set PAGENAME='</span><span class="default">$pagename</span><span class="string">', <br />
PAGEURL='</span><span class="default">$pageurl</span><span class="string">', <br />
EDITED=TO_DATE('</span><span class="default">$current_time</span><span class="string">','YYYYMMDDHH24MISS'), BODYMESSAGE = EMPTY_CLOB() <br />
WHERE PAGEID = '</span><span class="default">$select</span><span class="string">' returning BODYMESSAGE into :bodymessage"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$sql</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">OCIParse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">,</span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lob </span><span class="keyword">= </span><span class="default">OCINewDescriptor</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">,</span><span class="default">OCI_D_LOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">OCIBindByName</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">":bodymessage"</span><span class="keyword">,&amp;</span><span class="default">$lob</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">,</span><span class="default">OCI_B_CLOB</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">OCIExecute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">OCI_DEFAULT</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lob</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="default">$document</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lob</span><span class="keyword">-&gt;</span><span class="default">free</span><span class="keyword">(); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">OCIFreeStatement</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">OCICommit</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
function </span><span class="default">insertPageData</span><span class="keyword">(</span><span class="default">$pagename</span><span class="keyword">,</span><span class="default">$pageurl</span><span class="keyword">,</span><span class="default">$document</span><span class="keyword">) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$conn</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$current_time</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"YmdHis"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">"insert into MY_PAGE (PAGEID, PAGENAME, PAGEURL, EDITED, BODYMESSAGE) <br />
values (mypage_sequence.nextval,<br />
'</span><span class="default">$pagename</span><span class="string">',<br />
'</span><span class="default">$pageurl</span><span class="string">',<br />
TO_DATE('</span><span class="default">$current_time</span><span class="string">','YYYYMMDDHH24MISS'),<br />
empty_clob()) returning BODYMESSAGE into :bodymessage"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">OCIParse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clob1 </span><span class="keyword">= </span><span class="default">OCINewDescriptor</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">OCI_D_LOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">OCIBindByName </span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":bodymessage"</span><span class="keyword">, &amp;</span><span class="default">$clob1</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_CLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">OCIExecute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">OCI_DEFAULT</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clob1</span><span class="keyword">-&gt;</span><span class="default">save </span><span class="keyword">(</span><span class="default">$document</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">OCICommit</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"data inserted"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"unable to insert data"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25345""></a>
  <div class="note">
   <strong class="user">alexander dot zimmer at gmx dot at</strong>
   <a href="#25345" class="date">20-Sep-2002 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Addition to the posting of cthrall@rocketmail.com (from 06-Sep-2000):<br />
<br />
It's true, you can't call OCIBindByName in a loop and bind to an associative array like this:<br />
<br />
foreach ($array as $key =&gt; $val)<br />
{<br />
OCIBindByName($state, $key, $val, -1);<br />
}<br />
<br />
BUT: You can do it this way:<br />
<br />
foreach ($array as $key =&gt; $val)<br />
{<br />
OCIBindByName($state, $key, $array[$key], -1);<br />
}<br />
<br />
Background: the command OCIBindByName BINDS a PHP variable to a parameter, not just its current value. Thus, it is up to you to make sure that the variable has the correct value at the very time when OCIExecute is called, not just when OCIBindByName was called! The PHP variable gets evaluated at the point of OCIExecute and not earlier.<br />
<br />
This is somewhat more legible than cthrall's solution (but it surely works, too).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24742""></a>
  <div class="note">
   <strong class="user">chris_se at gmx dot net</strong>
   <a href="#24742" class="date">27-Aug-2002 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be warned if you use this function with a fixed-width character field:<br />
<br />
If you have a table with the following fields:<br />
<br />
create table personal_data (<br />
name&nbsp; &nbsp; &nbsp; char(20) not null,<br />
street&nbsp; &nbsp; &nbsp; char(50),<br />
city&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; char(50),<br />
primary key (name) using index<br />
);<br />
<br />
Now, if you want to update a column without OCIBindByName, you may write<br />
<br />
$stmt = OCIParse ($conn, "update personal_data set street = '$street' where name = '$name'");<br />
$res = OCIExecute ($stmt);<br />
OCIFreeStatement ($stmt);<br />
<br />
If you want to use OCIBindByName, the following will _only_ work, if the contents of $name has always the same length as field:<br />
<br />
$stmt = OCIParse ($conn, "update personal_data set street = :STREET where name = :NAME");<br />
OCIBindByName ($stmt, ":STREET", &amp;$street, 50);<br />
OCIBindByName ($stmt, ":NAME", &amp;$name, 20);<br />
$res = OCIExecute ($stmt);<br />
OCIFreeStatement ($stmt);<br />
<br />
(this will not produce any error, it's simply that the where-clause will never get true if the contents of $name is not as long as the field itself)<br />
<br />
To make this work, you have to trim the field:<br />
<br />
$stmt = OCIParse ($conn, "update personal_data set street = :STREET where trim(name) = :NAME");<br />
OCIBindByName ($stmt, ":STREET", &amp;$street, 50);<br />
OCIBindByName ($stmt, ":NAME", &amp;$name, 20);<br />
$res = OCIExecute ($stmt);<br />
OCIFreeStatement ($stmt);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24397""></a>
  <div class="note">
   <strong class="user">max at pict dot lviv dot ua</strong>
   <a href="#24397" class="date">15-Aug-2002 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those, who may wish to determine column size before execution of query, I suggest to use DBA_TAB_COLUMNS view. I did it with this function:<br />
<br />
function db_column_size($table,$column) {<br />
&nbsp; $connection = db_connect();<br />
&nbsp; $query = "SELECT DATA_LENGTH FROM DBA_TAB_COLUMNS ".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "WHERE TABLE_NAME='".strtoupper($table)."' ".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "AND COLUMN_NAME='".strtoupper($column)."'";<br />
<br />
&nbsp; $statement = OCIParse($connection, $query);<br />
&nbsp; OCIExecute($statement);<br />
<br />
&nbsp; ocifetchinto($statement,$row,OCI_ASSOC+OCI_RETURN_NULLS);<br />
&nbsp; return $row["DATA_LENGTH"];<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12714""></a>
  <div class="note">
   <strong class="user">k_a_h_l_i_l at yahoo dot com</strong>
   <a href="#12714" class="date">01-May-2001 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to bind an nvarchar field:<br />
<br />
<span class="default">&lt;?php<br />
$sql </span><span class="keyword">= </span><span class="string">"insert into my_table values (translate(:varname using nchar_cs))"</span><span class="keyword">;<br />
<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">OCIParse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$sql</span><span class="keyword">);<br />
</span><span class="default">OCIBindByName</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">":varname"</span><span class="keyword">, &amp;</span><span class="default">$value</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$err </span><span class="keyword">= </span><span class="default">OCIError</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
if(!</span><span class="default">$err</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">OCIExecute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$err </span><span class="keyword">= </span><span class="default">OCIError</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
}<br />
</span><span class="default">OCIFreeStatement</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="11373""></a>
  <div class="note">
   <strong class="user">andrea at neutrini dot it</strong>
   <a href="#11373" class="date">18-Feb-2001 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script print the real name of a BFILE saved. It use OCIBindByName ...<br />
<br />
<span class="default">&lt;?php<br />
$c1</span><span class="keyword">=</span><span class="default">OCILogon </span><span class="keyword">(</span><span class="string">"username"</span><span class="keyword">,</span><span class="string">"password"</span><span class="keyword">,</span><span class="string">"database"</span><span class="keyword">);<br />
</span><span class="default">$store_file </span><span class="keyword">= </span><span class="string">"NULL"</span><span class="keyword">;<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"DECLARE Lob_loc&nbsp; BFILE; DIRS&nbsp;&nbsp; VARCHAR2(30); FILS&nbsp; VARCHAR2(40); BEGIN SELECT B_FILE INTO Lob_loc FROM TABLE_WHIT_B_FILE WHERE KEY=2 ; DBMS_LOB.FILEGETNAME(Lob_loc,DIRS,FILS); :NOME:=FILS; END;"<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">ociparse</span><span class="keyword">(</span><span class="default">$c1</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">OCIBindByName</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">":NOME"</span><span class="keyword">,&amp;</span><span class="default">$store_file</span><span class="keyword">,</span><span class="default">50</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
if(!</span><span class="default">ociexecute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">)) echo </span><span class="string">"Error"</span><span class="keyword">;<br />
<br />
echo&nbsp; </span><span class="default">$store_file </span><span class="keyword">;<br />
<br />
</span><span class="default">OCIFreeStatement</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
</span><span class="default">OCILogOff</span><span class="keyword">(</span><span class="default">$c1</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10168""></a>
  <div class="note">
   <strong class="user">gmarcos at netspace dot com dot mx</strong>
   <a href="#10168" class="date">16-Dec-2000 11:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to load an image from oracle:<br />
&lt;?<br />
Header("Content-Type: image/png");<br />
$conn = OCILogon("user","passwd","bd");<br />
<br />
<br />
$stmt = OCIParse($conn,"select picture<br />
from table_with_picture ");<br />
<br />
$picture = OCINewDescriptor($stmt,OCI_D_LOB);<br />
<br />
OCIDefineByName($stmt,"PICTURE",&amp;$picture);<br />
OCIExecute($stmt);<br />
while(OCIFetch($stmt)){<br />
<br />
}<br />
<br />
OCIFreeStatement($stmt);<br />
$fp = fopen ("/directory/picture.tif","wb");<br />
fwrite($fp,$picture);<br />
fclose($fp);<br />
passthru("/usr/bin/X11/convert /directory/picture.tif png:-");<br />
<br />
<br />
?&gt;<br />
<br />
This work for blobs.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9395""></a>
  <div class="note">
   <strong class="user">Maxwell_Smart at ThePentagon dot com</strong>
   <a href="#9395" class="date">31-Oct-2000 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You cannot use a reserved word as a bind variable.Otherwise you'll get "OCIStmtExecute: ORA-01745: invalid host/bind variable name". So, while "RETURNING ROWID INTO :RowId" may be nice, it'll cause an error, as will "RETURNING ROWID INTO :SELECT", etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8335""></a>
  <div class="note">
   <strong class="user">cthrall at rocketmail dot com</strong>
   <a href="#8335" class="date">06-Sep-2000 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So, if you're calling OCIBindByName in a loop and binding to an associative array like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">while (list(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">OCIBindByName</span><span class="keyword">(</span><span class="default">$state</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'VALUE'</span><span class="keyword">], </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'LENGTH'</span><span class="keyword">]);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
it won't work.&nbsp; My WAG is that OCI gets confused when you bind a bunch of values to what appears to be the same variable, then call OCIExecute.<br />
<br />
Workaround is create a new array, and copy values into it:<br />
<span class="default">&lt;?php<br />
$value </span><span class="keyword">= array();<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
while (list(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'VALUE'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">OCIBindByName</span><span class="keyword">(</span><span class="default">$state</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'LENGTH'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3427""></a>
  <div class="note">
   <strong class="user">benjy at nectaris dot com</strong>
   <a href="#3427" class="date">27-Jan-2000 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that when binding a variable to a <br />
VARCHAR2 column, the length parameter should count an extra character (the terminating null.)<br />
<br />
For example, when binding to a column of type VARCHAR2(500), the length parameter should be 501. Otherwise when a string of length 500 is supplied as a bind value an error ("ORA-01480: trailing null missing from STR bind value") will be thrown.<br />
<br />
According to the OCI documentation this happens because the length parameter is used by OCI as a search limit for the terminating null in the underlying C/C++ character string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3421""></a>
  <div class="note">
   <strong class="user">k_a_h_l_i_l at yahoo dot com</strong>
   <a href="#3421" class="date">27-Jan-2000 02:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ocibindbyname with VARCHAR fields doesn't handle length dynamically. I had to define my variable with the correct length (and garbage data) before calling bindbyname. <br />
&nbsp;&nbsp;&nbsp; $myvar = "000000";<br />
&nbsp;&nbsp;&nbsp; OCIBindByName($stmt,":myvar",&amp;$myvar, -1);<br />
<br />
without the first initialization line ($myvar = "000000"), the statement will give a NULL length error when executed. This error happens even if the variable's length is provided as a parameter. So <br />
<br />
&nbsp;&nbsp;&nbsp; OCIBindByName($stmt,":myvar",&amp;$myvar, 6);<br />
<br />
won't work either unless the initialization statement is executed first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1425""></a>
  <div class="note">
   <strong class="user">philippe at styx dot net</strong>
   <a href="#1425" class="date">24-Aug-1999 11:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: If the table field is VARCHAR2(1),<br />
--&gt; ocibindbyname($stm, ":VAR", &amp;$Var, 1);<br />
won't work. You have to put instead:<br />
--&gt; ocibindbyname($stm, ":VAR", &amp;$Var, -1);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="oldaliases.oci8.html">OCI8 Obsolete Aliases and Functions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.ocicancel.html">ocicancel</a></div>
 <div class="up"><a href="oldaliases.oci8.html">OCI8 Obsolete Aliases and Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
