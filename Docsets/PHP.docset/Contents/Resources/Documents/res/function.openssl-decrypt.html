<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Decrypts data</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.openssl-csr-sign.html">openssl_csr_sign</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.openssl-dh-compute-key.html">openssl_dh_compute_key</a></div>
 <div class="up"><a href="ref.openssl.html">OpenSSL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.openssl-decrypt" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">openssl_decrypt</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.3.0)</p><p class="refpurpose"><span class="refname">openssl_decrypt</span> &mdash; <span class="dc-title">Decrypts data</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.openssl-decrypt-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>openssl_decrypt</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$data</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$method</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$password</tt></span>
   [, <span class="methodparam"><span class="type">bool</span> <tt class="parameter">$raw_input</tt><span class="initializer"> = false</span></span>
   [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$iv</tt><span class="initializer"> = &quot;&quot;</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   Takes a raw or base64 encoded string and decrypts it using a given method and key.
  </p>

  <div class="warning"><b class="warning">Warning</b><p class="simpara">This function is
currently not documented; only its argument list is available.
</p></div>

 </div>


 <div class="refsect1 parameters" id="refsect1-function.openssl-decrypt-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">data</tt></i></span>
     <dd>

      <p class="para">
       The data.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">method</tt></i></span>
     <dd>

      <p class="para">
       The cipher method.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">password</tt></i></span>
     <dd>

      <p class="para">
       The password.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">raw_input</tt></i></span>
     <dd>

      <p class="para">
       Setting to <b><tt>TRUE</tt></b> will take a raw encoded string,
       otherwise a base64 string is assumed for the
       <i><tt class="parameter">data</tt></i> parameter.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">iv</tt></i></span>
     <dd>

      <p class="para">
       A non-NULL Initialization Vector. 
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.openssl-decrypt-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   The decrypted string on success or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.openssl-decrypt-errors">
  <h3 class="title">Errors/Exceptions</h3>
  <p class="para">
   Emits an <b><tt>E_WARNING</tt></b> level error if an unknown cipher algorithm
   is passed via the <i><tt class="parameter">method</tt></i> parameter.
  </p>
  <p class="para">
   Emits an <b><tt>E_WARNING</tt></b> level error if an empty value is passed
   in via the <i><tt class="parameter">iv</tt></i> parameter.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.openssl-decrypt-changelog">
  <h3 class="title">Changelog</h3>
  <table class="doctable informaltable">
   
    <thead valign="middle">
     <tr valign="middle">
      <th>Version</th>
      <th>Description</th>
     </tr>

    </thead>

    <tbody valign="middle" class="tbody">
     <tr valign="middle">
      <td align="left">5.3.3</td>
      <td align="left">
       The <i><tt class="parameter">iv</tt></i> parameter was added.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.openssl-decrypt-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.openssl-encrypt.html" class="function" rel="rdfs-seeAlso">openssl_encrypt()</a> - Encrypts data</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107210""></a>
  <div class="note">
   <strong class="user">nbari at dalmp dot com</strong>
   <a href="#107210" class="date">15-Jan-2012 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are cases where you need to send data in a secure way within an 'un-secure' connection, a&nbsp; typically scenario of this, is a site with out SSL (no https).<br />
<br />
For this cases you can use the GibberishAES javascript library, this library will encrypt your data before it is submitted using CBC AES encryption mode, and it is fully compatible with a standar like OpenSSL.<br />
<br />
Example:<br />
<br />
When displaying a form, you can set a hidden field containing a token, the one is stored on the server via sessions and is going to be used as the 'password' for encrypting the data on the user side, in help with the GibberishAES library.<br />
<br />
In Javascript (user side): <br />
// GibberishAES.enc(string, password)<br />
// Defaults to 256 bit encryption<br />
GibberishAES.enc("Made with Gibberish\n", "password");<br />
// Outputs: "U2FsdGVkX1+21O5RB08bavFTq7Yq/gChmXrO3f00tvJaT55A5pPvqw0zFVnHSW1o"<br />
<br />
Later when the user submits the data, you will need to decrypt the data, for that you could use the class below and use it like this:<br />
<br />
<span class="default">&lt;?php<br />
sqAES</span><span class="keyword">::</span><span class="default">decrypt</span><span class="keyword">(</span><span class="string">'password'</span><span class="keyword">, </span><span class="string">'U2FsdGVkX1+21O5RB08bavFTq7Yq/gChmXrO3f00tvJaT55A5pPvqw0zFVnHSW1o'</span><span class="keyword">); <br />
</span><span class="default">?&gt;<br />
</span><br />
That will return&nbsp; the same result, that openssl would return from this command line :<br />
<br />
echo "U2FsdGVkX1+21O5RB08bavFTq7Yq/gChmXrO3f00tvJaT55A5pPvqw0zFVnHSW1o" | openssl enc -d -aes-256-cbc -a -k password<br />
<br />
This class currently only encrypts/decrypts AES256 but can be easily modified to feed your needs, right now it is fully compatible withe the&nbsp; GibberishAES library, so you could decrypt all your users data and also send encrypted data back to the user in a secure way, all this thanks to the openssl-decrypt/openssl-encrypt functions.<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">class </span><span class="default">sqAES </span><span class="keyword">{<br />
<br />
&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; * decrypt AES 256<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * @param string $password<br />
&nbsp;&nbsp; * @param data $edata<br />
&nbsp;&nbsp; * @return dencrypted data<br />
&nbsp;&nbsp; */<br />
&nbsp; </span><span class="keyword">public static function </span><span class="default">decrypt</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$edata</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$edata</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ct </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * From https://github.com/mdp/gibberish-aes<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * Number of rounds depends on the size of the AES in use<br />
&nbsp;&nbsp; &nbsp; * 3 rounds for 256<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; 2 rounds for the key, 1 for the IV<br />
&nbsp;&nbsp; &nbsp; * 2 rounds for 128<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; 1 round for the key, 1 round for the IV<br />
&nbsp;&nbsp; &nbsp; * 3 rounds for 192 since it's not evenly divided by 128 bits<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rounds </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data00 </span><span class="keyword">= </span><span class="default">$password</span><span class="keyword">.</span><span class="default">$salt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$md5_hash </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$md5_hash</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$data00</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$md5_hash</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$rounds</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$md5_hash</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$md5_hash</span><span class="keyword">[</span><span class="default">$i </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">].</span><span class="default">$data00</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">$md5_hash</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$iv&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">openssl_decrypt</span><span class="keyword">(</span><span class="default">$ct</span><span class="keyword">, </span><span class="string">'aes-256-cbc'</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; * crypt AES 256<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * @param string $password<br />
&nbsp;&nbsp; * @param data $data<br />
&nbsp;&nbsp; * @return base64 encrypted data<br />
&nbsp;&nbsp; */<br />
&nbsp; </span><span class="keyword">public static function </span><span class="default">crypt</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set a random salt<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">openssl_random_pseudo_bytes</span><span class="keyword">(</span><span class="default">8</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$salted </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dx </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Salt the key(32) and iv(16) = 48<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salted</span><span class="keyword">) &lt; </span><span class="default">48</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dx </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$dx</span><span class="keyword">.</span><span class="default">$password</span><span class="keyword">.</span><span class="default">$salt</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$salted </span><span class="keyword">.= </span><span class="default">$dx</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$salted</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$iv&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$salted</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encrypted_data </span><span class="keyword">= </span><span class="default">openssl_encrypt</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">'aes-256-cbc'</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'Salted__' </span><span class="keyword">. </span><span class="default">$salt </span><span class="keyword">. </span><span class="default">$encrypted_data</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.openssl-csr-sign.html">openssl_csr_sign</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.openssl-dh-compute-key.html">openssl_dh_compute_key</a></div>
 <div class="up"><a href="ref.openssl.html">OpenSSL Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
