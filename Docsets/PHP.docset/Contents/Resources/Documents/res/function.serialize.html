<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Generates a storable representation of a value</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.print-r.html">print_r</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.settype.html">settype</a></div>
 <div class="up"><a href="ref.var.html">Variable handling Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.serialize" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">serialize</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">serialize</span> &mdash; <span class="dc-title">Generates a storable representation of a value</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.serialize-description">
  <h3 class="title">Description</h3>
   <div class="methodsynopsis dc-description">
    <span class="type">string</span> <span class="methodname"><b>serialize</b></span>
     ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <tt class="parameter">$value</tt></span>
    )</div>

  <p class="para rdfs-comment">
   Generates a storable representation of a value
  </p>
  <p class="para">
   This is useful for storing or passing PHP values around without
   losing their type and structure.
  </p>
  <p class="para">
   To make the serialized string into a PHP value again, use
   <span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span>.  
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.serialize-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">value</tt></i></span>
     <dd>

      <p class="para">
       The value to be serialized. <span class="function"><b>serialize()</b></span>
       handles all types, except the <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>-type.
       You can even <span class="function"><b>serialize()</b></span> arrays that contain
       references to itself. Circular references inside the array/object you 
       are serializing will also be stored. Any other 
       reference will be lost.
      </p>
      <p class="para">
       When serializing objects, PHP will attempt to call the member function
       <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> prior to serialization. 
       This is to allow the object to do any last minute clean-up, etc. prior 
       to being serialized. Likewise, when the object is restored using 
       <span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> the <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> member function is called.
      </p>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
       Object&#039;s private members have the class name prepended to the member
       name; protected members have a &#039;*&#039; prepended to the member name.
       These prepended values have null bytes on either side.
       </p>
      </p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.serialize-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a string containing a byte-stream representation of 
   <i><tt class="parameter">value</tt></i> that can be stored anywhere.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.serialize-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-4793">
    <p><b>Example #1 <span class="function"><b>serialize()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;$session_data&nbsp;contains&nbsp;a&nbsp;multi-dimensional&nbsp;array&nbsp;with&nbsp;session<br />//&nbsp;information&nbsp;for&nbsp;the&nbsp;current&nbsp;user.&nbsp;&nbsp;We&nbsp;use&nbsp;serialize()&nbsp;to&nbsp;store<br />//&nbsp;it&nbsp;in&nbsp;a&nbsp;database&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;request.<br /><br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">odbc_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"webdb"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"php"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"chicken"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">odbc_prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"UPDATE&nbsp;sessions&nbsp;SET&nbsp;data&nbsp;=&nbsp;?&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sqldata&nbsp;</span><span style="color: #007700">=&nbsp;array&nbsp;(</span><span style="color: #0000BB">serialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$session_data</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]);<br />if&nbsp;(!</span><span style="color: #0000BB">odbc_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sqldata</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">odbc_prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;sessions&nbsp;(id,&nbsp;data)&nbsp;VALUES(?,&nbsp;?)"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">odbc_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sqldata</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Something&nbsp;went&nbsp;wrong..&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.serialize-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">4.0.7</td>
       <td align="left">
        The object serialization process was fixed.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.serialize-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Note that many built-in PHP objects cannot be serialized. However, those with 
    this ability either implement the <span class="interfacename"><a href="class.serializable.html" class="interfacename">Serializable</a></span> interface or the 
    magic <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> and
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> methods. If an 
    internal class does not fulfill any of those requirements, it cannot reliably be 
    serialized.
   </p>
   <p class="para">
    There are some historical exceptions to the above rule, where some internal objects 
    could be serialized without implementing the interface or exposing the methods. Notably, 
    the <a href="class.arrayobject.html" class="classname">ArrayObject</a> prior to PHP 5.2.0.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.serialize-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.unserialize.html" class="function" rel="rdfs-seeAlso">unserialize()</a> - Creates a PHP value from a stored representation</span></li>
    <li class="member"><a href="language.oop5.serialization.html" class="link">Serializing Objects</a></li>
    <li class="member"><a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a></li>
    <li class="member"><a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103761""></a>
  <div class="note">
   <strong class="user">tickthokk at gmail dot com</strong>
   <a href="#103761" class="date">02-May-2011 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On the topic of serialization, the comments seemed split on which was faster: serialize() or json_encode().<br />
<br />
I used an array with a serialized strlen() of 1604.<br />
<br />
At 5,000 itterations, serialize won over (by .0001 seconds).&nbsp; At 50,000 itterations, serialize still won.&nbsp; I then tested it with the suggested gzcompress() and base64_encode() combo.&nbsp; Both times json_encode won; first by .25 seconds, and second (at 50k) 2.85 seconds.<br />
<br />
However, that's only half the battle.&nbsp; Please take into consideration the difference between unserialize() and json_decode().&nbsp; In every instance, unserialize() was always faster.&nbsp; In the 5k test, it was faster by .22 seconds (.13 with compression).&nbsp; In the 50k test, it was faster by 2.4 seconds (1.8 with compression).<br />
<br />
Even if serialize() has it's downfalls, unserialize() balances that out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103717""></a>
  <div class="note">
   <strong class="user">jmanuel at ciges dot net</strong>
   <a href="#103717" class="date">29-Apr-2011 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello, <br />
<br />
I wanted to serialize a complex array (an array of arrays with a few levels, it's a configuration file) and I think I have found a bug in the 'serialize' function. I work with PHP 5.2.5 (from SLES 10).<br />
<br />
I had as result always the string "N;". This value corresponds to NULL value.<br />
<br />
So I did my own 'serialize' function. Here it is in case you had the same problem.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Function which returns serialization string for a scalar value<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">ser_value</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))&nbsp; &nbsp; {&nbsp; return </span><span class="string">"N"</span><span class="keyword">;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))&nbsp; &nbsp; {&nbsp; return </span><span class="default">$value </span><span class="keyword">? </span><span class="string">"b:0"</span><span class="keyword">:</span><span class="string">"b:1"</span><span class="keyword">;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_integer</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))&nbsp; &nbsp; {&nbsp; return </span><span class="string">"i:"</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; {&nbsp; return </span><span class="string">"s:"</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">":\""</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Recursive function which returns serialization string for an array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">serialize_data</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$n </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">"a:"</span><span class="keyword">.</span><span class="default">$n</span><span class="keyword">.</span><span class="string">":{"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">ser_value</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) ? </span><span class="default">serialize_data</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) : </span><span class="default">ser_value</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="string">"}"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Greetings from Spain<br />
<br />
Jos̩ M. Ciges</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103446""></a>
  <div class="note">
   <strong class="user">kevin at tra dot as</strong>
   <a href="#103446" class="date">13-Apr-2011 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to base64_encode(), save space in the DB by compressing the serialized object.&nbsp; As follows: <br />
<br />
<span class="default">&lt;?php<br />
mySerialize</span><span class="keyword">( </span><span class="default">$obj </span><span class="keyword">) { <br />
&nbsp;&nbsp; return </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)));<br />
}<br />
<br />
</span><span class="default">myUnserialize</span><span class="keyword">( </span><span class="default">$txt </span><span class="keyword">) {<br />
&nbsp;&nbsp; return </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">gzuncompress</span><span class="keyword">(</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">)));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102241""></a>
  <div class="note">
   <strong class="user">pgl at yoyo dot org</strong>
   <a href="#102241" class="date">03-Feb-2011 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another suggestion for coping with binary data in serialize()d variables is just to base64_encode() those fields before serializing. It will increase the size of the variable, but not by too much.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101926""></a>
  <div class="note">
   <strong class="user">reiners dot joh at googlemail dot com</strong>
   <a href="#101926" class="date">18-Jan-2011 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just realized a certain behaviour when I serialize objects, store them in $_SESSION and unserialize them after a reload.<br />
More precisely, static fields of the object will be available when serializing/unserializing but NOT when you do a page reload.<br />
<br />
This is because the static fields are on class level, and certainly, the classes will be completly initialized again when you do a page reload.<br />
Actually that behaviour is correct, but i spent long long time to debug a script before i actually realized this.<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
echo </span><span class="string">"&lt;pre&gt;Press F5<br />
<br />
"</span><span class="keyword">;<br />
class </span><span class="default">MyClass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//static variable<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">static private </span><span class="default">$foo_static</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//normal variable<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; static function </span><span class="default">getString_static</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$foo_static</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; static function </span><span class="default">setString_static</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$foo_static </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setString</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'myObj'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myObj </span><span class="keyword">= new </span><span class="default">MyClass</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">setString_static</span><span class="keyword">(</span><span class="string">"Will NOT be stored!!!"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">setString</span><span class="keyword">(</span><span class="string">"Will be stored"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Print content: \n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Normal Var: ' </span><span class="keyword">. </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">getString</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Static Var: ' </span><span class="keyword">. </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">getString_static</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\t\n\nNow serialize and unserialize object\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myObj </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"And print again..\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Normal Var: ' </span><span class="keyword">. </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">getString</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Static Var: ' </span><span class="keyword">. </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">getString_static</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Store object in session<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'myObj'</span><span class="keyword">] = </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">);<br />
<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//if myobj was stored<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myObj_loaded </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'myObj'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Print content when serialized, stored in session and unserialized after a relaod:\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Normal Var: ' </span><span class="keyword">. </span><span class="default">$myObj_loaded</span><span class="keyword">-&gt;</span><span class="default">getString</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Static Var: ' </span><span class="keyword">. </span><span class="default">$myObj_loaded</span><span class="keyword">-&gt;</span><span class="default">getString_static</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'myObj'</span><span class="keyword">]);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span>&lt;/pre&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100602""></a>
  <div class="note">
   <strong class="user">jcastromail at yahoo dot es</strong>
   <a href="#100602" class="date">26-Oct-2010 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i did a benchmark between serialization and json_serialize and i found that serialize is 12% fast than json_encode (no tag, php 5.2.12). <br />
<br />
I used this array as a example of serialization (10'000 iterations)<br />
<span class="default">&lt;?php<br />
$arr</span><span class="keyword">=array(<br />
&nbsp;&nbsp; </span><span class="string">"in"</span><span class="keyword">=&gt;array(</span><span class="string">"in1"</span><span class="keyword">=&gt;</span><span class="string">"valin1"</span><span class="keyword">,</span><span class="string">"in2"</span><span class="keyword">=&gt;</span><span class="default">506</span><span class="keyword">,</span><span class="string">"in33"</span><span class="keyword">=&gt;</span><span class="string">"valin3"</span><span class="keyword">)<br />
&nbsp;&nbsp; ,</span><span class="string">"out"</span><span class="keyword">=&gt;array(</span><span class="string">"in1"</span><span class="keyword">=&gt;</span><span class="string">"valin1"</span><span class="keyword">,</span><span class="string">"in2"</span><span class="keyword">=&gt;</span><span class="string">"valin2"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span>and unserialize is 70% fast than json_decode.<br />
<br />
in conclusion:<br />
a) as expected, serialize is the fast way to.. ahem, serialize objects and array (at least for some complex cases).<br />
b) but json produce a smaller string (and is more standard).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100455""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100455" class="date">16-Oct-2010 11:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you just want a way to store array as string, you should use "json_encode" and "json_decode" because:<br />
<br />
1. json_encode + json_decode is much faster than serialize + unserialize<br />
<br />
2. json format is readable<br />
<br />
3. json format is smaller than serialized result</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98139""></a>
  <div class="note">
   <strong class="user">regality at gmail dot com</strong>
   <a href="#98139" class="date">27-May-2010 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
serialize can be a handy tool for protecting against page expirations if you are using POST's. <br />
<br />
In my code I call the following function whenever I detect that the page has expired.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">savePost</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Save this in the login form<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'savePost'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;input type='hidden' name='savePost' value=\"</span><span class="keyword">{</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">savePost</span><span class="keyword">]}</span><span class="string">\"&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$savePost </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;input type='hidden' name='savePost' value=\"</span><span class="default">$savePost</span><span class="string">\"&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
and when I load each page I call the function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">restorePost</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">savePost</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_POST </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">htmlspecialchars_decode</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">savePost</span><span class="keyword">])));<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
That way if a user takes a long time doing something, they can re-authenticate and have their work restored.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96504""></a>
  <div class="note">
   <strong class="user">travis at travishegner dot com</strong>
   <a href="#96504" class="date">02-Mar-2010 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If serializing objects to be stored into a postgresql database, the 'null byte' injected for private and protected members throws a wrench into the system. Even pg_escape_bytea() on the value, and storing the value as a binary type fails under certain circumstances.<br />
<br />
For a dirty work around:<br />
<span class="default">&lt;?php<br />
<br />
$serialized_object </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$my_object</span><span class="keyword">);<br />
</span><span class="default">$safe_object </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\0"</span><span class="keyword">, </span><span class="string">"~~NULL_BYTE~~"</span><span class="keyword">, </span><span class="default">$serialized_object</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
this allows you to store the object in a readable text format as well. When reading the data back:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$serialized_object </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"~~NULL_BYTE~~"</span><span class="keyword">, </span><span class="string">"\0"</span><span class="keyword">, </span><span class="default">$safe_object</span><span class="keyword">);<br />
</span><span class="default">$my_object </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serialized_object</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The only gotcha's with this method is if your object member names or values may somehow contain the odd "~~NULL_BYTE~~" string. If that is the case, then str_replace() to a string that you are guaranteed not to have any where else in the string that serialize() returns.<br />
Also remember to define the class before calling unserialize().<br />
<br />
If you are storing session data into a postgresql database, then this workaround is an absolute must, because the $data passed to the session's write function is already serialized.<br />
<br />
Thanks,<br />
Travis Hegner</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96118""></a>
  <div class="note">
   <strong class="user">darlan at rdacom.com.br</strong>
   <a href="#96118" class="date">09-Feb-2010 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've made a simple code to serialize small arrays.. may be useful if someone needs to read the data in JS or store the array in database in a simple format. base64_encode/decode functions in JS can be found over the web...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">array2str</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">,</span><span class="default">$level</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= array();<br />
&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nkey </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nvalue </span><span class="keyword">= </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)?</span><span class="string">'$'</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">array2str</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) : (string)</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str</span><span class="keyword">[] = </span><span class="default">$nkey</span><span class="keyword">.</span><span class="string">'&amp;'</span><span class="keyword">.</span><span class="default">$nvalue</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//printf("Encoded %s,%s to %s,%s\n",$key,$value,$nkey,$nvalue);<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
}<br />
function </span><span class="default">str2array</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$rest </span><span class="keyword">= array();<br />
&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">'|'</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; } else </span><span class="default">$array</span><span class="keyword">=array(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$token</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$key</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">,</span><span class="default">$token</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nkey</span><span class="keyword">=</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nvalue </span><span class="keyword">= (&nbsp; &nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) != </span><span class="string">'$' </span><span class="keyword">? </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) : </span><span class="default">str2array</span><span class="keyword">(</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))) );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rest</span><span class="keyword">[</span><span class="default">$nkey</span><span class="keyword">] = </span><span class="default">$nvalue</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//printf("Decoded %s,%s to %s,%s\n",$key,$value,$nkey,$nvalue);<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp; return </span><span class="default">$rest</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
[]'s</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95781""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#95781" class="date">21-Jan-2010 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
you should really use mysql_real_escape_string() for escaping (serialized) strings that got thrown into a query (visit php.net/mysql_real_escape_string for further information)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93571""></a>
  <div class="note">
   <strong class="user">Alastair Lynn</strong>
   <a href="#93571" class="date">16-Sep-2009 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may be obvious, but for the record: as of the time of writing (PHP 5.3.0) you can't serialise a Closure object.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93313""></a>
  <div class="note">
   <strong class="user">donotmail at me dot com</strong>
   <a href="#93313" class="date">02-Sep-2009 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NOTE: php's serialize does not properly serialize arrays with which a slice of the array is a reference to the array itself, observe:<br />
<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= array();<br />
</span><span class="default">$a</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"blah"</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] =&amp; </span><span class="default">$a</span><span class="keyword">;<br />
<br />
</span><span class="default">$a</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"pleh"</span><span class="keyword">; </span><span class="comment">// $a[0] === "pleh"<br />
<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">));<br />
<br />
</span><span class="comment">// $b[0] == "pleh", $b[1][0] == "pleh"<br />
<br />
</span><span class="default">$b</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"blah"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
now $b[1][0] == "blah", but $b[0] == "pleh"<br />
after serializing and unserializing, slice 1 is no longer a reference to the array itself... I have found no way around this problem... even manually modifying the serialized string from <br />
'a:2:{i:0;s:4:"pleh";i:1;a:2:{i:0;s:4:"pleh";i:1;R:3;}}'<br />
to<br />
'a:2:{i:0;s:4:"pleh";i:1;R:1;}'<br />
<br />
to force the second slice to be a reference to the first element of the serialization (the array itself), it seemed to work at first glance, but then unreferences it when you alter it again, observe:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $testser </span><span class="keyword">= </span><span class="string">'a:2:{i:0;s:4:"pleh";i:1;R:1;}'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$testser</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"\n-----------------------\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"blah"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;<br />
</span><span class="default">?&gt;<br />
</span><br />
outputs:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; pleh<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;*RECURSION*<br />
)<br />
<br />
-----------------------<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; pleh<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; blah<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; pleh<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;*RECURSION*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92284""></a>
  <div class="note">
   <strong class="user">Alessandro Segala</strong>
   <a href="#92284" class="date">17-Jul-2009 08:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to serialize an array to store it inside a database.<br />
I was looking for a fast, simple way to do serialization, and I came out with 2 options: serialize() or json_encode().<br />
<br />
I ran some benchmarks to see which is the faster, and, surprisingly, I found that serialize() is always between 46% and 96% SLOWER than json_encode().<br />
So, if you don't need to serialize objects and have the json extension available, consider using it instead of serialize().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91371""></a>
  <div class="note">
   <strong class="user">NWdev</strong>
   <a href="#91371" class="date">08-Jun-2009 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're serializing a small array of values and sending them from page to page for display/navigation purposes (versus storing them as session values) via $_GET, save yourself some time and ensure your php.ini magic_quotes_gpc values are set the same on your hosting and localhost severs.<br />
<br />
In my case I had magic_quotes_gpc OFF locally, and it took a while to see why the values weren't unserializing properly (actually at all -- unserialize produced FALSE) on the action page (form action page) of the hosted version. A quick look at phpinfo() showed a difference -- Thanks to others mentioning use of magic_quotes when saving to mysql triggered a thot that this mismatch might cause the problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85988""></a>
  <div class="note">
   <strong class="user">Chieftl (chieftl at ua dot fm)</strong>
   <a href="#85988" class="date">27-Sep-2008 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think serialized data must be compact. But serialize() function saves float values in bulky format. It possible to squeeze float values, using preg_replace():<br />
<span class="default">&lt;?php<br />
$val </span><span class="keyword">= </span><span class="default">3.14159</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// initial value: float(3.14159)<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// standart float format: string(55) "d:3.14158999999999988261834005243144929409027099609375;"<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/d:([0-9]+(\.[0-9]+)?([Ee][+-]?[0-9]+)?);/e'</span><span class="keyword">, </span><span class="string">"'d:'.((float)$1).';'"</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// compact float format: string(10) "d:3.14159;"<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// unserialization successed: float(3.14159)<br />
</span><span class="default">?&gt;<br />
</span>In result becomes slowly serilization, but faster unserialization and less disk space.<br />
<br />
WARNING! Some values can be rounded off<br />
<span class="default">&lt;?php<br />
$val </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">/</span><span class="default">3</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// initial value: float(0.333333333333)<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// standart float format: string(55) "d:0.333333333333333303727386009995825588703155517578125;"<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/d:([0-9]+(\.[0-9]+)?([Ee][+-]?[0-9]+)?);/e'</span><span class="keyword">, </span><span class="string">"'d:'.((float)$1).';'"</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// compact float format: string(10) "d:0.333333333333;"<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// unserialization successed: float(0.333333333333)<br />
</span><span class="default">$val </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);&nbsp; </span><span class="comment">// but value is rounded off!: string(55) "d:0.3333333333330000147753935380023904144763946533203125;"<br />
</span><span class="default">?&gt;<br />
</span><br />
WARNING! Do not use for recursive serializations (serialize(serialize(...)))!<br />
<br />
Sorry for my poor English.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82189""></a>
  <div class="note">
   <strong class="user">Aditya P Bhatt (adityabhai at gmail dot com)</strong>
   <a href="#82189" class="date">31-Mar-2008 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple code to understand serialize function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">dog </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$age</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$owner</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">dog</span><span class="keyword">(</span><span class="default">$in_name</span><span class="keyword">=</span><span class="string">"unnamed"</span><span class="keyword">,</span><span class="default">$in_age</span><span class="keyword">=</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">$in_owner</span><span class="keyword">=</span><span class="string">"unknown"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$in_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">= </span><span class="default">$in_age</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">owner </span><span class="keyword">= </span><span class="default">$in_owner</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getage</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">* </span><span class="default">365</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getowner</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">owner</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getname</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span> <br />
&lt;body bgcolor=white&gt;<br />
&lt;h1&gt;Beware the dog&lt;/h1&gt;<br />
<span class="default">&lt;?php<br />
$ourfirstdog </span><span class="keyword">= new </span><span class="default">dog</span><span class="keyword">(</span><span class="string">"Rover"</span><span class="keyword">,</span><span class="default">12</span><span class="keyword">,</span><span class="string">"Lisa and Graham"</span><span class="keyword">);<br />
</span><span class="default">$dogdisc </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$ourfirstdog</span><span class="keyword">);<br />
&nbsp;<br />
</span><span class="default">$pet </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$dogdisc</span><span class="keyword">);<br />
</span><span class="default">$old </span><span class="keyword">= </span><span class="default">$pet</span><span class="keyword">-&gt;</span><span class="default">getage</span><span class="keyword">();<br />
</span><span class="default">$name </span><span class="keyword">= </span><span class="default">$pet</span><span class="keyword">-&gt;</span><span class="default">getname</span><span class="keyword">();<br />
print </span><span class="string">"Our first dog is called </span><span class="default">$name</span><span class="string"> and is </span><span class="default">$old</span><span class="string"> days old&lt;br&gt;"</span><span class="keyword">;<br />
print </span><span class="default">$dogdisc</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79339""></a>
  <div class="note">
   <strong class="user">Marek Soldt</strong>
   <a href="#79339" class="date">21-Nov-2007 09:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
serialize() and unserialize() behave a bit crazy if you try to work with bigger strings (100kb of size). It helps to divide the string parts to array:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// string in $data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ko </span><span class="keyword">= </span><span class="default">4096</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data2 </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">ceil</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) / </span><span class="default">$ko</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data2</span><span class="keyword">[] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,(</span><span class="default">$i </span><span class="keyword">* </span><span class="default">$ko</span><span class="keyword">),((</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">) * </span><span class="default">$ko</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="comment">// prepared array in $data2<br />
</span><span class="default">?&gt;<br />
</span><br />
...before serialize()<br />
<br />
and<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// array in $data2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$data2</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="default">$data2</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="comment">// your string in $data<br />
</span><span class="default">?&gt;<br />
</span><br />
...after unserialize()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79226""></a>
  <div class="note">
   <strong class="user">Feral</strong>
   <a href="#79226" class="date">15-Nov-2007 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While it may not be recommended, it is possible to convert an object to another class while conserving all of its properties (public, protected and private), using serialize.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">cast_class</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">, </span><span class="default">$newclass</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'cast_class expects parameter 1 to be object, ' </span><span class="keyword">. </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">) . </span><span class="string">' given'</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$newclass</span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// We'll save unserialize the work of triggering an error if the class does not exist<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Class ' </span><span class="keyword">. </span><span class="default">$newclass </span><span class="keyword">. </span><span class="string">' not found'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$serialized_parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$serialized_parts</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$newclass</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$serialized_parts</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">$newclass </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$serialized_parts</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Please note that several built-in classes (or classes that are declared in PECL extensions) will not behave as PHP-declared classes and will ne be able to be serialized properly. Because of that, you will not be able to change their class using this function.<br />
<br />
Please also note that serialize and unserialize are memory-hungry functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79187""></a>
  <div class="note">
   <strong class="user">barbuj at NOSPAM dot yahoo dot com</strong>
   <a href="#79187" class="date">14-Nov-2007 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my specific situation, I wanted to be able to pass some data from page to page, but without relying on a session variable. The answer I came up with was to serialize() the object in question, pass it on to the next page as a hidden form field, then unserialize() it. When ALL class variables are public, this worked fine. However, if there was at least one private/protected variable, the code no longer worked as expected ("Fatal error: Call to a member function display() on a non-object in page2.php on line 4")<br />
<br />
As others have already mentioned, private/protected class variables will not behave nicely (private variables are prefixed by class_name + &amp;#65533;, while protected variables are only prefixed by &amp;#65533; - when looking at the page source using Firefox). Internet Explorer does NOT display the extra character between the class name and variable name, but the code still doesn't work as one would expect.<br />
<br />
Suppose you have a simple class:<br />
<br />
testclass.php<br />
=============<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">TestClass </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp; function </span><span class="default">display</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"i=" </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">i</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
page1.php<br />
=========<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">require_once </span><span class="string">'testclass.php'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$tc </span><span class="keyword">= new </span><span class="default">TestClass</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$tc</span><span class="keyword">-&gt;</span><span class="default">display</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>&lt;form method = "post" action = "page2.php"&gt;<br />
&lt;input type = "hidden" name = "str" value = "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">htmlspecialchars</span><span class="keyword">( </span><span class="default">serialize</span><span class="keyword">( </span><span class="default">$tc </span><span class="keyword">) ); </span><span class="default">?&gt;</span>"&gt;<br />
&lt;input type = "submit"&gt;<br />
&lt;/form&gt;<br />
<br />
page2.php<br />
=========<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">require_once </span><span class="string">'testclass.php'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$tc </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">( </span><span class="default">stripslashes</span><span class="keyword">( </span><span class="default">htmlspecialchars_decode</span><span class="keyword">( </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"str"</span><span class="keyword">] ) ) );<br />
&nbsp; </span><span class="default">$tc</span><span class="keyword">-&gt;</span><span class="default">display</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
The fix, suggested by evulish on #php/irc.dal.net, is to replace htmlspecialchars()/htmlspecialchars_decode() by base64_encode()/base64_decode. The code becomes:<br />
<br />
page1.php<br />
=========<br />
&lt;input type = "hidden" name = "str" value = "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">base64_encode</span><span class="keyword">( </span><span class="default">serialize</span><span class="keyword">( </span><span class="default">$tc </span><span class="keyword">) ); </span><span class="default">?&gt;</span>"&gt;<br />
<br />
page2.php<br />
=========<br />
<span class="default">&lt;?php<br />
&nbsp; $tc </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">( </span><span class="default">base64_decode</span><span class="keyword">( </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"str"</span><span class="keyword">] ) );<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this will help someone...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78994""></a>
  <div class="note">
   <strong class="user">Jeex</strong>
   <a href="#78994" class="date">06-Nov-2007 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It may be worth noting that, depending on the size of the object you are serializing, the serialize function can take up a lot of memory.<br />
<br />
If your script isn't working as expected, your serialize call may have pushed the memory usage over the limit set by memory_limit in php.ini.<br />
<br />
More info on memory limits here: <a href="http://www.php.net/manual/en/ini.core.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/ini.core.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77796""></a>
  <div class="note">
   <strong class="user">aksel at metal dot ee</strong>
   <a href="#77796" class="date">13-Sep-2007 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To serialize objects with fields that contain unicode values use that logic.<br />
<br />
Note! Obviously it does not convert correctly possible unicode values in arrays that may be member values of the object. Use an array class for that that inherits from the same base object that implements that serialization;)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Serializes object with/without unicode fields<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Before serializing encodes unicode values<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * @return string<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">serialize</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$serialized </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_class_vars</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">))) as </span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$key</span><span class="keyword">) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$serialized["'</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">'"] = serialize($this-&gt;'</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">'$serialized["'</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">'"] = utf8_encode($this-&gt;'</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$serialized</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Unserializes object with/without unicode fields<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * @param string Serialized data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serialized</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serialized</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$prop </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop</span><span class="keyword">) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77148""></a>
  <div class="note">
   <strong class="user">nothanks at nothanks dot no</strong>
   <a href="#77148" class="date">16-Aug-2007 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had to put a massive multidimensional array in a single field in the database. Unfortunatly the array contained lots of "forbidden" characters: ", ', ;, :, and so on and so forth, breaking the query and my later attempts at deserialize().<br />
<br />
Here's a quick and dirty solution: <br />
<span class="default">&lt;?php<br />
$safe_string_to_store </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">( </span><span class="default">serialize</span><span class="keyword">( </span><span class="default">$multidimensional_array </span><span class="keyword">) ) ; <br />
</span><span class="default">?&gt;<br />
</span><br />
And in the other end: <br />
<span class="default">&lt;?php<br />
$encoded_serialized_string </span><span class="keyword">= </span><span class="default">dbh</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT archives_arr FROM "</span><span class="keyword">. </span><span class="default">$table_name </span><span class="keyword">. </span><span class="string">" WHERE id=0"</span><span class="keyword">)<br />
<br />
</span><span class="default">$array_restored_from_db </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">( </span><span class="default">base64_decode</span><span class="keyword">( </span><span class="default">$encoded_serialized_string </span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76976""></a>
  <div class="note">
   <strong class="user">deminy at deminy dot net</strong>
   <a href="#76976" class="date">08-Aug-2007 09:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Reply to erudd's post:<br />
<br />
The regular expression you used to unserialize a PHP session file won't work if the session file contains string variable which contains character "|".<br />
<br />
As I can see now, there is no any regular expression that can easily split data in a PHP session file. To read data from a session file, we may have to write a function to read content from the file, and then parse the content.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76056""></a>
  <div class="note">
   <strong class="user">btbeat at gmail dot com</strong>
   <a href="#76056" class="date">28-Jun-2007 01:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Generally when I do an insert into a database table of posted data, I use the recommended mysql_real_escape_string function, with stripslashes if the get_magic_quotes_gpc is on.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">prepData</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
&nbsp; }<br />
return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span>I've been having a problem inserting a serialized array into a MySQL database that contained single and double quotes for values.<br />
<br />
ex: "quotes" =&gt; "some 'quoted' "text""<br />
you'd think it would be:<br />
a:1:{s:6:"quotes";s:20:"some 'quoted' "text"";}<br />
as prepData function would strip the slashes.<br />
<br />
However, what goes into the database is:<br />
a:1:{s:6:"quotes";s:24:"some 'quoted' "text"";}<br />
as if there are slashes before the single and double quotes.<br />
<br />
Obviously on unserializing the data, there is an error, as 24 chars are expected, when there are only 20.<br />
<br />
So, the solution I've coded for my safe insert prepData function is: <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">prepData</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">$serialized </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp; if( </span><span class="default">$serialized </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
when inserting plain data from a post:<br />
&lt;? $data = prepData($data); ?&gt;<br />
<br />
for serialized data:<br />
&lt;? $data = prepData($data, 1); ?&gt;<br />
<br />
cracked my head on this one a bit :|<br />
<br />
strange behaviour for serialize(), i.e. string count, counts slashes that are not there.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75859""></a>
  <div class="note">
   <strong class="user">friday13 at ig dot com dot br</strong>
   <a href="#75859" class="date">19-Jun-2007 07:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have problem to use serialize function with hidden form field and the resolution was use htmlentities.<br />
<br />
Ex.:<br />
<br />
&lt;?<br />
<br />
$lista = array( 'pera', 'ma̤a', 'laranja' );<br />
<br />
print "&lt; input type='hidden' name='teste' value='htmlentities( serialize( $lista ) )'" &gt;";<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75733""></a>
  <div class="note">
   <strong class="user">lacent at gmail dot com</strong>
   <a href="#75733" class="date">13-Jun-2007 10:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i noticed the same problem related to quotes, but the person below had no code detailing it. i can only assume he wrote it to fix values, and not to fix the whole array, so heres 2 functions to handle encoding the array.<br />
<br />
&nbsp;&nbsp;&nbsp; function slw_serial ( $var = array(), $recur = FALSE ) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $recur ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ( $var as $k =&gt; $v ) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( is_array($v) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $var[$k] = slw_serial($v, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $var[$k] = base64_encode($v);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $var;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return serialize(slw_serial($var, 1));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function slw_unserial ( $var = FALSE, $recur = FALSE ) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $recur ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ( $var as $k =&gt; $v ) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( is_array($v) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $var[$k] = slw_unserial($v, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $var[$k] = base64_decode($v);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $var;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return slw_unserial(unserialize($var), 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
---------<br />
USAGE:<br />
---------<br />
<br />
&nbsp;&nbsp;&nbsp; $array = array();<br />
&nbsp;&nbsp;&nbsp; $array[] = 'this "is a" test';<br />
&nbsp;&nbsp;&nbsp; $array[] = array('pos'=&gt;'test', 'name'=&gt;'some "dude in" cali');<br />
&nbsp;&nbsp;&nbsp; $array = slw_serial($array);<br />
&nbsp;&nbsp;&nbsp; echo $array . '&lt;Br&gt;&lt;br&gt;';<br />
&nbsp;&nbsp;&nbsp; $array = slw_unserial($array);<br />
&nbsp;&nbsp;&nbsp; echo print_r($array, 1);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74655""></a>
  <div class="note">
   <strong class="user">kris dover</strong>
   <a href="#74655" class="date">21-Apr-2007 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The PHPSerialization class linked in my last comment now supports serialize()'ing java objects to the php serialization text format, thus facilitating a means of data inter-change between php and java communicating against a common php serialized data source.<br />
<br />
reverse mappings are as follows:<br />
&nbsp;&nbsp; _PHP Type_&nbsp;&nbsp; &lt;-----------------&nbsp;&nbsp; _Java Type_<br />
&nbsp;&nbsp; &nbsp;&nbsp; array&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java.lang.Object[]<br />
&nbsp;&nbsp; &nbsp;&nbsp; int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java.lang.Byte<br />
&nbsp;&nbsp; &nbsp;&nbsp; int&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java.lang.Short<br />
&nbsp;&nbsp; &nbsp;&nbsp; double&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; java.lang.Float<br />
&nbsp;&nbsp; &nbsp;&nbsp; double&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; java.lang.Long<br />
&nbsp;&nbsp; &nbsp;&nbsp; double&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; java.lang.BigInteger<br />
&nbsp;&nbsp; &nbsp;&nbsp; double&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; java.lang.BigDecimal<br />
&nbsp;&nbsp; &nbsp;&nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java.lang.Character<br />
&nbsp;&nbsp; &nbsp;&nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java.lang.CharBuffer<br />
&nbsp;&nbsp; &nbsp;&nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java.lang.StringBuffer</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71251""></a>
  <div class="note">
   <strong class="user">admin at goodsoft dot lv</strong>
   <a href="#71251" class="date">19-Nov-2006 08:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When I serialized an object and looked into resulting string, I mentioned that all private properties' names were prefixed by class name.<br />
<br />
This code:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">myclass </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$priv1 </span><span class="keyword">= </span><span class="string">"val1"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$myclasspriv2 </span><span class="keyword">= </span><span class="string">"val2"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$pub </span><span class="keyword">= </span><span class="string">"val3"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$inst </span><span class="keyword">= new </span><span class="default">myclass </span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$inst</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>resulted in (don't look at word wrapping):<br />
O:7:"myclass":3:{s:14:"myclasspriv1";<br />
s:4:"val1";s:21:"myclassmyclasspriv2";<br />
s:4:"val2";s:3:"pub";s:4:"val3";}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68220""></a>
  <div class="note">
   <strong class="user">Ates Goral</strong>
   <a href="#68220" class="date">18-Jul-2006 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Corrections/clarifications to&nbsp; "Anatomy of a serialize()'ed value":<br />
<br />
All strings appear inside quotes. This applies to string values, object class names and array key names. For example:<br />
<br />
s:3:"foo"<br />
O:7:"MyClass":1:{...<br />
a:2:{s:3:"bar";i:42;...<br />
<br />
Object property names and values are delimited by semi-colons, not colons. For example:<br />
<br />
O:7:"MyClass":2:{s:3:"foo";i:10;s:3:"bar";i:20}<br />
<br />
Double/float values are represented as:<br />
<br />
d:0.23241446</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66147""></a>
  <div class="note">
   <strong class="user">egingell at sisna dot com</strong>
   <a href="#66147" class="date">15-May-2006 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;?<br />
/*<br />
Anatomy of a serialize()'ed value:<br />
<br />
&nbsp;String<br />
&nbsp;s:size:value;<br />
<br />
&nbsp;Integer<br />
&nbsp;i:value;<br />
<br />
&nbsp;Boolean<br />
&nbsp;b:value; (does not store "true" or "false", does store '1' or '0')<br />
<br />
&nbsp;Null<br />
&nbsp;N;<br />
<br />
&nbsp;Array<br />
&nbsp;a:size:{key definition;value definition;(repeated per element)}<br />
<br />
&nbsp;Object<br />
&nbsp;O:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}<br />
<br />
&nbsp;String values are always in double quotes<br />
&nbsp;Array keys are always integers or strings<br />
&nbsp;&nbsp;&nbsp; "null =&gt; 'value'" equates to 's:0:"";s:5:"value";',<br />
&nbsp;&nbsp;&nbsp; "true =&gt; 'value'" equates to 'i:1;s:5:"value";',<br />
&nbsp;&nbsp;&nbsp; "false =&gt; 'value'" equates to 'i:0;s:5:"value";',<br />
&nbsp;&nbsp;&nbsp; "array(whatever the contents) =&gt; 'value'" equates to an "illegal offset type" warning because you can't use an<br />
&nbsp;&nbsp;&nbsp; array as a key; however, if you use a variable containing an array as a key, it will equate to 's:5:"Array";s:5:"value";',<br />
&nbsp;&nbsp; &nbsp; and<br />
&nbsp;&nbsp;&nbsp; attempting to use an object as a key will result in the same behavior as using an array will.<br />
*/<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63789""></a>
  <div class="note">
   <strong class="user">erudd at netfor dot com</strong>
   <a href="#63789" class="date">30-Mar-2006 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To unserialize a PHP session file, unserlize can not be used directly.<br />
The data must be split, as the php session file also contains the names of the variables which serialize/unserialize do not do.&nbsp; Here is a simple preg_split that will acomplish the split.. (regex not thuroughly tested, but should work for most all circumstances)<br />
<br />
<span class="default">&lt;?php<br />
$session </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$session_file</span><span class="keyword">);<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">'/([A-Za-z_][A-Za-z0-9_]*)\|/'</span><span class="keyword">,</span><span class="default">$session</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_DELIM_CAPTURE</span><span class="keyword">|</span><span class="default">PREG_SPLIT_NO_EMPTY</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
$data[0] will contain the variable name, and $data[1] will contain the serialized data.&nbsp; so in effect<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">$</span><span class="default">$data</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
</span><span class="default">?&gt;<br />
</span>will restore that one variable.<br />
<br />
just go through the $data array evens being the variable name, odd being the data.&nbsp; You can use this to create a simple command line session viewer:)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61675""></a>
  <div class="note">
   <strong class="user">angel at support-24 dot com</strong>
   <a href="#61675" class="date">09-Feb-2006 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I recently had a problem inserting serialized array in mysql DB using PEAR DB_Base class functions. mySQL fails to insert the serialized array because the serialized data contains semicolon. A way to solve that problem is to make same changes to the serialized data:<br />
<br />
$serializeorder = serialize($order);<br />
$serializeorder = preg_replace("#;#msi",'0x3B',$serializeorder);<br />
$serializeorder = preg_replace("/(\n)|(\r)/"," ",$serializeorder);<br />
$serializeorder = addcslashes($serializeorder, "\0..\37!@\@\177..\377"); <br />
$serializeorder = addslashes($serializeorder);<br />
<br />
Here we substitute the semicolon with it's hex. We alse get rid of cariage return. Remember to make the vise versa substitution again when extracting the data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61418""></a>
  <div class="note">
   <strong class="user">Neil Green</strong>
   <a href="#61418" class="date">02-Feb-2006 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Are you trying to store and retrieve an object from session and it's disappearing?&nbsp; Did you look at what the serialized object looked like and saw a strange "N;"?&nbsp; Does the object you're trying to serialize or store in a session define the __call magic method?<br />
<br />
Here's the problem:&nbsp; If you try to serialize an object that uses the __call magic method you are not going to be able to unserialize it.<br />
<br />
Here's what happens:<br />
<br />
1.&nbsp; You try to serialize an object with the __call magic method defined<br />
2.&nbsp; The magic method __sleep is always called on an object being serialized<br />
3.&nbsp; __call traps __sleep because it's not defined<br />
4.&nbsp; __call does not respond to __sleep with what is expected: an array of properties to serialize<br />
<br />
The solution is defining a __sleep method that returns what it's supposed to when you define a __call:<br />
<br />
&lt;?<br />
// This is just a handy debug function<br />
function show( $object ){ echo "&lt;pre&gt;" . print_r( $object, true ) . "&lt;/pre&gt;"; }<br />
<br />
class foo<br />
{<br />
&nbsp;&nbsp;&nbsp; private $private = "private value";<br />
&nbsp;&nbsp;&nbsp; public $public = "public value";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function __call( $method, $arguments )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Remove this and serialise/unserialse won't work<br />
&nbsp;&nbsp;&nbsp; public function __sleep()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array_keys( get_object_vars( $this ) );<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
$foo = new Foo();<br />
<br />
show( $foo );<br />
<br />
$serializedFoo = serialize( $foo );<br />
show( $serializedFoo );<br />
show( unserialize( $serializedFoo ) );<br />
?&gt;<br />
<br />
BTW, I'm using PHP Version 5.0.4 on Windows.<br />
<br />
To the editor:&nbsp; This post may be useful under the __call, __unserialise, and session pages as well.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60834""></a>
  <div class="note">
   <strong class="user">Embeded nulls with private vars</strong>
   <a href="#60834" class="date">17-Jan-2006 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are serializing an object with private variables, beware. The serialize() function returns a string with null (\x00) characters embedded within it, which you have to escape. Not great if you're trying to save objects into a DB...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60783""></a>
  <div class="note">
   
   <a href="#60783" class="date">16-Jan-2006 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use PHP 4.3.10 and I found out that if you use a class "MyClass", the constructor of the class must be called "__construct()" and NOT "MyClass()" like in Java or other languages.<br />
<br />
If you use the "MyClass()" constructor, the following won't work :<br />
&nbsp;&nbsp;&nbsp; $_SESSION['obj_my_class'] = new MyClass();<br />
If you don't believe me, you can have a look in the directory "session.save_path" (default /var/lib/php4) where is stored the session's file. You will see this :<br />
&nbsp;&nbsp;&nbsp; obj_my_class|N;<br />
and not your complete class!<br />
<br />
It took me almost one day to understand what was happening... :-(</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60666""></a>
  <div class="note">
   <strong class="user">varrah NO_GARBAGE_OR_SPAM AT mail DOT ru</strong>
   <a href="#60666" class="date">13-Jan-2006 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Worked with Andrea, so the script is now updated to support at least UTF-8 correctly. Details can be found at <a href="http://www.sitepoint.com/blogs/2004/04/22/ serializing-php-data-structures-for-javascript (had to insert space after the 22/&nbsp; otherwise the link was too long and comments engine didn" rel="nofollow" target="_blank">http://www.sitepoint.com/blogs/2004/04/22/ serializing-php-data-structures-for-javascript (had to insert space after the 22/&nbsp; otherwise the link was too long and comments engine didn</a>'t want to pass it :-) )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60535""></a>
  <div class="note">
   <strong class="user">varrah NO_GARBAGE_OR_SPAM AT mail DOT ru</strong>
   <a href="#60535" class="date">10-Jan-2006 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
andrea at 3site dot it gave a link for a JavaScript serialization class, but be prepared! This class works only on single-byte symbols, since JS str.length property gives the length of the string in SYMBOLS, not bytes (as PHP serialize() does), so a Unicode string JS-serialized in a way like: <br />
<br />
strSerialized = "s:" + strOriginal.length + ":" + strOriginal;<br />
<br />
will not be unserialized correctly by PHP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60317""></a>
  <div class="note">
   <strong class="user">MC_Gurk at gmx dot net</strong>
   <a href="#60317" class="date">03-Jan-2006 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are going to serialie an object which contains references to other objects you want to serialize some time later, these references will be lost when the object is unserialized.<br />
The references can only be kept if all of your objects are serialized at once.<br />
That means:<br />
<br />
$a = new ClassA(); <br />
$b = new ClassB($a); //$b containes a reference to $a;<br />
<br />
$s1=serialize($a);<br />
$s2=serialize($b);<br />
<br />
$a=unserialize($s1);<br />
$b=unserialize($s2);<br />
<br />
now b references to an object of ClassA which is not $a. $a is another object of Class A.<br />
<br />
use this:<br />
$buf[0]=$a;<br />
$buf[1]=$b;<br />
$s=serialize($buf);<br />
$buf=unserialize($s);<br />
$a=$buf[0];<br />
$b=$buf[1];<br />
<br />
all references are intact.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59330""></a>
  <div class="note">
   <strong class="user">Alexander Podgorny</strong>
   <a href="#59330" class="date">02-Dec-2005 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example of a base class to implement object persistence using serialize and unserialize:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Persistent<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**********************/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">Persistent</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">)) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**********************/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">save</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$f </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(@</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">))))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else die(</span><span class="string">"Could not write to file "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">.</span><span class="string">" at Persistant::save"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else die(</span><span class="string">"Could not open file "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">.</span><span class="string">" for writing, at Persistant::save"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**********************/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">open</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$vars </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$vars </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">"$"</span><span class="keyword">.</span><span class="string">"this-&gt;</span><span class="default">$key</span><span class="string"> = $"</span><span class="keyword">.</span><span class="string">"vars['"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$key</span><span class="string">'];"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**********************/<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
When an object is extended from this one it can be easily saved and re-opened using it's own methods as follows:<br />
<br />
&lt;?<br />
<br />
class foo extends Persistent<br />
{<br />
&nbsp;&nbsp; var $counter;<br />
&nbsp;&nbsp; function inc()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $this-&gt;counter++;<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
$fooObj = new $foo;<br />
$foo-&gt;open();<br />
print $foo-&gt;counter; // displays incrementing integer as page reloads<br />
$foo-&gt;inc();<br />
$foo-&gt;save();<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59117""></a>
  <div class="note">
   <strong class="user">andrea at 3site dot it</strong>
   <a href="#59117" class="date">26-Nov-2005 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello!<br />
Here you can find a JavaScript Object that should serialize JS vars for PHP and unserialize PHP vars for JavaScript.<br />
<a href="http://www.devpro.it/javascript_id_102.html" rel="nofollow" target="_blank">http://www.devpro.it/javascript_id_102.html</a><br />
<br />
Please read notes inside the code to know more about vars compatibility.<br />
<br />
It was created to resolve AJAX interaction and maybe usefull for other situations .... such:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// example nested array<br />
</span><span class="default">$myarray </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">123</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'nested'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'test'</span><span class="keyword">=&gt;</span><span class="default">false<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; ),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'other'</span><span class="keyword">=&gt;</span><span class="string">'value'<br />
</span><span class="keyword">);<br />
</span><span class="comment">// array serializzation<br />
</span><span class="default">$serialized </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$myarray</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>&lt;script type="text/javascript" src="PHP_Serializer.js"&gt;&lt;/script&gt;<br />
&lt;script type="text/javascript"&gt;<br />
// function to dump an object<br />
function showObject(obj, level) {<br />
&nbsp;&nbsp;&nbsp; var l = '';<br />
&nbsp;&nbsp;&nbsp; var tmp = '';<br />
&nbsp;&nbsp;&nbsp; for(var a = 0; a &lt; level; a++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; l += '[_]';<br />
&nbsp;&nbsp;&nbsp; for(var a in obj) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var type = typeof(obj[a]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(type == 'object')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tmp += showObject(obj[a], (level + 1));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; tmp += l + ' key: ' + a + ' = value: ' +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; obj[a] + ' &lt; ' + type + '\n';<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return tmp;<br />
}<br />
// new PHP_Serializer variable<br />
var php = new PHP_Serializer();<br />
// dinamyc JS var creation<br />
var myJSvar = php.unserialize("<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'"'</span><span class="keyword">, </span><span class="string">'\\"'</span><span class="keyword">, </span><span class="default">$serialized</span><span class="keyword">); </span><span class="default">?&gt;</span>");<br />
// look at dump :-)<br />
alert(showObject(myJSvar, 0));<br />
&lt;/script&gt;<br />
<br />
Regards</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58360""></a>
  <div class="note">
   <strong class="user">pavic at ieee dot org</strong>
   <a href="#58360" class="date">01-Nov-2005 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, if You get code like<br />
d:234 and than string You wanted, it's the problem, that <br />
s dot marechal at jejik dot com<br />
explanied.<br />
<br />
Well, here is a workaround for that problem, function safe serialize, which won't produce that unwanted chars...<br />
<br />
function safe_serialize($string) {<br />
&nbsp;&nbsp;&nbsp; return preg_replace("/(\n)|(\r)/"," ",$string);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58356""></a>
  <div class="note">
   <strong class="user">stephen dot adamson at smius dot com</strong>
   <a href="#58356" class="date">01-Nov-2005 09:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are serializing an object to store it in the database, using __sleep() can save you some space. The following code will not store empty (null) variables in the serialized string. For my purposes this saved a lot of space, since some of the member variables would not be given values.<br />
<br />
function __sleep()<br />
{<br />
&nbsp;&nbsp;&nbsp; $allVars = get_object_vars($this);<br />
&nbsp;&nbsp;&nbsp; $toReturn = array();<br />
&nbsp;&nbsp;&nbsp; foreach(array_keys($allVars) as $name)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($this-&gt;$name))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $toReturn[] = $name;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $toReturn;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58267""></a>
  <div class="note">
   <strong class="user">php barryhunter co uk</strong>
   <a href="#58267" class="date">29-Oct-2005 04:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you wanting to do something similar to 'mwwaygoo AT hotmail DOT com', then you may want to look at the built in function var_export.<br />
<br />
"var_export() gets structured information about the given variable. It is similar to var_dump()&nbsp; with one exception: the returned representation is valid PHP code."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57704""></a>
  <div class="note">
   <strong class="user">Sean  at  http://seanj dot jcink dot com</strong>
   <a href="#57704" class="date">11-Oct-2005 02:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Very short function I made to turn arrays into a string for fwriting, doesnt create unnecessary commas either:<br />
<br />
&lt;?<br />
function arraytostring($array){<br />
$text.="array(";<br />
$count=count($array);<br />
foreach ($array as $key=&gt;$value){<br />
$x++;<br />
if (is_array($value)) {$text.=$key."=&gt;".arraytostring($value); continue;}<br />
$text.="\"$key\"=&gt;\"$value\"";<br />
if ($count!=$x) $text.=",";<br />
}<br />
$text.=")";<br />
return $text;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57676""></a>
  <div class="note">
   <strong class="user">eggyknap at gmail dot com</strong>
   <a href="#57676" class="date">10-Oct-2005 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My thanks to the editor who pointed out the serialization bug. According to the bug report, this should be fixed in version 5.0.4, and is confirmed fixed in v 5.0.5. Unfortunately I'm not in a position to update my installation, but I found that passing the serialized string through addslashes before saving it to the database does the trick. It may be a bit inefficient, but it works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57621""></a>
  <div class="note">
   <strong class="user">eggyknap at gmail dot com</strong>
   <a href="#57621" class="date">08-Oct-2005 09:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's note: This has been fixed. Protected and private members were serialized with a leading \0 (zero byte). Bug report here, <a href="http://bugs.php.net/29865 - aidan@php.net]" rel="nofollow" target="_blank">http://bugs.php.net/29865 - aidan@php.net]</a><br />
<br />
Be careful trying to serialize objects containing private or protected data members. It appears that the serialization process includes characters in the result string to indicate the visibility of each member, but the characters used to denote protected or private data are outside the normal character set and can cause problems as you pass them through applications. I haven't found the culprit in my particular case, so I can't say that this is a bug in PHP, but it certainly is causing me some annoyance in my particular situation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54870""></a>
  <div class="note">
   <strong class="user">mwwaygoo AT hotmail DOT com</strong>
   <a href="#54870" class="date">18-Jul-2005 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello people,<br />
<br />
I had major problems getting serialize to work properly, as I wanted to sync two databases via email, and needed a way of converting a retrieved row to a string. It works the reverse of array(), in that it creates a statement that you can use to evaluate to the original array, so I called it unarray().<br />
Its a recursive function (self calling), so it doesnt matter how complex the array is.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$source</span><span class="keyword">=array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="string">'x'</span><span class="keyword">=&gt;</span><span class="string">'test'</span><span class="keyword">);<br />
</span><span class="default">$text</span><span class="keyword">=</span><span class="default">unarray</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
<br />
</span><span class="default">$destination</span><span class="keyword">=array(); </span><span class="comment">// prime the variable incase of failure.<br />
</span><span class="keyword">eval(</span><span class="string">'$destination='</span><span class="keyword">.</span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">);<br />
<br />
</span><span class="comment">// unarray.php&nbsp; &nbsp; REVERSE of array();<br />
<br />
</span><span class="keyword">function </span><span class="default">unarray</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$first</span><span class="keyword">=</span><span class="default">TRUE</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"array("</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(list(</span><span class="default">$key</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">)=</span><span class="default">each</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"'"</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"=&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="default">unarray</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">], </span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">$text</span><span class="keyword">.</span><span class="string">"), "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"'"</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">).</span><span class="string">"', "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$array</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"TRUE, "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"FALSE, "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">"NULL, "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">.=</span><span class="default">$array</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$first</span><span class="keyword">) </span><span class="default">$text</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">2</span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
p.s. I realise that it also creates unnecessary commas, but these are ignored when re-creating it. array(1,2,) is the same as array(1,2).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53821""></a>
  <div class="note">
   <strong class="user">abductee _at_ texture _minus_ editor.com</strong>
   <a href="#53821" class="date">14-Jun-2005 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
wiart at yahoo dot com wrote:<br />
&gt;As you can see, the original array :<br />
&gt;$arr["20041001103319"] = "test"<br />
&gt;<br />
&gt;after serialize/unserialize is:<br />
&gt;$arr[683700183] = "test"<br />
<br />
yepp, and i can explain it.<br />
<br />
the internal compiler of php does not hit anys rule wich foces him to make that number a string during serialisation. since it becomes an integer and php supports 32bit interger not arbitary bitwidth this is what happens:<br />
<br />
"20041001103319"<br />
equals hexadecimal:<br />
<br />
0x123A28C06FD7h<br />
<br />
if you cut away the frontpart cutting down to 32bis,<br />
you get:<br />
<br />
0x28C06FD7h<br />
<br />
wich equals 683700183.<br />
<br />
of, for those of you who speak binary:<br />
<br />
20041001103319 =<br />
100100011101000101000110000000110111111010111bin<br />
<br />
----cut-away----00101000110000000110111111010111bin<br />
=683700183<br />
<br />
so, what can you do to prevent stuff like this?<br />
eihter use only numbers between 0..9999999999<br />
or force strings, best way ist to add a character<br />
like <br />
<br />
foo["c2342303"]<br />
<br />
cheers, abductee</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49285""></a>
  <div class="note">
   <strong class="user">gafunchal NOSPAN at inf dot ufrgs dot br</strong>
   <a href="#49285" class="date">22-Jan-2005 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(please, excuse my poor English)<br />
<br />
'serialize' does strange things with floats, this code:<br />
<br />
&nbsp; $a = 3.14;<br />
&nbsp; $s = serialize($a);<br />
&nbsp; $fp = fopen("storage", "w");<br />
&nbsp; fwrite($fp, $s);<br />
&nbsp; fclose($fp);<br />
<br />
outputs something like (PHP 5.0.2):<br />
<br />
d:3.140000000000000124344978758017532527446746826171875;<br />
<br />
I wonder why serialize doesn't store data (not only float, I mean all types of data) in a more 'economic' format. Maybe binary is not the best option (there can be trouble storing it in databases), but there are still a lot of other possibilities.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48451""></a>
  <div class="note">
   <strong class="user">cjmeyer at npcc dot net</strong>
   <a href="#48451" class="date">23-Dec-2004 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
More on troubles with recursive object references and serialization.<br />
<br />
In my PHP 4.2.2 the solution suggested above (by james at gogo dot co dot nz), to pass a reference to the object to serialize(), does not help.&nbsp; There are still multiple copies of the objects woken up, and the recursive reference is no longer recursive.<br />
<br />
The only solution I have found is to use the __sleep and __wakeup magic functions to only serialize the link one-way, then recreate it manually on unserialize.&nbsp; This isn't too difficult;&nbsp; here is some code demonstrating this approach:<br />
<br />
class A {<br />
&nbsp; var $data = Null;<br />
&nbsp; var $b = Null;<br />
<br />
&nbsp; function A($data, $bData) {<br />
&nbsp;&nbsp;&nbsp; $this-&gt;data = $data;<br />
&nbsp;&nbsp;&nbsp; $this-&gt;b = new B(&amp;$this, $bData);<br />
&nbsp; }<br />
<br />
&nbsp; function printData() {<br />
&nbsp;&nbsp;&nbsp; print 'A thinks A data is ' . $this-&gt;data . "\n";<br />
&nbsp;&nbsp;&nbsp; print 'A thinks B data is ' . $this-&gt;b-&gt;data . "\n";<br />
&nbsp; }<br />
<br />
&nbsp; function __sleep() {<br />
&nbsp;&nbsp;&nbsp; print "A is going to sleep.\n";<br />
&nbsp;&nbsp;&nbsp; return array('data', 'b');<br />
&nbsp; }<br />
<br />
&nbsp; function __wakeup(){<br />
&nbsp;&nbsp;&nbsp; print "A is waking up.\n";<br />
&nbsp;&nbsp;&nbsp; $this-&gt;b-&gt;reLinkA($this);<br />
&nbsp; }<br />
<br />
}<br />
<br />
class B {<br />
&nbsp; var $data = Null;<br />
&nbsp; var $a = Null;<br />
<br />
&nbsp; function B(&amp;$a, $data) {<br />
&nbsp;&nbsp;&nbsp; $this-&gt;a =&amp; $a;<br />
&nbsp;&nbsp;&nbsp; $this-&gt;data = $data;<br />
&nbsp; }<br />
<br />
&nbsp; function printData() {<br />
&nbsp;&nbsp;&nbsp; print 'B thinks A data is ' . $this-&gt;a-&gt;data . "\n";<br />
&nbsp;&nbsp;&nbsp; print 'B thinks B data is ' . $this-&gt;data . "\n";<br />
&nbsp; }<br />
<br />
&nbsp; function __sleep() {<br />
&nbsp;&nbsp;&nbsp; print "B is going to sleep.\n";<br />
&nbsp;&nbsp;&nbsp; return array('data');<br />
&nbsp; }<br />
<br />
&nbsp; function __wakeup(){<br />
&nbsp;&nbsp;&nbsp; print "B is waking up.\n";<br />
&nbsp; }<br />
<br />
&nbsp; function reLinkA(&amp;$a) {<br />
&nbsp;&nbsp;&nbsp; $this-&gt;a =&amp; $a;<br />
&nbsp; }<br />
<br />
}<br />
<br />
$a = new A("origAdata", "origBdata");<br />
<br />
print '&lt;pre&gt;';<br />
<br />
print "I think A data is " . $a-&gt;data . "\n";<br />
print "I think B data is " . $a-&gt;b-&gt;data . "\n";<br />
$a-&gt;printData();<br />
$a-&gt;b-&gt;printData();<br />
<br />
$serA = serialize($a);<br />
$newA = unserialize($serA);<br />
<br />
$newA-&gt;data = 'newAdata';<br />
$newA-&gt;b-&gt;data = 'newBdata';<br />
<br />
print "I think new A data is " . $newA-&gt;data . "\n";<br />
print "I think new B data is " . $newA-&gt;b-&gt;data . "\n";<br />
$newA-&gt;printData();<br />
$newA-&gt;b-&gt;printData();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48239""></a>
  <div class="note">
   <strong class="user">wiart at yahoo dot com</strong>
   <a href="#48239" class="date">16-Dec-2004 03:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning: on 64 bits machines,&nbsp; if you use a long string only composed of numbers as a key in an array and serialize/unserialize it, you can run into problems:<br />
<br />
an example code:<br />
$arr["20041001103319"] = 'test';<br />
var_dump( $arr);<br />
$arr_in_str = serialize($arr);<br />
print "Now result is: $arr_in_str&lt;BR /&gt;";<br />
$final_arr = unserialize($arr_in_str);<br />
print "The final unserialized array:&lt;BR /&gt;";<br />
var_dump($final_arr);<br />
<br />
The result:<br />
array(1) { [20041001103319]=&gt;&nbsp; string(4) "test" } <br />
Now result is: a:1:{i:20041001103319;s:4:"test";}<br />
The final unserialized array:<br />
array(1) { [683700183]=&gt; string(4) "test" }<br />
<br />
As you can see, the original array :<br />
$arr["20041001103319"] = "test"<br />
<br />
after serialize/unserialize is:<br />
$arr[683700183] = "test"<br />
<br />
As you can see,&nbsp; the key has changed ...<br />
<br />
Apparently a problem of implicit casting + integer overflow (I posted a PHP bug report: <a href="http://bugs.php.net/bug.php?id=31117" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=31117</a>)<br />
<br />
I tested with the latest 4.3.10 compiled on my laptop (32 bits, Mandrake 9.1) --&gt; no such problem. But compiled on AMD 64 bits (Red Hat Taroon), the problem is present.<br />
<br />
Hope this will help some of you to not loose almost a whole day of debugging ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48123""></a>
  <div class="note">
   <strong class="user">richard dot prangnell at ntlworld dot com</strong>
   <a href="#48123" class="date">12-Dec-2004 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although the serialise function has its proper uses, it is a relatively slow process. I try to avoid using it wherever possible in the interests of performance. You can store text records in a database as plain text even when it contains PHP variables. The variable values are lost, naturally; but if they can easily be re-attached to retrieved records, zillions of clock cycles can be saved simply by using the str_replace() function:<br />
<br />
&nbsp; if($convert)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $mainContent = str_replace('$fixPath', $fixPath, $mainContent);<br />
&nbsp;&nbsp;&nbsp; $mainContent = str_replace('$theme', $theme, $mainContent);<br />
&nbsp; }<br />
<br />
The above snippet is used in a CMS project. $fixPath contains&nbsp; something like '.' or '..' to prepend relative paths (allowing the record to be used by scripts located in different parts of the directory hierarchy) and $theme inserts the name of the users custom page rendering scheme, which obviously would be undefined at record storage time anyway.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48000""></a>
  <div class="note">
   <strong class="user">corey at eyewantmedia dot com</strong>
   <a href="#48000" class="date">08-Dec-2004 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If this helps anybody, I was looking for a few quick calls to cache stuff to files. I settled on the below functions. By the way, if I am doing something stupid here, I'd appreciate some comments on that also. Anyway, on with the code:<br />
<br />
First, the usage:<br />
<br />
//Use:<br />
<br />
$var = tuncache('MyCacheName');<br />
if (is_null($var)) {<br />
&nbsp;&nbsp;&nbsp; $var = 'a really expensive process';<br />
&nbsp;&nbsp;&nbsp; $check = tcache('MyCacheName', $var, '+25 minutes');<br />
&nbsp;&nbsp;&nbsp; if (is_null($check)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die('I need to reset my permissions or get a bigger hard drive');<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
//use $var now<br />
<br />
Now, the functions:<br />
<br />
//uses strtotime to decide how long to cache $cacheVar based on $lifespan<br />
//so anything but a timestamp works. +1 day works, 09/14/2010 works, etc<br />
function tcache($cacheName, $cacheVar, $lifespan=null) {<br />
&nbsp;&nbsp;&nbsp; if (!is_null($lifespan)) { //a lifespan was provided<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (strpos($lifespan, '+') === 0 || strpos($lifespan, '-') === 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Have to do this to counter for bug in php5 to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //properly evaluate now to do the date math<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $endTime = strtotime(date('m/d/Y H:i:s') . ' ' .$lifespan);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //we can safely use anything else I think<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $endTime = strtotime($lifespan);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //cache forever (forever being ten years) until manually deleted<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $endTime = strtotime(date('m/d/Y H:i:s') . ' +10 years');<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $cVal = serialize($cacheVar);<br />
&nbsp;&nbsp;&nbsp; $file = tFindcache($cacheName);<br />
&nbsp;&nbsp;&nbsp; $result = true;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $f = fopen($file, 'w');<br />
&nbsp;&nbsp;&nbsp; if ($f === false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result = null; //barf if we can't open the file<br />
&nbsp;&nbsp;&nbsp; } else { //write the cache<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite($f, $endTime . "\n");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite($f, $cVal);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($f);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $result;<br />
}<br />
<br />
function tuncache($cacheName) {<br />
&nbsp;&nbsp;&nbsp; $file = tFindCache($cacheName);<br />
<br />
&nbsp;&nbsp;&nbsp; if (is_readable($file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //open file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $f = fopen($file, 'r');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $time = time();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $expTime = trim(fgets($f));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //check time<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($time &gt; $expTime) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //It expired<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = null;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Read it and unserialize it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data = fread($f, filesize($file));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = unserialize($data);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //barf<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result = null;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $result;<br />
}<br />
<br />
//just to set a few options for setting where to save stuff<br />
function tFindCache($cacheName) {<br />
&nbsp;&nbsp;&nbsp; if (isset($_ENV['PHP_CACHE_PATH'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $cachePath = $_ENV['PHP_CACHE_PATH'];<br />
&nbsp;&nbsp;&nbsp; } else if (isset($_SERVER['PHP_CACHE_PATH'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $cachePath = $_SERVER['PHP_CACHE_PATH'];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $cachePath = './'; //Potential danger here<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $cachePath .= 'PHP_CACHE_' . $cacheName . '.cache';<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $cachePath;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47809""></a>
  <div class="note">
   
   <a href="#47809" class="date">01-Dec-2004 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is just a modification of what Alan Reddan (areddan at silverarm dot ie) posted below.<br />
<br />
I figured it would be faster than walking an array, and it works wonderfully with cookies<br />
<br />
<span class="default">&lt;?php<br />
$data</span><span class="keyword">[</span><span class="default">qwerty</span><span class="keyword">] = </span><span class="string">"blah"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">a</span><span class="keyword">] = </span><span class="string">"1aa"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">b</span><span class="keyword">] = </span><span class="string">"2bb"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">c</span><span class="keyword">] = </span><span class="string">";;;;;;"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">name</span><span class="keyword">][</span><span class="default">first</span><span class="keyword">] = </span><span class="string">"Bob"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">name</span><span class="keyword">][</span><span class="default">last</span><span class="keyword">] = </span><span class="string">"Jones"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">val</span><span class="keyword">] = </span><span class="string">"This is a real long test string, to see how well the compression works!"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//To Serialise Call :<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">), </span><span class="default">9</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"my_var"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()+</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">);<br />
</span><span class="comment">//print "String: $string\n&lt;br&gt;"; //uncomment to see serialized array<br />
<br />
//To Unserialize Call<br />
</span><span class="keyword">if (isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">my_var</span><span class="keyword">])) {<br />
&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">gzuncompress</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">my_var</span><span class="keyword">]));<br />
<br />
&nbsp; echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
you can replace gzcompress with base64_encode and gzuncompress with base64_decode to have a similar experience<br />
<br />
Alan, thanks for the tip though, it got me where I wanted to be!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47509""></a>
  <div class="note">
   <strong class="user">paul at moveNOtoSPAMiceland DOT com</strong>
   <a href="#47509" class="date">18-Nov-2004 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was trying to submit a serialized array through a hidden form field using POST and was having a lot of trouble with the quotes. I couldn't figure out a way to escape the quotes in the string so that they'd show up right inside the form, so only the characters up to the first set of quotes were being sent.<br />
<br />
My solution was to base64_encode() the string, put that in the hidden form field, and send that through the POST method. Then I decoded it (using base64_decode()) on the other end. This seemed to solve the problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46816""></a>
  <div class="note">
   <strong class="user">Alexei dot Filine at cern dot ch</strong>
   <a href="#46816" class="date">24-Oct-2004 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple way to transfer PHP variables between PHP scripts running on different hosts can be done with HTTP_Request PEAR module. I think it is much more fast way than one done with XML-RPC but less portable (there were described ways to exchange vars between Perl and PHP below). Recieved PHP obects are required to be created before recieving by class definition similar to definition used on sending side. A script sending variable must output nothing except data sent by function 'sendVariable' so a 'composite variable' is to be used to transfer some variables by one request.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// exchange-protocol.php<br />
</span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">'include_path'</span><span class="keyword">, </span><span class="string">'.' </span><span class="keyword">);<br />
require_once </span><span class="string">"config.php"</span><span class="keyword">; </span><span class="comment">// set $PEAR_path<br />
</span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">'include_path'</span><span class="keyword">, </span><span class="default">ini_get</span><span class="keyword">( </span><span class="string">'include_path' </span><span class="keyword">).</span><span class="default">$PEAR_path </span><span class="keyword">);<br />
<br />
</span><span class="comment">// PEAR module<br />
</span><span class="keyword">require_once </span><span class="string">"HTTP/Request.php"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// magic words for HTTP header<br />
</span><span class="default">$gzcompressed_serialized_type </span><span class="keyword">= </span><span class="string">'application/serialized_gzcompressed_PHP_variable'</span><span class="keyword">;<br />
</span><span class="default">$serialized_type </span><span class="keyword">= </span><span class="string">'application/serialized_PHP_variable'</span><span class="keyword">;<br />
<br />
</span><span class="default">$compression_flag_name </span><span class="keyword">= </span><span class="string">'_compressionFlag_'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Date in the past<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">"Expires: Mon, 26 Jul 1997 05:00:00 GMT" </span><span class="keyword">);<br />
<br />
</span><span class="comment">// always modified<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">"Last-Modified: "</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">( </span><span class="string">"D, d M Y H:i:s" </span><span class="keyword">).</span><span class="string">" GMT" </span><span class="keyword">);<br />
<br />
</span><span class="comment">// returns non-zero on success<br />
</span><span class="keyword">function </span><span class="default">recieveVariable</span><span class="keyword">( </span><span class="default">$url</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;</span><span class="default">$var</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$passw </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$compression_flag </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$gzcompressed_serialized_type</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$serialized_type</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">=&amp; new </span><span class="default">HTTP_Request</span><span class="keyword">( </span><span class="string">"" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">setURL</span><span class="keyword">( </span><span class="default">$url </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">setMethod</span><span class="keyword">( </span><span class="default">HTTP_REQUEST_METHOD_POST </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// set user/password if required<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$user </span><span class="keyword">&amp;&amp; </span><span class="default">$passw </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">addPostData</span><span class="keyword">( </span><span class="default">$user</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$passw </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">sendRequest</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">clearPostData</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$compression_flag </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">addPostData</span><span class="keyword">( </span><span class="default">$compression_flag_name</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ( </span><span class="default">PEAR</span><span class="keyword">::</span><span class="default">isError</span><span class="keyword">( </span><span class="default">$response </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$response</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">getResponseHeader</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">getResponseCode</span><span class="keyword">() != </span><span class="default">200 </span><span class="keyword">||<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ! ( </span><span class="default">$header</span><span class="keyword">[</span><span class="string">'content-type'</span><span class="keyword">] == </span><span class="default">$gzcompressed_serialized_type </span><span class="keyword">||<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header</span><span class="keyword">[</span><span class="string">'content-type'</span><span class="keyword">] == </span><span class="default">$serialized_type </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// type error message<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">getResponseBody</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$header</span><span class="keyword">[</span><span class="string">'content-type'</span><span class="keyword">] == </span><span class="default">$gzcompressed_serialized_type </span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">gzuncompress</span><span class="keyword">( </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">getResponseBody</span><span class="keyword">() );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$req</span><span class="keyword">-&gt;</span><span class="default">getResponseBody</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// just for extra flexibility, if data chunk is small enough we can skip gzipping on the sending side: $compression_flag = 0;<br />
// in other case we use client preference: $compression_flag = $_REQUEST[$compression_flag_name];<br />
</span><span class="keyword">function </span><span class="default">sendVariable</span><span class="keyword">( &amp;</span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compression_flag </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$gzcompressed_serialized_type</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$serialized_type</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Date in the past<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">"Expires: Mon, 26 Jul 1997 05:00:00 GMT" </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// always modified<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">"Last-Modified: "</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">"D, d M Y H:i:s"</span><span class="keyword">).</span><span class="string">" GMT"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$compression_flag </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// set specialised content type to inform about data type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'content-type: '</span><span class="keyword">.</span><span class="default">$gzcompressed_serialized_type </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">gzcompress</span><span class="keyword">( </span><span class="default">serialize</span><span class="keyword">( </span><span class="default">$var </span><span class="keyword">) );<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// set specialised content type to inform about data type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'content-type: '</span><span class="keyword">.</span><span class="default">$serialized_type </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">serialize</span><span class="keyword">( </span><span class="default">$var </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
on client side:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">...<br />
require_once </span><span class="string">"exchange-protocol.php"</span><span class="keyword">;<br />
...<br />
if (</span><span class="default">recieveVariable</span><span class="keyword">( </span><span class="default">$url</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// success...<br />
</span><span class="keyword">} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// there was something wrong...<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
on the server side:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">...<br />
require_once </span><span class="string">"exchange-protocol.php"</span><span class="keyword">;<br />
...<br />
</span><span class="comment">// there must not be output before the function is called!!! execution is to 'die' if an error occures.<br />
</span><span class="default">sendVariable</span><span class="keyword">( </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compression_flag </span><span class="keyword">)<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46788""></a>
  <div class="note">
   <strong class="user">areddan at silverarm dot ie</strong>
   <a href="#46788" class="date">23-Oct-2004 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
This is an array_walk style serialize that works with multi dimensional arrays, it also base64 encodes and decodes to allow ';' to exist in the array.<br />
&nbsp;-- Alan Reddan <br />
*/<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">qwerty</span><span class="keyword">] = </span><span class="string">"blah"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">a</span><span class="keyword">] = </span><span class="string">"1aa"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">b</span><span class="keyword">] = </span><span class="string">"2bb"</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">c</span><span class="keyword">] = </span><span class="string">";;;;;;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//To Serialise Call :<br />
<br />
</span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="string">'base64_encoder_multi'</span><span class="keyword">);<br />
</span><span class="default">$serialized_string </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="comment">//print $serialized_string . '\n'; //uncomment to see serialized array<br />
<br />
//To Unserialize Call<br />
<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serialized_string</span><span class="keyword">);<br />
</span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">,</span><span class="string">'base64_cleaner_multi'</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="comment">//start functions<br />
</span><span class="keyword">function </span><span class="default">base64_encoder_multi</span><span class="keyword">(&amp;</span><span class="default">$val</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) </span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">,</span><span class="string">'base64_encoder_multi'</span><span class="keyword">,</span><span class="default">$new</span><span class="keyword">);<br />
&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">base64_cleaner_multi</span><span class="keyword">(&amp;</span><span class="default">$val</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) </span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">,</span><span class="string">'base64_cleaner_multi'</span><span class="keyword">,</span><span class="default">$new</span><span class="keyword">);<br />
&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="comment">//ends<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46313""></a>
  <div class="note">
   <strong class="user">brooklynphil hotmail com</strong>
   <a href="#46313" class="date">06-Oct-2004 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my experience of the (far and few in between) times when it is necessary to store large (megabytes) amounts of data in a php-readable ascii file format, using var_export() and require() is much faster serialize() and unserialize(file_get_contents()) (I have tested it on classes encapsulating arrays, i.e. <span class="default">&lt;?php </span><span class="keyword">class </span><span class="default">blah </span><span class="keyword">{ </span><span class="default">$a </span><span class="keyword">= array(</span><span class="default">megsofstuffhere</span><span class="keyword">); </span><span class="default">$b </span><span class="keyword">= array(</span><span class="default">megsofstuffhere</span><span class="keyword">); </span><span class="default">$c</span><span class="keyword">=... }; </span><span class="default">$data </span><span class="keyword">= new </span><span class="default">blah ?&gt;</span>)&nbsp;&nbsp; (var_export is also more readable and notepadable than serialize!)<br />
<br />
However, since var_export produces only the rvalue (or uninstantiation), of the data needed, dont forget to cosmetically modify output of var_export( , true): in case of classes, you will need to use "$var = new classname" (and rename a possible stdClass) and in case of arrays, etc, just use "$var = ".var_export().&nbsp; The file being var_export()ed to and require()ed must also be encapculated in "<span class="default">&lt;?php ?&gt;</span>" when written to (or else its just dumped to browser/stdout as a textfile).<br />
<br />
Hope this helps :)<br />
<br />
--Phil<br />
<br />
P.S. (in cases of small amounts of data, serialize is better, especially for cross-URL data transport using <span class="default">&lt;?php base64_encode</span><span class="keyword">(</span><span class="default">gzdeflate</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">()))</span><span class="default">?&gt;</span>)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46269""></a>
  <div class="note">
   <strong class="user">jan at bestbytes dot de</strong>
   <a href="#46269" class="date">05-Oct-2004 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This should be EXTREMELY helpful when you are getting lost in php 4 circular references and sessions or serializing ...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// this example is for php 4<br />
<br />
</span><span class="keyword">class </span><span class="default">Node </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$child</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$parent</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$load</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$__destroyed </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; function </span><span class="default">Node</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$load</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">load </span><span class="keyword">= </span><span class="default">$load</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">setParent</span><span class="keyword">(&amp;</span><span class="default">$parent</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parent </span><span class="keyword">= &amp;</span><span class="default">$parent</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">setChild</span><span class="keyword">(&amp;</span><span class="default">$child</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">child </span><span class="keyword">= &amp;</span><span class="default">$child</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; </span><span class="comment">/**<br />
&nbsp; * @return void<br />
&nbsp; * @desc fake __destroy from a php 4 point of view<br />
&nbsp; */<br />
&nbsp; </span><span class="keyword">function </span><span class="default">__destroy</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$props </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$props </span><span class="keyword">as </span><span class="default">$propName </span><span class="keyword">=&gt; </span><span class="default">$propValue</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; unset(</span><span class="default">$propValue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$propName</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$propName</span><span class="keyword">, </span><span class="string">'__destroy'</span><span class="keyword">) AND </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$propName</span><span class="keyword">-&gt;</span><span class="default">__destroyed </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$propName</span><span class="keyword">-&gt;</span><span class="default">__destroy</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$propName</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$propName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: text/plain'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// small load to check the serialized string<br />
</span><span class="default">$loadSize </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;<br />
<br />
</span><span class="comment">// big load to check leaking<br />
//$loadSize = 32 * 1024;<br />
<br />
</span><span class="default">$load&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$loadSize</span><span class="keyword">);<br />
<br />
for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">10</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp; echo </span><span class="string">'-------------------- '</span><span class="keyword">.(</span><span class="default">memory_get_usage</span><span class="keyword">()/</span><span class="default">1024</span><span class="keyword">).</span><span class="string">' -------------------------'</span><span class="keyword">.</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">$serMe </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">] =&amp; new </span><span class="default">Node</span><span class="keyword">(</span><span class="string">'parent'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">]&nbsp; =&amp; new </span><span class="default">Node</span><span class="keyword">(</span><span class="string">'child'</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; * this will work too !!<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $serMe['parent'] = new Node('parent');<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $serMe['child']&nbsp; = new Node('child');<br />
&nbsp;&nbsp; */<br />
<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]-&gt;</span><span class="default">setChild</span><span class="keyword">(</span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">]-&gt;</span><span class="default">setParent</span><span class="keyword">(</span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]);<br />
&nbsp; <br />
&nbsp; <br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$serMe</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; * 1.Problem:<br />
&nbsp;&nbsp; * <br />
&nbsp;&nbsp; * You have 2 or more objects with circular references to one another.<br />
&nbsp;&nbsp; * Serializing these objects will result in unexpected behaviour when<br />
&nbsp;&nbsp; * unserializing them:<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * Former references will become copies.<br />
&nbsp;&nbsp; * <br />
&nbsp;&nbsp; * This is because the php serialize handler can not handle references,<br />
&nbsp;&nbsp; * unless all involved objects, variables ... are within an array(),<br />
&nbsp;&nbsp; * that will be serialized.<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * This should be selfexplaining (just take a look at the length ...):<br />
&nbsp;&nbsp; * echo serialize($serMe['parent']);<br />
&nbsp;&nbsp; * echo serialize($serMe);<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * results in:<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * O:4:"node":5:{s:5:"value";s:6:"parent";s:5:"child";O:4:"node<br />
&nbsp;&nbsp; * ":5:{s:5:"value";s:5:"child";s:5:"child";N;s:6:"parent";O:4:<br />
&nbsp;&nbsp; * "node":5:{s:5:"value";s:6:"parent";s:5:"child";R:3;s:6:"pare<br />
&nbsp;&nbsp; * nt";N;s:4:"load";s:4:"....";s:11:"__destroyed";b:0;}s:4:"loa<br />
&nbsp;&nbsp; * d";s:4:"....";s:11:"__destroyed";b:0;}s:6:"parent";N;s:4:"lo<br />
&nbsp;&nbsp; * ad";s:4:"....";s:11:"__destroyed";b:0;}<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * a:2:{s:6:"parent";O:4:"node":5:{s:5:"value";s:6:"parent";s:5<br />
&nbsp;&nbsp; * :"child";O:4:"node":5:{s:5:"value";s:5:"child";s:5:"child";N<br />
&nbsp;&nbsp; * ;s:6:"parent";R:2;s:4:"load";s:4:"....";s:11:"__destroyed";b<br />
&nbsp;&nbsp; * :0;}s:6:"parent";N;s:4:"load";s:4:"....";s:11:"__destroyed";<br />
&nbsp;&nbsp; * b:0;}s:5:"child";R:4;}<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * PLEASE GIVE THE WORLD PROPER DOCUMENTATION ON THIS (or prove us wrong)<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * 2.Problem:<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * The loop below will result in extensive leaking (use the big $loadsize ...),<br />
&nbsp;&nbsp; * unless you help yourself and unset all the properties manually<br />
&nbsp;&nbsp; * see Node::__destroy()<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; */<br />
&nbsp;<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]-&gt;</span><span class="default">__destroy</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">]-&gt;</span><span class="default">__destroy</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$serMe </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; unset(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="string">'new parent'</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">'--&gt;'</span><span class="keyword">.</span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]-&gt;</span><span class="default">child</span><span class="keyword">-&gt;</span><span class="default">parent</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">.</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">'--&gt;'</span><span class="keyword">.</span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]-&gt;</span><span class="default">value</span><span class="keyword">.</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'parent'</span><span class="keyword">]-&gt;</span><span class="default">__destroy</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$serMe</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">]-&gt;</span><span class="default">__destroy</span><span class="keyword">();<br />
&nbsp; unset(</span><span class="default">$serMe</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45815""></a>
  <div class="note">
   <strong class="user">mary at nospam dot com</strong>
   <a href="#45815" class="date">20-Sep-2004 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use serialize() to easily convert an array to a sort of string which you can add to a URL, pay attention to the length of the serialized array.<br />
A URL has a limit when it comes to passing variables and values and it cuts off whatever is over limit. If your serialized array is too long, it will be cut off and you will end up with strange results on your other pages.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44993""></a>
  <div class="note">
   <strong class="user">jasbarne NOSPAM indiana SPAMSUCKS edu</strong>
   <a href="#44993" class="date">22-Aug-2004 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ignatiev at users dot sourceforge dot net and others using __sleep():<br />
<br />
If you decide to add this functionality (for whatever reason) you can serialize a modified copy of the object instead of the original object.&nbsp; There's added overhead of copying, but doing this allows you to continue using the original object after you've serialize it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44637""></a>
  <div class="note">
   <strong class="user">goetas at lignano dot it - GoetAs</strong>
   <a href="#44637" class="date">11-Aug-2004 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the serialize dont function properly when a variable contain a ; <br />
I wrote these two functions that resolve this problem:<br />
this function work only with arrays:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">base64_unserialize</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ary </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$ary</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ary </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">))){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ritorno</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]=</span><span class="default">base64_unserialize</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ritorno</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]=</span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ritorno</span><span class="keyword">;<br />
}<br />
function </span><span class="default">base64_serialize</span><span class="keyword">(</span><span class="default">$ary</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$ary</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ary </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ritorno</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]=</span><span class="default">base64_serialize</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ritorno</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]=</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">serialize </span><span class="keyword">(</span><span class="default">$ritorno</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43664""></a>
  <div class="note">
   <strong class="user">Andrew dot Morrison at stanford dot edu</strong>
   <a href="#43664" class="date">29-Jun-2004 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction to my last note:<br />
<br />
__sleep should return an array only containing the names of instance-variables to serialize.<br />
<br />
A simple (if not a little wasteful) hack to serialize all but a few class vars is to use get_class_vars as follows:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">strawman<br />
</span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$good_var</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$lame_var</span><span class="keyword">;<br />
<br />
&nbsp; function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Function __sleep() called\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$vars </span><span class="keyword">= </span><span class="default">get_class_vars</span><span class="keyword">(</span><span class="string">'strawman'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$vars</span><span class="keyword">[</span><span class="string">'lame_var'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$vars</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; function </span><span class="default">__wakeup</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp; print </span><span class="string">"Function __wakeup() called\n"</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; function </span><span class="default">strawman</span><span class="keyword">() { }<br />
}<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
if(</span><span class="default">session_is_registered</span><span class="keyword">(</span><span class="string">'strawman'</span><span class="keyword">))<br />
{<br />
&nbsp; print(</span><span class="string">"session data:\n"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'strawman'</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
}<br />
<br />
else<br />
{<br />
&nbsp; </span><span class="default">$strawman </span><span class="keyword">=&amp; new </span><span class="default">strawman</span><span class="keyword">();<br />
&nbsp; </span><span class="default">session_register</span><span class="keyword">(</span><span class="string">'strawman'</span><span class="keyword">);<br />
&nbsp; print(</span><span class="string">"new session data:\n"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'strawman'</span><span class="keyword">]);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41948""></a>
  <div class="note">
   <strong class="user">dr dot slump at cyteknt dot com</strong>
   <a href="#41948" class="date">27-Apr-2004 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
regarding PHP to JS serialization I did some time ago a function which works using "eval" as Harry points out.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//helper function, returns true if the array is associative<br />
</span><span class="keyword">function </span><span class="default">is_assoc_array</span><span class="keyword">( </span><span class="default">$var </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//false if not an array or empty<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) || (!</span><span class="default">count</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) ) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$var </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (! </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">)) return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Serialize function which generates JavaScript's eval's compatible code.<br />
<br />
Usage (JavaScript) :<br />
var myVar = eval('<span class="default">&lt;?php js_serialize</span><span class="keyword">(</span><span class="default">$phpvar</span><span class="keyword">); </span><span class="default">?&gt;</span>');<br />
&nbsp;&nbsp;&nbsp; <br />
Notes:<br />
Objects and associative arrays are encoded as JS Objects&nbsp; &nbsp; <br />
Doesn't serialize object methods<br />
Serializes 'resource' types as nulls<br />
Assoc. Arrays containing integer keys, those keys are prefixed with 'idx_'<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">js_serialize</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">$recursed </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) || </span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) return </span><span class="string">'null'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//object or assoc. array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) || </span><span class="default">is_assoc_array</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//typecast to array in the case it could be an object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$props </span><span class="keyword">= (array)</span><span class="default">$var</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$props </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//index values are preffixed with 'idx_'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">)) </span><span class="default">$k </span><span class="keyword">= </span><span class="string">"idx_</span><span class="default">$k</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">.= </span><span class="default">$k</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">js_serialize</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">).</span><span class="string">','</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$props</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$js</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$js</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="string">'{'</span><span class="keyword">.</span><span class="default">$js</span><span class="keyword">.</span><span class="string">'}'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (! </span><span class="default">$recursed</span><span class="keyword">) </span><span class="default">$js </span><span class="keyword">= </span><span class="string">"(</span><span class="default">$js</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$var </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">.= </span><span class="default">js_serialize</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">).</span><span class="string">","</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$js</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$js</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="string">"[</span><span class="default">$js</span><span class="string">]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//escape the string<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">( array(</span><span class="string">'"'</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">), array(</span><span class="string">'\\"'</span><span class="keyword">, </span><span class="string">'\\n'</span><span class="keyword">), </span><span class="default">$var </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="default">$recursed </span><span class="keyword">? </span><span class="string">"\"</span><span class="default">$var</span><span class="string">\"" </span><span class="keyword">: </span><span class="string">"(new String(\"</span><span class="default">$var</span><span class="string">\"))"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= (</span><span class="default">$var</span><span class="keyword">)?</span><span class="string">'true'</span><span class="keyword">:</span><span class="string">'false'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="default">$recursed </span><span class="keyword">? </span><span class="default">$var </span><span class="keyword">: </span><span class="string">"(new Boolean(</span><span class="default">$var</span><span class="string">))"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; } else { </span><span class="comment">//should be an int or a float in theory&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$js </span><span class="keyword">= </span><span class="default">$recursed </span><span class="keyword">? </span><span class="default">$var </span><span class="keyword">: </span><span class="string">"(new Number(</span><span class="default">$var</span><span class="string">))"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$js</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41775""></a>
  <div class="note">
   <strong class="user">hfuecks at phppatterns dot com</strong>
   <a href="#41775" class="date">21-Apr-2004 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding serializing PHP data types to Javascript, following Ivans note below, theres an example at <a href="http://www.tekool.net/php/js_serializer/." rel="nofollow" target="_blank">http://www.tekool.net/php/js_serializer/.</a><br />
<br />
The basic serialization looks good although, in its current form, it works on the basis of generating Javascript source which a browser executes as a page loads. Using Javascripts eval() the same can be done with strings containing Javascript if youre working with something like XMLHTTPRequest</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41703""></a>
  <div class="note">
   <strong class="user">Antonie</strong>
   <a href="#41703" class="date">20-Apr-2004 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Passing of multiple select (single dimensional or even multidimensional) arrays is even harder, even using serialize.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39710""></a>
  <div class="note">
   <strong class="user">Jouhni [jouhni at web dot de]</strong>
   <a href="#39710" class="date">08-Feb-2004 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to save serialized values in cookies you have to pay attention to the following:<br />
A serialized array looks like this:<br />
<br />
a:2:{i:0;s:9:"Element 1";i:1;s:9:"Element 2";}<br />
<br />
Because quotation marks are saved with a backslash in front of it in cookies it is not possible to unserialize a cookie-saved serialized array. You have to do a stripslashes() before unserializing the cookie.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39685""></a>
  <div class="note">
   <strong class="user">info at b1g dot de</strong>
   <a href="#39685" class="date">07-Feb-2004 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using Cache_Lite from pear.php.net and if you are logging in your users using cookies, use this cache-ID for example:<br />
<br />
<span class="default">&lt;?php<br />
$cache_id </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">] . </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
This will create a new page in cache when a user logs in. Anyway he can't login properly. Works fine for me.<br />
<br />
Sorry for my broken English.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37727""></a>
  <div class="note">
   <strong class="user">tino at infeon dot com</strong>
   <a href="#37727" class="date">24-Nov-2003 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While writing shopping cart applications i needed a way to keep track of many variables beteween page loads.. i was using a cookie for each but this became hard to manage so I cam up with this simple session object. It serializes the object, base 64 encodes it and sets a cookie for it.. vice versa on page load where it detects the cookie<br />
<br />
add whatever variables you need to this class <br />
<br />
btw if you like it, hate it or have any comments send me an email to let me know<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">session </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$cartID</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$userID</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$userAuth</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">session </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Attempt to load previous session from user cookie<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //First see if the session was passed through the URL<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //This is useful to pass stuff between different URL<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'session'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">= </span><span class="default">unserialize </span><span class="keyword">(</span><span class="default">base64_decode </span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'session'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Check for the cookie, if none a blank session is created<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'session'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">= </span><span class="default">unserialize </span><span class="keyword">(</span><span class="default">base64_decode </span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'session'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">save </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie </span><span class="keyword">(</span><span class="string">'session'</span><span class="keyword">, </span><span class="default">base64_encode </span><span class="keyword">(</span><span class="default">serialize </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">delete </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie </span><span class="keyword">(</span><span class="string">'session'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset (</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36828""></a>
  <div class="note">
   <strong class="user">ignatiev at users dot sourceforge dot net</strong>
   <a href="#36828" class="date">23-Oct-2003 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One problem with serialize() is that by default it does NOT alter the object, so nothing prevents you from continuing using you object after serialize()'ing it.<br />
<br />
After a while, you or someone else decides to optimize storage of this object and add a __sleep and __wakeup functions; now, serialize()'ing this same class calls __sleep() member function, potentially changing the object - old code unexpectedly breaks.<br />
<br />
Possible solutions: in the above scenario old code would most likely still work if __sleep() only creates new object variables, not altering existing ones.&nbsp; Another option is to always call __wakeup(), if it exists, after each serialize(), or immediately destroy the object if it is no longer used.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35781""></a>
  <div class="note">
   <strong class="user">iam4webwork at hotmail dot com</strong>
   <a href="#35781" class="date">14-Sep-2003 05:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think an example is in order to specify what is meant by "returns a string containing a byte-stream representation of value that can be stored anywhere."<br />
<br />
Here's an example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">serialize</span><span class="keyword">(</span><span class="string">"php"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Result is as follows:<br />
<br />
s:3:"php";<br />
<br />
The cryptic result is a string indicating that the serialized data is itself a string of 3 bytes whose value is "php".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34534""></a>
  <div class="note">
   <strong class="user">james at gogo dot co dot nz</strong>
   <a href="#34534" class="date">30-Jul-2003 03:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just spent an hour rifling through code to find the cause of a problem<br />
only to find it's an oddity with serialization and recursive objects, so<br />
figured I'd post for the next person who gets the same problem.<br />
<br />
********************************* Symptoms *********************************<br />
When unserializing a previously serialized object, the __wakeup() function<br />
is mysteriously called more than once, and the accessing the objects<br />
properties from the "outside" gives different results than accessing them<br />
from an object contained within the object and holding&nbsp; a recursive<br />
reference to the object.<br />
<br />
********************************** Example *********************************<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo2 </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">foo2</span><span class="keyword">(&amp;</span><span class="default">$foo</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">=&amp; </span><span class="default">$foo</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">fooName</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'foo2 thinks foo-&gt;name is ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">foo </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$name&nbsp; </span><span class="keyword">= </span><span class="string">'unnamed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$foo2 </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">foo</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo2 </span><span class="keyword">=&amp; new </span><span class="default">foo2</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">fooName</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'foo thinks foo-&gt;name is ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__wakeup</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"foo is waking up&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$myFoo&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&amp; new </span><span class="default">foo</span><span class="keyword">();<br />
</span><span class="default">$myFoo</span><span class="keyword">-&gt;</span><span class="default">name&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'myFoo'</span><span class="keyword">;<br />
echo </span><span class="string">"I think foo-&gt;name is </span><span class="keyword">{</span><span class="default">$myFoo</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">}</span><span class="string">.&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$myFoo</span><span class="keyword">-&gt;</span><span class="default">fooName</span><span class="keyword">();<br />
</span><span class="default">$myFoo</span><span class="keyword">-&gt;</span><span class="default">foo2</span><span class="keyword">-&gt;</span><span class="default">fooName</span><span class="keyword">();<br />
<br />
</span><span class="default">$serializedFoo </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$myFoo</span><span class="keyword">);<br />
</span><span class="default">$myNewFoo&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serializedFoo</span><span class="keyword">);<br />
<br />
</span><span class="default">$myNewFoo</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">'myNewFoo'</span><span class="keyword">;<br />
echo </span><span class="string">"I think foo-&gt;name is </span><span class="keyword">{</span><span class="default">$myNewFoo</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">}</span><span class="string">.&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$myNewFoo</span><span class="keyword">-&gt;</span><span class="default">fooName</span><span class="keyword">();<br />
</span><span class="default">$myNewFoo</span><span class="keyword">-&gt;</span><span class="default">foo2</span><span class="keyword">-&gt;</span><span class="default">fooName</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
********************************** Analysis ********************************<br />
execution of the example produces...<br />
<br />
I think foo-&gt;name is myFoo.<br />
foo thinks foo-&gt;name is myFoo<br />
foo2 thinks foo-&gt;name is myFoo<br />
foo is waking up<br />
foo is waking up<br />
I think foo-&gt;name is myNewFoo.<br />
foo thinks foo-&gt;name is myNewFoo<br />
foo2 thinks foo-&gt;name is myFoo<br />
<br />
We can see that the first three lines are as expected, however we see<br />
__wakeup is happening twice, and then the final line is in error as foo2<br />
apparently does not see the changed name.<br />
<br />
What is happening is that there are actually two seperate foo objects being<br />
deserialized, the "top level one" and the one that was originally<br />
referenced in foo2, that is, the reference is not being serialized as a<br />
reference but rather a whole object.&nbsp; This is evident in the two __wakeup()<br />
calls, there are two foo objects being woken up.<br />
<br />
******************************** Solution **********************************<br />
The solution is very simple, when serializing it is necessary to force the <br />
passing of a reference to the top-level object being serialized thus..<br />
<br />
$serializedFoo = serialize(&amp;$myFoo);<br />
<br />
with that form of the serialization (note the ampersand to force passing of<br />
reference), the example produces the following..<br />
<br />
I think foo-&gt;name is myFoo.<br />
foo thinks foo-&gt;name is myFoo<br />
foo2 thinks foo-&gt;name is myFoo<br />
foo is waking up<br />
I think foo-&gt;name is myNewFoo.<br />
foo thinks foo-&gt;name is myNewFoo<br />
foo2 thinks foo-&gt;name is myNewFoo<br />
<br />
We note now there is only one __wakeup() call being made and that all<br />
parties agree on the name property of the foo object.<br />
<br />
******************************** Notes ************************************<br />
I was of the belief that ampersand's in the arguments to functions was<br />
deprecated in favour of ampersands in the function's parameter list<br />
declaration (i.e instead of "blah(&amp;$my_thing)" we declare blah as "function<br />
blah(&amp;$your_thing) {...}"), however this required use of serialize seems to<br />
contravene this deprecation as it is plainly necessary to use the ampersand<br />
in the function call here.&nbsp; Perhaps this is a hold-over from earlier times<br />
and will be changed in the future ?<br />
<br />
-- <br />
James Sleeman (<a href="http://www.gogo.co.nz/" rel="nofollow" target="_blank">http://www.gogo.co.nz/</a>)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34218""></a>
  <div class="note">
   <strong class="user">dan at mojavelinux dot com</strong>
   <a href="#34218" class="date">18-Jul-2003 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to safely unserialize a complex object in any context, it is wise to save two files at the time of serialization (or save the file in two parts).&nbsp; One file will contain the result of get_included_files() at the time of serialization and the other file contains the serialized version of the object.&nbsp; To unserialize, simply read in the included file list and call include_once on all of those files and then call unserialize on your object data.<br />
<br />
While this may be slightly inefficient because certain files that were included are no longer needed (maybe they were only needed when creating the object), at least you can be sure the object data is going to come out of serialization okay.<br />
<br />
Note: If you stick to the convention of classes beginning with uppercase (and the filenames following the classnames) then you can even filter the get_included_files() list to get only the class definition files.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32965""></a>
  <div class="note">
   <strong class="user">webmaster at feeltong dot com</strong>
   <a href="#32965" class="date">12-Jun-2003 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People usually use 'hidden' fields when they submit some variables from previous step to the next step even if they have so many varibles to send. It will look like following form.<br />
<br />
&lt;form name='tmpForm' method='post' action='nextStep.php'&gt;<br />
&lt;input type='hidden' name='var[name]' value='&lt;?=$var[name]?&gt;'&gt;<br />
&lt;input type='hidden' name='var[id]' value='&lt;?=$var[id]?&gt;'&gt;<br />
&lt;input type='hidden' name='var[address]' value='&lt;?=$var[address]?&gt;'&gt;<br />
&lt;input type='hidden' name='var[age]' value='&lt;?=$var[age]?&gt;'&gt;<br />
&lt;input type='hidden' name='var[gender]' value='&lt;?=$var[gender]?&gt;'&gt;<br />
&lt;input type='hidden' name='var[car]' value='&lt;?=$var[car]?&gt;'&gt;<br />
.<br />
.<br />
.<br />
&lt;/form&gt;<br />
<br />
Look at the following codes. It is more simplified. I'd better use base64_encode and serialize than stripslashes and serialize.<br />
<br />
&lt;form name='tmpForm' method='post' action='nextStep.php'&gt;<br />
&lt;input type='hidden' name='var' value='&lt;?=base64_encode(serialize($var))?&gt;'&gt;<br />
&lt;/form&gt;<br />
<br />
Have Fun !!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31331""></a>
  <div class="note">
   <strong class="user">rodrigo at ditech dot com dot br</strong>
   <a href="#31331" class="date">17-Apr-2003 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi!<br />
If you wanna save all the POST data and reload it again in another time... you can use this: <br />
(Thanks for my_stripslashes() function ;-)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// saving POST<br />
</span><span class="keyword">if (</span><span class="default">$REQUEST_METHOD</span><span class="keyword">==</span><span class="string">"POST"</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"postData.txt"</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);&nbsp; <br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">));<br />
&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// reloading POST and passing to variables<br />
</span><span class="keyword">if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="string">"postData.txt"</span><span class="keyword">)) {<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="string">"postData.txt"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">my_stripslashes</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// catches it in some message above<br />
&nbsp; </span><span class="default">$postData </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">extract</span><span class="keyword">(</span><span class="default">$postData</span><span class="keyword">, </span><span class="default">EXTR_OVERWRITE</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Now you have all variables from old POST in your actual script.<br />
Well useful when you have a great form very used and of course, DEPENDING of your tool.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29079""></a>
  <div class="note">
   <strong class="user">pli9 at itsa dot ucsf dot edu</strong>
   <a href="#29079" class="date">31-Jan-2003 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have also written some code for importing serialized PHP data into PERL and then writing it back into PHP.&nbsp; I think the similar library posted above is actually more robust for a few select cases, but mine is more compact and a little easier to follow.&nbsp; I'd really like comments if anyone finds this useful or has improvements.&nbsp; Please credit me if you use my code.<br />
<br />
<a href="http://www.hcs.harvard.edu/~pli/code/serialPHP.pm" rel="nofollow" target="_blank">http://www.hcs.harvard.edu/~pli/code/serialPHP.pm</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20034""></a>
  <div class="note">
   <strong class="user">kjh90 at orgio dot net</strong>
   <a href="#20034" class="date">20-Mar-2002 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to put serialized data into DB, you have to add slashes.<br />
At this point, there's a problem. If you got data via HTTP POST method, the data has slashes already. I tried to work with "array_walk" or "array_map", but it doesn't work when the data has array. <br />
So make extended stripslashes function. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">my_stripslashes</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$vals</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">my_stripslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$vals </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$vals</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">));<br />
...<br />
</span><span class="default">$SQL</span><span class="keyword">=</span><span class="string">"insert into DB() values(</span><span class="default">$data</span><span class="string">)"</span><span class="keyword">;<br />
...<br />
</span><span class="default">$SQL</span><span class="keyword">=</span><span class="string">"select data from DB"</span><span class="keyword">;<br />
...<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">my_stripslashes</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
...<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14111""></a>
  <div class="note">
   
   <a href="#14111" class="date">17-Jul-2001 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
BEWARE: if you serialize to store values on a database, and the variables you are serializing already have the " (double-quote) char, you may have a problem. After serializing you will have var delimiters as " and content " (double-quotes) escaped, but your databse may just treat them like the same. You end up with a failed unserialize. You want something like:<br />
<br />
a:5:{s:9:"this is a \"quote\"";a:1:{s:(ETC)<br />
<br />
And not:<br />
a:5:{s:9:"this is a "quote"";a:1:{s:(ETC)<br />
<br />
So just make sure you double escape content quotes ...<br />
<br />
It's simple, but i can't explain it any simpler =(</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13994""></a>
  <div class="note">
   <strong class="user">scott (at) hurring.com</strong>
   <a href="#13994" class="date">12-Jul-2001 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have written a perl module that does the same thing as PHP's serialize() and unserialize() commands so that Perl can now serialize and unserialize data in the same format as PHP. <br />
<br />
It's quite handy for storing information in databases or files (or anywhere, really) that both PHP and Perl scripts need to read from and write to. <br />
<br />
It supports string, double, integer, and array types (no object or reference support). <br />
<br />
It's free code, too. :) <br />
<br />
URL: <a href="http://hurring.com/code/perl/serialize/" rel="nofollow" target="_blank">http://hurring.com/code/perl/serialize/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13074""></a>
  <div class="note">
   <strong class="user">sbarnum at mac dot com</strong>
   <a href="#13074" class="date">24-May-2001 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having trouble with serialized strings, try this function.&nbsp; Pass it the name of an array whose value you want to include in hidden form inputs, a url, or session variable.&nbsp; Works with strings or multidimensional arrays.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//////////////////////////////////////////////<br />
&nbsp;&nbsp;&nbsp; // propogate v0.8 by sbarnum<br />
&nbsp;&nbsp;&nbsp; // method can be 'form' or 'url' or 'session'<br />
&nbsp;&nbsp;&nbsp; //////////////////////////////////////////////<br />
</span><span class="keyword">function </span><span class="default">propogate </span><span class="keyword">(</span><span class="default">$arrayName</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">=</span><span class="string">'form'</span><span class="keyword">, </span><span class="default">$arrayData</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$arrayData</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// custom values passed to array, use these instead of globals<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">${</span><span class="default">$arrayName</span><span class="keyword">} = </span><span class="default">$arrayData</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// use global values<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global ${</span><span class="default">$arrayName</span><span class="keyword">};<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"session"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_register</span><span class="keyword">(${</span><span class="default">$arrayName</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">reset</span><span class="keyword">(${</span><span class="default">$arrayName</span><span class="keyword">});<br />
&nbsp;&nbsp;&nbsp; while (list(</span><span class="default">$key</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">)=@</span><span class="default">each</span><span class="keyword">(${</span><span class="default">$arrayName</span><span class="keyword">})){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subArrayName </span><span class="keyword">= </span><span class="default">$arrayName </span><span class="keyword">. </span><span class="string">"[" </span><span class="keyword">. </span><span class="default">$key </span><span class="keyword">. </span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$html </span><span class="keyword">.= </span><span class="default">propogate </span><span class="keyword">(</span><span class="default">$subArrayName</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$method</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"form"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$html </span><span class="keyword">.= </span><span class="string">"&lt;INPUT type='hidden' name='"</span><span class="keyword">.</span><span class="default">$arrayName</span><span class="keyword">.</span><span class="string">"["</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">"]' value='"</span><span class="keyword">.</span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"'&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"url"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$html </span><span class="keyword">.= </span><span class="string">"&amp;"</span><span class="keyword">.</span><span class="default">$arrayName</span><span class="keyword">.</span><span class="string">"["</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">"]=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$html</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3918""></a>
  <div class="note">
   <strong class="user">MarkRoedel at letu dot edu</strong>
   <a href="#3918" class="date">21-Feb-2000 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A call to serialize() appears to mess with the array's internal pointer.&nbsp; If you're going to be walking through your array after serializing it, you'll want to make a call to reset() first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.print-r.html">print_r</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.settype.html">settype</a></div>
 <div class="up"><a href="ref.var.html">Variable handling Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
