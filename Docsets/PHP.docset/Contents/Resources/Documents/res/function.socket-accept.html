<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Accepts a connection on a socket</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="ref.sockets.html">Socket Functions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.socket-bind.html">socket_bind</a></div>
 <div class="up"><a href="ref.sockets.html">Socket Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.socket-accept" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_accept</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5)</p><p class="refpurpose"><span class="refname">socket_accept</span> &mdash; <span class="dc-title">Accepts a connection on a socket</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.socket-accept-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><b>socket_accept</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$socket</tt></span>
   )</div>

  <p class="para rdfs-comment">
   After the socket <i><tt class="parameter">socket</tt></i> has been created
   using <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span>, bound to a name with
   <span class="function"><a href="function.socket-bind.html" class="function">socket_bind()</a></span>, and told to listen for connections
   with <span class="function"><a href="function.socket-listen.html" class="function">socket_listen()</a></span>, this function will accept
   incoming connections on that socket. Once a successful connection
   is made, a new socket resource is returned, which may be used
   for communication. If there are multiple connections queued on
   the socket, the first will be used. If there are no pending
   connections, <span class="function"><b>socket_accept()</b></span> will block until
   a connection becomes present. If <i><tt class="parameter">socket</tt></i>
   has been made non-blocking using
   <span class="function"><a href="function.socket-set-blocking.html" class="function">socket_set_blocking()</a></span> or
   <span class="function"><a href="function.socket-set-nonblock.html" class="function">socket_set_nonblock()</a></span>, <b><tt>FALSE</tt></b> will be returned.
  </p>
  <p class="para">
   The socket resource returned by
   <span class="function"><b>socket_accept()</b></span> may not be used to accept new
   connections. The original listening socket
   <i><tt class="parameter">socket</tt></i>, however, remains open and may be
   reused.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-accept-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">socket</tt></i></span>
     <dd>

      <p class="para">
       A valid socket resource created with <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span>.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-accept-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a new socket resource on success, or <b><tt>FALSE</tt></b> on error. The actual
   error code can be retrieved by calling
   <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span>. This error code may be passed to
   <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span> to get a textual explanation of the
   error.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.socket-accept-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - Initiates a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-listen.html" class="function" rel="rdfs-seeAlso">socket_listen()</a> - Listens for a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-create.html" class="function" rel="rdfs-seeAlso">socket_create()</a> - Create a socket (endpoint for communication)</span></li>
    <li class="member"><span class="function"><a href="function.socket-bind.html" class="function" rel="rdfs-seeAlso">socket_bind()</a> - Binds a name to a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-strerror.html" class="function" rel="rdfs-seeAlso">socket_strerror()</a> - Return a string describing a socket error</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="83103""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#83103" class="date">09-May-2008 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to know the remote address ( ip address ) and the port of an incoming connection that has been accepted with socket_accept(), you can use socket_getpeername()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82618""></a>
  <div class="note">
   <strong class="user">Boylett</strong>
   <a href="#82618" class="date">18-Apr-2008 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to have multiple clients on a server you will have to use non blocking.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$clients </span><span class="keyword">= array();<br />
</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">,</span><span class="default">SOCK_STREAM</span><span class="keyword">,</span><span class="default">SOL_TCP</span><span class="keyword">);<br />
</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="string">'127.0.0.1'</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">);<br />
</span><span class="default">socket_listen</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
</span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
<br />
while(</span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$newc </span><span class="keyword">= </span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Client </span><span class="default">$newc</span><span class="string"> has connected\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$clients</span><span class="keyword">[] = </span><span class="default">$newc</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80691""></a>
  <div class="note">
   <strong class="user">lars at opdenkamp dot eu</strong>
   <a href="#80691" class="date">29-Jan-2008 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to make a daemon process that forks on each client connection, you'll find out that there's a bug in PHP. The child processes send SIGCHLD to their parent when they exit but the parent can't handle signals while it's waiting for socket_accept (blocking).<br />
<br />
Here is a piece of code that makes a non-blocking forking server.<br />
<br />
#!/usr/bin/php -q<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp; * Listens for requests and forks on each connection<br />
&nbsp; */<br />
<br />
</span><span class="default">$__server_listening </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">ob_implicit_flush</span><span class="keyword">();<br />
declare(</span><span class="default">ticks </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">become_daemon</span><span class="keyword">();<br />
<br />
</span><span class="comment">/* nobody/nogroup, change to your host's uid/gid of the non-priv user */<br />
</span><span class="default">change_identity</span><span class="keyword">(</span><span class="default">65534</span><span class="keyword">, </span><span class="default">65534</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* handle signals */<br />
</span><span class="default">pcntl_signal</span><span class="keyword">(</span><span class="default">SIGTERM</span><span class="keyword">, </span><span class="string">'sig_handler'</span><span class="keyword">);<br />
</span><span class="default">pcntl_signal</span><span class="keyword">(</span><span class="default">SIGINT</span><span class="keyword">, </span><span class="string">'sig_handler'</span><span class="keyword">);<br />
</span><span class="default">pcntl_signal</span><span class="keyword">(</span><span class="default">SIGCHLD</span><span class="keyword">, </span><span class="string">'sig_handler'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* change this to your own host / port */<br />
</span><span class="default">server_loop</span><span class="keyword">(</span><span class="string">"127.0.0.1"</span><span class="keyword">, </span><span class="default">1234</span><span class="keyword">);<br />
<br />
</span><span class="comment">/**<br />
&nbsp; * Change the identity to a non-priv user<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">change_identity</span><span class="keyword">( </span><span class="default">$uid</span><span class="keyword">, </span><span class="default">$gid </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">posix_setgid</span><span class="keyword">( </span><span class="default">$gid </span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Unable to setgid to " </span><span class="keyword">. </span><span class="default">$gid </span><span class="keyword">. </span><span class="string">"!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">posix_setuid</span><span class="keyword">( </span><span class="default">$uid </span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Unable to setuid to " </span><span class="keyword">. </span><span class="default">$uid </span><span class="keyword">. </span><span class="string">"!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp; * Creates a server socket and listens for incoming client connections<br />
&nbsp; * @param string $address The address to listen on<br />
&nbsp; * @param int $port The port to listen on<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">server_loop</span><span class="keyword">(</span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; GLOBAL </span><span class="default">$__server_listening</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) &lt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"failed to create socket: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$ret </span><span class="keyword">= </span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)) &lt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"failed to bind socket: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if( ( </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">socket_listen</span><span class="keyword">( </span><span class="default">$sock</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">) ) &lt; </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"failed to listen to socket: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"waiting for clients to connect\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$__server_listening</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$connection </span><span class="keyword">= @</span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$connection </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif (</span><span class="default">$connection </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">handle_client</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$connection</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"error: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp; * Signal handler<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">sig_handler</span><span class="keyword">(</span><span class="default">$sig</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$sig</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">SIGTERM</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">SIGINT</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">SIGCHLD</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">pcntl_waitpid</span><span class="keyword">(-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$status</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/** <br />
&nbsp; * Handle a new client connection<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">handle_client</span><span class="keyword">(</span><span class="default">$ssock</span><span class="keyword">, </span><span class="default">$csock</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; GLOBAL </span><span class="default">$__server_listening</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* fork failed */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"fork failure!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die;<br />
&nbsp;&nbsp;&nbsp; }elseif (</span><span class="default">$pid </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* child process */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__server_listening </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$ssock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">interact</span><span class="keyword">(</span><span class="default">$csock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$csock</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$csock</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">interact</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* TALK TO YOUR CLIENT */<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">/**<br />
&nbsp; * Become a daemon by forking and closing the parent<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">become_daemon</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* fork failed */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"fork failure!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp;&nbsp; }elseif (</span><span class="default">$pid</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* close the parent */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">exit();<br />
&nbsp;&nbsp;&nbsp; }else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* child becomes our daemon */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">posix_setsid</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">umask</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">posix_getpid</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75732""></a>
  <div class="note">
   <strong class="user">galantonp at yahoo dot com</strong>
   <a href="#75732" class="date">13-Jun-2007 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
socket_accept with timeout, seems to work for me on Apache/1.3.37 (FreeBSD 6.0) PHP/4.4.7. <br />
<br />
Adapted from ScriptBlue at nyc dot rr dot com's post under socket_connect.<br />
<br />
<span class="default">&lt;?php<br />
$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">,</span><span class="default">SOCK_STREAM</span><span class="keyword">,</span><span class="default">SOL_TCP</span><span class="keyword">);<br />
</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="default">$address</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">);<br />
</span><span class="default">socket_listen</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"Waiting for a connection\n"</span><span class="keyword">;<br />
</span><span class="default">$conn </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
switch(@</span><span class="default">socket_select</span><span class="keyword">(</span><span class="default">$r </span><span class="keyword">= array(</span><span class="default">$socket</span><span class="keyword">), </span><span class="default">$w </span><span class="keyword">= array(</span><span class="default">$socket</span><span class="keyword">), </span><span class="default">$e </span><span class="keyword">= array(</span><span class="default">$socket</span><span class="keyword">), </span><span class="default">60</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connection refused\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connection accepted\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$conn </span><span class="keyword">= @</span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connection timed out\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
if (</span><span class="default">$conn </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// communicate over $conn<br />
</span><span class="keyword">}<br />
<br />
&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75289""></a>
  <div class="note">
   <strong class="user">gmkarl at gmail dot com</strong>
   <a href="#75289" class="date">22-May-2007 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware signal handler functions set with pcntl_signal are not called while a socket is blocking waiting for a connection; the signal is absorbed silently and the handler called when a connection is made.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52876""></a>
  <div class="note">
   <strong class="user">simon at 180solutions dot com</strong>
   <a href="#52876" class="date">16-May-2005 08:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;Accepting a connection using php-sockets:<br />
&gt;<br />
&gt;$fd = socket_create(AF_INET, SOCK_STREAM, 6 /* OR &gt;getprotobyname("TCP")*/);<br />
&gt;<br />
&gt;$PORT = 5000;<br />
&gt;<br />
&gt;socket_bind($fd, "0.0.0.0", $PORT);<br />
&gt;<br />
&gt;while(true)<br />
&gt;{<br />
&gt;$remote_fd = socket_accept($fd);<br />
&gt;<br />
&gt;remote_socket_client_handle($remote_fd);<br />
&gt;<br />
&gt;}<br />
&gt;<br />
&gt;It is simple!<br />
<br />
This example doesn't work. You have to call socket_listen($fd) after your bind in order to accept incoming connections.<br />
<br />
Simon</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38198""></a>
  <div class="note">
   <strong class="user">Greg MacLellan</strong>
   <a href="#38198" class="date">11-Dec-2003 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The socket returned by this resource will be non-blocking, regardless of what the listening socket is set to. This is actually true for all FCNTL modifiers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35071""></a>
  <div class="note">
   <strong class="user">diogo at transoft dot com dot br</strong>
   <a href="#35071" class="date">18-Aug-2003 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Accepting a connection using php-sockets:<br />
<br />
$fd = socket_create(AF_INET, SOCK_STREAM, 6 /* OR getprotobyname("TCP")*/);<br />
<br />
$PORT = 5000;<br />
<br />
socket_bind($fd, "0.0.0.0", $PORT);<br />
<br />
while(true)<br />
{<br />
$remote_fd = socket_accept($fd);<br />
<br />
remote_socket_client_handle($remote_fd);<br />
<br />
}<br />
<br />
It is simple!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="ref.sockets.html">Socket Functions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.socket-bind.html">socket_bind</a></div>
 <div class="up"><a href="ref.sockets.html">Socket Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
