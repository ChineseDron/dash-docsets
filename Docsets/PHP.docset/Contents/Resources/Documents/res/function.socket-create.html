<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Create a socket (endpoint for communication)</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.socket-create-pair.html">socket_create_pair</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.socket-get-option.html">socket_get_option</a></div>
 <div class="up"><a href="ref.sockets.html">Socket Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.socket-create" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_create</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5)</p><p class="refpurpose"><span class="refname">socket_create</span> &mdash; <span class="dc-title">Create a socket (endpoint for communication)</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.socket-create-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><b>socket_create</b></span>
    ( <span class="methodparam"><span class="type">int</span> <tt class="parameter">$domain</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$type</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$protocol</tt></span>
   )</div>

  <p class="para rdfs-comment">
   Creates and returns a socket resource, also referred to as an endpoint
   of communication. A typical network connection is made up of 2 sockets, one
   performing the role of the client, and another performing the role of the server.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-create-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">domain</tt></i></span>
     <dd>

      <p class="para">
       The <i><tt class="parameter">domain</tt></i> parameter specifies the protocol
       family to be used by the socket.
      </p>
      <table class="doctable table">
       <caption><b>Available address/protocol families</b></caption>
       
        <thead valign="middle">
         <tr valign="middle">
          <th>Domain</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody valign="middle" class="tbody">
         <tr valign="middle">
          <td align="left"><b><tt>AF_INET</tt></b></td>
          <td align="left">
           IPv4 Internet based protocols. TCP and UDP are common protocols of
           this protocol family.
          </td>
         </tr>

         <tr valign="middle">
          <td align="left"><b><tt>AF_INET6</tt></b></td>
          <td align="left">
           IPv6 Internet based protocols. TCP and UDP are common protocols of
           this protocol family.
          </td>
         </tr>

         <tr valign="middle">
          <td align="left"><b><tt>AF_UNIX</tt></b></td>
          <td align="left">
           Local communication protocol family. High efficiency and low
           overhead make it a great form of IPC (Interprocess Communication).
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">type</tt></i></span>
     <dd>

      <p class="para">
       The <i><tt class="parameter">type</tt></i> parameter selects the type of communication
       to be used by the socket.
      </p>
      <table class="doctable table">
       <caption><b>Available socket types</b></caption>
       
        <thead valign="middle">
         <tr valign="middle">
          <th>Type</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody valign="middle" class="tbody">
         <tr valign="middle">
          <td align="left"><b><tt>SOCK_STREAM</tt></b></td>
          <td align="left">
           Provides sequenced, reliable, full-duplex, connection-based byte streams.
           An out-of-band data transmission mechanism may be supported.
           The TCP protocol is based on this socket type.
          </td>
         </tr>

         <tr valign="middle">
          <td align="left"><b><tt>SOCK_DGRAM</tt></b></td>
          <td align="left">
           Supports datagrams (connectionless, unreliable messages of a fixed maximum length).
           The UDP protocol is based on this socket type.
          </td>
         </tr>

           <tr valign="middle">
          <td align="left"><b><tt>SOCK_SEQPACKET</tt></b></td>
          <td align="left">
           Provides a sequenced, reliable, two-way connection-based data transmission path for
           datagrams of fixed maximum length;  a consumer is required to read an
           entire packet with each read call.
          </td>
         </tr>

         <tr valign="middle">
          <td align="left"><b><tt>SOCK_RAW</tt></b></td>
          <td align="left">
           Provides raw network protocol access. This special type of socket
           can be used to manually construct any type of protocol. A common use
           for this socket type is to perform ICMP requests (like ping).
          </td>
         </tr>

         <tr valign="middle">
          <td align="left"><b><tt>SOCK_RDM</tt></b></td>
          <td align="left">
           Provides a reliable datagram layer that does not guarantee ordering.
           This is most likely not implemented on your operating system.
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">protocol</tt></i></span>
     <dd>

      <p class="para">
       The <i><tt class="parameter">protocol</tt></i> parameter sets the specific
       protocol within the specified <i><tt class="parameter">domain</tt></i> to be used
       when communicating on the returned socket. The proper value can be
       retrieved by name by using <span class="function"><a href="function.getprotobyname.html" class="function">getprotobyname()</a></span>. If
       the desired protocol is TCP, or UDP the corresponding constants
       <b><tt>SOL_TCP</tt></b>, and <b><tt>SOL_UDP</tt></b>
       can also be used.
      </p>
      <table class="doctable table">
       <caption><b>Common protocols</b></caption>
       
        <thead valign="middle">
         <tr valign="middle">
          <th>Name</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody valign="middle" class="tbody">
         <tr valign="middle">
          <td align="left">icmp</td>
          <td align="left">
           The Internet Control Message Protocol is used primarily by gateways
           and hosts to report errors in datagram communication. The &quot;ping&quot;
           command (present in most modern operating systems) is an example
           application of ICMP.
          </td>
         </tr>

         <tr valign="middle">
          <td align="left">udp</td>
          <td align="left">
           The User Datagram Protocol is a connectionless, unreliable,
           protocol with fixed record lengths. Due to these aspects, UDP
           requires a minimum amount of protocol overhead.
          </td>
         </tr>

         <tr valign="middle">
          <td align="left">tcp</td>
          <td align="left">
           The Transmission Control Protocol is a reliable, connection based,
           stream oriented, full duplex protocol. TCP guarantees that all data packets
           will be received in the order in which they were sent. If any packet is somehow
           lost during communication, TCP will automatically retransmit the packet until
           the destination host acknowledges that packet. For reliability and performance
           reasons, the TCP implementation itself decides the appropriate octet boundaries
           of the underlying datagram communication layer. Therefore, TCP applications must
           allow for the possibility of partial record transmission.
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-create-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><b>socket_create()</b></span> returns a socket resource on success,
   or <b><tt>FALSE</tt></b> on error. The actual error code can be retrieved by calling
   <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span>. This error code may be passed to
   <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span> to get a textual explanation of the
   error.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.socket-create-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.0.0</td>
       <td align="left">
        The <b><tt>AF_INET6</tt></b> constant was added.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.socket-create-errors">
  <h3 class="title">Errors/Exceptions</h3>
   <p class="para">
    If an invalid <i><tt class="parameter">domain</tt></i> or
    <i><tt class="parameter">type</tt></i> is given, <span class="function"><b>socket_create()</b></span>
    defaults to <b><tt>AF_INET</tt></b> and
    <b><tt>SOCK_STREAM</tt></b> respectively and additionally emits an
    <b><tt>E_WARNING</tt></b> message.
   </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.socket-create-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.socket-accept.html" class="function" rel="rdfs-seeAlso">socket_accept()</a> - Accepts a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-bind.html" class="function" rel="rdfs-seeAlso">socket_bind()</a> - Binds a name to a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - Initiates a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-listen.html" class="function" rel="rdfs-seeAlso">socket_listen()</a> - Listens for a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-last-error.html" class="function" rel="rdfs-seeAlso">socket_last_error()</a> - Returns the last error on the socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-strerror.html" class="function" rel="rdfs-seeAlso">socket_strerror()</a> - Return a string describing a socket error</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="101012""></a>
  <div class="note">
   <strong class="user">geoff at spacevs dot com</strong>
   <a href="#101012" class="date">20-Nov-2010 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a ping function for PHP without using exec/system/passthrough/etc... Very useful to use to just test if a host is online before attempting to connect to it. Timeout is in seconds.<br />
<br />
<span class="default">&lt;?PHP<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ping</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* ICMP ping packet with a pre-calculated checksum */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$package </span><span class="keyword">= </span><span class="string">"\x08\x00\x7d\x4b\x00\x00\x00\x00PingHost"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$socket&nbsp; </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_RCVTIMEO</span><span class="keyword">, array(</span><span class="string">'sec' </span><span class="keyword">=&gt; </span><span class="default">$timeout</span><span class="keyword">, </span><span class="string">'usec' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_send</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$package</span><span class="keyword">, </span><span class="default">strLen</span><span class="keyword">(</span><span class="default">$package</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">socket_read</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93415""></a>
  <div class="note">
   <strong class="user">rhollencamp at gmail dot com</strong>
   <a href="#93415" class="date">08-Sep-2009 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you create a socket with AF_UNIX, a file will be created in the filesystem. This file is not removed when you call socket_close - you should unlink the file after you close the socket.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90573""></a>
  <div class="note">
   <strong class="user">took at sd-gp dot de</strong>
   <a href="#90573" class="date">28-Apr-2009 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple example how to send a raw udp packet<br />
<br />
<span class="default">&lt;?php<br />
$frame </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)<br />
);<br />
<br />
</span><span class="default">send_frame</span><span class="keyword">(</span><span class="default">$frame</span><span class="keyword">, </span><span class="default">1500</span><span class="keyword">);<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Sends 18x8 MCUF-UDP packet to target host.<br />
&nbsp;*<br />
&nbsp;* see also:<br />
&nbsp;* wiki.blinkenarea.org/index.php/MicroControllerUnitFrame<br />
&nbsp;*<br />
&nbsp;* @param array&nbsp; &nbsp; $frame 18x8 '0' or '1'<br />
&nbsp;* @param int&nbsp; &nbsp; $delay delay in msec<br />
&nbsp;* @param string&nbsp; &nbsp; $host target host<br />
&nbsp;* @param int&nbsp; &nbsp; $port target port (udp)<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">send_frame</span><span class="keyword">(</span><span class="default">$frame</span><span class="keyword">, </span><span class="default">$delay</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">=</span><span class="string">"192.168.0.23"</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">=</span><span class="default">2323</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"\x23\x54\x26\x66\x00\x08\x00\x12\x00\x01\x00\xff"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buf </span><span class="keyword">= </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">8</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">18</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$frame</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buf</span><span class="keyword">.=</span><span class="string">"\xff"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buf</span><span class="keyword">.=</span><span class="string">"\x00"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$buf</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">$delay</span><span class="keyword">*</span><span class="default">1000</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83877""></a>
  <div class="note">
   <strong class="user">skelly at keenio</strong>
   <a href="#83877" class="date">16-Jun-2008 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It took some investigation to understand the bit about raw sockets requiring root access and raw sockets being required to perform a seemingly simple "ping" on a Linux server. My source of confusion was that the regular command line "ping" utility did not require me to be root to exec it, so what was the difference? I found the answer starting with a forum posting to look up `man 7 raw` for raw sockets info which reveals:<br />
<br />
"Only processes with an effective user ID of 0 or the CAP_NET_RAW&nbsp; capability are allowed to open raw sockets."<br />
<br />
So root is not the only way; the ping utility normally works because it has suid permission. There is some interesting source code however that allows you to selectively assign the CAP_NET_RAW capability without the need for suid. Use at your own risk, this is provided for informational purposes only:<br />
<br />
<a href="http://www.olafdietsche.de/linux/capability/" rel="nofollow" target="_blank">http://www.olafdietsche.de/linux/capability/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82915""></a>
  <div class="note">
   <strong class="user">shaun at verticalevolution dot com</strong>
   <a href="#82915" class="date">01-May-2008 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After weeks of trying to find a PHP network client that supports TFTP and Telnet I finally break down and wrote a client library. You can find it here: <a href="http://www.verticalevolution.com/blog/index.php?/pages/PHP-Client.html" rel="nofollow" target="_blank">http://www.verticalevolution.com/blog/index.php?/pages/PHP-Client.html</a><br />
<br />
This isn't like other telnet libraries that just exec the OS's telnet, it makes and negotiates its own options. It creates the TFTP packets to send data back and forth.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81938""></a>
  <div class="note">
   <strong class="user">alexander dot krause at ed-solutions dot de</strong>
   <a href="#81938" class="date">20-Mar-2008 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On UNIX systems php needs /etc/protocols for constants like SOL_UDP and SOL_TCP.<br />
<br />
This file was missing on my embedded platform.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80775""></a>
  <div class="note">
   <strong class="user">Jean Charles MAMMANA</strong>
   <a href="#80775" class="date">31-Jan-2008 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've written the ping() function using socket_create() with SOCK_RAW.<br />
(on Unix System, you need to have the root acces to execute this function)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/// start ping.inc.php ///<br />
<br />
</span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"No Error"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// timeout in ms<br />
</span><span class="keyword">function </span><span class="default">ping</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$datasize </span><span class="keyword">= </span><span class="default">64</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_icmp_error</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"No Error"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ident </span><span class="keyword">= array(</span><span class="default">ord</span><span class="keyword">(</span><span class="string">'J'</span><span class="keyword">), </span><span class="default">ord</span><span class="keyword">(</span><span class="string">'C'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$seq&nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">), </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">8</span><span class="keyword">); </span><span class="comment">// type = 8 : request<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// code = 0<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// checksum init<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// checksum init<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$ident</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// identifier<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$ident</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); </span><span class="comment">// identifier<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$seq</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// seq<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$seq</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); </span><span class="comment">// seq<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$datasize</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chk </span><span class="keyword">= </span><span class="default">icmpChecksum</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">$chk</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]; </span><span class="comment">// checksum init<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] = </span><span class="default">$chk</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]; </span><span class="comment">// checksum init<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">,&nbsp; </span><span class="default">getprotobyname</span><span class="keyword">(</span><span class="string">'icmp'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$read&nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$write&nbsp; </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$except </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$select </span><span class="keyword">= </span><span class="default">socket_select</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">, </span><span class="default">$write</span><span class="keyword">, </span><span class="default">$except</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">* </span><span class="default">1000</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$select </span><span class="keyword">=== </span><span class="default">NULL</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Select Error"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$select </span><span class="keyword">=== </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Timeout"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$recv </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_stop </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_recvfrom</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$recv</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$recv </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">, </span><span class="default">$recv</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$recv</span><span class="keyword">[</span><span class="default">10</span><span class="keyword">] !== </span><span class="default">1</span><span class="keyword">) </span><span class="comment">// ICMP proto = 1<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Not ICMP packet"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$recv</span><span class="keyword">[</span><span class="default">21</span><span class="keyword">] !== </span><span class="default">0</span><span class="keyword">) </span><span class="comment">// ICMP response = 0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Not ICMP response"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ident</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">25</span><span class="keyword">] || </span><span class="default">$ident</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">26</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Bad identification number"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$seq</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">27</span><span class="keyword">] || </span><span class="default">$seq</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">28</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Bad sequence number"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ms </span><span class="keyword">= (</span><span class="default">$time_stop </span><span class="keyword">- </span><span class="default">$time_start</span><span class="keyword">) * </span><span class="default">1000</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ms </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Response too long"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ms </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ms</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">icmpChecksum</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bit </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$bit</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) % </span><span class="default">2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">+= </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">= (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$sum </span><span class="keyword">&amp; </span><span class="default">0xffff</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">+= (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">, ~</span><span class="default">$sum</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">getLastIcmpError</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_icmp_error</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_icmp_error</span><span class="keyword">;<br />
}<br />
</span><span class="comment">/// end ping.inc.php ///<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80569""></a>
  <div class="note">
   <strong class="user">Kyle Wilson</strong>
   <a href="#80569" class="date">22-Jan-2008 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to ionic and david...<br />
<br />
I'm just taking a stab at this, but wouldn't some combination of gethostbynamel and php_uname('n') provide you with the world-facing IP address without making a system call or using expensive socket operations?&nbsp; Don't get me wrong, socket operations have their place, but if you just need the server IP from a cli script, socket operations seem expensive. :)<br />
<br />
<span class="default">&lt;?php<br />
print_r</span><span class="keyword">(</span><span class="default">gethostbynamel</span><span class="keyword">(</span><span class="default">php_uname</span><span class="keyword">(</span><span class="string">'n'</span><span class="keyword">)));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74922""></a>
  <div class="note">
   <strong class="user">matth ingersoll</strong>
   <a href="#74922" class="date">03-May-2007 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When running these types of sockets, typically you need to be root or else they fail (not the case with stream sockets: <a href="http://us.php.net/manual/en/function.stream-socket-server.php" rel="nofollow" target="_blank">http://us.php.net/manual/en/function.stream-socket-server.php</a>)<br />
<br />
This is an example for Linux/Unix type systems to use sockets without being root. (tested on Debian and CentOS)<br />
<br />
<span class="default">&lt;?php<br />
$user </span><span class="keyword">= </span><span class="string">"daemon"</span><span class="keyword">;<br />
</span><span class="default">$script_name </span><span class="keyword">= </span><span class="string">"uid"</span><span class="keyword">; </span><span class="comment">//the name of this script<br />
<br />
/////////////////////////////////////////////<br />
//try creating a socket as a user other than root<br />
</span><span class="keyword">echo </span><span class="string">"\n__________________________________________\n"</span><span class="keyword">;<br />
echo </span><span class="string">"Trying to start a socket as user </span><span class="default">$user</span><span class="string">\n"</span><span class="keyword">;<br />
</span><span class="default">$uid_name </span><span class="keyword">= </span><span class="default">posix_getpwnam</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">);<br />
</span><span class="default">$uid_name </span><span class="keyword">= </span><span class="default">$uid_name</span><span class="keyword">[</span><span class="string">'uid'</span><span class="keyword">];<br />
<br />
if(</span><span class="default">posix_seteuid</span><span class="keyword">(</span><span class="default">$uid_name</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"SUCCESS: You are now </span><span class="default">$user</span><span class="string">!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$socket </span><span class="keyword">= @</span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"SUCCESS: You are NOT root and created a socket! This should not happen!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"ERROR: socket_create() failed because you're not root!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_process </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"ps aux | grep -v grep | grep </span><span class="default">$script_name</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Current process stats::--&gt;\t </span><span class="default">$show_process</span><span class="string">"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="string">"ERROR: seteuid(</span><span class="default">$uid_name</span><span class="string">) failed!\n"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">/////////////////////////////////////////////<br />
//no try creating a socket as root<br />
</span><span class="keyword">echo </span><span class="string">"\n__________________________________________\n"</span><span class="keyword">;<br />
echo </span><span class="string">"Trying to start a socket as user 'root'\n"</span><span class="keyword">;<br />
if(</span><span class="default">posix_seteuid</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"SUCCESS: You are now root!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_process </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"ps aux | grep -v grep | grep </span><span class="default">$script_name</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Current process stats::--&gt;\t </span><span class="default">$show_process</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$socket </span><span class="keyword">= @</span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"SUCCESS: You created a socket as root and now should seteuid() to another user\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/////////////////////////////////////////<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //now modify the socket as another user<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"\n__________________________________________\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Switching to user </span><span class="default">$user</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">posix_seteuid</span><span class="keyword">(</span><span class="default">$uid_name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"SUCCESS: You are now </span><span class="default">$user</span><span class="string">!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">8000</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"SUCCESS: socket_bind() worked as </span><span class="default">$user</span><span class="string">!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"ERROR: Must be root to user socket_bind()\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_process </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"ps aux | grep -v grep | grep </span><span class="default">$script_name</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Current process stats::--&gt;\t </span><span class="default">$show_process</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); </span><span class="comment">//hard to error check but it does close as this user<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"SUCCESS: You closed the socket as user </span><span class="default">$user</span><span class="string">!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"ERROR: seteuid(</span><span class="default">$uid_name</span><span class="string">) failed while socket was open!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"ERROR: Socket failed for some reason!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="string">"ERROR: Changing to root failed!\n"</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72496""></a>
  <div class="note">
   <strong class="user">ionic at ionic dot de</strong>
   <a href="#72496" class="date">21-Jan-2007 03:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To david _at* eder #do; us:<br />
<br />
Dependent on your system, you could, at least on LINUX, use exec with "/sbin/ifconfig eth0 | awk '/inet /{ print substr($2,9) }'" (also working for non-root users), that will work a little bit faster as your PHP function.<br />
<br />
Though, we should keep in mind that users with safe_mode enabled are more or less forced to use the socket thing. :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68709""></a>
  <div class="note">
   <strong class="user">jens at surefoot dot com</strong>
   <a href="#68709" class="date">08-Aug-2006 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please be aware that RAW sockets (as used for the ping example) are restricted to root accounts on *nix systems. Since web servers hardly ever run as root, they won't work on webpages.<br />
<br />
On Windows based servers it should work regardless.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60438""></a>
  <div class="note">
   
   <a href="#60438" class="date">06-Jan-2006 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a ping function that uses sockets instead of exec().&nbsp; Note: I was unable to get socket_create() to work without running from CLI as root.&nbsp; I've already calculated the package's checksum to simplify the code (the message is 'ping' but it doesn't actually matter).<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">ping</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$package </span><span class="keyword">= </span><span class="string">"\x08\x00\x19\x2f\x00\x00\x00\x00\x70\x69\x6e\x67"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* create the socket, the last '1' denotes ICMP */&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* set socket receive timeout to 1 second */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_RCVTIMEO</span><span class="keyword">, array(</span><span class="string">"sec" </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">, </span><span class="string">"usec" </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* connect to socket */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* record start time */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$start_usec</span><span class="keyword">, </span><span class="default">$start_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start_time </span><span class="keyword">= ((float) </span><span class="default">$start_usec </span><span class="keyword">+ (float) </span><span class="default">$start_sec</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_send</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$package</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$package</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(@</span><span class="default">socket_read</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$end_usec</span><span class="keyword">, </span><span class="default">$end_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end_time </span><span class="keyword">= ((float) </span><span class="default">$end_usec </span><span class="keyword">+ (float) </span><span class="default">$end_sec</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total_time </span><span class="keyword">= </span><span class="default">$end_time </span><span class="keyword">- </span><span class="default">$start_time</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$total_time</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58257""></a>
  <div class="note">
   <strong class="user">kyle gibson</strong>
   <a href="#58257" class="date">28-Oct-2005 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Took me about 20 minutes to figure out the proper arguments to supply for a AF_UNIX socket. Anything else, and I would get a PHP warning about the 'type' not being supported. I hope this saves someone else time.<br />
<br />
<span class="default">&lt;?php <br />
$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_UNIX</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="comment">// code<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49368""></a>
  <div class="note">
   <strong class="user">david at eder dot us</strong>
   <a href="#49368" class="date">25-Jan-2005 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes when you are running CLI, you need to know your own ip address.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; $addr </span><span class="keyword">= </span><span class="default">my_ip</span><span class="keyword">();<br />
&nbsp; echo </span><span class="string">"my ip address is </span><span class="default">$addr</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
&nbsp; function </span><span class="default">my_ip</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">=</span><span class="string">'64.0.0.0'</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_getsockname</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$addr</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43057""></a>
  <div class="note">
   <strong class="user">david at eder dot us</strong>
   <a href="#43057" class="date">08-Jun-2004 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seems there aren't any examples of UDP clients out there.&nbsp; This is a tftp client.&nbsp; I hope this makes someone's life easier.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">tftp_fetch</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create the request packet<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">) . </span><span class="default">$filename </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">) . </span><span class="string">'octet' </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// UDP is connectionless, so we just send on it.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">), </span><span class="default">0x100</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">69</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; do<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// $buffer and $port both come back with information for the ack<br />
&nbsp;&nbsp; &nbsp;&nbsp; // 516 = 4 bytes for the header + 512 bytes of data<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">socket_recvfrom</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">516</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// add the block number from the data packet to the ack packet<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">) . </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// send ack<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// append the data to the return variable<br />
&nbsp;&nbsp; &nbsp;&nbsp; // for large files this function should take a file handle as an arg<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">) == </span><span class="default">516</span><span class="keyword">);&nbsp; </span><span class="comment">// the first non-full packet is the last.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$ret</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19075""></a>
  <div class="note">
   <strong class="user">evan at coeus hyphen group dot com</strong>
   <a href="#19075" class="date">14-Feb-2002 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Okay I talked with Richard a little (via e-mail). We agree that getprotobyname() and using the constants should be the same in functionality and speed, the use of one or the other is merely coding style. Personally, we both think the constants are prettier :).<br />
<br />
The eight different protocols are the ones implemented in PHP- not the total number in existance (RFC 1340 has 98).<br />
<br />
All we disagree on is using 0- Richard says that "accordning to the official unix/bsd sockets 0 is more than fine." I think that since 0 is a reserved number according to RFC 1320, and when used usually refers to IP, not one of it's sub-protocols (TCP, UDP, etc.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19032""></a>
  <div class="note">
   <strong class="user">email at NOSPAMrichard-samar dot de</strong>
   <a href="#19032" class="date">13-Feb-2002 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually, you don't need to use <br />
getprotobyname("tcp") but instead can use<br />
the constants:&nbsp; SOL_TCP&nbsp; and&nbsp;&nbsp; SOL_UDP.<br />
<br />
Here an extract of the source from<br />
ext/sockets which should make this clear.<br />
<br />
if ((pe = getprotobyname("tcp"))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; REGISTER_LONG_CONSTANT("SOL_TCP", pe-&gt;p_proto,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; CONST_CS | CONST_PERSISTENT);<br />
}<br />
<br />
Normally the third parameter can be set to 0. In the<br />
original BSD Socket implementation the third parameter<br />
(there are 8 different types, here only two) should be<br />
IPPROTO_TCP or IPPROTO_UPD (or one of the 6 others ones).<br />
These two parameters are though not warpped in PHP as<br />
constants and therefore not available.<br />
Please use SOL_TCP&nbsp; and&nbsp;&nbsp; SOL_UDP. e.g.:<br />
<br />
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br />
<br />
Please be aware of the fact that UDP<br />
and TCP can only be used with AF_INET which is: "Adress Family Internet". With UNIX Domain sockets TCP/UDP would make no sense!<br />
<br />
best regards<br />
-Richard-Moh Samar</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.socket-create-pair.html">socket_create_pair</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.socket-get-option.html">socket_get_option</a></div>
 <div class="up"><a href="ref.sockets.html">Socket Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
