<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Reads remainder of a stream into a string</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.stream-filter-remove.html">stream_filter_remove</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.stream-get-filters.html">stream_get_filters</a></div>
 <div class="up"><a href="ref.stream.html">Stream Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.stream-get-contents" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stream_get_contents</h1> 
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">stream_get_contents</span> &mdash; <span class="dc-title">Reads remainder of a stream into a string</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.stream-get-contents-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>stream_get_contents</b></span>
    ( <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$handle</tt></span>
   [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$maxlength</tt><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <tt class="parameter">$offset</tt><span class="initializer"> = -1</span></span>
  ]] )</div>

  <p class="para rdfs-comment"> 
   Identical to <span class="function"><a href="function.file-get-contents.html" class="function">file_get_contents()</a></span>, except that
   <span class="function"><b>stream_get_contents()</b></span> operates on an already open
   stream resource and returns the remaining contents in a string, up to
   <i><tt class="parameter">maxlength</tt></i> bytes and starting at the specified
   <i><tt class="parameter">offset</tt></i>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stream-get-contents-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">handle</tt></i> (<span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>)</span>
     <dd>

      <p class="para">
       A stream resource (e.g. returned from <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>)
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">maxlength</tt></i> (<span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>)</span>
     <dd>

      <p class="para">
       The maximum bytes to read. Defaults to -1 (read all the remaining
       buffer).
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">offset</tt></i> (<span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>)</span>
     <dd>

      <p class="para">
       Seek to the specified offset before reading. If this number is negative,
       no seeking will occur and reading will start from the current position.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stream-get-contents-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a string or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.stream-get-contents-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.1.0</td>
       <td align="left">
        The <i><tt class="parameter">offset</tt></i> was added.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.stream-get-contents-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-3658">
    <p><b>Example #1 <span class="function"><b>stream_get_contents()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$stream&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://www.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;print&nbsp;all&nbsp;the&nbsp;page&nbsp;starting&nbsp;at&nbsp;the&nbsp;offset&nbsp;10<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">stream_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br />}<br /><br /><br />if&nbsp;(</span><span style="color: #0000BB">$stream&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://www.example.net'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;print&nbsp;the&nbsp;first&nbsp;5&nbsp;bytes<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">stream_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.stream-get-contents-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">This function is
binary-safe.</span></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.stream-get-contents-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.fgets.html" class="function" rel="rdfs-seeAlso">fgets()</a> - Gets line from file pointer</span></li>
    <li class="member"><span class="function"><a href="function.fread.html" class="function" rel="rdfs-seeAlso">fread()</a> - Binary-safe file read</span></li>
    <li class="member"><span class="function"><a href="function.fpassthru.html" class="function" rel="rdfs-seeAlso">fpassthru()</a> - Output all remaining data on a file pointer</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106905""></a>
  <div class="note">
   <strong class="user">clarck dot smith at gmail dot com</strong>
   <a href="#106905" class="date">17-Dec-2011 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In that case when stream_get_contents/fread/fgets or other stream reading functions block indefinitely your script because they don't reached the limit of bytes to read use the socket_get_meta_data function to figure out the number of the bytes to read. It returns an array that contains a key named 'unread_bytes' and then pass that number to your favourite stream reading functions second parameter to read from the stream.<br />
<br />
Maybe a good workaround to use the stream_select function, and set the socket to non-blocking mode with the use of stream_set_blocking($stream, 0). In this case the socket reading functions work properly.<br />
<br />
Cheers, Ervin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104724""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#104724" class="date">03-Jul-2011 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that using fiddler as a proxy in the stream context options causes this function to throw a warning:<br />
<br />
Warning: stream_get_contents() [function.stream-get-contents]: SSL: An existing connection was forcibly closed by the remote host.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101974""></a>
  <div class="note">
   <strong class="user">m rahman</strong>
   <a href="#101974" class="date">20-Jan-2011 01:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When omitting the parameter $maxlength, any received bytes are stacked up until the underlying stream is not readable anymore, the the function returns that stack in one piece.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82870""></a>
  <div class="note">
   <strong class="user">finalmau at gmail dot com</strong>
   <a href="#82870" class="date">29-Apr-2008 04:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
some times this functions cause an max execution time time error, Why?<br />
<br />
Simple, if you use it the function wait for have the specified byte&nbsp; length into the resource or the end of file, but, several times this not happend, so we need implement an artificial flag like this:<br />
<br />
$tmp = stream_get_contents($this-&gt;socket, 42);<br />
while($tmp[42] != 'N'){<br />
<br />
//Your code...<br />
<br />
$tmp = stream_get_contents($this-&gt;socket, 42);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69229""></a>
  <div class="note">
   <strong class="user">Jim Keller</strong>
   <a href="#69229" class="date">28-Aug-2006 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Per wez (at php.net), "the trick is to tell the recipient how big the packet is, so that it can read the correct length." <br />
<br />
In my own experience, when using PHP streams to send data bursts, the "max length" parameter seems to act more as an exact length parameter, as the stream will block indefinitely until max length is reached or until the other side fcloses() the stream. The latter is ok unless you need to keep the stream open to continue communication, in which case you have to let the receiving end know how much data to expect, or it will block indefinitely if the max length of data is not sent. You need to pack() and prepend the length of the outgoing data stream in the first 4 bytes of the packet, as follows:<br />
<br />
function send_pkt($stream, $my_data)<br />
{<br />
<br />
&nbsp;&nbsp; $len = strlen($my_data);<br />
<br />
&nbsp;&nbsp; $send_data = pack('N', $len) . $my_data; //Pack the length in a network-friendly way, then prepend it to the data. <br />
<br />
&nbsp;&nbsp; $final_len = strlen($send_data);<br />
<br />
&nbsp;&nbsp; if ( fwrite($stream, $send_data) &lt; $final_len ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //something went wrong, trigger error<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
function recv_pkt($stream)<br />
{<br />
<br />
&nbsp;&nbsp; $packed_len = stream_get_contents($stream, 4); //The first 4 bytes contain our N-packed length<br />
&nbsp;&nbsp; $hdr = unpack('Nlen', $packed_len); <br />
&nbsp;&nbsp; $len = $hdr['len'];<br />
&nbsp;&nbsp; $recvd_data = stream_get_contents($stream, $len);<br />
<br />
&nbsp;&nbsp; return $recvd_data;<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.stream-filter-remove.html">stream_filter_remove</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.stream-get-filters.html">stream_get_filters</a></div>
 <div class="up"><a href="ref.stream.html">Stream Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
