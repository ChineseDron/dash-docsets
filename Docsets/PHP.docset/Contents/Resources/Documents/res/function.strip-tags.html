<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Strip HTML and PHP tags from a string</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.strcspn.html">strcspn</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.stripcslashes.html">stripcslashes</a></div>
 <div class="up"><a href="ref.strings.html">String Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.strip-tags" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">strip_tags</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">strip_tags</span> &mdash; <span class="dc-title">Strip HTML and PHP tags from a string</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.strip-tags-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><b>strip_tags</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$str</tt></span>
   [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$allowable_tags</tt></span>
  ] )</div>

  <p class="para rdfs-comment">
   This function tries to return a string with all NUL bytes, HTML and PHP tags stripped
   from a given <i><tt class="parameter">str</tt></i>.  It uses the same tag stripping
   state machine as the <span class="function"><a href="function.fgetss.html" class="function">fgetss()</a></span> function.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.strip-tags-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">str</tt></i></span>
     <dd>

      <p class="para">
       The input string.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">allowable_tags</tt></i></span>
     <dd>

      <p class="para">
       You can use the optional second parameter to specify tags which should
       not be stripped.
      </p>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
        HTML comments and PHP tags are also stripped. This is hardcoded and
        can not be changed with <i><tt class="parameter">allowable_tags</tt></i>.
       </p>
      </p></blockquote>
      <blockquote class="note"><p><b class="note">Note</b>: 
       <p class="para">
        This parameter should not contain whitespace.
        <span class="function"><b>strip_tags()</b></span> sees a tag as a case-insensitive
        string between <i>&lt;</i> and the first whitespace or
        <i>&gt;</i>. It means that
        <i>strip_tags(&quot;&lt;br/&gt;&quot;, &quot;&lt;br&gt;&quot;)</i> returns an
        empty string.
       </p>
      </p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.strip-tags-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the stripped string.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.strip-tags-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.0.0</td>
       <td align="left">
        <span class="function"><b>strip_tags()</b></span> is now binary safe
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">4.3.0</td>
       <td align="left">
        HTML comments are now always stripped
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.strip-tags-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-4433">
    <p><b>Example #1 <span class="function"><b>strip_tags()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'&lt;p&gt;Test&nbsp;paragraph.&lt;/p&gt;&lt;!--&nbsp;Comment&nbsp;--&gt;&nbsp;&lt;a&nbsp;href="#fragment"&gt;Other&nbsp;text&lt;/a&gt;'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">strip_tags</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Allow&nbsp;&lt;p&gt;&nbsp;and&nbsp;&lt;a&gt;<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">strip_tags</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'&lt;p&gt;&lt;a&gt;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Test paragraph. Other text
&lt;p&gt;Test paragraph.&lt;/p&gt; &lt;a href=&quot;#fragment&quot;&gt;Other text&lt;/a&gt;
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.strip-tags-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><b class="warning">Warning</b>
   <p class="para">
    Because <span class="function"><b>strip_tags()</b></span> does not actually validate the
    HTML, partial or broken tags can result in the removal of more
    text/data than expected.
   </p>
  </div>
  <div class="warning"><b class="warning">Warning</b>
   <p class="para">
    This function does not modify any attributes on the tags that you allow
    using <i><tt class="parameter">allowable_tags</tt></i>, including the
    <i>style</i> and <i>onmouseover</i> attributes
    that a mischievous user may abuse when posting text that will be shown
    to other users.
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.strip-tags-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.htmlspecialchars.html" class="function" rel="rdfs-seeAlso">htmlspecialchars()</a> - Convert special characters to HTML entities</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107078""></a>
  <div class="note">
   <strong class="user">Cubist</strong>
   <a href="#107078" class="date">05-Jan-2012 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function to simply test if a given location index is inside a tag in the string<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">in_tag</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$index</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//test if $index occurs inside an html tag in $str<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$before </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$index</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$after </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$index</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prev_lt </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="string">'&lt;'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$next_lt </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="string">'&lt;'</span><span class="keyword">) + </span><span class="default">$index</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prev_gt </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="string">'&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$next_gt </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="string">'&gt;'</span><span class="keyword">) + </span><span class="default">$index</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$prev_gt </span><span class="keyword">&lt; </span><span class="default">$prev_lt</span><span class="keyword">) &amp;&amp; (</span><span class="default">$next_lt </span><span class="keyword">&gt; </span><span class="default">$next_gt</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106493""></a>
  <div class="note">
   <strong class="user">Maddy Vora</strong>
   <a href="#106493" class="date">13-Nov-2011 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the function created for strip tags with sub string<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">displaySubStringWithStrip</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$length </span><span class="keyword">== </span><span class="default">NULL</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">50</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stringDisplay </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) &gt; </span><span class="default">$length</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stringDisplay </span><span class="keyword">.= </span><span class="string">' ...'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$stringDisplay</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106238""></a>
  <div class="note">
   <strong class="user">shimy1984</strong>
   <a href="#106238" class="date">20-Oct-2011 09:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following is an easy way to use strip_tags() with a simple array or a multidimensional array.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">strip_tags_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stripped_data </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stripped_data</span><span class="keyword">[] = </span><span class="default">strip_tags_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stripped_data</span><span class="keyword">[] = </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$stripped_data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106098""></a>
  <div class="note">
   <strong class="user">dhgouveia at hotmail dot com</strong>
   <a href="#106098" class="date">10-Oct-2011 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is just for strip the inside tags <br />
<br />
<span class="default">&lt;?php<br />
$allow </span><span class="keyword">= </span><span class="string">'&lt;p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;&lt;strong&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="string">'&lt;p style="text-align:center"&gt;Paragraph&lt;/p&gt;&lt;strong&gt;Bold&lt;/strong&gt;&lt;br/&gt;&lt;span style="color:red"&gt;Red&lt;/span&gt;&lt;h1&gt;Header&lt;/h1&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$allow</span><span class="keyword">);<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">clean_inside_tags</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">$allow</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'&lt;textarea&gt;'</span><span class="keyword">.</span><span class="default">$result</span><span class="keyword">.</span><span class="string">'&lt;/textarea&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Clean the inside of the tags<br />
</span><span class="keyword">function </span><span class="default">clean_inside_tags</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">,</span><span class="default">$tags</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;([^&gt;]+)&gt;/i"</span><span class="keyword">,</span><span class="default">$tags</span><span class="keyword">,</span><span class="default">$allTags</span><span class="keyword">,</span><span class="default">PREG_PATTERN_ORDER</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$allTags</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$tag</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$txt </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">"[^&gt;]*&gt;/i"</span><span class="keyword">,</span><span class="string">"&lt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">"&gt;"</span><span class="keyword">,</span><span class="default">$txt</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$txt</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104475""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#104475" class="date">16-Jun-2011 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to strip ANSI escape color codes.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_ansi</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\e\[[;?0-9]*[0-9A-Za-z]/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102620""></a>
  <div class="note">
   <strong class="user">aleksey at favor dot com dot ua</strong>
   <a href="#102620" class="date">24-Feb-2011 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
strip_tags destroys the whole HTML behind the tags with invalid attributes. Like &lt;img src="/images/image.jpg""&gt; (look, there is an odd quote before &gt;.)<br />
<br />
So I wrote function which fixes unsafe attributes and replaces odd " and ' quotes with &amp;quot; and &amp;#39;.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fix_unsafe_attributes</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; while (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/&lt;([A-Za-z])[^&gt;]*?&gt;/'</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">PREG_OFFSET_CAPTURE</span><span class="keyword">)) { </span><span class="comment">// find where the tag begins<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// scan attributes and find odd " and '<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while ((((</span><span class="default">$i1 </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">)) || </span><span class="default">1</span><span class="keyword">) &amp;&amp; ((</span><span class="default">$i2 </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'\''</span><span class="keyword">)) || </span><span class="default">1</span><span class="keyword">)) &amp;&amp; (</span><span class="default">$i1 </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">$i2 </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) &amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((</span><span class="default">$i </span><span class="keyword">= (int)((</span><span class="default">$i1 </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) &amp;&amp; (</span><span class="default">$i2 </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) ? (</span><span class="default">$i1 </span><span class="keyword">&lt; </span><span class="default">$i2 </span><span class="keyword">? </span><span class="default">$i1 </span><span class="keyword">: </span><span class="default">$i2</span><span class="keyword">) : (</span><span class="default">$i1 </span><span class="keyword">== </span><span class="default">false </span><span class="keyword">? </span><span class="default">$i2 </span><span class="keyword">: </span><span class="default">$i1</span><span class="keyword">))) !== </span><span class="default">false</span><span class="keyword">) &amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (((</span><span class="default">$c </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'&gt;'</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) || (</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$c</span><span class="keyword">))) {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$s</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ((</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) || (</span><span class="default">$s</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">} != </span><span class="string">'='</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">).(</span><span class="default">$s</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">} == </span><span class="string">'"' </span><span class="keyword">? </span><span class="string">'&amp;quot;' </span><span class="keyword">: </span><span class="string">'&amp;#39;'</span><span class="keyword">); </span><span class="comment">// replace odd " and '<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$i </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$out</span><span class="keyword">.</span><span class="default">$s</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Maybe this function can be rewritten with simple regular expression but I have no luck to make it quickly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102221""></a>
  <div class="note">
   <strong class="user">Abdul Al-hasany</strong>
   <a href="#102221" class="date">02-Feb-2011 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted in the documentation strip_tags would strip php and comments tags even if they are add to $allowable_tags.<br />
<br />
Here is a little workaround for this issue:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">stripTags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">)<br />
{<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// replace php and comments tags so they do not get stripped&nbsp; <br />
&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"@&lt;\?@"</span><span class="keyword">, </span><span class="string">"#?#"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"@&lt;!--@"</span><span class="keyword">, </span><span class="string">"#!--#"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// strip tags normally<br />
&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// return php and comments tags to their origial form<br />
&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"@#\?#@"</span><span class="keyword">, </span><span class="string">"&lt;?"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"@#!--#@"</span><span class="keyword">, </span><span class="string">"&lt;!--"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The function would replace the tags to hashes so strip_tags would not identify them as normal tags, and then when strip_tags does its job the tags are modified back to their original form.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102173""></a>
  <div class="note">
   <strong class="user">Montana</strong>
   <a href="#102173" class="date">31-Jan-2011 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IMO, the function should allow you to remove any tag that you specify.&nbsp; The structure could be something like this:<br />
<br />
strip_tags($string,$allow_or_remove_listed,$list)<br />
<br />
As an example:<br />
<br />
<span class="default">&lt;?php<br />
$str </span><span class="keyword">= </span><span class="string">"&lt;p&gt;&lt;strong&gt;This is a string.&lt;/strong&gt; &lt;a href="</span><span class="default">http</span><span class="keyword">:</span><span class="comment">//www.example.com/"&gt;Some Random Website&lt;/a&gt;";<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">"remove"</span><span class="keyword">,</span><span class="string">"&lt;strong&gt;"</span><span class="keyword">);<br />
echo </span><span class="default">$str</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
would remove the &lt;strong&gt; tag.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100995""></a>
  <div class="note">
   <strong class="user">frank at silverwolf media ddoott comm</strong>
   <a href="#100995" class="date">19-Nov-2010 02:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that strip_tags may stumble when it encounters two consecutive quotes. Regardless of whether that's a bug or a feature (different PHP versions seem to behave differently) here's a workaround:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $wtf </span><span class="keyword">= </span><span class="string">'<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;First line&lt;/p&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;a href=\"foo"&gt;bar&lt;/a&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;Second line&lt;/p&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;a href=\"foo\""&gt;bar&lt;/a&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;Third line&lt;/p&gt;<br />
&nbsp; '</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">'Raw: ' </span><span class="keyword">. </span><span class="default">$wtf </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">'strip_tags(): ' </span><span class="keyword">. </span><span class="default">strip_tags </span><span class="keyword">(</span><span class="default">$wtf</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">'Regexp: ' </span><span class="keyword">. </span><span class="default">preg_replace </span><span class="keyword">(</span><span class="string">'/&lt;[^&gt;]*&gt;/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$wtf</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Raw output:<br />
<br />
&nbsp; &lt;p&gt;First line&lt;/p&gt;<br />
&nbsp; &lt;a href=\"foo"&gt;bar&lt;/a&gt;<br />
&nbsp; &lt;p&gt;Second line&lt;/p&gt;<br />
&nbsp; &lt;a href=\"foo\""&gt;bar&lt;/a&gt;<br />
&nbsp; &lt;p&gt;Third line&lt;/p&gt;<br />
<br />
strip_tags() output:<br />
<br />
&nbsp; First line<br />
&nbsp; bar<br />
&nbsp; Third line<br />
<br />
preg_replace() output:<br />
<br />
&nbsp; First line<br />
&nbsp; bar<br />
&nbsp; Second line<br />
&nbsp; bar<br />
&nbsp; Third line</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99643""></a>
  <div class="note">
   <strong class="user">tom at cowin dot us</strong>
   <a href="#99643" class="date">27-Aug-2010 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With most web based user input of more than a line of text, it seems I get 90% 'paste from Word'. I've developed this fn over time to try to strip all of this cruft out. A few things I do here are application specific, but if it helps you - great, if you can improve on it or have a better way - please - post it... <br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">strip_word_html</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$allowed_tags </span><span class="keyword">= </span><span class="string">'&lt;b&gt;&lt;i&gt;&lt;sup&gt;&lt;sub&gt;&lt;em&gt;&lt;strong&gt;&lt;u&gt;&lt;br&gt;'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mb_regex_encoding</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//replace MS special characters first<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search </span><span class="keyword">= array(</span><span class="string">'/&amp;lsquo;/u'</span><span class="keyword">, </span><span class="string">'/&amp;rsquo;/u'</span><span class="keyword">, </span><span class="string">'/&amp;ldquo;/u'</span><span class="keyword">, </span><span class="string">'/&amp;rdquo;/u'</span><span class="keyword">, </span><span class="string">'/&amp;mdash;/u'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace </span><span class="keyword">= array(</span><span class="string">'\''</span><span class="keyword">, </span><span class="string">'\''</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//make sure _all_ html entities are converted to the plain ascii equivalents - it appears<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //in some MS headers, some html entities are encoded and some aren't<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//try to strip out any C style comments first, since these, embedded in html comments, seem to<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //prevent strip_tags from removing html comments (MS Word introduced combination)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">mb_stripos</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="string">'/*'</span><span class="keyword">) !== </span><span class="default">FALSE</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">mb_eregi_replace</span><span class="keyword">(</span><span class="string">'#/\*.*?\*/#s'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="string">'m'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//introduce a space into any arithmetic expressions that could be caught by strip_tags so that they won't be<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //'&lt;1' becomes '&lt; 1'(note: somewhat application specific)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(array(</span><span class="string">'/&lt;([0-9]+)/'</span><span class="keyword">), array(</span><span class="string">'&lt; $1'</span><span class="keyword">), </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$allowed_tags</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//eliminate extraneous whitespace from start and end of line, or anywhere there are two or more spaces, convert it to one<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(array(</span><span class="string">'/^\s\s+/'</span><span class="keyword">, </span><span class="string">'/\s\s+$/'</span><span class="keyword">, </span><span class="string">'/\s\s+/u'</span><span class="keyword">), array(</span><span class="string">''</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">), </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//strip out inline css and simplify style tags<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search </span><span class="keyword">= array(</span><span class="string">'#&lt;(strong|b)[^&gt;]*&gt;(.*?)&lt;/(strong|b)&gt;#isu'</span><span class="keyword">, </span><span class="string">'#&lt;(em|i)[^&gt;]*&gt;(.*?)&lt;/(em|i)&gt;#isu'</span><span class="keyword">, </span><span class="string">'#&lt;u[^&gt;]*&gt;(.*?)&lt;/u&gt;#isu'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace </span><span class="keyword">= array(</span><span class="string">'&lt;b&gt;$2&lt;/b&gt;'</span><span class="keyword">, </span><span class="string">'&lt;i&gt;$2&lt;/i&gt;'</span><span class="keyword">, </span><span class="string">'&lt;u&gt;$1&lt;/u&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//on some of the ?newer MS Word exports, where you get conditionals of the form 'if gte mso 9', etc., it appears<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //that whatever is in one of the html comments prevents strip_tags from eradicating the html comment that contains<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //some MS Style Definitions - this last bit gets rid of any leftover comments */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_matches </span><span class="keyword">= </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/\&lt;!--/u"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$num_matches</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\&lt;!--(.)*--\&gt;/isu'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98793""></a>
  <div class="note">
   <strong class="user">cyex at hotmail dot com</strong>
   <a href="#98793" class="date">08-Jul-2010 03:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I thought someone else might find this useful... a simple way to strip BBCode:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$bbcode_str </span><span class="keyword">= </span><span class="string">"Here is some [b]bold text[/b] and some [color=#FF0000]red text[/color]!"</span><span class="keyword">;<br />
<br />
</span><span class="default">$plain_text </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'['</span><span class="keyword">,</span><span class="string">']'</span><span class="keyword">), array(</span><span class="string">'&lt;'</span><span class="keyword">,</span><span class="string">'&gt;'</span><span class="keyword">), </span><span class="default">$bbcode_str</span><span class="keyword">));<br />
<br />
</span><span class="comment">//Outputs: Here is some bold text, and some red text!<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97386""></a>
  <div class="note">
   <strong class="user">php at wizap dot com</strong>
   <a href="#97386" class="date">16-Apr-2010 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This could be overkill but this strips all HTML tags and gives you the option to preserve the ones you define. It also takes into account tags like &lt;script&gt; removing all the javascript, too! You can also strip out all the content between any tag that has an opening and closing tag, like &lt;table&gt;, &lt;object&gt;, etc.<br />
<br />
<span class="default">&lt;?php <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">remove_HTML</span><span class="keyword">(</span><span class="default">$s </span><span class="keyword">, </span><span class="default">$keep </span><span class="keyword">= </span><span class="string">'' </span><span class="keyword">, </span><span class="default">$expand </span><span class="keyword">= </span><span class="string">'script|style|noframes|select|option'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**///prep the string<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**///initialize keep tag logic<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$keep</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">,</span><span class="default">$keep</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="string">'[{(' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&lt;/' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="string">'[{(/' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//begin removal<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /**///remove comment blocks<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&lt;!--'</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&lt;!--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'--&gt;'</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**///remove tags with content between them<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$expand</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">,</span><span class="default">$expand</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">strlen</span><span class="keyword">(</span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">$e</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="string">'&gt;'</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$len</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**///remove remaining tags<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&lt;'</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&lt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="string">'&gt;'</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**///finalize keep tag<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'[{(' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'[{(/' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="string">'&lt;/' </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96483""></a>
  <div class="note">
   <strong class="user">LWC</strong>
   <a href="#96483" class="date">01-Mar-2010 07:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is support for stripping content for the reverse strip_tags function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_only</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">, </span><span class="default">$stripContent </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tags </span><span class="keyword">= (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">'&gt;'</span><span class="keyword">) !== </span><span class="default">false </span><span class="keyword">? </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&gt;'</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&lt;'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">)) : array(</span><span class="default">$tags</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">end</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">) == </span><span class="string">''</span><span class="keyword">) </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$stripContent</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="string">'(.+&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">'[^&gt;]*&gt;|)'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#&lt;/?'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">'[^&gt;]*&gt;'</span><span class="keyword">.</span><span class="default">$content</span><span class="keyword">.</span><span class="string">'#is'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="string">'&lt;font color="red"&gt;red&lt;/font&gt; text'</span><span class="keyword">;<br />
</span><span class="default">$tags </span><span class="keyword">= </span><span class="string">'font'</span><span class="keyword">;<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">strip_only</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">); </span><span class="comment">// red text<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">strip_only</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">// text<br />
</span><span class="default">?&gt;<br />
</span><br />
Note this function always assumed no two tags start the same way (e.g. &lt;bla&gt; and &lt;blas&gt;) and therefore censors blas along with bla.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93567""></a>
  <div class="note">
   <strong class="user">Steve</strong>
   <a href="#93567" class="date">16-Sep-2009 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function like strip_tags, only it removes only the tags (with attributes) specified:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_only</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tags </span><span class="keyword">= (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">'&gt;'</span><span class="keyword">) !== </span><span class="default">false </span><span class="keyword">? </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&gt;'</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&lt;'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">)) : array(</span><span class="default">$tags</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">end</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">) == </span><span class="string">''</span><span class="keyword">) </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">) </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#&lt;/?'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">'[^&gt;]*&gt;#is'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="string">'&lt;p style="text-align:center"&gt;Paragraph&lt;/p&gt;&lt;strong&gt;Bold&lt;/strong&gt;&lt;br/&gt;&lt;span style="color:red"&gt;Red&lt;/span&gt;&lt;h1&gt;Header&lt;/h1&gt;'</span><span class="keyword">;<br />
<br />
echo </span><span class="default">strip_only</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, array(</span><span class="string">'p'</span><span class="keyword">, </span><span class="string">'h1'</span><span class="keyword">));<br />
echo </span><span class="default">strip_only</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">'&lt;p&gt;&lt;h1&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Both return:<br />
Paragraph&lt;strong&gt;Bold&lt;/strong&gt;&lt;br/&gt;&lt;span style="color:red"&gt;Red&lt;/span&gt;Header<br />
<br />
Hope this helps somebody else</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91376""></a>
  <div class="note">
   <strong class="user">roly426 at gmail dot com</strong>
   <a href="#91376" class="date">09-Jun-2009 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To check for broken tags an easier approach would be to use xml_parse(). You can also get a descriptive error with xml_get_error_code().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91346""></a>
  <div class="note">
   <strong class="user">magus at otserv dot com dot br</strong>
   <a href="#91346" class="date">07-Jun-2009 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function that verify if in a string have broken HTML tags, returning true if do. Useful for previning broken tags to affect the page.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># Example usage: broken_tags("&lt;b&gt;This is a string&lt;/u&gt;") returns TRUE, broken_tags("&lt;b&gt;This is a string&lt;/b&gt;") returns FALSE.<br />
</span><span class="keyword">function </span><span class="default">broken_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/(&lt;\w+)(?:.){0,}?&gt;/"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$v1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;\/\w+&gt;/"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$v2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$open </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'strtolower'</span><span class="keyword">, </span><span class="default">$v1</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$closed </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'strtolower'</span><span class="keyword">, </span><span class="default">$v2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$open </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end_tag </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;(.*)/"</span><span class="keyword">, </span><span class="string">"&lt;/$1&gt;"</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$end_tag</span><span class="keyword">, </span><span class="default">$closed</span><span class="keyword">)) return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$closed</span><span class="keyword">[</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$end_tag</span><span class="keyword">, </span><span class="default">$closed</span><span class="keyword">)]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90080""></a>
  <div class="note">
   <strong class="user">brettz9 AAT yah</strong>
   <a href="#90080" class="date">05-Apr-2009 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Works on shortened &lt;?...?&gt; syntax and thus also will remove XML processing instructions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89878""></a>
  <div class="note">
   <strong class="user">hongong at webafrica dot org dot za</strong>
   <a href="#89878" class="date">26-Mar-2009 12:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An easy way to clean a string of all CDATA encapsulation.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_cdata</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/&lt;!\[cdata\[(.*?)\]\]&gt;/is'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$string</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example: echo strip_cdata('&lt;![CDATA[Text]]&gt;');<br />
Returns: Text</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89453""></a>
  <div class="note">
   <strong class="user">nathan@8</strong>
   <a href="#89453" class="date">08-Mar-2009 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Improperly formatted javascript being add to tags and the limit of 15 instences of recursion before memory allocation runs out are some of the concerns involved in coding.&nbsp; Here is the code that I created to leave tags intact but strip scripting from only inside the tags...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_javascript</span><span class="keyword">(</span><span class="default">$filter</span><span class="keyword">){<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// realign javascript href to onclick<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/href=(['\"]).*?javascript:(.*)?<br />
\\1/i"</span><span class="keyword">, </span><span class="string">"onclick=' $2 '"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//remove javascript from tags<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/&lt;(.*)?javascript.*?\(.*?((?&gt;[^()]+)<br />
|(?R)).*?\)?\)(.*)?&gt;/i"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;(.*)?javascript.*?\(.*?((?&gt;<br />
[^()]+)|(?R)).*?\)?\)(.*)?&gt;/i"</span><span class="keyword">, </span><span class="string">"&lt;$1$3$4$5&gt;"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// dump expressions from contibuted content<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">0</span><span class="keyword">) </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/:expression\(.*?((?&gt;[^<br />
(.*?)]+)|(?R)).*?\)\)/i"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/&lt;(.*)?:expr.*?\(.*?((?&gt;[^()]+)|(?<br />
R)).*?\)?\)(.*)?&gt;/i"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;(.*)?:expr.*?\(.*?((?&gt;[^()]<br />
+)|(?R)).*?\)?\)(.*)?&gt;/i"</span><span class="keyword">, </span><span class="string">"&lt;$1$3$4$5&gt;"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// remove all on* events&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/&lt;(.*)?\s?on.+?=?\s?.+?(['\"]).*?\\2<br />
\s?(.*)?&gt;/i"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;(.*)?\s?on.+?=?\s?.+?<br />
(['\"]).*?\\2\s?(.*)?&gt;/i"</span><span class="keyword">, </span><span class="string">"&lt;$1$3&gt;"</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$filter</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see this does not clean up correctly... it does <br />
however remove dangerous stuff... <br />
<br />
&lt;a href=javascript: { {({}{}()())}alert('xss') ) ) }&gt;<br />
<br />
&lt;div onload..;,;..'alert(\"xss_attack\");'&gt;<br />
<br />
&lt;a href='javascript:{ alert(\"xss_attack\"); otherxss();}'<br />
&nbsp;onclick= 'alert(\"xss_attack\");' onhover='alert<br />
(\"xss_attack\");' onmouseout=alert(\"xss_attack\") <br />
class='thisclass'&gt; link&lt;/a&gt;<br />
<br />
style='width:expression(alert(\"xss_attack\"));'<br />
<br />
This can be completed before using strip_tags().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89410""></a>
  <div class="note">
   <strong class="user">kai at froghh dot de</strong>
   <a href="#89410" class="date">06-Mar-2009 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a function that decides if &lt; is a start of a tag or a lower than / lower than + equal:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">lt_replace</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;([^[:alpha:]])/"</span><span class="keyword">, </span><span class="string">'&amp;lt;\\1'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
It's to be used before strip_slashes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89309""></a>
  <div class="note">
   <strong class="user">mehul dot g12 at gmail dot com</strong>
   <a href="#89309" class="date">03-Mar-2009 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Strip tags doesn't work fine if we have '&lt;' symbol in the string followed immediately by any letter. but it doed work fine if there is a space after '&lt;' symbol. e.g.<br />
<br />
<span class="default">&lt;?php<br />
strip_tags</span><span class="keyword">(</span><span class="string">'&lt;p&gt;1&lt;4&lt;/p&gt;'</span><span class="keyword">);&nbsp; </span><span class="comment">//won't work fine<br />
</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="string">'&lt;p&gt;1 &lt; 4&lt;/p&gt;'</span><span class="keyword">);&nbsp; </span><span class="comment">//will work fine<br />
</span><span class="default">?&gt;<br />
</span><br />
to solve this problem, I used a simple logic. This code will replace '&lt;' by html char, if it not a part of html tag.<br />
<br />
My version of strip_tags is as follow:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">my_strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strs</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&lt;'</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">$strs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$strs</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$strs</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="string">'&gt;'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">.</span><span class="string">'&amp;lt;'</span><span class="keyword">.</span><span class="default">$strs</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">.</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$strs</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">);&nbsp; &nbsp; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88991""></a>
  <div class="note">
   <strong class="user">CEO at CarPool2Camp dot org</strong>
   <a href="#88991" class="date">17-Feb-2009 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note the different outputs from different versions of the same tag:<br />
<br />
<span class="default">&lt;?php </span><span class="comment">// striptags.php<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">'&lt;br&gt;Each&lt;br/&gt;New&lt;br /&gt;Line'</span><span class="keyword">;<br />
</span><span class="default">$new&nbsp; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">'&lt;br&gt;'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">);&nbsp; </span><span class="comment">// OUTPUTS string(21) "&lt;br&gt;EachNew&lt;br /&gt;Line"<br />
<br />
</span><span class="keyword">&lt;?</span><span class="default">php </span><span class="comment">// striptags.php<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">'&lt;br&gt;Each&lt;br/&gt;New&lt;br /&gt;Line'</span><span class="keyword">;<br />
</span><span class="default">$new&nbsp; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">'&lt;br/&gt;'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">); </span><span class="comment">// OUTPUTS string(16) "Each&lt;br/&gt;NewLine"<br />
<br />
</span><span class="keyword">&lt;?</span><span class="default">php </span><span class="comment">// striptags.php<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">'&lt;br&gt;Each&lt;br/&gt;New&lt;br /&gt;Line'</span><span class="keyword">;<br />
</span><span class="default">$new&nbsp; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">); </span><span class="comment">// OUTPUTS string(11) "EachNewLine"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88491""></a>
  <div class="note">
   <strong class="user">Leendert W</strong>
   <a href="#88491" class="date">26-Jan-2009 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Maybe also a usefull function for someone.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">removeUnsafeAttributesAndGivenTags</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$validTags </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$regex </span><span class="keyword">= </span><span class="string">'#\s*&lt;(/?\w+)\s+(?:on\w+\s*=\s*(["\'\s])?.+?<br />
\(\1?.+?\1?\);?\1?|style=["\'].+?["\'])\s*&gt;#is'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$regex</span><span class="keyword">, </span><span class="string">'&lt;${1}&gt;'</span><span class="keyword">,</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$validTags</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88254""></a>
  <div class="note">
   <strong class="user">phzzyzhou at gmail dot com</strong>
   <a href="#88254" class="date">17-Jan-2009 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
strip_tags will strip '&lt;' and the string behind, like this<br />
<br />
<span class="default">&lt;?php<br />
$str </span><span class="keyword">= &lt;&lt;&lt;EOF<br />
</span><span class="string">123 &lt; 456<br />
&lt;a&gt;link&lt;/a&gt;<br />
bbb<br />
</span><span class="keyword">EOF;<br />
<br />
echo </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will output:<br />
123<br />
<br />
---------------------------------<br />
this function will repiar this<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">will_strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(&lt;)([^&gt;]*?&lt;)/' </span><span class="keyword">, </span><span class="string">'&amp;lt;$2' </span><span class="keyword">, </span><span class="default">$str </span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } while (</span><span class="default">$count </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&gt;' </span><span class="keyword">, </span><span class="string">'&amp;gt;' </span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">will_strip_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will output:<br />
123 &amp;lt; 456<br />
link<br />
bbb</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88179""></a>
  <div class="note">
   <strong class="user">tleblan at pricegrabber dot com</strong>
   <a href="#88179" class="date">13-Jan-2009 07:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think it is worth mentioning that if some tags are allowed using the second parameter, this function does not allow to strip attributes within the allowed tags and hence should not be used against XSS vulnerabilities.<br />
<br />
One can still execute javascript by 2 means:<br />
- by inserting attributes that typically accept javascript <br />
&nbsp; &gt;&gt; onClick="alert('XSS');"<br />
- by using styles <br />
&nbsp; &gt;&gt; style="width:expression(alert('XSS'));" (works on IE7 and probably other versions)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86964""></a>
  <div class="note">
   <strong class="user">mariusz.tarnaski at wp dot pl</strong>
   <a href="#86964" class="date">12-Nov-2008 08:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi. I made a function that removes the HTML tags along with their contents:<br />
<br />
Function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_tags_content</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$tags </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$invert </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">) {<br />
<br />
&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/&lt;(.+?)[\s]*\/?[\s]*&gt;/si'</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">), </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">) AND </span><span class="default">count</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$invert </span><span class="keyword">== </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@&lt;(?!(?:'</span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">) .</span><span class="string">')\b)(\w+)\b.*?&gt;.*?&lt;/\1&gt;@si'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@&lt;('</span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">) .</span><span class="string">')\b.*?&gt;.*?&lt;/\1&gt;@si'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; elseif(</span><span class="default">$invert </span><span class="keyword">== </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@&lt;(\w+)\b.*?&gt;.*?&lt;/\1&gt;@si'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Sample text:<br />
$text = '&lt;b&gt;sample&lt;/b&gt; text with &lt;div&gt;tags&lt;/div&gt;';<br />
<br />
Result for strip_tags($text):<br />
sample text with tags<br />
<br />
Result for strip_tags_content($text):<br />
&nbsp;text with <br />
<br />
Result for strip_tags_content($text, '&lt;b&gt;'):<br />
&lt;b&gt;sample&lt;/b&gt; text with <br />
<br />
Result for strip_tags_content($text, '&lt;b&gt;', TRUE);<br />
&nbsp;text with &lt;div&gt;tags&lt;/div&gt;<br />
<br />
I hope that someone is useful :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86463""></a>
  <div class="note">
   <strong class="user">lucky760 at VideoSift dot com</strong>
   <a href="#86463" class="date">20-Oct-2008 10:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's come to my attention that PHP's strip_tags has been doing something funky to some video embed codes that our members submit. I'm not sure the exact situation, but whenever there is a &lt;param&gt; tag that is very long, strip_tags() will completely remove the tag even though it's specified as an allowable tag.<br />
<br />
Here's an example of the existing problem:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// a single very long &lt;param&gt; tag<br />
</span><span class="default">$html </span><span class="keyword">=&lt;&lt;&lt;EOF<br />
</span><span class="string">&lt;param name="flashVars" value="skin=http%3A//cdn-i.dmdentertainm<br />
...[snip]...<br />
vie%20of%20All-Time"/&gt;<br />
</span><span class="keyword">EOF;<br />
<br />
echo </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">, </span><span class="string">'&lt;param&gt;'</span><span class="keyword">);<br />
</span><span class="comment">// this outputs an empty string<br />
</span><span class="default">?&gt;<br />
</span><br />
This is the function I built to fix and extend the functionality of strip_tags(). The args are:<br />
- $i_html - the HTML string to be parsed<br />
- $i_allowedtags - an array of allowed tag names<br />
- $i_trimtext - whether or not to strip all text outside of the allowed tags<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">real_strip_tags</span><span class="keyword">(</span><span class="default">$i_html</span><span class="keyword">, </span><span class="default">$i_allowedtags </span><span class="keyword">= array(), </span><span class="default">$i_trimtext </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$i_allowedtags</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i_allowedtags </span><span class="keyword">= !empty(</span><span class="default">$i_allowedtags</span><span class="keyword">) ? array(</span><span class="default">$i_allowedtags</span><span class="keyword">) : array();<br />
&nbsp; </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">, </span><span class="default">$i_allowedtags</span><span class="keyword">);<br />
<br />
&nbsp; if (empty(</span><span class="default">$tags</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tags </span><span class="keyword">= </span><span class="string">'[a-z]+'</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'@&lt;/?\s*(' </span><span class="keyword">. </span><span class="default">$tags </span><span class="keyword">. </span><span class="string">')(\s+[a-z_]+=(\'[^\']+\'|"[^"]+"))*\s*/?&gt;@i'</span><span class="keyword">, </span><span class="default">$i_html</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$full_tags </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$tag_names </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
<br />
&nbsp; foreach (</span><span class="default">$full_tags </span><span class="keyword">as </span><span class="default">$i </span><span class="keyword">=&gt; </span><span class="default">$full_tag</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$tag_names</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$i_allowedtags</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$i_trimtext</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$full_tags</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i_html </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$full_tag</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$i_html</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">$i_trimtext </span><span class="keyword">? </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$full_tags</span><span class="keyword">) : </span><span class="default">$i_html</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
And here's an example with the a block of full video embed code with &lt;object&gt;&lt;embed&gt;&lt;param&gt; and some extraneous HTML:<br />
<br />
<span class="default">&lt;?php<br />
$html </span><span class="keyword">=&lt;&lt;&lt;EOF<br />
</span><span class="string">&lt;em&gt;&lt;div&gt;&lt;object type="application/x-shock<br />
...[snip]...<br />
me.html"&gt;Wal-Mart Makes The Worst Movie of All-Time&lt;/a&gt; -- powered by whatever&lt;/div&gt;&lt;/em&gt;<br />
</span><span class="keyword">EOF;<br />
<br />
</span><span class="default">$good_html </span><span class="keyword">= </span><span class="default">real_strip_tags</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">, array(</span><span class="string">'object'</span><span class="keyword">, </span><span class="string">'embed'</span><span class="keyword">, </span><span class="string">'param'</span><span class="keyword">), </span><span class="default">TRUE</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Now $good_html contains only the specified tags and none of the "powered by" type text. I hope someone finds this as useful as I needed it to be. :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85940""></a>
  <div class="note">
   <strong class="user">southsentry at yahoo dot com</strong>
   <a href="#85940" class="date">25-Sep-2008 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking for a simple way to ban html from review posts, and the like. I have seen a few classes to do it. This line, while it doesn't strip the post, effectively blocks people from posting html in review and other forms.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$review</span><span class="keyword">)) &lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$review</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If you want to further get by the tricksters that use &amp; for html links, include this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$review</span><span class="keyword">)) &lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$review</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
} elseif ( </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$review</span><span class="keyword">, </span><span class="string">"&amp;"</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">5</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
I hope this helps someone out!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85291""></a>
  <div class="note">
   <strong class="user">Liam Morland</strong>
   <a href="#85291" class="date">23-Aug-2008 05:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a suggestion for getting rid of attributes: After you run your HTML through strip_tags(), use the DOM interface to parse the HTML. Recursively walk through the DOM tree and remove any unwanted attributes. Serialize the DOM back to the HTML string.<br />
<br />
Don't make the default permit mistake: Make a list of the attributes you want to ALLOW and remove any others, rather than removing a specific list, which may be missing something important.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82180""></a>
  <div class="note">
   <strong class="user">Kalle Sommer Nielsen</strong>
   <a href="#82180" class="date">30-Mar-2008 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This adds alot of missing javascript events on the strip_tags_attributes() function from below entries.<br />
<br />
Props to MSDN for lots of them ;)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_tags_attributes</span><span class="keyword">(</span><span class="default">$sSource</span><span class="keyword">, </span><span class="default">$aAllowedTags </span><span class="keyword">= array(), </span><span class="default">$aDisabledAttributes </span><span class="keyword">= array(</span><span class="string">'onabort'</span><span class="keyword">, </span><span class="string">'onactivate'</span><span class="keyword">, </span><span class="string">'onafterprint'</span><span class="keyword">, </span><span class="string">'onafterupdate'</span><span class="keyword">, </span><span class="string">'onbeforeactivate'</span><span class="keyword">, </span><span class="string">'onbeforecopy'</span><span class="keyword">, </span><span class="string">'onbeforecut'</span><span class="keyword">, </span><span class="string">'onbeforedeactivate'</span><span class="keyword">, </span><span class="string">'onbeforeeditfocus'</span><span class="keyword">, </span><span class="string">'onbeforepaste'</span><span class="keyword">, </span><span class="string">'onbeforeprint'</span><span class="keyword">, </span><span class="string">'onbeforeunload'</span><span class="keyword">, </span><span class="string">'onbeforeupdate'</span><span class="keyword">, </span><span class="string">'onblur'</span><span class="keyword">, </span><span class="string">'onbounce'</span><span class="keyword">, </span><span class="string">'oncellchange'</span><span class="keyword">, </span><span class="string">'onchange'</span><span class="keyword">, </span><span class="string">'onclick'</span><span class="keyword">, </span><span class="string">'oncontextmenu'</span><span class="keyword">, </span><span class="string">'oncontrolselect'</span><span class="keyword">, </span><span class="string">'oncopy'</span><span class="keyword">, </span><span class="string">'oncut'</span><span class="keyword">, </span><span class="string">'ondataavaible'</span><span class="keyword">, </span><span class="string">'ondatasetchanged'</span><span class="keyword">, </span><span class="string">'ondatasetcomplete'</span><span class="keyword">, </span><span class="string">'ondblclick'</span><span class="keyword">, </span><span class="string">'ondeactivate'</span><span class="keyword">, </span><span class="string">'ondrag'</span><span class="keyword">, </span><span class="string">'ondragdrop'</span><span class="keyword">, </span><span class="string">'ondragend'</span><span class="keyword">, </span><span class="string">'ondragenter'</span><span class="keyword">, </span><span class="string">'ondragleave'</span><span class="keyword">, </span><span class="string">'ondragover'</span><span class="keyword">, </span><span class="string">'ondragstart'</span><span class="keyword">, </span><span class="string">'ondrop'</span><span class="keyword">, </span><span class="string">'onerror'</span><span class="keyword">, </span><span class="string">'onerrorupdate'</span><span class="keyword">, </span><span class="string">'onfilterupdate'</span><span class="keyword">, </span><span class="string">'onfinish'</span><span class="keyword">, </span><span class="string">'onfocus'</span><span class="keyword">, </span><span class="string">'onfocusin'</span><span class="keyword">, </span><span class="string">'onfocusout'</span><span class="keyword">, </span><span class="string">'onhelp'</span><span class="keyword">, </span><span class="string">'onkeydown'</span><span class="keyword">, </span><span class="string">'onkeypress'</span><span class="keyword">, </span><span class="string">'onkeyup'</span><span class="keyword">, </span><span class="string">'onlayoutcomplete'</span><span class="keyword">, </span><span class="string">'onload'</span><span class="keyword">, </span><span class="string">'onlosecapture'</span><span class="keyword">, </span><span class="string">'onmousedown'</span><span class="keyword">, </span><span class="string">'onmouseenter'</span><span class="keyword">, </span><span class="string">'onmouseleave'</span><span class="keyword">, </span><span class="string">'onmousemove'</span><span class="keyword">, </span><span class="string">'onmoveout'</span><span class="keyword">, </span><span class="string">'onmouseover'</span><span class="keyword">, </span><span class="string">'onmouseup'</span><span class="keyword">, </span><span class="string">'onmousewheel'</span><span class="keyword">, </span><span class="string">'onmove'</span><span class="keyword">, </span><span class="string">'onmoveend'</span><span class="keyword">, </span><span class="string">'onmovestart'</span><span class="keyword">, </span><span class="string">'onpaste'</span><span class="keyword">, </span><span class="string">'onpropertychange'</span><span class="keyword">, </span><span class="string">'onreadystatechange'</span><span class="keyword">, </span><span class="string">'onreset'</span><span class="keyword">, </span><span class="string">'onresize'</span><span class="keyword">, </span><span class="string">'onresizeend'</span><span class="keyword">, </span><span class="string">'onresizestart'</span><span class="keyword">, </span><span class="string">'onrowexit'</span><span class="keyword">, </span><span class="string">'onrowsdelete'</span><span class="keyword">, </span><span class="string">'onrowsinserted'</span><span class="keyword">, </span><span class="string">'onscroll'</span><span class="keyword">, </span><span class="string">'onselect'</span><span class="keyword">, </span><span class="string">'onselectionchange'</span><span class="keyword">, </span><span class="string">'onselectstart'</span><span class="keyword">, </span><span class="string">'onstart'</span><span class="keyword">, </span><span class="string">'onstop'</span><span class="keyword">, </span><span class="string">'onsubmit'</span><span class="keyword">, </span><span class="string">'onunload'</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (empty(</span><span class="default">$aDisabledAttributes</span><span class="keyword">)) return </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$sSource</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$aAllowedTags</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;(.*?)&gt;/ie'</span><span class="keyword">, </span><span class="string">"'&lt;' . preg_replace(array('/javascript:[^\"\']*/i', '/(" </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">, </span><span class="default">$aDisabledAttributes</span><span class="keyword">) . </span><span class="string">")[ \\t\\n]*=[ \\t\\n]*[\"\'][^\"\']*[\"\']/i', '/\s+/'), array('', '', ' '), stripslashes('\\1')) . '&gt;'"</span><span class="keyword">, </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$sSource</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$aAllowedTags</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80429""></a>
  <div class="note">
   <strong class="user">bstrick at gmail dot com</strong>
   <a href="#80429" class="date">15-Jan-2008 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will strip all PHP and HTML out of a file.&nbsp; Leaves only plain txt.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Open the search file<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="comment">// Get rid of all PHP code.&nbsp; &nbsp; &nbsp; &nbsp; <br />
</span><span class="default">$search </span><span class="keyword">= array(</span><span class="string">'/&lt;\?((?!\?&gt;).)*\?&gt;/s'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
<br />
</span><span class="default">$new </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">));<br />
<br />
echo </span><span class="default">$new</span><span class="keyword">;<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
- Strick</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70945""></a>
  <div class="note">
   <strong class="user">David</strong>
   <a href="#70945" class="date">05-Nov-2006 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * strip_selected_tags ( string str [, string strip_tags[, strip_content flag]] )<br />
&nbsp;&nbsp; &nbsp; * ---------------------------------------------------------------------<br />
&nbsp;&nbsp; &nbsp; * Like strip_tags() but inverse; the strip_tags tags will be stripped, not kept.<br />
&nbsp;&nbsp; &nbsp; * strip_tags: string with tags to strip, ex: "&lt;a&gt;&lt;p&gt;&lt;quote&gt;" etc.<br />
&nbsp;&nbsp; &nbsp; * strip_content flag: TRUE will also strip everything between open and closed tag<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">strip_selected_tags</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$tags </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$stripContent </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;([^&gt;]+)&gt;/i"</span><span class="keyword">,</span><span class="default">$tags</span><span class="keyword">,</span><span class="default">$allTags</span><span class="keyword">,</span><span class="default">PREG_PATTERN_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$allTags</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$tag</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$stripContent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">"[^&gt;]*&gt;.*&lt;\/"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">"&gt;/iU"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&lt;\/?"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">"[^&gt;]*&gt;/iU"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69740""></a>
  <div class="note">
   <strong class="user">jausions at php dot net</strong>
   <a href="#69740" class="date">18-Sep-2006 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To sanitize any user input, you should also consider PEAR's HTML_Safe package.<br />
<br />
<a href="http://pear.php.net/package/HTML_Safe" rel="nofollow" target="_blank">http://pear.php.net/package/HTML_Safe</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68757""></a>
  <div class="note">
   <strong class="user">admin at automapit dot com</strong>
   <a href="#68757" class="date">09-Aug-2006 10:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">html2txt</span><span class="keyword">(</span><span class="default">$document</span><span class="keyword">){<br />
</span><span class="default">$search </span><span class="keyword">= array(</span><span class="string">'@&lt;script[^&gt;]*?&gt;.*?&lt;/script&gt;@si'</span><span class="keyword">,&nbsp; </span><span class="comment">// Strip out javascript<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'@&lt;[\/\!]*?[^&lt;&gt;]*?&gt;@si'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Strip out HTML tags<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'@&lt;style[^&gt;]*?&gt;.*?&lt;/style&gt;@siU'</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">// Strip style tags properly<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'@&lt;![\s\S]*?--[ \t\n\r]*&gt;@'&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Strip multi-line comments including CDATA<br />
</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$document</span><span class="keyword">);<br />
return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This function turns HTML into text... strips tags, comments spanning multiple lines including CDATA, and anything else that gets in it's way.<br />
<br />
It's a frankenstein function I made from bits picked up on my travels through the web, thanks to the many who have unwittingly contributed!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64121""></a>
  <div class="note">
   <strong class="user">JeremysFilms.com</strong>
   <a href="#64121" class="date">07-Apr-2006 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple little function for blocking tags by replacing the '&lt;' and '&gt;' characters with their HTML entities.&nbsp; Good for simple posting systems that you don't want to have a chance of stripping non-HTML tags, or just want everything to show literally without any security issues:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">block_tags</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replaced_string </span><span class="keyword">= </span><span class="default">str_ireplace</span><span class="keyword">(</span><span class="string">'&lt;'</span><span class="keyword">,</span><span class="string">'&amp;lt'</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replaced_string </span><span class="keyword">= </span><span class="default">str_ireplace</span><span class="keyword">(</span><span class="string">'&gt;'</span><span class="keyword">,</span><span class="string">'&amp;gt'</span><span class="keyword">,</span><span class="default">$replaced_string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$replaced_string</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">block_tags</span><span class="keyword">(</span><span class="string">'&lt;b&gt;HEY&lt;/b&gt;'</span><span class="keyword">); </span><span class="comment">//Returns &amp;ltb&amp;gtHEY&amp;lt/b&amp;gt<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62705""></a>
  <div class="note">
   <strong class="user">cesar at nixar dot org</strong>
   <a href="#62705" class="date">07-Mar-2006 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a recursive function for strip_tags like the one showed in the stripslashes manual page.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strip_tags_deep</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp; return </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ?<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'strip_tags_deep'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) :<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// Example<br />
</span><span class="default">$array </span><span class="keyword">= array(</span><span class="string">'&lt;b&gt;Foo&lt;/b&gt;'</span><span class="keyword">, </span><span class="string">'&lt;i&gt;Bar&lt;/i&gt;'</span><span class="keyword">, array(</span><span class="string">'&lt;b&gt;Foo&lt;/b&gt;'</span><span class="keyword">, </span><span class="string">'&lt;i&gt;Bar&lt;/i&gt;'</span><span class="keyword">));<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">strip_tags_deep</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Output<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61834""></a>
  <div class="note">
   <strong class="user">salavert at~ akelos</strong>
   <a href="#61834" class="date">13-Feb-2006 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * Works like PHP function strip_tags, but it only removes selected tags.<br />
&nbsp;&nbsp;&nbsp; * Example:<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; strip_selected_tags('&lt;b&gt;Person:&lt;/b&gt; &lt;strong&gt;Salavert&lt;/strong&gt;', 'strong') =&gt; &lt;b&gt;Person:&lt;/b&gt; Salavert<br />
&nbsp;&nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">strip_selected_tags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$tags </span><span class="keyword">= array())<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">() &gt; </span><span class="default">2 </span><span class="keyword">? </span><span class="default">array_diff</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">,array(</span><span class="default">$text</span><span class="keyword">))&nbsp; : (array)</span><span class="default">$tags</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">'[^&gt;]*&gt;(.*)&lt;\/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">'&gt;/iU'</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$found</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$found</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$found</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope you find it useful,<br />
<br />
Jose Salavert</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61385""></a>
  <div class="note">
   <strong class="user">webmaster at tmproductionz dot com</strong>
   <a href="#61385" class="date">01-Feb-2006 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">remove_tag </span><span class="keyword">( </span><span class="default">$tag </span><span class="keyword">, </span><span class="default">$data </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while ( </span><span class="default">eregi </span><span class="keyword">( </span><span class="string">"&lt;" </span><span class="keyword">. </span><span class="default">$tag </span><span class="keyword">, </span><span class="default">$data </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$it&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">stripos </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">, </span><span class="string">"&lt;" </span><span class="keyword">. </span><span class="default">$tag&nbsp;&nbsp; </span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$it2&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">stripos </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">, </span><span class="string">"&lt;/" </span><span class="keyword">. </span><span class="default">$tag </span><span class="keyword">. </span><span class="string">"&gt;" </span><span class="keyword">) + </span><span class="default">strlen </span><span class="keyword">( </span><span class="default">$tag </span><span class="keyword">) + </span><span class="default">3 </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp&nbsp; </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">, </span><span class="default">0&nbsp; &nbsp; </span><span class="keyword">, </span><span class="default">$it&nbsp; </span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp2 </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">, </span><span class="default">$it2 </span><span class="keyword">, </span><span class="default">strlen </span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">) ) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$temp </span><span class="keyword">. </span><span class="default">$temp2 </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$data </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
this code will remove only and all of the specified tag from a given haystack.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55695""></a>
  <div class="note">
   
   <a href="#55695" class="date">10-Aug-2005 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**removes specifed tags from the text where each tag requires a <br />
&nbsp;&nbsp; &nbsp; *closing tag and if the later<br />
&nbsp;&nbsp; &nbsp; *is not found then everything after will be removed<br />
&nbsp;&nbsp; &nbsp; *typical usage:<br />
&nbsp;&nbsp; &nbsp; *some html text, array('script','body','html') - all lower case*/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">removeTags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$tags_array</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tags_array </span><span class="keyword">= </span><span class="default">$array_flip</span><span class="keyword">(</span><span class="default">$tags_array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$pos </span><span class="keyword">&lt; </span><span class="default">$length </span><span class="keyword">&amp;&amp; (</span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="string">'&lt;'</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dlm_pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dlm2_pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="string">'&gt;'</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$dlm_pos </span><span class="keyword">&gt; </span><span class="default">$dlm2_pos</span><span class="keyword">)</span><span class="default">$dlm_pos</span><span class="keyword">=</span><span class="default">$dlm2_pos</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$which_tag </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">,</span><span class="default">$dlm_pos</span><span class="keyword">-(</span><span class="default">$pos</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tag_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$srch_tag</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$tags_array</span><span class="keyword">[</span><span class="default">$which_tag</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//if no tag matches found<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">++</span><span class="default">$pos</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//find the end<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sec_tag </span><span class="keyword">= </span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$which_tag</span><span class="keyword">.</span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sec_pos </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$sec_tag</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">+</span><span class="default">$tag_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//remove everything after if end of the tag not found<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$sec_pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) </span><span class="default">$sec_pos </span><span class="keyword">= </span><span class="default">$length</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$sec_tag</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rmv_length </span><span class="keyword">= </span><span class="default">$sec_pos</span><span class="keyword">-</span><span class="default">$pos</span><span class="keyword">+</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$sec_tag</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">,</span><span class="default">$rmv_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//update length<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">$length </span><span class="keyword">- </span><span class="default">$rmv_length</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53292""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#53292" class="date">27-May-2005 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Someone can use attributes like CSS in the tags.<br />
Example, you strip all tagw except &lt;b&gt; then a user can still do &lt;b style="color: red; font-size: 45pt"&gt;Hello&lt;/b&gt; which might be undesired.<br />
<br />
Maybe BB Code would be something.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48364""></a>
  <div class="note">
   <strong class="user">eric at direnetworks dot com</strong>
   <a href="#48364" class="date">20-Dec-2004 06:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the strip_tags() function in both php 4.3.8 and 5.0.2 (probably many more, but these are the only 2 versions I tested with) have a max tag length of 1024.&nbsp; If you're trying to process a tag over this limit, strip_tags will not return that line (as if it were an illegal tag).&nbsp;&nbsp; I noticed this problem while trying to parse a paypal encrypted link button (&lt;input type="hidden" name="encrypted" value="encryptedtext"&gt;, with &lt;input&gt; as an allowed tag), which is 2702 characters long.&nbsp; I can't really think of any workaround for this other than parsing each tag to figure out the length, then only sending it to strip_tags() if its under 1024, but at that point, I might as well be stripping the tags myself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46101""></a>
  <div class="note">
   <strong class="user">@dada</strong>
   <a href="#46101" class="date">29-Sep-2004 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you&nbsp; only want to have the text within the tags, you can use this function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">showtextintags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)<br />
<br />
{<br />
<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(\&lt;script)(.*?)(script&gt;)/si"</span><span class="keyword">, </span><span class="string">"dada"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$text</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&lt;!--"</span><span class="keyword">, </span><span class="string">"&amp;lt;!--"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(\&lt;)(.*?)(--\&gt;)/mi"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">.</span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"\\2"</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
return </span><span class="default">$text</span><span class="keyword">;<br />
<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
it will show all the text without tags and (!!!) without javascripts</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44987""></a>
  <div class="note">
   <strong class="user">Anonymous User</strong>
   <a href="#44987" class="date">22-Aug-2004 09:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that tags constitute visual whitespace, so stripping may leave the resulting text looking misjoined.<br />
<br />
For example, <br />
<br />
"&lt;strong&gt;This is a bit of text&lt;/strong&gt;&lt;p /&gt;Followed by this bit"<br />
<br />
are seperable paragraphs on a visual plane, but if simply stripped of tags will result in<br />
<br />
"This is a bit of textFollowed by this bit"<br />
<br />
which may not be what you want, e.g. if you are creating an excerpt for an RSS description field.<br />
<br />
The workaround is to force whitespace prior to stripping, using something like this:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp;&nbsp; $text </span><span class="keyword">= </span><span class="default">getTheText</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;/'</span><span class="keyword">,</span><span class="string">' &lt;'</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&gt;/'</span><span class="keyword">,</span><span class="string">'&gt; '</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$desc </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$desc </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[\n\r\t]/'</span><span class="keyword">,</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$desc</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$desc </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&nbsp; /'</span><span class="keyword">,</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$desc</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44771""></a>
  <div class="note">
   <strong class="user">Isaac Schlueter php at isaacschlueter dot com</strong>
   <a href="#44771" class="date">15-Aug-2004 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am creating a rendering plugin for a CMS system (<a href="http://b2evolution.net" rel="nofollow" target="_blank">http://b2evolution.net</a>) that wraps certain bits of text in acronym tags.&nbsp; The problem is that if you have something like this:<br />
&lt;a href="<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>" title="PHP is cool!"&gt;PHP&lt;/a&gt;<br />
<br />
then the plugin will mangle it into:<br />
<br />
&lt;a href="<a href="http://www.&lt;acronym title=" rel="nofollow" target="_blank">http://www.&lt;acronym title=</a>"PHP: Hypertext Processor"&gt;php&lt;/acronym&gt;.net" title="&lt;acronym title="PHP: Hypertext Processor"&gt;PHP&lt;/acronym&gt; is cool!&gt;PHP&lt;/a&gt;<br />
<br />
This function will strip out tags that occur within other tags.&nbsp; Not super-useful in tons of situations, but it was an interesting puzzle.&nbsp; I had started out using preg_replace, but it got riduculously complicated when there were linebreaks and multiple instances in the same tag.<br />
<br />
The CMS does its XHTML validation before the content gets to the plugin, so we can be pretty sure that the content is well-formed, except for the tags inside of other tags.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'antiTagInTag' </span><span class="keyword">) )<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// $content is the string to be anti-tagintagged, and $format sets the format of the internals.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">antiTagInTag</span><span class="keyword">( </span><span class="default">$content </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'htmlhead' </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'format_to_output' </span><span class="keyword">) ) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; </span><span class="comment">// Use the external function if it exists, or fall back on just strip_tags.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">format_to_output</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">, </span><span class="default">$format</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contentwalker </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$content </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagend </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$tagstart </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="string">'&lt;'</span><span class="keyword">, </span><span class="default">$tagend </span><span class="keyword">+ </span><span class="default">1 </span><span class="keyword">) ; </span><span class="default">$tagstart </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">&amp;&amp; </span><span class="default">$tagstart </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$content </span><span class="keyword">); </span><span class="default">$tagstart </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="string">'&lt;'</span><span class="keyword">, </span><span class="default">$tagend </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// got the start of a tag.&nbsp; Now find the proper end!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$walker </span><span class="keyword">= </span><span class="default">$tagstart </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$open </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">$open </span><span class="keyword">!= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$walker </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$content </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nextopen </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="string">'&lt;'</span><span class="keyword">, </span><span class="default">$walker </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nextclose </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="string">'&gt;'</span><span class="keyword">, </span><span class="default">$walker </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$nextclose </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; </span><span class="comment">// ERROR! Open waka without close waka!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // echo '&lt;code&gt;Error in antiTagInTag - malformed tag!&lt;/code&gt; ';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$nextopen </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">$nextopen </span><span class="keyword">&gt; </span><span class="default">$nextclose </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { </span><span class="comment">// No more opens, but there was a close; or, a close happens before the next open.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // walker goes to the close+1, and open decrements<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$open </span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$walker </span><span class="keyword">= </span><span class="default">$nextclose </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif( </span><span class="default">$nextopen </span><span class="keyword">&lt; </span><span class="default">$nextclose </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { </span><span class="comment">// an open before the next close<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$open </span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$walker </span><span class="keyword">= </span><span class="default">$nextopen </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagend </span><span class="keyword">= </span><span class="default">$walker</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$tagend </span><span class="keyword">&gt; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$content </span><span class="keyword">) ) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagend </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$content </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagend </span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagstart </span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="default">$tagstart</span><span class="keyword">, </span><span class="default">$tagend </span><span class="keyword">- </span><span class="default">$tagstart </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tags</span><span class="keyword">[] = </span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newtag </span><span class="keyword">= </span><span class="default">format_to_output</span><span class="keyword">( </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$format </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newtags</span><span class="keyword">[] = </span><span class="string">'&lt;' </span><span class="keyword">. </span><span class="default">$newtag </span><span class="keyword">. </span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newtag </span><span class="keyword">= </span><span class="default">format_to_output</span><span class="keyword">( </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$format </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">, </span><span class="default">$newtags</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36898""></a>
  <div class="note">
   <strong class="user">leathargy at hotmail dot com</strong>
   <a href="#36898" class="date">26-Oct-2003 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it seems we're all overlooking a few things:<br />
1) if we replace "&lt;/ta&lt;/tableble&gt;" by removing &lt;/table, we're not better off. try using a char-by-char comparison, and replaceing stuff with *s, because then this ex would become "&lt;/ta******ble&gt;", which is not problemmatic; also, with a char by char approach, you can skip whitespace, and kill stuff like "&lt; table&gt;"... just make sure &lt;&amp;bkspTable&gt; doesn't work...<br />
2) no browser treats { as &lt;.[as far as i know]<br />
3) because of statement 2, we can do:<br />
<br />
<span class="default">&lt;?php<br />
$remove</span><span class="keyword">=array(</span><span class="string">"&lt;?"</span><span class="keyword">,</span><span class="string">"&lt;"</span><span class="keyword">,</span><span class="string">"?&gt;"</span><span class="keyword">,</span><span class="string">"&gt;"</span><span class="keyword">);<br />
</span><span class="default">$change</span><span class="keyword">=array(</span><span class="string">"{[pre]}"</span><span class="keyword">,</span><span class="string">"{["</span><span class="keyword">,</span><span class="string">"{/pre}"</span><span class="keyword">,</span><span class="string">"]}"</span><span class="keyword">);<br />
</span><span class="default">$repairSeek </span><span class="keyword">= array(</span><span class="string">"{[pre]}"</span><span class="keyword">, </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">,</span><span class="string">"{[b]}"</span><span class="keyword">,</span><span class="string">"{[/b]}"</span><span class="keyword">,</span><span class="string">"{[br]}"</span><span class="keyword">);<br />
</span><span class="comment">// and so forth...<br />
<br />
</span><span class="default">$repairChange</span><span class="keyword">(</span><span class="string">"&lt;pre&gt;"</span><span class="keyword">,</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">,</span><span class="string">"&lt;b&gt;"</span><span class="keyword">,</span><span class="string">"&lt;b&gt;"</span><span class="keyword">,</span><span class="string">"&lt;br&gt;"</span><span class="keyword">);<br />
</span><span class="comment">// and so forth...<br />
<br />
</span><span class="default">$maltags</span><span class="keyword">=array(</span><span class="string">"{["</span><span class="keyword">,</span><span class="string">"]}"</span><span class="keyword">);<br />
</span><span class="default">$nontags</span><span class="keyword">=array(</span><span class="string">"{"</span><span class="keyword">,</span><span class="string">"}"</span><span class="keyword">);<br />
</span><span class="default">$unclean</span><span class="keyword">=...;</span><span class="comment">//get variable from somewhere...<br />
</span><span class="default">$unclean</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$remove</span><span class="keyword">,</span><span class="default">$change</span><span class="keyword">,</span><span class="default">$unclean</span><span class="keyword">);<br />
</span><span class="default">$unclean</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$repairSeek</span><span class="keyword">, </span><span class="default">$repairChange</span><span class="keyword">, </span><span class="default">$unclean</span><span class="keyword">);<br />
</span><span class="default">$clean</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$maltags</span><span class="keyword">, </span><span class="default">$nontags</span><span class="keyword">, </span><span class="default">$unclean</span><span class="keyword">);<br />
<br />
</span><span class="comment">////end example....<br />
</span><span class="default">?&gt;<br />
</span><br />
4) we can further improve the above by using explode(for our ease):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">purifyText</span><span class="keyword">(</span><span class="default">$unclean</span><span class="keyword">, </span><span class="default">$fixme</span><span class="keyword">)<br />
{<br />
</span><span class="default">$remove</span><span class="keyword">=array();<br />
</span><span class="default">$remove</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$fixit</span><span class="keyword">[</span><span class="string">'remove'</span><span class="keyword">]);<br />
</span><span class="comment">//... and so forth for each of the above arrays...<br />
// or you could just pass the arrays..., or a giant string<br />
//put above here...<br />
</span><span class="keyword">return </span><span class="default">$clean<br />
</span><span class="keyword">}</span><span class="comment">//done<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35679""></a>
  <div class="note">
   <strong class="user">dougal at gunters dot org</strong>
   <a href="#35679" class="date">10-Sep-2003 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
strip_tags() appears to become nauseated at the site of a &lt;!DOCTYPE&gt; declaration (at least in PHP 4.3.1). You might want to do something like:<br />
<br />
$html = str_replace('&lt;!DOCTYPE','&lt;DOCTYPE',$html);<br />
<br />
before processing with strip_tags().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19925""></a>
  <div class="note">
   <strong class="user">guy at datalink dot SPAMMENOT dot net dot au</strong>
   <a href="#19925" class="date">14-Mar-2002 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Strip tags will NOT remove HTML entities such as &amp;nbsp;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17656""></a>
  <div class="note">
   <strong class="user">chrisj at thecyberpunk dot com</strong>
   <a href="#17656" class="date">18-Dec-2001 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
strip_tags has doesn't recognize that css within the style tags are not document text. To fix this do something similar to the following:<br />
<br />
$htmlstring = preg_replace("'&lt;style[^&gt;]*&gt;.*&lt;/style&gt;'siU",'',$htmlstring);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.strcspn.html">strcspn</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.stripcslashes.html">stripcslashes</a></div>
 <div class="up"><a href="ref.strings.html">String Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
