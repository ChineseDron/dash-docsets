<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Deletes a file</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.umask.html">umask</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="book.inotify.html">Inotify</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.unlink" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">unlink</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">unlink</span> &mdash; <span class="dc-title">Deletes a file</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.unlink-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><b>unlink</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$filename</tt></span>
   [, <span class="methodparam"><span class="type">resource</span> <tt class="parameter">$context</tt></span>
  ] )</div>

  <p class="para rdfs-comment">
   Deletes <i><tt class="parameter">filename</tt></i>.  Similar to the Unix C unlink()
   function. A <b><tt>E_WARNING</tt></b> level error will be generated on
   failure.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.unlink-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">filename</tt></i></span>
     <dd>

      <p class="para">
       Path to the file.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">context</tt></i></span>
     <dd>

      <blockquote class="note"><p><b class="note">Note</b>: <span class="simpara">Context support was added
with PHP 5.0.0. For a description of <i>contexts</i>, refer to
<a href="book.stream.html" class="xref">Streams</a>.</span></p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.unlink-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <b><tt>TRUE</tt></b> on success or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.unlink-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.0.0</td>
       <td align="left">
        As of PHP 5.0.0 <span class="function"><b>unlink()</b></span> can also be used with
        <em class="emphasis">some</em> URL wrappers. Refer to <a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a> for a listing of which wrappers support
        <span class="function"><b>unlink()</b></span>.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.unlink-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-2235">
    <p><b>Example #1 Basic <span class="function"><b>unlink()</b></span> usage</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$fh&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.html'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'a'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fh</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'&lt;h1&gt;Hello&nbsp;world!&lt;/h1&gt;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fh</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">unlink</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.html'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.unlink-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.rmdir.html" class="function" rel="rdfs-seeAlso">rmdir()</a> - Removes directory</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106952""></a>
  <div class="note">
   <strong class="user">tornadossash at yahoo dot com</strong>
   <a href="#106952" class="date">20-Dec-2011 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I also had the permission denied problem on Windows IIS7.0 (Vista). I could avoid this error if I give the user IUSR rights on the folder where the files are being written.<br />
<br />
method:<br />
folder: right click - properties - security - add user IUSR<br />
give him full rights on this folder.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104370""></a>
  <div class="note">
   <strong class="user">holdoffhunger at gmail dot com</strong>
   <a href="#104370" class="date">11-Jun-2011 08:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There seems to be a lot of independent investigators here looking for buggy execution of this code (which actually be caused by or worsened by a Windows, Server operating system).&nbsp; The main issue seems to be knowing for certain that the file was actually deleted, for example, not producing an error when a file isn't deleted on the command, or producing an error when the file actually is deleted.&nbsp; Anyhow, the following is a tiny piece of code that absolutely deletes, even if it produces an error message, or never finishes, if it is unable to delete.<br />
<br />
There are two outcomes: (1) It deletes the file, and continues happily along, error message, or not.&nbsp; (2) It can't delete the file, can't modify the permissions, etc., and therefore, the script never completes, or it may throw some PHP errors at you eventually.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data_file_to_delete</span><span class="keyword">) == </span><span class="default">TRUE</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$data_file_to_delete</span><span class="keyword">, </span><span class="default">0666</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$data_file_to_delete</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102565""></a>
  <div class="note">
   <strong class="user">webmaster at sebastiangrinke dot info</strong>
   <a href="#102565" class="date">21-Feb-2011 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a problem with unwriteable files test this ;)<br />
Its a bit longer but it works really fine for me :)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">delete_folder</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">){<br />
&nbsp; if(!</span><span class="default">is_writeable</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">) &amp;&amp; </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">)){</span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">,</span><span class="default">0777</span><span class="keyword">);}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">);<br />
&nbsp; while(</span><span class="default">$tmp</span><span class="keyword">=</span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$tmp</span><span class="keyword">!=</span><span class="string">'..' </span><span class="keyword">&amp;&amp; </span><span class="default">$tmp</span><span class="keyword">!=</span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$tmp</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_writeable</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }elseif(!</span><span class="default">is_writeable</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">0666</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_writeable</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">delete_folder</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }elseif(!</span><span class="default">is_writeable</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">0777</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">delete_folder</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp; </span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">);<br />
&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$tmp_path</span><span class="keyword">)){return </span><span class="default">true</span><span class="keyword">;}<br />
&nbsp; else{return </span><span class="default">false</span><span class="keyword">;}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101637""></a>
  <div class="note">
   <strong class="user">dexen dot devries at gmail dot com</strong>
   <a href="#101637" class="date">31-Dec-2010 01:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Deleted a large file but seeing no increase in free space or decrease of disk usage? Using UNIX or other POSIX OS?<br />
<br />
The unlink() is not about removing file, it's about removing a file name. The manpage says: ``unlink - delete a name and possibly the file it refers to''.<br />
<br />
Most of the time a file has just one name -- removing it will also remove (free, deallocate) the `body' of file (with one caveat, see below). That's the simple, usual case.<br />
<br />
However, it's perfectly fine for a file to have several names (see the link() function), in the same or different directories. All the names will refer to the file body and `keep it alive', so to say. Only when all the names are removed, the body of file actually is freed.<br />
<br />
The caveat:<br />
A file's body may *also* be `kept alive' (still using diskspace) by a process holding the file open. The body will not be deallocated (will not free disk space) as long as the process holds it open. In fact, there's a fancy way of resurrecting a file removed by a mistake but still held open by a process...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101261""></a>
  <div class="note">
   <strong class="user">federico at poisonfx dot com</strong>
   <a href="#101261" class="date">06-Dec-2010 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here the simplest way to delete files with mask<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; $mask </span><span class="keyword">= </span><span class="string">"*.jpg"<br />
&nbsp;&nbsp; </span><span class="default">array_map</span><span class="keyword">( </span><span class="string">"unlink"</span><span class="keyword">, </span><span class="default">glob</span><span class="keyword">( </span><span class="default">$mask </span><span class="keyword">) );<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101098""></a>
  <div class="note">
   <strong class="user">kgy</strong>
   <a href="#101098" class="date">25-Nov-2010 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a note to the windows unlink problem. I had some code running on a linux server, unlinking files fine, but when i switched to my home computer running on windows, i suddenly had the unlink - permission denied problem. After trying everything (all those things with ownership, etc.), i found out that my file (a temporary file created with tempnam) was not closed, therefore it couldn't be unlinked. I hope this helps someone outthere :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100580""></a>
  <div class="note">
   <strong class="user">lpatrick</strong>
   <a href="#100580" class="date">25-Oct-2010 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
unlink can fail after using ODBC commands on the file (on Windows).<br />
<br />
Neither <span class="default">&lt;?php odbc_free_result</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); </span><span class="default">?&gt;</span> nor <span class="default">&lt;?php odbc_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">); unset(</span><span class="default">$conn</span><span class="keyword">); </span><span class="default">?&gt;</span> did the trick.<br />
<br />
Only <span class="default">&lt;?php odbc_close_all</span><span class="keyword">(); </span><span class="default">?&gt;</span> released the file such that it could be deleted afterwards ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100092""></a>
  <div class="note">
   <strong class="user">zibi at nora dot pl</strong>
   <a href="#100092" class="date">24-Sep-2010 07:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Shorter'n'faster version of Eddys "The shortest recursive delete possible"<br />
<br />
function rrmdir($path)<br />
{<br />
&nbsp; return is_file($path)?<br />
&nbsp;&nbsp;&nbsp; @unlink($path):<br />
&nbsp;&nbsp;&nbsp; array_map('rrmdir',glob($path.'/*'))==@rmdir($path)<br />
&nbsp; ;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98861""></a>
  <div class="note">
   <strong class="user">layla_mwazza at hotmail dot com</strong>
   <a href="#98861" class="date">12-Jul-2010 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
May sound dumb, but it may help. Permission denied? Is the file still open in your script? Was for me...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97744""></a>
  <div class="note">
   <strong class="user">mateusz at bkfmyjnie dot pl</strong>
   <a href="#97744" class="date">06-May-2010 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using PHP &gt;= 5.0, consider using RecursiveDirectoryIterator (<a href="http://php.net/manual/en/class.recursivedirectoryiterator.php" rel="nofollow" target="_blank">http://php.net/manual/en/class.recursivedirectoryiterator.php</a>) class to iterate over all directories and files in a subtree in order to remove them.<br />
Just be sure to use -&gt;isDot() (<a href="http://php.net/manual/en/directoryiterator.isdir.php" rel="nofollow" target="_blank">http://php.net/manual/en/directoryiterator.isdir.php</a>) to check for, and skip, dot and dot-dot (`.' and `..') directories :P</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94766""></a>
  <div class="note">
   <strong class="user">Eddy Vlad</strong>
   <a href="#94766" class="date">23-Nov-2009 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The shortest recursive delete possible.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Delete a file or recursively delete a directory<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param string $str Path to file or directory<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">recursiveDelete</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return @</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$scan </span><span class="keyword">= </span><span class="default">glob</span><span class="keyword">(</span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">).</span><span class="string">'/*'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$scan </span><span class="keyword">as </span><span class="default">$index</span><span class="keyword">=&gt;</span><span class="default">$path</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">recursiveDelete</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return @</span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91499""></a>
  <div class="note">
   <strong class="user">reminder</strong>
   <a href="#91499" class="date">12-Jun-2009 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
careful with unlink...<br />
"very unlikely" is not "impossible" : granted, it will happen.<br />
<br />
1) "expected" : a typo and you'll get : unlink('/')<br />
2) "very likely" : some of your files are writeable by anyone. <br />
3) "possible" : you're backup drive is mounted and preserves the authorizations of the original files<br />
4) "very unlikely" : that particular day, at that particular moment, the unlink function decided to work recursively<br />
<br />
played all day long with ext3grep : no result.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87045""></a>
  <div class="note">
   <strong class="user">Jon Hassall</strong>
   <a href="#87045" class="date">16-Nov-2008 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the recursive delete method made a little more readable:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Recursively delete a directory<br />
&nbsp;*<br />
&nbsp;* @param string $dir Directory name<br />
&nbsp;* @param boolean $deleteRootToo Delete specified top-level directory as well<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">unlinkRecursive</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$deleteRootToo</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$obj </span><span class="keyword">== </span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$obj </span><span class="keyword">== </span><span class="string">'..'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$obj</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlinkRecursive</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$deleteRootToo</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86734""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#86734" class="date">01-Nov-2008 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To unlink, the web server user must have write permissions to the directory.<br />
<br />
Conversely, if a user has write permissions to a directory, it may delete files from that directory regardless of who owns them...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86302""></a>
  <div class="note">
   <strong class="user">hi at hi dot hi</strong>
   <a href="#86302" class="date">11-Oct-2008 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
using this function with windows will generate an error, make sure to use is_file</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86167""></a>
  <div class="note">
   <strong class="user">garagod at gmail dot com</strong>
   <a href="#86167" class="date">06-Oct-2008 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When I'm using unlink() or rename() with a SSH2.SFTP wrapper, both functions always return FALSE (but without a warning) even on success.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">SERVER_NAME</span><span class="keyword">, </span><span class="default">PORT</span><span class="keyword">);<br />
</span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">USERNAME</span><span class="keyword">, </span><span class="default">PASSWORD</span><span class="keyword">);<br />
</span><span class="default">$sftp </span><span class="keyword">= </span><span class="default">ssh2_sftp</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);<br />
<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="string">"ssh2.s<a href="ftp://" rel="nofollow" target="_blank">ftp://</a></span><span class="default">$sftp</span><span class="string">/" </span><span class="keyword">. </span><span class="default">REMOTE_DIRECTORY </span><span class="keyword">. </span><span class="default">FILENAME</span><span class="keyword">); </span><span class="comment">// returns FALSE on success and on failure<br />
<br />
</span><span class="default">rename</span><span class="keyword">(</span><span class="string">"ssh2.s<a href="ftp://" rel="nofollow" target="_blank">ftp://</a></span><span class="default">$sftp</span><span class="string">/" </span><span class="keyword">. </span><span class="default">REMOTE_DIRECTORY </span><span class="keyword">. </span><span class="default">OLD_FILENAME</span><span class="keyword">, </span><span class="string">"ssh2.s<a href="ftp://" rel="nofollow" target="_blank">ftp://</a></span><span class="default">$sftp</span><span class="string">/" </span><span class="keyword">. </span><span class="default">REMOTE_DIRECTORY </span><span class="keyword">. </span><span class="default">NEW_FILENAME</span><span class="keyword">); </span><span class="comment">// returns FALSE on success and on failure<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86062""></a>
  <div class="note">
   <strong class="user">http://www.paladinux.net</strong>
   <a href="#86062" class="date">01-Oct-2008 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Under Windows System and Apache, denied access to file is an usual error to unlink file.<br />
To delete file you must to change file's owern.<br />
An example:<br />
<br />
<span class="default">&lt;?php<br />
chown</span><span class="keyword">(</span><span class="default">$TempDirectory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$FileName</span><span class="keyword">,</span><span class="default">666</span><span class="keyword">); </span><span class="comment">//Insert an Invalid UserId to set to Nobody Owern; 666 is my standard for "Nobody"<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$TempDirectory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$FileName</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85938""></a>
  <div class="note">
   <strong class="user">gotdalife at gmail dot com</strong>
   <a href="#85938" class="date">25-Sep-2008 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To anyone who's had a problem with the permissions denied error, it's sometimes caused when you try to delete a file that's in a folder higher in the hierarchy to your working directory (i.e. when trying to delete a path that starts with "../").<br />
<br />
So to work around this problem, you can use chdir() to change the working directory to the folder where the file you want to unlink is located.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $old </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">(); </span><span class="comment">// Save the current directory<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$path_to_file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$old</span><span class="keyword">); </span><span class="comment">// Restore the old working directory&nbsp; &nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85443""></a>
  <div class="note">
   <strong class="user">southsentry at yahoo dot com</strong>
   <a href="#85443" class="date">31-Aug-2008 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is in response to alvaro at demogracia dot com<br />
<br />
Yes, I found that out and have had to wrap it with is_file:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">)) {<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84928""></a>
  <div class="note">
   <strong class="user">PD</strong>
   <a href="#84928" class="date">06-Aug-2008 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been working on some little tryout where a backup file was created before modifying the main textfile. Then when an error is thrown, the main file will be deleted (unlinked) and the backup file is returned instead.<br />
<br />
Though, I have been breaking my head for about an hour on why I couldn't get my persmissions right to unlink the main file.<br />
<br />
Finally I knew what was wrong: because I was working on the file and hadn't yet closed the file, it was still in use and ofcourse couldn't be deleted :)<br />
<br />
So I thought of mentoining this here, to avoid others of making the same mistake:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// First close the file<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Then unlink :)<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$somefile</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80110""></a>
  <div class="note">
   <strong class="user">Guilherme Komel</strong>
   <a href="#80110" class="date">29-Dec-2007 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have founda that trying to delete a file using relative path like the example below does not work.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $do </span><span class="keyword">= </span><span class="default">unlink</span><span class="keyword">(</span><span class="string">"../pics/</span><span class="default">$fileToDel</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$do</span><span class="keyword">==</span><span class="string">"1"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"The file was deleted successfully."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else { echo </span><span class="string">"There was an error trying to delete the file."</span><span class="keyword">; } <br />
</span><span class="default">?&gt;<br />
</span><br />
I did not work at all, instead what I had to do was: <br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; chdir</span><span class="keyword">(</span><span class="string">'../pics/'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$do </span><span class="keyword">= </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$fileToDel</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$do</span><span class="keyword">==</span><span class="string">"1"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"The file was deleted successfully."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else { echo </span><span class="string">"There was an error trying to delete the file."</span><span class="keyword">; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Then it worked !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79940""></a>
  <div class="note">
   <strong class="user">ayor ATTTTT ayor.biz</strong>
   <a href="#79940" class="date">20-Dec-2007 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ggarciaa's post above has already one small error, closedir has to be used even if $DeleteMe is false<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// ggarciaa at gmail dot com (04-July-2007 01:57)<br />
// I needed to empty a directory, but keeping it<br />
// so I slightly modified the contribution from<br />
// stefano at takys dot it (28-Dec-2005 11:57)<br />
// A short but powerfull recursive function<br />
// that works also if the dirs contain hidden files<br />
//<br />
// $dir = the target directory<br />
// $DeleteMe = if true delete also $dir, if false leave it alone<br />
<br />
</span><span class="keyword">function </span><span class="default">SureRemoveDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$DeleteMe</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) return;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$obj</span><span class="keyword">==</span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$obj</span><span class="keyword">==</span><span class="string">'..'</span><span class="keyword">) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">)) </span><span class="default">SureRemoveDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$DeleteMe</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//SureRemoveDir('EmptyMe', false);<br />
//SureRemoveDir('RemoveMe', true);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78134""></a>
  <div class="note">
   <strong class="user">james at NOSPAM dot telserco dot com</strong>
   <a href="#78134" class="date">29-Sep-2007 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Cheap and dirty example for cleaning a directory of files so many seconds old.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function cleantmp() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $seconds_old = 3600;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $directory = "/var/tmp";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( !$dirhandle = @opendir($directory) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while( false !== ($filename = readdir($dirhandle)) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $filename != "." &amp;&amp; $filename != ".." ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $filename = $directory. "/". $filename;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( @filemtime($filename) &lt; (time()-$seconds_old) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($filename);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76875""></a>
  <div class="note">
   <strong class="user">rahulnvaidya at gmail dot com</strong>
   <a href="#76875" class="date">03-Aug-2007 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ggarciaa's post above has one small error, it will ignore file and directory strings that are evaluated as false (ie. "0")<br />
<br />
Fixed code is below (false !==)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// ggarciaa at gmail dot com (04-July-2007 01:57)<br />
// I needed to empty a directory, but keeping it<br />
// so I slightly modified the contribution from<br />
// stefano at takys dot it (28-Dec-2005 11:57)<br />
// A short but powerfull recursive function<br />
// that works also if the dirs contain hidden files<br />
//<br />
// $dir = the target directory<br />
// $DeleteMe = if true delete also $dir, if false leave it alone<br />
<br />
</span><span class="keyword">function </span><span class="default">SureRemoveDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$DeleteMe</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) return;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$obj</span><span class="keyword">==</span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$obj</span><span class="keyword">==</span><span class="string">'..'</span><span class="keyword">) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">)) </span><span class="default">SureRemoveDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$DeleteMe</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//SureRemoveDir('EmptyMe', false);<br />
//SureRemoveDir('RemoveMe', true);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76186""></a>
  <div class="note">
   <strong class="user">ggarciaa at gmail dot com</strong>
   <a href="#76186" class="date">03-Jul-2007 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// ggarciaa at gmail dot com (04-July-2007 01:57)<br />
// I needed to empty a directory, but keeping it<br />
// so I slightly modified the contribution from<br />
// stefano at takys dot it (28-Dec-2005 11:57)<br />
// A short but powerfull recursive function<br />
// that works also if the dirs contain hidden files<br />
//<br />
// $dir = the target directory<br />
// $DeleteMe = if true delete also $dir, if false leave it alone<br />
<br />
</span><span class="keyword">function </span><span class="default">SureRemoveDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$DeleteMe</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) return;<br />
&nbsp;&nbsp;&nbsp; while ((</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$obj</span><span class="keyword">==</span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$obj</span><span class="keyword">==</span><span class="string">'..'</span><span class="keyword">) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">)) </span><span class="default">SureRemoveDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$DeleteMe</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//SureRemoveDir('EmptyMe', false);<br />
//SureRemoveDir('RemoveMe', true);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71328""></a>
  <div class="note">
   <strong class="user">torch at torchsdomain dot com</strong>
   <a href="#71328" class="date">22-Nov-2006 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is simple function that will find and remove all files (except "." ones) that match the expression ($match, "*" as wildcard) under starting directory ($path) and all other directories under it.<br />
<br />
function rfr($path,$match){<br />
&nbsp;&nbsp; static $deld = 0, $dsize = 0;<br />
&nbsp;&nbsp; $dirs = glob($path."*");<br />
&nbsp;&nbsp; $files = glob($path.$match);<br />
&nbsp;&nbsp; foreach($files as $file){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(is_file($file)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $dsize += filesize($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; unlink($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $deld++;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; foreach($dirs as $dir){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(is_dir($dir)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $dir = basename($dir) . "/";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; rfr($path.$dir,$match);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return "$deld files deleted with a total size of $dsize bytes";<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70037""></a>
  <div class="note">
   <strong class="user">bmcouto at hotmail dot com</strong>
   <a href="#70037" class="date">30-Sep-2006 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
$myFile </span><span class="keyword">= </span><span class="string">"testFile.txt"</span><span class="keyword">;<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$myFile</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">) or die(</span><span class="string">"can't open file"</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Now to delete testFile.txt we simply run a PHP script that is located in the same directory. Unlink just needs to know the name of the file to start working its destructive magic.<br />
<br />
<span class="default">&lt;?php<br />
$myFile </span><span class="keyword">= </span><span class="string">"testFile.txt"</span><span class="keyword">;<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$myFile</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The testFile.txt should now be removed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68938""></a>
  <div class="note">
   <strong class="user">paul at pes-systems dot net</strong>
   <a href="#68938" class="date">16-Aug-2006 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A work around for the Permission Denied problem.<br />
<br />
I used ftp_connect() then ftp_delete() to erase files which unlink could not erase due to permision problems</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53549""></a>
  <div class="note">
   <strong class="user">bishop</strong>
   <a href="#53549" class="date">05-Jun-2005 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* rm() -- Vigorously erase files and directories.<br />
&nbsp;* <br />
&nbsp;* @param $fileglob mixed If string, must be a file name (foo.txt), glob pattern (*.txt), or directory name.<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If array, must be an array of file names, glob patterns, or directories.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">rm</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ok </span><span class="keyword">= </span><span class="default">rm</span><span class="keyword">(</span><span class="string">"</span><span class="default">$fileglob</span><span class="string">/*"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! </span><span class="default">$ok</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matching </span><span class="keyword">= </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$matching </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'No files match supplied glob %s'</span><span class="keyword">, </span><span class="default">$fileglob</span><span class="keyword">), </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rcs </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'rm'</span><span class="keyword">, </span><span class="default">$matching</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">, </span><span class="default">$rcs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; } else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$fileglob</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rcs </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'rm'</span><span class="keyword">, </span><span class="default">$fileglob</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">, </span><span class="default">$rcs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Param #1 must be filename or glob pattern, or array of filenames or glob patterns'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53027""></a>
  <div class="note">
   <strong class="user">jchase at solidmark dot com</strong>
   <a href="#53027" class="date">20-May-2005 10:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's note: A suggestion for a work-around was submitted by argistof at gmail dot com: You can use the recursive option (see man chmod) when chmodding, for instance 'chmod 777 directory/ -R'. Be aware though, this will change the permissions of all files and folders in the diectory.]<br />
<br />
Just a note which you probably all know, but I didn't, and it might save another poor sap some unnecessary time:<br />
<br />
I was doing unlink() and fopen() on a file and got a permission denied error, even after chmoding the file to 0777.&nbsp; <br />
<br />
The folder that contains the file must ALSO have write permission.&nbsp; Took a headache to find this out.&nbsp; <br />
<br />
Hope this helps someone :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51517""></a>
  <div class="note">
   <strong class="user">ashley at semantic dot org</strong>
   <a href="#51517" class="date">02-Apr-2005 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually you should use "@unlink" rather than testing with file_exists. The former is atomic, whereas the latter can break if you can't guarantee only one process will try to delete a given file at a time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49728""></a>
  <div class="note">
   <strong class="user">dagski_AT_gmail_DOT_com</strong>
   <a href="#49728" class="date">06-Feb-2005 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
before you could unlink a file created which uses a handle e.g., <br />
<br />
$handle = sqlite('temp.db'); <br />
<br />
unset($handle); first befofe<br />
unlink($handle);<br />
<br />
to avoide permission denied error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45665""></a>
  <div class="note">
   <strong class="user">chris at vibenewmedia dot com</strong>
   <a href="#45665" class="date">14-Sep-2004 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To delete all files of a particular extension, or infact, delete all with wildcard, a much simplar way is to use the glob function.&nbsp; Say I wanted to delete all jpgs .........<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">foreach (</span><span class="default">glob</span><span class="keyword">(</span><span class="string">"*.jpg"</span><span class="keyword">) as </span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$filename</span><span class="string"> size " </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45470""></a>
  <div class="note">
   <strong class="user">pc AT newagelab DOT com DOT ua</strong>
   <a href="#45470" class="date">08-Sep-2004 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To delete files using wildcards:<br />
<br />
&lt;?<br />
function delfile($str)<br />
{<br />
&nbsp;&nbsp;&nbsp; foreach(glob($str) as $fn) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unlink($fn);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.umask.html">umask</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="book.inotify.html">Inotify</a></div>
 <div class="up"><a href="ref.filesystem.html">Filesystem Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
