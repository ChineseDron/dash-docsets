<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Fetch an OAuth protected resource</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="oauth.enablesslchecks.html">OAuth::enableSSLChecks</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="oauth.generatesignature.html">OAuth::generateSignature</a></div>
 <div class="up"><a href="class.oauth.html">OAuth</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="oauth.fetch" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">OAuth::fetch</h1>
  <p class="verinfo">(PECL OAuth &gt;= 0.99.1)</p><p class="refpurpose"><span class="refname">OAuth::fetch</span> &mdash; <span class="dc-title">Fetch an OAuth protected resource</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-oauth.fetch-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><b>OAuth::fetch</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$protected_resource_url</tt></span>
   [, <span class="methodparam"><span class="type">array</span> <tt class="parameter">$extra_parameters</tt></span>
   [, <span class="methodparam"><span class="type">string</span> <tt class="parameter">$http_method</tt></span>
   [, <span class="methodparam"><span class="type">array</span> <tt class="parameter">$http_headers</tt></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   Fetch a resource.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-oauth.fetch-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">protected_resource_url</tt></i></span>
     <dd>

      <p class="para">
       URL to the OAuth protected resource.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">extra_parameters</tt></i></span>
     <dd>

      <p class="para">
       Extra parameters to send with the request for the resource.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">http_method</tt></i></span>
     <dd>

      <p class="para">
       One of the <b><tt>OAUTH_HTTP_METHOD_*</tt></b>
       <a href="oauth.constants.html" class="link">OAUTH constants</a>, which includes
       GET, POST, PUT, HEAD, or DELETE.
      </p>
      <p class="para">
       HEAD (<b><tt>OAUTH_HTTP_METHOD_HEAD</tt></b>) can be useful for
       discovering information prior to the request (if OAuth credentials are
       in the <i>Authorization</i> header).
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">http_headers</tt></i></span>
     <dd>

      <p class="para">
       HTTP client headers (such as User-Agent, Accept, etc.)
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-oauth.fetch-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <b><tt>TRUE</tt></b> on success or <b><tt>FALSE</tt></b> on failure.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-oauth.fetch-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">1.0.0</td>
       <td align="left">
        Previously returned <b><tt>NULL</tt></b> on failure, instead of <b><tt>FALSE</tt></b>.
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">0.99.5</td>
       <td align="left">
        The <i><tt class="parameter">http_method</tt></i> parameter was added
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">0.99.8</td>
       <td align="left">
        The <i><tt class="parameter">http_headers</tt></i> parameter was added
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-oauth.fetch-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-4805">
    <p><b>Example #1 <span class="function"><b>OAuth::fetch()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$oauth&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">OAuth</span><span style="color: #007700">(</span><span style="color: #DD0000">"consumer_key"</span><span style="color: #007700">,</span><span style="color: #DD0000">"consumer_secret"</span><span style="color: #007700">,</span><span style="color: #0000BB">OAUTH_SIG_METHOD_HMACSHA1</span><span style="color: #007700">,</span><span style="color: #0000BB">OAUTH_AUTH_TYPE_AUTHORIZATION</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$oauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setToken</span><span style="color: #007700">(</span><span style="color: #DD0000">"access_token"</span><span style="color: #007700">,</span><span style="color: #DD0000">"access_token_secret"</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$oauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://photos.example.net/photo?file=vacation.jpg"</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$response_info&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$oauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLastResponseInfo</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type:&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$response_info</span><span style="color: #007700">[</span><span style="color: #DD0000">"content_type"</span><span style="color: #007700">]}</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$oauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLastResponse</span><span style="color: #007700">();<br />}&nbsp;catch(</span><span style="color: #0000BB">OAuthException&nbsp;$E</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Exception&nbsp;caught!\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Response:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$E</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">lastResponse&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-oauth.fetch-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="methodname"><a href="oauth.getlastresponse.html" class="methodname" rel="rdfs-seeAlso">OAuth::getLastResponse()</a> - Get the last response</span></li>
    <li class="member"> <span class="methodname"><a href="oauth.getlastresponseinfo.html" class="methodname" rel="rdfs-seeAlso">OAuth::getLastResponseInfo()</a> - Get HTTP information about the last response</span></li>
    <li class="member"> <span class="methodname"><a href="oauth.settoken.html" class="methodname" rel="rdfs-seeAlso">OAuth::setToken()</a> - Sets the token and secret</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105332""></a>
  <div class="note">
   <strong class="user">sun at drupal dot org</strong>
   <a href="#105332" class="date">09-Aug-2011 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure that your $extra_parameters is an array.<br />
<br />
If it's not, then OAuth will silently skip the malformed data type and produce a signature base string that is invalid (doesn't contain POST parameters, as defined in the RFC).<br />
<br />
You should file a critical bug report against any REST API you find in the wild that accepts such a bogus signature to pass authentication.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103074""></a>
  <div class="note">
   <strong class="user">contact info  at  mech dot cx</strong>
   <a href="#103074" class="date">23-Mar-2011 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having troubles getting fetch() to post, the remote server (Twitter, in this case) complained at me that their "resource only supports POST". Turned out to be a known bug in OAuth 1.1, downgrading to 1.0 fixed it.<br />
<br />
Don't lose as much time over this as I did :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99627""></a>
  <div class="note">
   <strong class="user">Lyuben Penkovski (l_penkovski at yahoo dot com)</strong>
   <a href="#99627" class="date">26-Aug-2010 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the provider's web server is configured to use Keep-Alive extension to HTTP protocol (HTTP 1.1), there can be a big delay in the response time from the provider. By default Apache is configured to use Keep-Alive for 5 seconds. This is the delay after which the response will come back to the consumer. If you have this issue of delayed result, you can pass in HTTP headers when calling $consumer-&gt;fetch():<br />
<br />
<span class="default">&lt;?php<br />
$consumer </span><span class="keyword">= new </span><span class="default">OAuth</span><span class="keyword">(</span><span class="string">"consumer_key"</span><span class="keyword">, </span><span class="string">"consumer_secret"</span><span class="keyword">, </span><span class="default">OAUTH_SIG_METHOD_HMACSHA1</span><span class="keyword">, </span><span class="default">OAUTH_AUTH_TYPE_FORM</span><span class="keyword">);<br />
</span><span class="default">$consumer</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">(</span><span class="string">'<a href="http://example.com/api/" rel="nofollow" target="_blank">http://example.com/api/</a>'</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">OAUTH_HTTP_METHOD_POST</span><span class="keyword">, array(</span><span class="string">'Connection'</span><span class="keyword">=&gt;</span><span class="string">'close'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Then the provider will send the result immediately after it's ready with the processing and the connection will be closed. Unfortunately, when calling $consumer-&gt;getRequestToken() and $consumer-&gt;getAccessToken() there's no way provided to pass in HTTP headers and this delay (if present) cannot be avoided, or at least we could not find a way to avoid it.<br />
<br />
The solution that worked for us is to send this header from the provider when returning result to the consumer:<br />
<br />
<span class="default">&lt;?php<br />
$result </span><span class="keyword">= </span><span class="string">'oauth_callback_accepted=true&amp;oauth_token=' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">-&gt;</span><span class="default">oauth_token</span><span class="keyword">) .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;oauth_token_secret='</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">-&gt;</span><span class="default">oauth_token_secret</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 200 OK'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: '</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">));<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/x-www-form-urlencoded'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Connection:close'</span><span class="keyword">);<br />
echo </span><span class="default">$result</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
This can work if you have the possibility to modify the code of the provider, e.g. if you are the provider yourself or if you can talk with the people that develop it and ask them to send this header for your request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="oauth.enablesslchecks.html">OAuth::enableSSLChecks</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="oauth.generatesignature.html">OAuth::generateSignature</a></div>
 <div class="up"><a href="class.oauth.html">OAuth</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
