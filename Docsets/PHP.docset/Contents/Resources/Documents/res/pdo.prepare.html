<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Prepares a statement for execution and returns a statement object</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="pdo.lastinsertid.html">PDO::lastInsertId</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="pdo.query.html">PDO::query</a></div>
 <div class="up"><a href="class.pdo.html">PDO</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="pdo.prepare" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">PDO::prepare</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.0, PECL pdo &gt;= 0.1.0)</p><p class="refpurpose"><span class="refname">PDO::prepare</span> &mdash; <span class="dc-title">
   Prepares a statement for execution and returns a statement object
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-pdo.prepare-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="class.pdostatement.html" class="type PDOStatement">PDOStatement</a></span> <span class="methodname"><b>PDO::prepare</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$statement</tt></span>
   [, <span class="methodparam"><span class="type">array</span> <tt class="parameter">$driver_options</tt><span class="initializer"> = array()</span></span>
  ] )</div>


  <p class="para rdfs-comment">
   Prepares an SQL statement to be executed by the
   <span class="function"><a href="pdostatement.execute.html" class="function">PDOStatement::execute()</a></span> method. The SQL statement can
   contain zero or more named (:name) or question mark (?) parameter markers
   for which real values will be substituted when the statement is executed.
   You cannot use both named and question mark parameter markers within the same
   SQL statement; pick one or the other parameter style.
   Use these parameters to bind any user-input, do not include the user-input
   directly in the query.
  </p>
  <p class="para">
   You must include a unique parameter marker for each value you wish to pass
   in to the statement when you call <span class="function"><a href="pdostatement.execute.html" class="function">PDOStatement::execute()</a></span>.
   You cannot use a named parameter marker of the same name twice in a prepared
   statement. You cannot bind multiple values to a single named parameter in,
   for example, the IN() clause of an SQL statement.
  </p>
  <p class="para">
   Calling <span class="function"><b>PDO::prepare()</b></span> and
   <span class="function"><a href="pdostatement.execute.html" class="function">PDOStatement::execute()</a></span> for statements that will be
   issued multiple times with different parameter values optimizes the
   performance of your application by allowing the driver to negotiate
   client and/or server side caching of the query plan and meta information,
   and helps to prevent SQL injection attacks by eliminating the need to
   manually quote the parameters.
  </p>
  <p class="para">
   PDO will emulate prepared statements/bound parameters for drivers that do
   not natively support them, and can also rewrite named or question mark
   style parameter markers to something more appropriate, if the driver
   supports one style but not the other.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-pdo.prepare-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">statement</tt></i></span>
     <dd>

      <p class="para">
       This must be a valid SQL statement for the target database server.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">driver_options</tt></i></span>
     <dd>

      <p class="para">
       This array holds one or more key=&gt;value pairs to set
       attribute values for the PDOStatement object that this method
       returns. You would most commonly use this to set the
       <i>PDO::ATTR_CURSOR</i> value to
       <i>PDO::CURSOR_SCROLL</i> to request a scrollable cursor.
       Some drivers have driver specific options that may be set at
       prepare-time.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-pdo.prepare-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   If the database server successfully prepares the statement,
   <span class="function"><b>PDO::prepare()</b></span> returns a
   <a href="class.pdostatement.html" class="classname">PDOStatement</a> object.
   If the database server cannot successfully prepare the statement,
   <span class="function"><b>PDO::prepare()</b></span> returns <b><tt>FALSE</tt></b> or emits
   <a href="class.pdoexception.html" class="classname">PDOException</a> (depending on <a href="pdo.error-handling.html" class="link">error handling</a>).
  </p>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Emulated prepared statements does not communicate with the database server
    so <span class="function"><b>PDO::prepare()</b></span> does not check the statement.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 examples" id="refsect1-pdo.prepare-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-962"><p><b>Example #1 Prepare an SQL statement with named parameters</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Execute&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;by&nbsp;passing&nbsp;an&nbsp;array&nbsp;of&nbsp;values&nbsp;*/<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;name,&nbsp;colour,&nbsp;calories<br />&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;fruit<br />&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;calories&nbsp;&lt;&nbsp;:calories&nbsp;AND&nbsp;colour&nbsp;=&nbsp;:colour'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_CURSOR&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">CURSOR_FWDONLY</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">':calories'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">':colour'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'red'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$red&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">':calories'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">175</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">':colour'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yellow'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$yellow&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-963">
    <p><b>Example #2 Prepare an SQL statement with question mark parameters</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Execute&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;by&nbsp;passing&nbsp;an&nbsp;array&nbsp;of&nbsp;values&nbsp;*/<br /></span><span style="color: #0000BB">$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name,&nbsp;colour,&nbsp;calories<br />&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;fruit<br />&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;calories&nbsp;&lt;&nbsp;?&nbsp;AND&nbsp;colour&nbsp;=&nbsp;?'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'red'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$red&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #0000BB">175</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'yellow'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$yellow&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-pdo.prepare-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="pdo.exec.html" class="function" rel="rdfs-seeAlso">PDO::exec()</a> - Execute an SQL statement and return the number of affected rows</span></li>
    <li class="member"><span class="function"><a href="pdo.query.html" class="function" rel="rdfs-seeAlso">PDO::query()</a> - Executes an SQL statement, returning a result set as a PDOStatement object</span></li>
    <li class="member"><span class="function"><a href="pdostatement.execute.html" class="function" rel="rdfs-seeAlso">PDOStatement::execute()</a> - Executes a prepared statement</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="104363""></a>
  <div class="note">
   <strong class="user">webmaster at salientdigital dot com</strong>
   <a href="#104363" class="date">10-Jun-2011 10:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using PDO to do database introspection...<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get a list of tables<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tables </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SHOW TABLES"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stm </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$stm</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$columnname </span><span class="keyword">= </span><span class="string">'Tables_in_'</span><span class="keyword">. </span><span class="default">$config</span><span class="keyword">[</span><span class="string">'database'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">$row </span><span class="keyword">= </span><span class="default">$stm</span><span class="keyword">-&gt;</span><span class="default">fetchObject</span><span class="keyword">() ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tables</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">-&gt;</span><span class="default">$columnname</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tables</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
I just found that it is not possible to prepare "SHOW CREATE TABLE ?" nor "SHOW CREATE TABLE :tablename" however, doing it with string concatenation worked fine:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $schemas </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$tables </span><span class="keyword">as </span><span class="default">$table</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">'SHOW CREATE TABLE '</span><span class="keyword">. </span><span class="default">$table</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stm </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$stm</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$columnname </span><span class="keyword">= </span><span class="string">'Create Table'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">$row </span><span class="keyword">= </span><span class="default">$stm</span><span class="keyword">-&gt;</span><span class="default">fetchObject</span><span class="keyword">() ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$schemas</span><span class="keyword">[</span><span class="default">$table</span><span class="keyword">] = </span><span class="default">$row</span><span class="keyword">-&gt;</span><span class="default">$columnname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$schemas</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99697""></a>
  <div class="note">
   <strong class="user">pascal dot buguet at laposte dot net</strong>
   <a href="#99697" class="date">31-Aug-2010 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PDO::CURSOR_SCROLL is ok with MSS.<br />
You must install SQL Server Driver for PHP 2.0 CTP2 : SQLSRV20.EXE<br />
and&nbsp; the native client "Microsoft SQL Server 2008 R2 Native Client" : sqlncli.msi.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97942""></a>
  <div class="note">
   <strong class="user">php at evan dot fribourgonline dot com</strong>
   <a href="#97942" class="date">17-May-2010 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that PDO::CURSOR_SCROLL is **not** supported or emulated by the MySQL PDO driver, nor is a warning thrown.<br />
<br />
See: <a href="http://bugs.php.net/bug.php?id=44475" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=44475</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96544""></a>
  <div class="note">
   <strong class="user">Robin</strong>
   <a href="#96544" class="date">04-Mar-2010 05:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use prepared statements to ensure integrity of binary data during storage and retrieval. Escaping/quoting by f.e. sqlite_escape_string() or PDO::quote() is NOT suited for binary data - only for strings of text.<br />
<br />
A simple test verifies perfect storage and retrieval with prepared statements:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$num_values </span><span class="keyword">= </span><span class="default">10000</span><span class="keyword">;<br />
<br />
</span><span class="default">$db </span><span class="keyword">= new </span><span class="default">pdo</span><span class="keyword">( </span><span class="string">'sqlite::memory:' </span><span class="keyword">);<br />
<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">exec</span><span class="keyword">( </span><span class="string">'CREATE TABLE data (binary BLOB(512));' </span><span class="keyword">);<br />
<br />
</span><span class="comment">// generate plenty of troublesome, binary data<br />
</span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$num_values</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ )<br />
{<br />
&nbsp;&nbsp;&nbsp; for( </span><span class="default">$val </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">512</span><span class="keyword">/</span><span class="default">16</span><span class="keyword">; </span><span class="default">$c</span><span class="keyword">++ )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">.= </span><span class="default">md5</span><span class="keyword">( </span><span class="default">mt_rand</span><span class="keyword">(), </span><span class="default">true </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">$binary</span><span class="keyword">[] = </span><span class="default">$val</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// insert each value by prepared statement<br />
</span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$num_values</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ )<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">( </span><span class="string">'INSERT INTO data VALUES (?);' </span><span class="keyword">)-&gt;</span><span class="default">execute</span><span class="keyword">( array(</span><span class="default">$binary</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) );<br />
<br />
</span><span class="comment">// fetch the entire row<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">'SELECT binary FROM data;' </span><span class="keyword">)-&gt;</span><span class="default">fetchAll</span><span class="keyword">( </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_COLUMN </span><span class="keyword">);<br />
<br />
</span><span class="comment">// compare with original array, noting any mismatch<br />
</span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$num_values</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ )<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] != </span><span class="default">$binary</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] ) echo </span><span class="string">"[</span><span class="default">$i</span><span class="string">] mismatch\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$db </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94354""></a>
  <div class="note">
   <strong class="user">sgirard at rossprint dot com</strong>
   <a href="#94354" class="date">29-Oct-2009 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Maybe everyone else already knows this but...<br />
<br />
If you have a routine that prepares/executes many insert or update statements for a sqlite db then you may want to make use of the pdo transactions. <br />
<br />
On some old hardware my query set went from 12 seconds to 1/3-1/2 second. <br />
<br />
-sean</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93469""></a>
  <div class="note">
   <strong class="user">richard at codevanilla.com</strong>
   <a href="#93469" class="date">11-Sep-2009 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
beware<br />
PDO will emulate prepared statements/bound parameters for drivers that do not natively support them, and can also rewrite named or question mark style parameter markers to something more appropriate, if the driver supports one style but not the other.<br />
<br />
This includes mySQL it seems so<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">try{ <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sth1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db1</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$t1</span><span class="keyword">, array(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_CURSOR </span><span class="keyword">=&gt; </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">CURSOR_FWDONLY</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; catch(</span><span class="default">PDOException $e</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'dbError'</span><span class="keyword">, </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
does not and so will not throw the exception if your SQL is wrong.<br />
<br />
You will need to check that $sth1 is not null.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91078""></a>
  <div class="note">
   <strong class="user">daniel dot egeberg at gmail dot com</strong>
   <a href="#91078" class="date">24-May-2009 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can also pass an array of values to PDOStatement::execute(). This is also secured against SQL injection. You don't necessarily have to use bindParam() or bindValue().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90209""></a>
  <div class="note">
   <strong class="user">admin at wdfa dot co dot uk</strong>
   <a href="#90209" class="date">09-Apr-2009 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note on the SQL injection properties of prepared statements.<br />
<br />
Prepared statements only project you from SQL injection IF you use the bindParam or bindValue option.<br />
<br />
For example if you have a table called users with two fields, username and email and someone updates their username you might run<br />
<br />
UPDATE `users` SET `user`='$var'<br />
<br />
where $var would be the user submitted text. <br />
<br />
Now if you did <br />
<span class="default">&lt;?php<br />
$a</span><span class="keyword">=new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">"mysql:host=localhost;dbname=database;"</span><span class="keyword">,</span><span class="string">"root"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);<br />
</span><span class="default">$b</span><span class="keyword">=</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"UPDATE `users` SET user='</span><span class="default">$var</span><span class="string">'"</span><span class="keyword">);<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
and the user had entered&nbsp; User', email='test for a test the injection would occur and the email would be updated to test as well as the user being updated to User.<br />
<br />
Using bindParam as follows<br />
&nbsp;<span class="default">&lt;?php<br />
$var</span><span class="keyword">=</span><span class="string">"User', email='test"</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">=new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">"mysql:host=localhost;dbname=database;"</span><span class="keyword">,</span><span class="string">"root"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);<br />
</span><span class="default">$b</span><span class="keyword">=</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"UPDATE `users` SET user=:var"</span><span class="keyword">);<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">":var"</span><span class="keyword">,</span><span class="default">$var</span><span class="keyword">);<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
The sql would be escaped and update the username to User', email='test'</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83281""></a>
  <div class="note">
   <strong class="user">ak_9jsz</strong>
   <a href="#83281" class="date">18-May-2008 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using cursors doesn't work with SQLite 3.5.9. I get an error message when it gets to the execute() method.<br />
<br />
Some of you might be saying "duh!" but i was surprised to see TRIGGER support in SQLite, so i had to try. :)<br />
<br />
I wanted to use Absolute referencing on a Scrollable cursor and i only wanted one column of data. So i used this instead of a cursor.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$dbo </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">'sqlite:tdb'</span><span class="keyword">);<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">'SELECT F1, F2 FROM tblA WHERE F1 &lt;&gt; "A";'</span><span class="keyword">;<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$dbo</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
</span><span class="default">$res</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$resColumn </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_COLUMN</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
for(</span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$r</span><span class="keyword">&lt;=</span><span class="default">3</span><span class="keyword">;</span><span class="default">$r</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Row '</span><span class="keyword">. </span><span class="default">$r </span><span class="keyword">. </span><span class="string">' returned: ' </span><span class="keyword">. </span><span class="default">$resColumn</span><span class="keyword">[</span><span class="default">$r</span><span class="keyword">] . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$dbo </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79178""></a>
  <div class="note">
   <strong class="user">Stan</strong>
   <a href="#79178" class="date">14-Nov-2007 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using prepared SELECT statements on a MySQL database prior to MySQL 5.1.17 can lead to SERIOUS performance degradation.<br />
<br />
Quote from <a href="http://dev.mysql.com/doc/refman/5.1/en/query-cache.html :" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.1/en/query-cache.html :</a><br />
<br />
&gt;&gt; The query cache is not used for server-side prepared statements before MySQL 5.1.17 &lt;&lt;<br />
<br />
The MySQL query cache buffers complete query results and is used to satisfy repeated identical queries if the underlying tables do not change in the meantime - just what happens all the time in a typical web application. It speeds up queries by a several hundred to a several thousand percent.<br />
<br />
Obviously, it doesn't make much sense to give up query caching for the relatively small performance benefit of prepared statements (i.e. the DBMS not having to parse and optimize the same query multiple times) - so using PDO-&gt;query() for SELECT statements is probably the better choice i you're connecting to MySQL &lt; 5.1.17.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74362""></a>
  <div class="note">
   <strong class="user">www.onphp5.com</strong>
   <a href="#74362" class="date">07-Apr-2007 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that the statement regarding driver_options is misleading:<br />
<br />
"This array holds one or more key=&gt;value pairs to set attribute values for the PDOStatement object that this method returns. You would most commonly use this to set the PDO::ATTR_CURSOR value to PDO::CURSOR_SCROLL to request a scrollable cursor. Some drivers have driver specific options that may be set at prepare-time"<br />
<br />
From this you might think that scrollable cursors work for all databases, but they don't! Check out this bug report:<br />
<a href="http://bugs.php.net/bug.php?id=34625" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=34625</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73421""></a>
  <div class="note">
   <strong class="user">johniskew</strong>
   <a href="#73421" class="date">22-Feb-2007 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to create variable sql statements in a prepare statement...for example you may need to construct a sql query with zero, one, two, etc numbers of arguments...here is a way to do it without a lot of if/else statements needed to glue the sql together:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">matchCriteria</span><span class="keyword">(</span><span class="default">$field1</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">,</span><span class="default">$field2</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">,</span><span class="default">$field3</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db</span><span class="keyword">=</span><span class="default">DB</span><span class="keyword">::</span><span class="default">conn</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">=array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramArray</span><span class="keyword">=array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$field1</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">[]=</span><span class="string">'field1=?'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramArray</span><span class="keyword">[]=</span><span class="default">$field1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$field2</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">[]=</span><span class="string">'field2=?'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramArray</span><span class="keyword">[]=</span><span class="default">$field2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$field3</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql</span><span class="keyword">[]=</span><span class="string">'field3=?'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramArray</span><span class="keyword">[]=</span><span class="default">$field3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs</span><span class="keyword">=</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'SELECT * FROM mytable'</span><span class="keyword">.(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$paramArray</span><span class="keyword">)&gt;</span><span class="default">0 </span><span class="keyword">? </span><span class="string">' WHERE '</span><span class="keyword">.</span><span class="default">join</span><span class="keyword">(</span><span class="string">' AND '</span><span class="keyword">,</span><span class="default">$sql</span><span class="keyword">) : </span><span class="string">''</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">$rs</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$paramArray</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$rs</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71127""></a>
  <div class="note">
   <strong class="user">jacques at chester dot id dot au</strong>
   <a href="#71127" class="date">13-Nov-2006 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Watch out: prepared statements on MySQL barf if you try to pass in substitution tables for sql keywords, table names, view names and field names.<br />
<br />
For example, this will not work:<br />
<br />
$stmt = $dbh-&gt;prepare("SELECT :sqlAggregate( :fieldName) from :viewName";<br />
<br />
You will get a MySQL error 1064 and a very unhelpful error message.<br />
<br />
In short, you need to do string substitutions into your queries if you want configurable table names, aggregate keywords etc etc.<br />
<br />
Which doesn't help at all in the "protection from injection attacks" thing. A very annoying discovery.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69335""></a>
  <div class="note">
   <strong class="user">william dot clarke at gmail dot com</strong>
   <a href="#69335" class="date">31-Aug-2006 03:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Surely if you want to use prepared statements that way you should use the syntax in the second example:<br />
<br />
eg. <br />
<br />
instead of:<br />
select id,name from demo_de where name LIKE :name OR name=:name <br />
<br />
use:<br />
select id,name from demo_de where name LIKE ? OR name=?<br />
<br />
I believe you are supposed to either use distinct named parameters (name, name1) OR anonymous parameters (?s)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69291""></a>
  <div class="note">
   <strong class="user">roth at egotec dot com</strong>
   <a href="#69291" class="date">30-Aug-2006 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Attention using MySQL and prepared statements.<br />
Using a placeholder multiple times inside a statement doesn't work. PDO just translates the first occurance und leaves the second one as is.<br />
<br />
select id,name from demo_de where name LIKE :name OR name=:name<br />
<br />
You have to use<br />
<br />
select id,name from demo_de where name LIKE :name OR name=:name2<br />
<br />
and bind name two times. I don't know if other databases (for example Oracle or MSSQL) support multiple occurances. If that's the fact, then the PDO behaviour for MySQL should be changed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="pdo.lastinsertid.html">PDO::lastInsertId</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="pdo.query.html">PDO::query</a></div>
 <div class="up"><a href="class.pdo.html">PDO</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
