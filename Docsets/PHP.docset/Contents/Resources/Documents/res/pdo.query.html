<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Executes an SQL statement, returning a result set as a PDOStatement object</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="pdo.prepare.html">PDO::prepare</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="pdo.quote.html">PDO::quote</a></div>
 <div class="up"><a href="class.pdo.html">PDO</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="pdo.query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">PDO::query</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.0, PECL pdo &gt;= 0.2.0)</p><p class="refpurpose"><span class="refname">PDO::query</span> &mdash; <span class="dc-title">
   Executes an SQL statement, returning a result set as a PDOStatement object
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-pdo.query-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="class.pdostatement.html" class="type PDOStatement">PDOStatement</a></span> <span class="methodname"><b>PDO::query</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$statement</tt></span>
   )</div>


  <div class="methodsynopsis dc-description">
   <span class="type"><a href="class.pdostatement.html" class="type PDOStatement">PDOStatement</a></span> <span class="methodname"><b>PDO::query</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$statement</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$PDO::FETCH_COLUMN</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$colno</tt></span>
   )</div>


  <div class="methodsynopsis dc-description">
   <span class="type"><a href="class.pdostatement.html" class="type PDOStatement">PDOStatement</a></span> <span class="methodname"><b>PDO::query</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$statement</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$PDO::FETCH_CLASS</tt></span>
   , <span class="methodparam"><span class="type">string</span> <tt class="parameter">$classname</tt></span>
   , <span class="methodparam"><span class="type">array</span> <tt class="parameter">$ctorargs</tt></span>
   )</div>


  <div class="methodsynopsis dc-description">
   <span class="type"><a href="class.pdostatement.html" class="type PDOStatement">PDOStatement</a></span> <span class="methodname"><b>PDO::query</b></span>
    ( <span class="methodparam"><span class="type">string</span> <tt class="parameter">$statement</tt></span>
   , <span class="methodparam"><span class="type">int</span> <tt class="parameter">$PDO::FETCH_INTO</tt></span>
   , <span class="methodparam"><span class="type">object</span> <tt class="parameter">$object</tt></span>
   )</div>


  <p class="para rdfs-comment">
   <span class="function"><b>PDO::query()</b></span> executes an SQL statement in
   a single function call, returning the result set (if any) returned by the
   statement as a PDOStatement object.
  </p>
  <p class="para">
   For a query that you need to issue multiple times, you will realize better
   performance if you prepare a PDOStatement object using
   <span class="function"><a href="pdo.prepare.html" class="function">PDO::prepare()</a></span> and issue the statement with multiple
   calls to <span class="function"><a href="pdostatement.execute.html" class="function">PDOStatement::execute()</a></span>.
  </p>
  <p class="para">
   If you do not fetch all of the data in a result set before issuing your
   next call to <span class="function"><b>PDO::query()</b></span>, your call may fail. Call
   <span class="function"><a href="pdostatement.closecursor.html" class="function">PDOStatement::closeCursor()</a></span> to release the database
   resources associated with the PDOStatement object before issuing your
   next call to <span class="function"><b>PDO::query()</b></span>.
  </p>

  <blockquote class="note"><p><b class="note">Note</b>: 
   <p class="para">
    Although this function is only documented as having a single
    parameter, you may pass additional arguments to this function.
    They will be treated as though you called
    <span class="function"><a href="pdostatement.setfetchmode.html" class="function">PDOStatement::setFetchMode()</a></span> on the resultant statement
    object.
   </p>
  </p></blockquote>

 </div>

 <div class="refsect1 parameters" id="refsect1-pdo.query-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">statement</tt></i></span>
      <dd>

       <p class="para">
        The SQL statement to prepare and execute.
       </p>
       <p class="para">
        Data inside the query should be <a href="pdo.quote.html" class="link">properly escaped</a>.
       </p>
      </dd>

     </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-pdo.query-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
    <span class="function"><b>PDO::query()</b></span> returns a PDOStatement object, or <b><tt>FALSE</tt></b>
    on failure.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-pdo.query-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-964">
    <p><b>Example #1 Demonstrate PDO::query</b></p>
    <div class="example-contents"><p>
     A nice feature of <span class="function"><b>PDO::query()</b></span> is that it
     enables you to iterate over the rowset returned by a
     successfully executed SELECT statement.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">getFruit</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;name,&nbsp;color,&nbsp;calories&nbsp;FROM&nbsp;fruit&nbsp;ORDER&nbsp;BY&nbsp;name'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\t"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'color'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\t"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'calories'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
apple   red     150
banana  yellow  250
kiwi    brown   75
lemon   yellow  25
orange  orange  300
pear    green   150
watermelon      pink    90
</pre></div>
    </div>
   </div>
  </p>
 </div>



 <div class="refsect1 seealso" id="refsect1-pdo.query-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="pdo.exec.html" class="function" rel="rdfs-seeAlso">PDO::exec()</a> - Execute an SQL statement and return the number of affected rows</span></li>
    <li class="member"><span class="function"><a href="pdo.prepare.html" class="function" rel="rdfs-seeAlso">PDO::prepare()</a> - Prepares a statement for execution and returns a statement object</span></li>
    <li class="member"><span class="function"><a href="pdostatement.execute.html" class="function" rel="rdfs-seeAlso">PDOStatement::execute()</a> - Executes a prepared statement</span></li>
   </ul>
  </p>
 </div>



</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="85919""></a>
  <div class="note">
   <strong class="user">marcos at marcosregis dot com</strong>
   <a href="#85919" class="date">24-Sep-2008 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After a lot of hours working with DataLink on Oracle-&gt;MySQL and PDO we (me and Adriano Rodrigues, that solve it) discover that PDO (and oci too) need the attribute AUTOCOMMIT set to FALSE to work correctly with.<br />
There's&nbsp; 3 ways to set autocommit to false: On constructor, setting the atribute after construct and before query data or initiating a Transaction (that turns off autocommit mode)<br />
<br />
The examples:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// First way - On PDO Constructor<br />
</span><span class="default">$options </span><span class="keyword">= array(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_AUTOCOMMIT</span><span class="keyword">=&gt;</span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
</span><span class="default">$pdo </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="default">$dsn</span><span class="keyword">,</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">);<br />
<br />
</span><span class="comment">// now we are ready to query DataLinks<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php <br />
</span><span class="comment">// Second Way - Before create statements<br />
</span><span class="default">$pdo </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="default">$dsn</span><span class="keyword">,</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">);<br />
<br />
</span><span class="default">$pdo</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_AUTOCOMMIT</span><span class="keyword">,</span><span class="default">FALSE</span><span class="keyword">);<br />
</span><span class="comment">// or<br />
</span><span class="default">$pdo</span><span class="keyword">-&gt;</span><span class="default">beginTransaction</span><span class="keyword">();<br />
<br />
</span><span class="comment">// now we are ready to query DataLinks<br />
</span><span class="default">?&gt;<br />
</span><br />
To use DataLinks on oci just use OCI_DEFAULT on oci_execute() function;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85820""></a>
  <div class="note">
   <strong class="user">oohall [AT] gmail [DOT] com</strong>
   <a href="#85820" class="date">18-Sep-2008 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since query() dosn't support ? paramaters I hacked this up:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">MyPDO </span><span class="keyword">extends </span><span class="default">PDO<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$qcache</span><span class="keyword">; </span><span class="comment">// prepared query cache<br />
<br />
&nbsp;&nbsp;&nbsp; // Usage: $dbobject-&gt;query($sql, $args...)<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">pquery</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">qcache</span><span class="keyword">[</span><span class="default">$sql</span><span class="keyword">])) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">qcache</span><span class="keyword">[</span><span class="default">$sql</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">qcache</span><span class="keyword">[</span><span class="default">$sql</span><span class="keyword">] = </span><span class="default">$query</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$query</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Food for thought: If you're going though the results of a query and use this function to perform another query of the same type (meaning same object) the results from the previous query will be lost. Granted, this probably won't happen (often). but it should be noted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84483""></a>
  <div class="note">
   <strong class="user">andrea at bhweb dot it</strong>
   <a href="#84483" class="date">16-Jul-2008 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If someone is suffering of the "MySQL server has gone away" problem after executing multiple queries, this is a solution that solved it for me. It's similar to the one needed for the exact same problem in mysqli.<br />
<br />
<span class="default">&lt;?php<br />
$stmt</span><span class="keyword">=</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
do { </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">(); </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">closeCursor</span><span class="keyword">(); ++</span><span class="default">$line</span><span class="keyword">; } while(</span><span class="default">$stmt</span><span class="keyword">-<br />
&gt;</span><span class="default">nextRowset</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span><br />
I found this only works using prepare and execute this way, not if you <br />
directly execute the query with query().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80563""></a>
  <div class="note">
   <strong class="user">NUNTIUS</strong>
   <a href="#80563" class="date">22-Jan-2008 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found this method extremely useful for getting the iteration count. Note the usage of "for" instead of "while" or "foreach". Just place the "$row = $query-&gt;fetch()" as the second condition of your for loop (which is do until). This is the best of both worlds IMHO. Criticism welcome.<br />
<br />
try {<br />
&nbsp;&nbsp;&nbsp; $hostname = "servername";<br />
&nbsp;&nbsp;&nbsp; $dbname = "dbname";<br />
&nbsp;&nbsp;&nbsp; $username = "username";<br />
&nbsp;&nbsp;&nbsp; $pw = "password";<br />
&nbsp;&nbsp;&nbsp; $pdo = new PDO ("mssql:host=$hostname;dbname=$dbname","$username","$pw");<br />
&nbsp; } catch (PDOException $e) {<br />
&nbsp;&nbsp;&nbsp; echo "Failed to get DB handle: " . $e-&gt;getMessage() . "\n";<br />
&nbsp;&nbsp;&nbsp; exit;<br />
&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; $query = $pdo-&gt;prepare("select name FROM tbl_name");<br />
&nbsp;&nbsp; &nbsp;&nbsp; $query-&gt;execute();<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; for($i=0; $row = $query-&gt;fetch(); $i++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo $i." - ".$row['name']."&lt;br/&gt;";<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; unset($pdo); <br />
&nbsp;&nbsp; &nbsp;&nbsp; unset($query);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79299""></a>
  <div class="note">
   <strong class="user">wuzup_13 at hotmail dot com</strong>
   <a href="#79299" class="date">19-Nov-2007 09:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an example PDO query function, dbQuery only needs to be passed your database query in order to work.<br />
Our return solves the problem of not being able to count PDO returns/objects.<br />
You can perform a count() on the return array, unless only 1 row is returned, then you will be counting columns, instead of rows.<br />
See for yourself, I think you'll find this useful, it solved many of our problems - we have to do a bit more backend work, but such is the cost of a reasonable PDO function.<br />
<br />
EXAMPLE:<br />
<br />
// If you know the select statement will return only one row:<br />
$row = dbQuery("SELECT * FROM users WHERE user_id = 1");<br />
print $row['user_id']; // Prints one row. If more than one, will print "Array"<br />
<br />
// If you are expecting one or more rows:<br />
$query = dbQuery("SELECT * FROM users");<br />
foreach ($query as $row) {<br />
&nbsp; print $row['user_id']; // Prints ALL rows<br />
}<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">dbConnect</span><span class="keyword">() {<br />
&nbsp; global </span><span class="default">$dbh</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'database_target'</span><span class="keyword">] = </span><span class="string">"localhost"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'database_name'</span><span class="keyword">] = </span><span class="string">"my_db"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="string">"root"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$dbConnString </span><span class="keyword">= </span><span class="string">"mysql:host=" </span><span class="keyword">. </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'database_target'</span><span class="keyword">] . </span><span class="string">"; dbname=" </span><span class="keyword">. </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'database_name'</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$dbh </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="default">$dbConnString</span><span class="keyword">, </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">], </span><span class="default">$dbInfo</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_ERRMODE</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ERRMODE_EXCEPTION</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">errorInfo</span><span class="keyword">();<br />
&nbsp; if(</span><span class="default">$error</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] != </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;p&gt;DATABASE CONNECTION ERROR:&lt;/p&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$error</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
function </span><span class="default">dbQuery</span><span class="keyword">(</span><span class="default">$queryString</span><span class="keyword">) {<br />
&nbsp; global </span><span class="default">$dbh</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$queryString</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; foreach (</span><span class="default">$query </span><span class="keyword">as </span><span class="default">$query2</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$queryReturn</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$query2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp; }<br />
&nbsp; if(</span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$queryReturn</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$queryReturn</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">dbConnect</span><span class="keyword">(); </span><span class="comment">// Connect to Database<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79290""></a>
  <div class="note">
   <strong class="user">Adael</strong>
   <a href="#79290" class="date">19-Nov-2007 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For get one row from one query:<br />
<span class="default">&lt;?PHP<br />
$row </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT * FROM customers"</span><span class="keyword">)-&gt;</span><span class="default">fetch</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74943""></a>
  <div class="note">
   <strong class="user">fredrik at NOSPAM dot rambris dot com</strong>
   <a href="#74943" class="date">05-May-2007 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The handling of errors by this function is controlled by the attribute PDO::ATTR_ERRMODE.<br />
<br />
Use the following to make it throw an exception:<br />
<span class="default">&lt;?php<br />
$dbh</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_ERRMODE</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ERRMODE_EXCEPTION</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74773""></a>
  <div class="note">
   <strong class="user">nicobn at gmail dot com</strong>
   <a href="#74773" class="date">26-Apr-2007 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that when Query() fails, it does not return a PDOStatement object . It simply returns false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74733""></a>
  <div class="note">
   <strong class="user">Ravo</strong>
   <a href="#74733" class="date">25-Apr-2007 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I struggled with this trying to figure out why I couldn't return a single row using a simple query. This may or may be obvious but you have to use PDOstatement functions of the result of a PDO-&gt;query(). This took me a while to figure out since it is a far cry from the query functions of old.<br />
<br />
<span class="default">&lt;?php<br />
$connection </span><span class="keyword">= new </span><span class="default">pdo</span><span class="keyword">(</span><span class="string">"sqlite:file.sq3"</span><span class="keyword">);<br />
</span><span class="default">$query</span><span class="keyword">=</span><span class="string">"SELECT * FROM table"</span><span class="keyword">;<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">$connection</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_ASSOC</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72565""></a>
  <div class="note">
   <strong class="user">ts at tpdada dot art dot pl</strong>
   <a href="#72565" class="date">24-Jan-2007 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Look out for re-using this same variable for PDOStatement twice. You should always clear it if you want use it again.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* WRONG */<br />
<br />
</span><span class="default">$oPDO </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">();<br />
<br />
</span><span class="default">$oPDOStatement </span><span class="keyword">= </span><span class="default">$oPDO</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'SELECT something'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* making something with $oPDOStatement, i.e. fetch() */<br />
<br />
&nbsp; </span><span class="default">$oPDOStatement </span><span class="keyword">= </span><span class="default">$oPDO</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'SELECT something completly different'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* and now $oPDOStatement is unuseful, fetch() doesn't returns result etc. */<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
But...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* GOOD */<br />
<br />
&nbsp;</span><span class="default">$oPDO </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">();<br />
<br />
&nbsp;</span><span class="default">$oPDOStatement </span><span class="keyword">= </span><span class="default">$oPDO</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'SELECT something'</span><span class="keyword">);<br />
<br />
&nbsp;</span><span class="comment">/* making something with $oPDOStatement, i.e. fetch() */<br />
<br />
&nbsp;/* and destroy poor, little object as we had used it */<br />
<br />
&nbsp;</span><span class="default">$oPDOStatement&nbsp; </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;</span><span class="default">$oPDOStatement </span><span class="keyword">= </span><span class="default">$oPDO</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'SELECT something completly different'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* and everything works fine */<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72537""></a>
  <div class="note">
   <strong class="user">jonmsawyer at gmail dot com</strong>
   <a href="#72537" class="date">23-Jan-2007 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ dozoyousan at gmail dot com<br />
&gt; 03-May-2006 05:26<br />
&gt; &gt; When query() fails, the boolean false is returned.<br />
&gt;<br />
&gt; I think that is "Silent Mode".<br />
&gt; If that set attribute ErrorMode "Exception Mode"<br />
&gt; then that throw PDOException.<br />
&gt; $pdoObj = new PDO( $dsn, $user, $pass );<br />
&gt; $pdoObj-&gt;setAttribute("PDO::ATTR_ERRMODE",<br />
&gt; PDO::ERRMODE_EXCEPTION);<br />
<br />
What you say is correct, however, your PHP code is incorrect:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// This is fine<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pdoObj </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">( </span><span class="default">$dsn</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// This line is wrong<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pdoObj</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="string">"PDO::ATTR_ERRMODE"</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ERRMODE_EXCEPTION</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// It should be:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pdoObj</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_ERRMODE</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ERRMODE_EXCEPTION</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Parameter 1 should not be in quotes. PHP interprets<br />
&nbsp;&nbsp;&nbsp; // that as a string. Instead, internally, its represented<br />
&nbsp;&nbsp;&nbsp; // as type LONG INT. Try it :)<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps. Cheers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70794""></a>
  <div class="note">
   <strong class="user">yannikh at gmeil dot com</strong>
   <a href="#70794" class="date">28-Oct-2006 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@E. Rnie:<br />
The example DOES work fine.<br />
query returns in iterable object. print_r just does not show that!<br />
<br />
Ich you use fetchAll() you will receive an Array with all rows. Of course this works too, but it is not a good idea on big resultsets.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66433""></a>
  <div class="note">
   <strong class="user">E. Rnie</strong>
   <a href="#66433" class="date">22-May-2006 06:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the above example does not function well...<br />
it just returned<br />
(<br />
&nbsp;&nbsp;&nbsp; [queryString] =&gt; "SELECT * FROM...."<br />
)<br />
<br />
with a trailing -&gt;fetchAll() everthing is working fine...<br />
<br />
the complete correct line:<br />
<br />
foreach ($conn-&gt;query($sql)-&gt;fetchAll as $row) {<br />
.<br />
.<br />
.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65543""></a>
  <div class="note">
   <strong class="user">dozoyousan at gmail dot com</strong>
   <a href="#65543" class="date">02-May-2006 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt; When query() fails, the boolean false is returned. <br />
<br />
I think that is "Silent Mode".<br />
If that set attribute ErrorMode "Exception Mode"<br />
then that throw PDOException.<br />
&nbsp;$pdoObj = new PDO( $dsn, $user, $pass );<br />
&nbsp;$pdoObj-&gt;setAttribute("PDO::ATTR_ERRMODE", PDO::ERRMODE_EXCEPTION);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="pdo.prepare.html">PDO::prepare</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="pdo.quote.html">PDO::quote</a></div>
 <div class="up"><a href="class.pdo.html">PDO</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
