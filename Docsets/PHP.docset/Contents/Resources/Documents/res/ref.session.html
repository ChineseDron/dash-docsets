<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Session Functions</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="session.security.html">Sessions and security</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.session-cache-expire.html">session_cache_expire</a></div>
 <div class="up"><a href="book.session.html">Sessions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="ref.session" class="reference">
 <h1 class="title">Session Functions</h1>

 









































































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.session-cache-expire.html">session_cache_expire</a> â€” Return current cache expire</li><li><a href="function.session-cache-limiter.html">session_cache_limiter</a> â€” Get and/or set the current cache limiter</li><li><a href="function.session-commit.html">session_commit</a> â€” Alias of session_write_close</li><li><a href="function.session-decode.html">session_decode</a> â€” Decodes session data from a string</li><li><a href="function.session-destroy.html">session_destroy</a> â€” Destroys all data registered to a session</li><li><a href="function.session-encode.html">session_encode</a> â€” Encodes the current session data as a string</li><li><a href="function.session-get-cookie-params.html">session_get_cookie_params</a> â€” Get the session cookie parameters</li><li><a href="function.session-id.html">session_id</a> â€” Get and/or set the current session id</li><li><a href="function.session-is-registered.html">session_is_registered</a> â€” Find out whether a global variable is registered in a session</li><li><a href="function.session-module-name.html">session_module_name</a> â€” Get and/or set the current session module</li><li><a href="function.session-name.html">session_name</a> â€” Get and/or set the current session name</li><li><a href="function.session-regenerate-id.html">session_regenerate_id</a> â€” Update the current session id with a newly generated one</li><li><a href="function.session-register-shutdown.html">session_register_shutdown</a> â€” Session shutdown function</li><li><a href="function.session-register.html">session_register</a> â€” Register one or more global variables with the current session</li><li><a href="function.session-save-path.html">session_save_path</a> â€” Get and/or set the current session save path</li><li><a href="function.session-set-cookie-params.html">session_set_cookie_params</a> â€” Set the session cookie parameters</li><li><a href="function.session-set-save-handler.html">session_set_save_handler</a> â€” Sets user-level session storage functions</li><li><a href="function.session-start.html">session_start</a> â€” Initialize session data</li><li><a href="function.session-status.html">session_status</a> â€” Returns the current session status</li><li><a href="function.session-unregister.html">session_unregister</a> â€” Unregister a global variable from the current session</li><li><a href="function.session-unset.html">session_unset</a> â€” Free all session variables</li><li><a href="function.session-write-close.html">session_write_close</a> â€” Write session data and end session</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105088""></a>
  <div class="note">
   <strong class="user">Sam Yong - hellclanner at live dot com</strong>
   <a href="#105088" class="date">27-Jul-2011 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following has been tested true in PHP 5.3.5.<br />
<br />
Setting the session variables after the execution of the script i.e. in __destruct function, will not work. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Example</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__destruct</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'test'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_write_close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The above example will write nothing into the temporary session file, as I observed through a custom Session Save Handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103218""></a>
  <div class="note">
   <strong class="user">jitchavan at gmail dot com</strong>
   <a href="#103218" class="date">01-Apr-2011 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IE issue :-<br />
<br />
when form target set to iframe source and after posting form content you are setting session variables,<br />
In this scenario if parent page having image src blank then session values set in iframe action page will be LOST surprisingly in IE ONLY.Solution is quite simple don't keep Image src blank.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100311""></a>
  <div class="note">
   <strong class="user">ted at tedmurph dot com</strong>
   <a href="#100311" class="date">07-Oct-2010 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having problems with $_SESSION information not being written or being lost in a seemingly random way.&nbsp; There was a Location: call being made deep in a Zend OAuth module, I am using an IIS server with PHP as a CGI, etc.<br />
<br />
The answer was simply that you need to have the domain be consistent for sessions to work consistently.&nbsp; In my case, I was switching back and forth between www.EXAMPLE.com:888 and EXAMPLE.com:888.&nbsp; The unusual port, the hidden Location: call, the handoff with OAuth, etc all served to confuse me, but the intermitent error was caused by this simple goof of keeping the domain consistent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99664""></a>
  <div class="note">
   <strong class="user">hinom06 [at] hotmail.co.jp</strong>
   <a href="#99664" class="date">29-Aug-2010 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
simple session test version 1.1<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">/* [EDIT by danbrown AT php DOT net: <br />
&nbsp;&nbsp; The author of this note named this <br />
&nbsp;&nbsp; file tmp.php in his/her tests. If <br />
&nbsp;&nbsp; you save it as a different name, <br />
&nbsp;&nbsp; simply update the links at the <br />
&nbsp;&nbsp; bottom to reflect the change.] */ <br />
<br />
</span><span class="default">error_reporting</span><span class="keyword">( </span><span class="default">E_ALL </span><span class="keyword">); <br />
</span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'Asia/Tokyo'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//ini_set( 'session.save_path', '/tmp' ); // for debug purposes<br />
&nbsp;&nbsp; <br />
</span><span class="default">session_start</span><span class="keyword">(); <br />
<br />
</span><span class="comment">// check if session_id() exists.<br />
/*<br />
for example, if exists and session wont read, must send session.name as parameter in URL.<br />
<br />
Some servers configurations may have problem to recognize PHPSESSID, even if transid value is 0 or 1.&nbsp; <br />
So, this test is usefull to identify any causes.<br />
<br />
*/<br />
</span><span class="keyword">if( </span><span class="default">session_id</span><span class="keyword">() == </span><span class="string">'' </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'session_id() empty'</span><span class="keyword">;<br />
}else{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">session_id</span><span class="keyword">();<br />
}<br />
echo </span><span class="string">'&lt;hr&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$sessPath&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">); <br />
</span><span class="default">$sessCookie </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_path'</span><span class="keyword">); <br />
</span><span class="default">$sessName&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.name'</span><span class="keyword">); <br />
</span><span class="default">$sessVar&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">; <br />
<br />
echo </span><span class="string">'&lt;br&gt;sessPath: ' </span><span class="keyword">. </span><span class="default">$sessPath</span><span class="keyword">; <br />
echo </span><span class="string">'&lt;br&gt;sessCookie: ' </span><span class="keyword">. </span><span class="default">$sessCookie</span><span class="keyword">; <br />
<br />
echo </span><span class="string">'&lt;hr&gt;'</span><span class="keyword">; <br />
<br />
if( !isset( </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'p'</span><span class="keyword">] ) ){ <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// instantiate new session var <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] = </span><span class="string">'hello world'</span><span class="keyword">; <br />
}else{ <br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'p'</span><span class="keyword">] == </span><span class="default">1 </span><span class="keyword">){ <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// printing session value and global cookie PHPSESSID <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$sessVar </span><span class="keyword">. </span><span class="string">': '</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] ) ){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'[not exists]'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;' </span><span class="keyword">. </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">': '</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">] ) ){ <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">] ) ){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">] ) ){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'problem, check your PHP settings'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; }else{ <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// destroy session by unset() function <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">unset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] ); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// check if was destroyed <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( !isset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] ) ){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">' was "unseted"'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">' was not "unseted"'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; } <br />
} <br />
</span><span class="default">?&gt;</span> <br />
&lt;hr&gt; <br />
&lt;a href=tmp.php?p=1&amp;<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">session_id</span><span class="keyword">();</span><span class="default">?&gt;</span>&gt;test 1 (printing session value)&lt;/a&gt; <br />
&lt;br&gt; <br />
&lt;a href=tmp.php?p=2&amp;<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">session_id</span><span class="keyword">();</span><span class="default">?&gt;</span>&gt;test 2 (kill session)&lt;/a&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99219""></a>
  <div class="note">
   <strong class="user">Trevor Brown</strong>
   <a href="#99219" class="date">04-Aug-2010 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A confirmation of behaviour, just in case this saves anyone else some time...<br />
<br />
There is (potentially) a special case when session.gc_probability = 0 and session.gc_divisor = 0.&nbsp; Depending on how they wanted to work their maths underneath, the coders *might* have opted to interpret 0/0 as 1 (which is sometimes assumed in certain maths proofs), but thankfully it seems they haven't.&nbsp; With both values set to 0, the session code will follow the spirit of the directives and invoke the garbage collector with zero probability.&nbsp; At least this is true with php 5.2.5 (which, to be certain, I inspected the source of).<br />
<br />
To be safe, however, setting both to zero is *probably* not a good idea because usually 0/0 is undefined, so it could presumably mean anything (some arguments exist that claim 0/0 is equal to every fraction).&nbsp; Wouldn't you rather know for sure what your probability was set to?&nbsp; In other words, don't set gc_divisor = 0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96309""></a>
  <div class="note">
   <strong class="user">Jeremy Speer</strong>
   <a href="#96309" class="date">19-Feb-2010 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When working on a project, I found a need to switch live sessions between two different pieces of software. The documentation to do this is scattered all around different sites, especially in comments sections rather than examples. One difficulty I encountered was the session save handler for one of the applications was set, whereas the other was not. Now, I didn't code in the function session_set_save_handler(), instead I utilize that once I'm done with the function (manually), however this function could easily be extended to include that functionality. Basically, it is only overriding the system's default session save handler. To overcome this after you have used getSessionData(), just call session_write_close(), session_set_save_handler() with the appropriate values, then re-run session_name(), session_id() and session_start() with their appropriate values. If you don't know the session id, it's the string located in $_COOKIE[session_name], or $_REQUEST[session_name] if you are using trans_sid. [note: use caution with trusting data from $_REQUEST, if at all possible, use $_GET or $_POST instead depending on the page].<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getSessionData </span><span class="keyword">(</span><span class="default">$session_name </span><span class="keyword">= </span><span class="string">'PHPSESSID'</span><span class="keyword">, </span><span class="default">$session_save_handler </span><span class="keyword">= </span><span class="string">'files'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$session_data </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># did we get told what the old session id was? we can't continue it without that info<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$session_name</span><span class="keyword">, </span><span class="default">$_COOKIE</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># save current session id<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$session_id </span><span class="keyword">= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$session_name</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$old_session_id </span><span class="keyword">= </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># write and close current session<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_write_close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># grab old save handler, and switch to files<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$old_session_save_handler </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.save_handler'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.save_handler'</span><span class="keyword">, </span><span class="default">$session_save_handler</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># now we can switch the session over, capturing the old session name<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$old_session_name </span><span class="keyword">= </span><span class="default">session_name</span><span class="keyword">(</span><span class="default">$session_name</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_id</span><span class="keyword">(</span><span class="default">$session_id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># get the desired session data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$session_data </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># close this session, switch back to the original handler, then restart the old session<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_write_close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.save_handler'</span><span class="keyword">, </span><span class="default">$old_session_save_handler</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_name</span><span class="keyword">(</span><span class="default">$old_session_name</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_id</span><span class="keyword">(</span><span class="default">$old_session_id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># now return the data we just retrieved<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$session_data</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93225""></a>
  <div class="note">
   <strong class="user">brfelipe08 at hotmail dot com</strong>
   <a href="#93225" class="date">28-Aug-2009 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to use sessions, and some accents required for some Latin-based languages, you should encode your files in ISO-8859-1.<br />
You will run into some problems if you try to use UTF-8 - with or without BOM -, and ANSI will not support accents.<br />
ISO-8859-1 will both support sessions and the accents.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90756""></a>
  <div class="note">
   <strong class="user">edA-qa at disemia dot com</strong>
   <a href="#90756" class="date">08-May-2009 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
WARNING for Debian users.&nbsp; Just to drive you completely crazy Debian does its own form of session management and will completely ignore all alterations to the values who do within your PHP script.<br />
<br />
Debian sets up a &lt;crontab /etc/cron.d/php5&gt; which deletes all files, including those in subdirectories, which exceed the gc_maxlifetime specified in the &lt;php.ini&gt; file only.<br />
<br />
That is, on Debian (and likely variants like Ubuntu) modifying the session expiration settings (like gc_maxlifetime) does *NOTHING*.&nbsp; You *HAVE* to modify the global &lt;php.ini&gt;.&nbsp; Not even a &lt;.htaccess&gt; file will help you.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90739""></a>
  <div class="note">
   <strong class="user">edA-qa at disemia dot com</strong>
   <a href="#90739" class="date">07-May-2009 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sessions may be deleted before the time limit you set in gc_maxlifetime. <br />
<br />
If you have multiple pages on the same server, each using the session (the same or distinct named sessions, it doesn't matter), the *minimum* gc_maxlifetime of any of those scripts ends up being the effective lifetime of the session files.<br />
<br />
This can also apply to the lifetime coming from a CLI invocation of a PHP script on that machine which happens to use the session.<br />
<br />
This can be bothersome since even though you think all your pages include the same file which sets up the script, even a single PHP page which doesn't can invoke the GC and have the scripts deleted.<br />
<br />
Thus, if you need to set a long gc_maxlifetime you are best doing this through the INI file or in a .htaccess file for the entire directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87392""></a>
  <div class="note">
   <strong class="user">LaurentT</strong>
   <a href="#87392" class="date">03-Dec-2008 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For UNIX :<br />
<br />
One might encounter some problems with sessions, having different sites on the same server : sessions would either merge if one is using more than one site at a time or crash if sites are owned by different system users. For instance :<br />
<br />
www.example.com is stored in /home/site1/www<br />
www.example.net is stored in /home/site2/www<br />
<br />
Using both www.example.com and www.example.net would cause sessions to act weird.<br />
<br />
If you're using PHP as an Apache module, you can easely use php_value in the http.conf to set a unique session.name depending on the site. If you're using suPHP though (PHP as CGI) you can't use php_value, though you can use suPHP_ConfigPath.<br />
<br />
Here's an example : <br />
<br />
&lt;VirtualHost 10.10.10.10:8081&gt;<br />
&nbsp;&nbsp;&nbsp; DocumentRoot /home/site1/www<br />
&nbsp;&nbsp;&nbsp; ServerName www.example.com<br />
&nbsp;&nbsp;&nbsp; suPHP_ConfigPath /home/site1/server_config<br />
&lt;/VirtualHost&gt;<br />
&lt;VirtualHost 10.10.10.10:8082&gt;<br />
&nbsp;&nbsp;&nbsp; DocumentRoot /home/site2/www<br />
&nbsp;&nbsp;&nbsp; ServerName www.example.net<br />
&nbsp;&nbsp;&nbsp; suPHP_ConfigPath /home/site2/server_config<br />
&lt;/VirtualHost&gt;<br />
<br />
Each server_config folder contain a php.ini file specific to the vHost. You then just have to change the values of each session.name to unique ones and you're done !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83625""></a>
  <div class="note">
   <strong class="user">hinom - iMasters</strong>
   <a href="#83625" class="date">04-Jun-2008 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
simple session test<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* [EDIT by danbrown AT php DOT net:<br />
&nbsp;&nbsp; The author of this note named this<br />
&nbsp;&nbsp; file tmp.php in his/her tests. If<br />
&nbsp;&nbsp; you save it as a different name,<br />
&nbsp;&nbsp; simply update the links at the<br />
&nbsp;&nbsp; bottom to reflect the change.] */<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$sessPath&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">);<br />
</span><span class="default">$sessCookie </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_path'</span><span class="keyword">);<br />
</span><span class="default">$sessName&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.name'</span><span class="keyword">);<br />
</span><span class="default">$sessVar&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'&lt;br&gt;sessPath: ' </span><span class="keyword">. </span><span class="default">$sessPath</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br&gt;sessCookie: ' </span><span class="keyword">. </span><span class="default">$sessCookie</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'&lt;hr&gt;'</span><span class="keyword">;<br />
<br />
if( !isset( </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'p'</span><span class="keyword">] ) ){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// instantiate new session var<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] = </span><span class="string">'hello world'</span><span class="keyword">;<br />
}else{<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'p'</span><span class="keyword">] == </span><span class="default">1 </span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// printing session value and global cookie PHPSESSID<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$sessVar </span><span class="keyword">. </span><span class="string">': '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] ) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'[not exists]'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;' </span><span class="keyword">. </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">': '</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">] ) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">] ) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$sessName</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( isset( </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">] ) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'problem, check your PHP settings'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }else{<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// destroy session by unset() function<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">unset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// check if was destroyed<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( !isset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$sessVar</span><span class="keyword">] ) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">' was "unseted"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$sessName </span><span class="keyword">. </span><span class="string">' was not "unseted"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span>&lt;hr&gt;<br />
&lt;a href=tmp.php?p=1&gt;test 1 (printing session value)&lt;/a&gt;<br />
&lt;br&gt;<br />
&lt;a href=tmp.php?p=2&gt;test 2 (kill session)&lt;/a&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82987""></a>
  <div class="note">
   <strong class="user">paul at shirron dot net</strong>
   <a href="#82987" class="date">05-May-2008 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In php.ini, I have:<br />
<br />
session.save_path="C:\DOCUME~1\pjs9486\LOCALS~1\Temp\php\session"<br />
<br />
I was cleaning out the temp directory, and deleted the php directory. Session stuff quit working. I re-created the php directory. Still no luck. I re-created the session directory in the php directory, and session stuff resumed working.<br />
<br />
I would have expected session_start() to have re-created directories in the path, if they didn't exist, but, it doesn't.<br />
<br />
Note to self: Don't do that again!!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82301""></a>
  <div class="note">
   <strong class="user">Vextor</strong>
   <a href="#82301" class="date">04-Apr-2008 08:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that the garbage engine can't delete the expired session related to the itself. If there is only one session, it won't expire even if it has expired the gc_maxlifetime set.<br />
<br />
It will be necessary another client connecting, starting a different session, and the garbage collector of this new session will be able to clean the other expired sessions.<br />
<br />
I tested this in Windows with file sessions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82149""></a>
  <div class="note">
   <strong class="user">session a emailaddress d cjb d net</strong>
   <a href="#82149" class="date">28-Mar-2008 11:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It doesn't appear in the documentation, or in anyone's comment here, but setting session.gc_maxlifetime to 0 means the session will not expire until the browser is closed.<br />
<br />
Of course this still doesn't fix the problems associated with the garbage collector doing it's own thing.<br />
The best solution to that still appears to be changing session.save_path</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81641""></a>
  <div class="note">
   <strong class="user">Csar</strong>
   <a href="#81641" class="date">07-Mar-2008 07:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's a bug in Internet explorer in which sessions do not work if the name of the server is not a valid name. For example...if your server is called web_server (_ isn't a valid character), if you call a page which uses sessions like <a href="http://web_server/example.php your sessions won" rel="nofollow" target="_blank">http://web_server/example.php your sessions won</a>'t work but sessions will work if you call the script like this<br />
[IP NUMBER]/example.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81357""></a>
  <div class="note">
   <strong class="user">Niko</strong>
   <a href="#81357" class="date">24-Feb-2008 02:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to anonymousleaf at gmail dot com:<br />
<br />
you can get the same result by using this much simplier function call:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
</span><span class="default">session_regenerate_id</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>at the top of the file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79899""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#79899" class="date">18-Dec-2007 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey people,<br />
<br />
&nbsp;&nbsp; This caused a minimal amount of discomfort, but however was quickly solved when I peeked in the php.ini and saw that the entire 'session.save_path' was commented out!&nbsp; This must have been from the version change from 5.0 to 5.2, and sessions naturally began to work correctly when I removed the comment token and filled in the value like so (using Apache):<br />
<br />
session.save_path = "c:\Windows\Temp"<br />
<br />
Maybe this will serve as a starting point and save some time for some of you out there who start from a fresh php.ini.<br />
<br />
--Matthew</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78151""></a>
  <div class="note">
   <strong class="user">carl /a/ suchideas /o/ com</strong>
   <a href="#78151" class="date">30-Sep-2007 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another gotcha to add to this list is that using a relative session.save_path is a VERY BAD idea.<br />
<br />
You can just about pull it off, if you're very careful, but note two related points:<br />
<br />
1) The path is taken relative to the directory of the ORIGINALLY executed script, so unless all pages are run from the same directory, you'll have to set the directory separately in each individual subfolder<br />
<br />
2) If you call certain functions, such as session_regenerate_id(), PHP will try to take the session directory relative to the exectuable, or something like that, creating an error IN the executable. This provides slightly cryptic error messages, like this:<br />
<br />
Warning: Unknown: open(relative_path\ilti9oq3j9ks0jvih1fmiq4sv1.session, O_RDWR) failed: No such file or directory (2) in Unknown on line 0<br />
<br />
Warning: Unknown: Failed to write session data (files). Please verify that the current setting of session.save_path is correct (relative_path) in Unknown on line 0<br />
<br />
... so don't even bother. Just use<br />
<br />
<span class="default">&lt;?php ini_set</span><span class="keyword">(</span><span class="string">"session.save_path"</span><span class="keyword">,</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">"/relative_path"</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
(or equivalent) in a file which you know is always in the same place relative to the file.<br />
<br />
{PHP version 5.1.6}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77438""></a>
  <div class="note">
   <strong class="user">jsnell at e-normous dot com</strong>
   <a href="#77438" class="date">29-Aug-2007 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Careful not to try to use integer as a key to the $_SESSION array (such as $_SESSION[0] = 1;)&nbsp; or you will get the error "Notice: Unknown: Skipping numeric key 0. in Unknown on line 0"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76061""></a>
  <div class="note">
   <strong class="user">Nigel Barlass</strong>
   <a href="#76061" class="date">28-Jun-2007 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Lima's note on sessions and browser's tabs needs to be modified for my version of php as the call to uniqid('') will return an alphanumeric string.<br />
Hence the ereg statement should be:<br />
if(!ereg('^SESS[0-9a-z]+$',$_REQUEST['SESSION_NAME'])) {...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74865""></a>
  <div class="note">
   <strong class="user">legolas558 d0t users dot sf dot net</strong>
   <a href="#74865" class="date">01-May-2007 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To clear out a possible doubt of other readers which have read this part of "Eric dot Deplagne at nerim dot net" note:<br />
<br />
--------<br />
In fact, two other variables (at least) play a role in session duration, and will explain that the session might last more than expected. The gc erasing your data is a probabilistic thing. Each time a session is opened, the probability the gc is started is session.gc_probability/session.gc_divisor. session.gc_probability defaults to 1 and session.gc_divisor defaults to 100, which makes a 1% probability.<br />
<br />
This is to have sessions long enough. I'm unsure about having sessions lasting exactly the time we want them to.<br />
--------<br />
<br />
The gc erasing of the sessions is NOT a probabilistic thing, they are erased ONLY when they are older than the number of seconds specified in "session.gc_maxlifetime" ini setting.<br />
<br />
The probabilistic fact is that old sessions will not be erased if the garbage collector is not run frenquently enough, but anyway it is your choice to have a higher or lower "session.gc_probability" on "session.gc_divisor" ratio.<br />
<br />
So, talking from the server side point of view, a session can last more than the specified amount of time but not less. And if the client respects the cookies duration (in case of cookie-based sessions) those invalid sessions will not last more than expected.<br />
<br />
You finally might want to add a timestamp inside the session and validate its age through it to radically solve the problem, if necessary. Example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
session_start</span><span class="keyword">();<br />
<br />
if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'generated'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'generated'</span><span class="keyword">] = </span><span class="default">time</span><span class="keyword">();<br />
else { </span><span class="comment">// if the session is not allowed to live more, regenerate it<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">time</span><span class="keyword">() - </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'generated'</span><span class="keyword">] &gt; </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.gc_maxlifetime'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array(</span><span class="string">'generated' </span><span class="keyword">=&gt; </span><span class="default">time</span><span class="keyword">());<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74791""></a>
  <div class="note">
   <strong class="user">g_s_b</strong>
   <a href="#74791" class="date">27-Apr-2007 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try to use your own session handling functions (eg. for saving session data to DB) make sure session.auto_start directive is 0.<br />
<br />
The manual warns about not being able to put objects in your sessions with auto_start=1: I guess that for the same reason your customized handling functions are ignored is sessions start automatically.<br />
<br />
Hope this saves somebody a few minutes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74565""></a>
  <div class="note">
   <strong class="user">skysama at googles_mail dot com</strong>
   <a href="#74565" class="date">17-Apr-2007 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your session are not retrieving correctly make sure that session.cookie_secure is to set to 'Off' if you are NOT going through https. Everytime you navigate the site your session data will not be retrieved and your sessionid will change. It may be obvious but I spent two days trying to figuring this out. Hope it helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74557""></a>
  <div class="note">
   <strong class="user">Edemilson Lima &lt;pulstar at gmail dot com&gt;</strong>
   <a href="#74557" class="date">17-Apr-2007 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sessions and browser's tabs<br />
<br />
May you have noticed when you open your website in two or more tabs in Firefox, Opera, IE 7.0 or use 'Control+N' in IE 6.0 to open a new window, it is using the same cookie or is passing the same session id, so the another tab is just a copy of the previous tab. What you do in one will affect the another and vice-versa. Even if you open Firefox again, it will use the same cookie of the previous session. But that is not what you need mostly of time, specially when you want to copy information from one place to another in your web application. This occurs because the default session name is "PHPSESSID" and all tabs will use it. There is a workaround and it rely only on changing the session's name.<br />
<br />
Put these lines in the top of your main script (the script that call the subscripts) or on top of each script you have:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">version_compare</span><span class="keyword">(</span><span class="default">phpversion</span><span class="keyword">(),</span><span class="string">'4.3.0'</span><span class="keyword">)&gt;=</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'^SESS[0-9]+$'</span><span class="keyword">,</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'SESSION_NAME'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'SESSION_NAME'</span><span class="keyword">]=</span><span class="string">'SESS'</span><span class="keyword">.</span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">output_add_rewrite_var</span><span class="keyword">(</span><span class="string">'SESSION_NAME'</span><span class="keyword">,</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'SESSION_NAME'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_name</span><span class="keyword">(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'SESSION_NAME'</span><span class="keyword">]);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
How it works: <br />
<br />
First we compare if the PHP version is at least 4.3.0 (the function output_add_rewrite_var() is not available before this release). <br />
<br />
After we check if the SESSION_NAME element in $_REQUEST array is a valid string in the format "SESSIONxxxxx", where xxxxx is an unique id, generated by the script. If SESSION_NAME is not valid (ie. not set yet), we set a value to it. <br />
<br />
uniqid('') will generate an unique id for a new session name. It don't need to be too strong like uniqid(rand(),TRUE), because all security rely in the session id, not in the session name. We only need here a different id for each session we open. Even getmypid() is enough to be used for this, but I don't know if this may post a treat to the web server. I don't think so.<br />
<br />
output_add_rewrite_var() will add automatically a pair of 'SESSION_NAME=SESSxxxxx' to each link and web form in your website. But to work properly, you will need to add it manually to any header('location') and Javascript code you have, like this:<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'location: script.php?'</span><span class="keyword">.</span><span class="default">session_name</span><span class="keyword">().</span><span class="string">'='</span><span class="keyword">.</span><span class="default">session_id</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp;&nbsp; . </span><span class="string">'&amp;SESSION_NAME='</span><span class="keyword">.</span><span class="default">session_name</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span>&lt;input type="image" src="button.gif" onClick="javascript:open_popup('script.php?<span class="default">&lt;?php <br />
</span><span class="keyword">echo </span><span class="default">session_name</span><span class="keyword">(); </span><span class="default">?&gt;</span>=<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">session_id</span><span class="keyword">(); </span><span class="default">?&gt;</span>&amp;SESSION_NAME=<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">session_name</span><span class="keyword">(); </span><span class="default">?&gt;</span>')" /&gt;<br />
<br />
The last function, session_name() will define the name of the actual session that the script will use. <br />
<br />
So, every link, form, header() and Javascript code will forward the SESSION_NAME value to the next script and it will know which is the session it must use. If none is given, it will generate a new one (and so, create a new session to a new tab).<br />
<br />
May you are asking why not use a cookie to pass the SESSION_NAME along with the session id instead. Well, the problem with cookie is that all tabs will share the same cookie to do it, and the sessions will mix anyway. Cookies will work partially if you set them in different paths and each cookie will be available in their own directories. But this will not make sessions in each tab completly separated from each other. Passing the session name through URL via GET and POST is the best way, I think.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74289""></a>
  <div class="note">
   <strong class="user">Marcin Wiazowski</strong>
   <a href="#74289" class="date">03-Apr-2007 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
'session.cookie_domain' should be set to empty string for all local domain names, not only for 'localhost' (but should not be empty for local IP addresses):<br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'session.cookie_domain'</span><span class="keyword">, (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">],</span><span class="string">'.'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71913""></a>
  <div class="note">
   <strong class="user">Marce!</strong>
   <a href="#71913" class="date">22-Dec-2006 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when using use_trans_sid and javascript together. When adding a form dynamically with javascript, you usually need to put it in quotes and use addslashes() for your html code.<br />
This will nicely put slashes into the code for your form and the javascript will work perfectly. Or so you would think. PHP does recognise the form, even with the slashes added. So it will neatly insert a hidden variable to your form, with the name of your session variable and the value of the session ID. This hidden variable isn't slashed though, and it may break your javascript code.<br />
<br />
The only solution I came up with, is to manually add the hidden variable, before applying the addslashes() function. It will then be shown correctly, and PHP will not insert the hidden value. Of course you may get both a cookie and the variable, depending on your settings, but it does work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71394""></a>
  <div class="note">
   <strong class="user">robin at amiance dot com</strong>
   <a href="#71394" class="date">26-Nov-2006 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want the simplest way there is to log a session out after 30 minutes (or any other period of inactivity) simply add a second line after session_start(), like this:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"PHPSESSID"</span><span class="keyword">,</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'PHPSESSID'</span><span class="keyword">],</span><span class="default">time</span><span class="keyword">()+</span><span class="default">1800</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Where 1800 is the time in seconds before the session should expire. PHPSESSID is the default session ID. This way, every time a user loads a page they get their session extended.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69541""></a>
  <div class="note">
   <strong class="user">nhap24</strong>
   <a href="#69541" class="date">09-Sep-2006 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent about 8 hours debugging a problem with sessions and redirecting, and I finally found the problem, which after looking back, should have been the first thing I tried.<br />
<br />
I use sessions to prevent hotlinking, so if someone hotlinks my file, I will redirect them to a different page by re-writing the header information.&nbsp; When I redirected, I sent path information in the GET data about the file they were trying to access.&nbsp; Long story short, when I redirected with a forward-slash "/" AFTER the .php, the page would create a different session ID than the rest of my domain was using.&nbsp; This happened despite the fact that the cookie path was set to "/" (which should have captured any path on my domain).&nbsp; <br />
<br />
The issue was even harder to figure out, because the page with the wrong session ID was NOT creating a second cookie.&nbsp; The only cookie was the one with the proper ID, but the broken page did not use this cookie (where then, did it get this ID from?).<br />
<br />
To fix the problem, I simply removed the forward-slash from the GET data (base64_encoding works nicely).<br />
<br />
I imagine this is an issue with my browser parsing the url, but I tried both Opera and Firefox (IE doesn't load anymore :/) and both browsers showed the same problem.<br />
<br />
I looked into hidden header data, failure to write the cookie, trans_ses_id (even though it was set to false), HTTP_HOST, everything, but in the end it was just a stupid forward-slash that had done me in.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69352""></a>
  <div class="note">
   <strong class="user">greenthumb at 4point-webdesign dot de</strong>
   <a href="#69352" class="date">01-Sep-2006 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Similar to the use of captcha images you can easely track and advise user who don't accept cookies, especially no session cookies without redirecting them.<br />
<br />
so here's the deal:<br />
<br />
if the main script (which outputs the html) doesn't have a value in it's session which says that a session is running successfully a different value is saved in the session and an image is included in the html which checks wether the session-check value is set or not. <br />
<br />
If it's set the image-script sets a confirming value which will verify the session to be running correctly and output a transparent 1*1px gif.<br />
<br />
If the value is not set the image outputs an advising image which tells to allow cookies.<br />
<br />
You can also wrap the image with a link who refers the user&nbsp; to a page addressing the cookie issue. If the 1px trans is generated the user will hardly find the link, but if the error-image is generated he will surely be able to click it.<br />
<br />
pros: <br />
- works<br />
- no rerouting, you can see the result on the first page opened by the user<br />
- no javascript<br />
<br />
cons: <br />
- bad accessebility (if you give the image an alt-text any blind user will read it at least on the first call, but you cold also write this into the alt text... so maybe there are no cons)<br />
<br />
i hope this'll help</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66675""></a>
  <div class="note">
   <strong class="user">rehevkor5 at fastmail dot fm</strong>
   <a href="#66675" class="date">25-May-2006 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a value specified for session.referer_check you may run into difficulty when someone accesses your site and attempts to log in with a mis-capitalized URL.&nbsp; The logon will fail because any calls to session_start() will result in the existing session being trashed and a new one being created.&nbsp; This becomes a bigger problem when the logon is followed by a header("Location: ...") redirect, because the session_start() at the top of the page will fail.<br />
<br />
Because session_start() always returns true, it's not obvious how to detect when the referer check fails.&nbsp; To detect it, I have come up with a method which compares the intended session id with the session id after session_start() is run.&nbsp; If they are different, the user is redirected to the proper location.&nbsp; This example uses a technique to avoid session id fixation, as well.<br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'session.referer_check'</span><span class="keyword">, </span><span class="string">'www.yourdomain.edu/ltr/'</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.use_only_cookies'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">session_name</span><span class="keyword">(</span><span class="string">'yourapp'</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">]));<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
if(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'badreferer'</span><span class="keyword">])<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'You tried accessing the site with a bad URL. Try logging on again.'</span><span class="keyword">;<br />
if(</span><span class="default">isUserAuthed</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_sessid </span><span class="keyword">= </span><span class="default">session_id</span><span class="keyword">(); </span><span class="comment">//save current session id so we can delete it later<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( !</span><span class="default">session_regenerate_id</span><span class="keyword">() ) </span><span class="comment">//get a new session id (must do this before destroying the old session)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">die(</span><span class="string">"Couldn't regenerate your session id."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_sessid </span><span class="keyword">= </span><span class="default">session_id</span><span class="keyword">(); </span><span class="comment">//save new session id so we can get back to it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_id</span><span class="keyword">(</span><span class="default">$old_sessid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$old_sessid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_destroy</span><span class="keyword">(); </span><span class="comment">//destroy the session they got before they logged in<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_id</span><span class="keyword">(</span><span class="default">$new_sessid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">(); </span><span class="comment">//start the new session<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array(); </span><span class="comment">//not really necessary any more, but still a good idea<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">session_id</span><span class="keyword">() != </span><span class="default">$new_sessid</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*If this is true, then the session_start() failed to work properly. If session_start() failed to work properly, the most likely cause is that the referer url is different from that set in fuxebox.ini on session.referer_check. The most common cause of this is URL capitalization problems. Therefore, we relocate them to the proper URL, and set a flag to display an error because we can't use pushError() if the session isn't valid. */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$good_url </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.referer_check'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: <a href="http://" rel="nofollow" target="_blank">http://</a>'</span><span class="keyword">.</span><span class="default">$good_url</span><span class="keyword">.</span><span class="string">'?badreferer=1'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$new_sessid</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Set session variables here<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'isloggedin'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'You have been logged in.'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65854""></a>
  <div class="note">
   <strong class="user">php AT coryforsyth [removeme] d0t com</strong>
   <a href="#65854" class="date">08-May-2006 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just finished a marathon debugging session with sessions, and I wanted to share what I learned with the rest of the PHP community because this has been a problem I've battled on several projects before finally solving it today.<br />
<br />
I am using sessions to register a user's ID, and every so often, for no apparent reason, the session would seem to expire and my logged-in user would get kicked out.<br />
<br />
This is the code I am using to validate a user:<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$auth </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
if (isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= new </span><span class="default">User</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">]);<br />
&nbsp;&nbsp; </span><span class="default">$auth </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
else {<br />
&nbsp;&nbsp; </span><span class="default">$login </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">];<br />
&nbsp;&nbsp; </span><span class="default">$password </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">];<br />
&nbsp;&nbsp; </span><span class="default">$login </span><span class="keyword">= </span><span class="default">clean</span><span class="keyword">(</span><span class="default">$login</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$password </span><span class="keyword">= </span><span class="default">clean</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="comment">// clean() is my own function to escape quotes and so on<br />
&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="default">checkLogin</span><span class="keyword">(</span><span class="default">$login</span><span class="keyword">,</span><span class="default">$password</span><span class="keyword">);<br />
&nbsp;&nbsp; if (!</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$auth </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
if (!</span><span class="default">$auth</span><span class="keyword">) {<br />
&nbsp;&nbsp; die(</span><span class="string">"you must log in."</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// etc etc ... //<br />
</span><span class="default">?&gt;<br />
</span><br />
I was scratching my head as to why, on about 10% of the times I sent a user to a new page (a PHP page that didn't have any of the sessions stuff--no session_start() and no mention of any session variables), when they came back the session variables were all empty.<br />
<br />
I came upon a clue when I used ini_set to change the session.save_path location.&nbsp; My idea was that maybe the session files in /tmp were being deleted by other users on the system or something.&nbsp; So I added this line before session_start():<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">,</span><span class="string">"/path/to/unique/dir/"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>I knew no one else was saving their sessions there, so I started logging in to my page and at the same time checking for the creation of new sess_* files.&nbsp; I noticed that sometimes, especially when I had problems, a second session file (that was empty) would appear.<br />
<br />
What I realized was that the URL was changing from www.coryforsyth.com to coryforsyth.com.&nbsp; When the presence of the WWW changed, PHP thought it was a different session and created an empty one that caused my script to log me out.&nbsp; If I went to the location bar of my browser and added/removed the WWW (to the way it had been before), all was well and I was still logged in.<br />
<br />
An incredibly thorny problem. I hope this post helps someone else fix it, or even better prevent it.&nbsp; I changed my hosting preferences to automatically add a WWW to my domain if it wasn't typed that way.<br />
<br />
thanks,<br />
Cory Forsyth</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64525""></a>
  <div class="note">
   <strong class="user">brady at volchok dot com</strong>
   <a href="#64525" class="date">17-Apr-2006 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Session locking (concurrency) notes:<br />
<br />
As mentioned several times throughout this section on Sessions, the default PHP session model locks a session until the page has finished loading. So if you have two or three frames that load, and each one uses sessions, they will load one at a time. This is so that only one PHP execution context has write access to the session at any one time.<br />
<br />
Some people work around this by calling session_write_close() as soon as they've finished writing any data to the $_SESSION - they can continue to read data even after they've called it. The disadvantage to session_write_close() is that your code still will lock on that first call to session_start() on any session'ed page, and that you have to sprinkle session_write_close() everywhere you use sessions, as soon as you can. This is still a very good method, but if your Session access follows some particular patterns, you may have another way which requires less modification of your code.<br />
<br />
The idea is that if your session code &lt;b&gt;mostly&lt;/b&gt; reads from sessions, and rarely writes to them, then you can allow concurrent access. To prevent completely corrupted session data, we will lock the session's backing store (tmp files usually) while we write to them. This means the session is only locked for the brief instant that we are writing to the backing store. However, this means that if you have two pages loading simultaneously, and both modify the session, the &lt;i&gt;Last One Wins&lt;/i&gt;. Whichever one loads first will get its data overwritten by the one that loads second. If this is okay with you, you may continue - otherwise, use the session_write_close method, above.<br />
<br />
If you have complicated bits of code that depend on some state in the session, and some state in a database or text file, or something else - again, you may not want to use this method. When you have two simultaneous pages running, you might find that one page runs halfway through, modifying your text file, then the second one runs all the way through, further modifying your text file, then the first one finishes - and your data might be mangled, or completely lost.<br />
<br />
So if you're prepared to debug potentially very, very nasty race conditions, and your access patterns for your sessions is read-mostly and write-rarely (and not write-dearly), then you can try the following system. <br />
<br />
Copy the example from session_set_save_handler() into your include file, above where you start your sessions. Modify the session write() method:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">write</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">$sess_data</span><span class="keyword">)<br />
{<br />
&nbsp; global </span><span class="default">$sess_save_path</span><span class="keyword">, </span><span class="default">$sess_session_name</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$sess_file </span><span class="keyword">= </span><span class="string">"</span><span class="default">$sess_save_path</span><span class="string">/sess_</span><span class="default">$id</span><span class="string">"</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$sess_file</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">LOCK_EX</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">=</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$sess_data</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">LOCK_UN</span><span class="keyword">);<br />
&nbsp;&nbsp; return(</span><span class="default">$results</span><span class="keyword">);<br />
&nbsp; } else {<br />
&nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You will probably also want to add a GC (Garbage Collection) method for the sessions, as well.<br />
<br />
And of course, take this advice with a grain of salt - We currently have it running on our testing server, and it seems to work OK there, but people have reported terrible problems with the Shared Memory session handler, and this method may be as unsafe as that.<br />
<br />
You can also consider implementing your own locks for scary concurrency-sensitive bits of your code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63837""></a>
  <div class="note">
   <strong class="user">Cosmo</strong>
   <a href="#63837" class="date">01-Apr-2006 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Fairly new to PHP, I've been looking to alter session timeouts on a shared host where I don't have direct access to configure php.ini.&nbsp; There doesn't appear to be any easy way to find out how to do this in this manual (nor from a quick web search).<br />
<br />
The code below seems to work OK to set session timeout.&nbsp; &nbsp;&nbsp; a timeout of 30 secs is used for convenient testing.&nbsp; gc settings must come before session_start().<br />
<br />
The garbage collection is made 100% by setting probability and divisor to the same value - if I have correctly understood what these functions do.<br />
&nbsp; <br />
(on the first pass of the file, there is no session file - that's established only when the script ends for the first time.&nbsp; Keep reloading to test).<br />
<br />
Comments welcome.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; ini_set</span><span class="keyword">(</span><span class="string">'session.gc_maxlifetime'</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.gc_probability'</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.gc_divisor'</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="comment">// check to see what's happening<br />
</span><span class="default">$filepath </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">).</span><span class="string">'/sess_'</span><span class="keyword">.</span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">)) <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filetime </span><span class="keyword">= </span><span class="default">filemtime </span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timediff </span><span class="keyword">= </span><span class="default">mktime</span><span class="keyword">() - </span><span class="default">$filetime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'session established '</span><span class="keyword">.</span><span class="default">$timediff</span><span class="keyword">.</span><span class="string">' seconds ago&lt;br&gt;&lt;br&gt;'</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62486""></a>
  <div class="note">
   <strong class="user">crown2gain at yahoo dot com</strong>
   <a href="#62486" class="date">01-Mar-2006 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just spent a lot of time trying to figure out why my session variables were not available after I seemed to have set them(could echo after setting).&nbsp; I use the same script for several different functions, so the user may reload the page for other purposes.&nbsp; Someone else posted the use of session_write_close();&nbsp; before a Location redirect.&nbsp; This also worked in put this after I set the session variables the variables are available when the page reloads for another function.<br />
<br />
<span class="default">&lt;?php<br />
$_SESSION</span><span class="keyword">[</span><span class="string">'guid'</span><span class="keyword">] = </span><span class="default">$guid</span><span class="keyword">;<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'userdata'</span><span class="keyword">] = </span><span class="default">$response</span><span class="keyword">;<br />
</span><span class="default">session_write_close</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62450""></a>
  <div class="note">
   <strong class="user">a l bell at hutchison dot com dot au</strong>
   <a href="#62450" class="date">28-Feb-2006 03:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please Note;<br />
<br />
Internet explorer users beware.<br />
<br />
When using session_start() to begin a session this session will remain open until the page has finished loading or it is explicitly terminated.<br />
<br />
You can lose the session however if the the page contains a reference to &lt;img src=""&gt; with name and id references (which may be used if the image is referencing a dynamic image, called by javascript)&nbsp; This seems to casue IE6 to refresh the page session id and hence loose the session.<br />
<br />
This took hours for me to diagnose when users were getting unexpectedly logged out of my site due to this "" in the img src.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62433""></a>
  <div class="note">
   <strong class="user">kintar at infinities-within dot net</strong>
   <a href="#62433" class="date">28-Feb-2006 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Important note that it just took me the better part of two hours to figure out:&nbsp; Even if you're using session_write_close(), calling exit after a redirect will eat your session variables.&nbsp; I had the following:<br />
<br />
Source of register.php:<br />
<span class="default">&lt;?PHP<br />
<br />
</span><span class="comment">// Some files included here<br />
<br />
// Process our posted form data<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">processPost</span><span class="keyword">();<br />
<br />
if (</span><span class="default">$result</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">redirect</span><span class="keyword">(</span><span class="string">'success.php'</span><span class="keyword">);<br />
}<br />
else<br />
{<br />
&nbsp; </span><span class="default">redirect</span><span class="keyword">(</span><span class="string">'failure.php'</span><span class="keyword">);<br />
}<br />
<br />
exit;<br />
</span><span class="default">?&gt;<br />
</span><br />
processPost() was setting a couple of session variables, including an error message, but neither results page was seeing those variables.&nbsp; I removed the exit call from the register page, and all works fine.<br />
<br />
/bonks self</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61881""></a>
  <div class="note">
   <strong class="user">hans at nieser dot net</strong>
   <a href="#61881" class="date">14-Feb-2006 07:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FreeBSD users, instead of modifying the PHP5 port Makefile, you can either install the session extension using the www/php5-session port, or you can install several extensions at once (you can pick them from a menu) using the lang/php5-extensions port. Same goes for PHP4</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61361""></a>
  <div class="note">
   <strong class="user">just_somedood at yahoo dot com</strong>
   <a href="#61361" class="date">01-Feb-2006 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're running FreeBSD, and installed php5 (have not checked 4) from the ports, and are getting errors saying the session functions are undefined, try running phpinfo().&nbsp; You'll probably see that the '--disable-all' configure command was used.&nbsp; To fix, edit the /usr/ports/lang/php5/Makefile, and remove the '--disable-all' line.&nbsp; In that directory, run a 'make deinstall', if you installed already.&nbsp; Next, run 'make install' while still in that same directory.&nbsp; It should work fine after that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61053""></a>
  <div class="note">
   <strong class="user">jerry dot walsh at gmail dot com</strong>
   <a href="#61053" class="date">24-Jan-2006 06:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using sharedance to distributed php sessions across a group of machines beware of the following:<br />
<br />
On a freebsd 6.x system I have observed a huge performance hit caused by dns/host file lookups.<br />
<br />
To ensure maximum performance using sharedance you should set the 'SESSION_HANDLER_HOST' constant to an IP rather than a hostname.<br />
<br />
When i did this my requests per second jumped from 55 to 389 requests per second!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59914""></a>
  <div class="note">
   <strong class="user">jazfresh at hotmail dot com</strong>
   <a href="#59914" class="date">19-Dec-2005 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The vanilla implementation of session will blindly spew back the value of the session_id that the user sends it after URL decoding it. This can be used as an attack vector, by including strings like "%0D%0ALocation:%20<a href="http://someothersite.com/%0D%0A" rel="nofollow" target="_blank">http://someothersite.com/%0D%0A</a>" in the cookie. Never trust user input, always cleanse it. If you only expect alphanumerics in the session hash, reject any session_id that doesn't contain it.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#^[[:alnum:]]+$#'</span><span class="keyword">, </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">])) {<br />
&nbsp; unset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'session_id'</span><span class="keyword">]);<br />
}<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58895""></a>
  <div class="note">
   <strong class="user">Bram</strong>
   <a href="#58895" class="date">19-Nov-2005 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[editors note]<br />
It should be noted that it's highly recommended to store sessions for each virtual host in seperate directories or in a database.<br />
[/editors note]<br />
<br />
I just noticed that it's possible to access the same session through multiple apache virtual hosts.<br />
So keep this in mind when using sessions for anything sensitive, and make sure to encrypt the data (using the mcrypt functions for example, when available).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58641""></a>
  <div class="note">
   <strong class="user">Lachlan Hunt</strong>
   <a href="#58641" class="date">10-Nov-2005 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt; Note:&nbsp; The arg_separator.output&nbsp; php.ini directive allows to customize the argument seperator. For full XHTML conformance, specify &amp;amp; there.<br />
<br />
Exactly the same rule applies to HTML as well, there is abolutely no reason why this should not be set to &amp;amp; by default.&nbsp; The only difference is that in XHTML, XML error handling defines that it's a well formedness error.&nbsp; For HTML, error handling was not so well defined nor sanely implemented and tag soup parsers just accept it, but that doesn't make it right.<br />
<br />
arg_separator.output *MUST* be set to either of these if you're outputting either HTML or XML:<br />
<br />
arg_separator.output = "&amp;amp;"<br />
arg_separator.output = ";"<br />
<br />
<a href="http://www.w3.org/QA/2005/04/php-session" rel="nofollow" target="_blank">http://www.w3.org/QA/2005/04/php-session</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58091""></a>
  <div class="note">
   <strong class="user">christopher dot klein at ecw dot de</strong>
   <a href="#58091" class="date">23-Oct-2005 11:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have trouble with Internet Explorer 6 and non-working sessions (all session-data is lost after clicking on a link), please look user-hints for setcookie().<br />
You have to add the following line after session_start() to get sessions working:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="comment">// Initalize session<br />
&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp; </span><span class="comment">// Send modified header<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'P3P: CP="NOI ADM DEV PSAi COM NAV OUR OTRo STP IND DEM"'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56908""></a>
  <div class="note">
   <strong class="user">akoma at t3 dot rim dot or dot jp</strong>
   <a href="#56908" class="date">19-Sep-2005 03:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your are using UTF-8, make sure your source<br />
code editor to do not put the BOM mark <br />
(unicode sign) at the top of your source code. so<br />
it is sent before session_start() causing "headers<br />
already sent" message on httpd error log.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55903""></a>
  <div class="note">
   <strong class="user">fasteddie at byu dot edu not_this_part</strong>
   <a href="#55903" class="date">16-Aug-2005 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hope this helps someone:<br />
---PHP SESSIONS NOT WORKING---<br />
My sessions wouldnt ever load from disk. The sessions would start just fine, and a session file would be created and written to disk. (BTW, I'm on a win XP box, Apache 2.0.54, PHP version 5.0.4.) However, next time I loaded the page, the old session would not be used. Instead, a NEW session was created. For me, this happened no matter what computer I was using, whether it was the server (localhost) or a client (remote). A new session was created EVERY TIME I loaded the page.. it was annoying. After a few hours of googling, I gave up and decided to mess around in the php.ini file. I changed this line:<br />
session.cookie_path = /<br />
to this:<br />
session.cookie_path =<br />
<br />
Now, php sessions are loaded properly.<br />
<br />
I havent tried many things but I think maybe it is because windows needs backslashes (\) instead of forward slashes (/), and if you just leave it blank, it turns out ok.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55620""></a>
  <div class="note">
   <strong class="user">artistan at cableone dot net</strong>
   <a href="#55620" class="date">08-Aug-2005 10:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I rewrote adodb's session management class to work across servers with database managed sessions.&nbsp; Take a look at <a href="http://phplens.com/lens/lensforum/msgs.php?id=13428" rel="nofollow" target="_blank">http://phplens.com/lens/lensforum/msgs.php?id=13428</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55239""></a>
  <div class="note">
   <strong class="user">Christian Boltz &lt;php-manual at cboltz dot de&gt;</strong>
   <a href="#55239" class="date">28-Jul-2005 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another note about session.bug_compat_42 and bug_compat_warn.<br />
<br />
[full error message:<br />
&nbsp;&nbsp;&nbsp; "Your script possibly relies on a session side-effect which existed <br />
&nbsp;&nbsp;&nbsp; until PHP 4.2.3. Please be advised that the session extension does <br />
&nbsp;&nbsp;&nbsp; not consider global variables as a source of data, unless<br />
&nbsp;&nbsp;&nbsp; register_globals is enabled. You can disable this functionality and <br />
&nbsp;&nbsp;&nbsp; this warning by setting session.bug_compat_42 or <br />
&nbsp;&nbsp;&nbsp; session.bug_compat_warn to off, respectively."<br />
]<br />
<br />
The following short script causes the bug_compat_42 warning to appear.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; session_start</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'var'</span><span class="keyword">] = </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="string">"foo"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
It took me an hour to find out this :-(&nbsp; - so I post it here to avoid <br />
that more people need such a long time.<br />
<br />
Conclusion and test results:<br />
<br />
You'll get this warning if $_SESSION['var'] contains NULL and you assign <br />
anything (except NULL) to the global variable $var.<br />
<br />
The warning will _not_ appear:<br />
- if $_SESSION['var'] contains anything else&nbsp;&nbsp; - or -<br />
- if you don't use a global variable named $var</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54881""></a>
  <div class="note">
   <strong class="user">d43m0n at shaw dot ca</strong>
   <a href="#54881" class="date">18-Jul-2005 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
I posted earlyer about a issue/bug with Windows servers handling sessions. If you did not read it, it was based on the fact that if you can use ini_set to re-define the session.save_path to a relitive location. PHP will instead use it as the exact location with out looking at the directory where your script is bein execute, thus to say, the session file is not created, or re-read. This of course only occurs if you use <span class="default">&lt;?php reregister_id</span><span class="keyword">() </span><span class="default">?&gt;</span>. This function is told to open the requested session file, obtain the varibles, regenerate an id for that session, create the new session file and then send the cookie header to the client, of course I did not create this function, so it may not be in that order.<br />
<br />
The following code will generate the error that I speak of, and will not successfully generate the new session id, of course like I said above, this only accours on PHP 5 &amp; 5.0.4 under the Windows Environment.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; define</span><span class="keyword">(</span><span class="string">"_PATH_TMP"</span><span class="keyword">, </span><span class="string">"./tmp"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">, </span><span class="default">_PATH_TMP</span><span class="keyword">);<br />
&nbsp; </span><span class="default">session_start</span><span class="keyword">(); <br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">][</span><span class="string">'obsolete'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">session_regenerate_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">][</span><span class="string">'replaced'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
(I know that PHP may use defined constants that include '_' characters at the beggining, if it has not already, but I am taking that chance atm...)<br />
<br />
This can simply be resolved by using the following code:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; define</span><span class="keyword">(</span><span class="string">"_PATH_TMP"</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SCRIPT_FILENAME'</span><span class="keyword">]) . </span><span class="string">"/tmp"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">, </span><span class="default">_PATH_TMP</span><span class="keyword">);<br />
&nbsp; </span><span class="default">session_start</span><span class="keyword">(); <br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">][</span><span class="string">'obsolete'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">session_regenerate_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">][</span><span class="string">'replaced'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see it uses the uses the servers environment to assurtain the exact location to the script, then locates the next root directory of it, and then allows you to define the tmp directory.<br />
<br />
* Of course, you dont need to use a tmp directory, and this issue only occurse when using subdirectorys, I found that the following works just aswell, but this did not fit my needs!<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; define</span><span class="keyword">(</span><span class="string">"_PATH_TMP"</span><span class="keyword">, </span><span class="string">"./"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">, </span><span class="default">_PATH_TMP</span><span class="keyword">);<br />
&nbsp; </span><span class="default">session_start</span><span class="keyword">(); <br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">][</span><span class="string">'obsolete'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">session_regenerate_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">][</span><span class="string">'replaced'</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53900""></a>
  <div class="note">
   <strong class="user">nigelf at esp dot co dot uk</strong>
   <a href="#53900" class="date">16-Jun-2005 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Session data is not available to an object's __destruct method as sessions are closed before the object is 'destroyed'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53809""></a>
  <div class="note">
   <strong class="user">Richard [at] postamble [dot] [co] [uk]</strong>
   <a href="#53809" class="date">13-Jun-2005 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Having to use transparent on a system where trans_sid was not compiled, I came up with the folowing ob_start handler:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ob_sid_rewrite</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replacements </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/&lt;\s*(a|link|script)\s[^&gt;]*(href|src)\s*=\s*"([^"]*)"/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/&lt;\s*(a|link|script)\s[^&gt;]*(href|src)\s*=\s*\'([^\'&lt;&gt;]*)\'/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="default">$replacements</span><span class="keyword">, </span><span class="string">"pa_sid_rewriter"</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;form\s[^&gt;]*&gt;/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'\0&lt;input type="hidden" name="' </span><span class="keyword">. </span><span class="default">session_name</span><span class="keyword">() . </span><span class="string">'" value="' </span><span class="keyword">. </span><span class="default">session_id</span><span class="keyword">() . </span><span class="string">'"/&gt;'</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; return </span><span class="default">$buffer</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">pa_sid_rewriter</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buf </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url_orig</span><span class="keyword">=</span><span class="default">$url</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$url</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]==</span><span class="string">'/' </span><span class="keyword">|| </span><span class="default">$url</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]==</span><span class="string">'#' </span><span class="keyword">|| </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^[A-Za-z0-9]*:/'</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$buf</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ses_name </span><span class="keyword">= </span><span class="default">session_name</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"</span><span class="default">$session_name</span><span class="string">="</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$buf</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"#"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$p</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)==</span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$buf</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">.=</span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">.=</span><span class="string">"&amp;amp;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">.=</span><span class="default">session_name</span><span class="keyword">() .</span><span class="string">"="</span><span class="keyword">.</span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ref</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">.=</span><span class="default">$ret</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$url_orig</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">, </span><span class="default">$buf</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
It adds a field to urls and a fake form entry.<br />
<br />
You can start the rewrite by doing the folowing at the start of the script:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">pa_set_trans_sid</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">defined</span><span class="keyword">(</span><span class="string">'SID'</span><span class="keyword">) ){ </span><span class="comment">// use trans sid as its available<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"session.use_cookies"</span><span class="keyword">, </span><span class="string">"0"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"session.use_trans_sid"</span><span class="keyword">, </span><span class="string">"true"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"url_rewriter.tags"</span><span class="keyword">, </span><span class="string">"a=href,area=href,script=src,link=href," <br />
</span><span class="keyword">. </span><span class="string">"frame=src,input=src,form=fakeentry"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_sid_rewrite'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48653""></a>
  <div class="note">
   <strong class="user">trev at beammeupnowplease dot com</strong>
   <a href="#48653" class="date">03-Jan-2005 08:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can't turn off session.use_trans_sid on an individual script basis until PHP5. <br />
<br />
However, if you use ini_set('url_rewriter.tags', ''); at the top of your script this will stop the SID being written to the URL's in PHP4. <br />
<br />
Hopefully will save someone else a frustrating couple of hours. <br />
<br />
Trev</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47603""></a>
  <div class="note">
   <strong class="user">Michael Wells</strong>
   <a href="#47603" class="date">22-Nov-2004 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to share sessions across a cluster of servers, and don't want to use NFS, or a relatively heavy and slow RDBMS, there is an excellent tool called ShareDance that can do it over a simple TCP protocol. ShareDance comes complete with a PHP interface example and works 'out of the box' for me.<br />
<br />
<a href="http://sharedance.pureftpd.org/" rel="nofollow" target="_blank">http://sharedance.pureftpd.org/</a><br />
<br />
My thanks to Frank Denis for writing this elegant, valuable piece of software.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45354""></a>
  <div class="note">
   <strong class="user">Dopey</strong>
   <a href="#45354" class="date">02-Sep-2004 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when using the Content-Length header with session.use_trans_sid enabled. Technically, it might not be a bug, but PHP does not update the header when it adds the session ID to links in a page. The result is that only partial content is shown in a browser.<br />
<br />
In short: if you use ob_get_length to figure out Content-Length, turn session.use_trans_sid off!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42994""></a>
  <div class="note">
   <strong class="user">schulze at telstra dot com dot not dot this dot bit</strong>
   <a href="#42994" class="date">06-Jun-2004 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sessions not sticking and cookies not setting with IE? took me ages to find the problem.<br />
<br />
you need a 'compact privacy policy'! it's not hard once you know how! <br />
<br />
this was too much for me: <a href="http://www.w3.org/TR/P3P/" rel="nofollow" target="_blank">http://www.w3.org/TR/P3P/</a><br />
<br />
but <a href="http://www.sitepoint.com/article/p3p-cookies-ie6/2 is very easy to apply" rel="nofollow" target="_blank">http://www.sitepoint.com/article/p3p-cookies-ie6/2 is very easy to apply</a><br />
<br />
and a visit to this site is very worthwhile: <a href="http://www.privacycouncil.com/freep3pfix.php" rel="nofollow" target="_blank">http://www.privacycouncil.com/freep3pfix.php</a><br />
<br />
happy PHP to all!<br />
<br />
Erich</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42132""></a>
  <div class="note">
   <strong class="user">Afternoon</strong>
   <a href="#42132" class="date">04-May-2004 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a good solution to create a persistent session by storing a persistence flag, ironically, in the session itelf. I start the session (which sends a Set-Cookie with no expiry time), read the flag and then, if the user wants a persistent session, stop and restart the session with the expiry time set using session_set_cookie_params, which then sends a cookie with a good expiry time. This solution has been quickly tested with all major browsers and seems to work.<br />
<br />
I have outlined the whole process in my blog: <a href="http://aftnn.org/journal/508" rel="nofollow" target="_blank">http://aftnn.org/journal/508</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37555""></a>
  <div class="note">
   <strong class="user">pautzomat at web dot de</strong>
   <a href="#37555" class="date">19-Nov-2003 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware of the fact that absolute URLs are NOT automatically rewritten to contain the SID. <br />
<br />
Of course, it says so in the documentation ('Passing the Session Id') and of course it makes perfectly sense to have that restriction, but here's what happened to me:<br />
I have been using sessions for quite a while without problems. When I used a global configuration file to be included in all my scripts, it contained a line like this:<br />
<br />
$sHomeDirectory = '<a href="http://my.server.com/one/of/my/projects" rel="nofollow" target="_blank">http://my.server.com/one/of/my/projects</a>'<br />
<br />
which was used to make sure that all automatically generated links had the right prefix (just like $cfg['PmaAbsoluteUri'] works in phpMyAdmin). After introducing that variable, no link would pass the SID anymore, causing every script to return to the login page. It took me hours (!!) to recognize that this wasn't a bug in my code or some misconfiguration in php.ini and then still some more time to find out what it was. The above restriction had completely slipped from my mind (if it ever was there...)<br />
<br />
Skipping the 'http:' did the job.<br />
<br />
OK, it was my own mistake, of course, but it just shows you how easily one can sabotage his own work for hours... Just don't do it ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9086""></a>
  <div class="note">
   <strong class="user">ricmarques at spamcop dot net</strong>
   <a href="#9086" class="date">15-Oct-2000 05:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding session.cache_limiter :<br />
<br />
For those of you who - like me - had trouble finding the meaning of the possible values (nocache, public and private), here's the explaination taken from the HTTP 1.1 Specification at<br />
<a href="http://www.w3.org/Protocols/rfc2068/rfc2068" rel="nofollow" target="_blank">http://www.w3.org/Protocols/rfc2068/rfc2068</a><br />
<br />
<br />
"14.9.1 What is Cachable<br />
<br />
[snip]<br />
<br />
public<br />
&nbsp; Indicates that the response is cachable by any cache, even if it would normally be non-cachable or cachable only within a non-shared cache. (See also Authorization, section 14.8, for additional details.)<br />
<br />
private<br />
&nbsp; Indicates that all or part of the response message is intended for a&nbsp; single user and MUST NOT be cached by a shared cache. This allows an origin server to state that the specified parts of the response are intended for only one user and are not a valid response for requests by other users. A private (non-shared) cache may cache the response.<br />
<br />
&nbsp; Note: This usage of the word private only controls where the response may be cached, and cannot ensure the privacy of the message content.<br />
<br />
no-cache<br />
&nbsp; Indicates that all or part of the response message MUST NOT be cached anywhere. This allows an origin server to prevent caching even by caches that have been configured to return stale responses to client requests.<br />
<br />
&nbsp; Note: Most HTTP/1.0 caches will not recognize or obey this directive."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="7915""></a>
  <div class="note">
   <strong class="user">shanemayer42 at yahoo dot com</strong>
   <a href="#7915" class="date">19-Aug-2000 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Session Garbage Collection Observation:<br />
<br />
It appears that session file garbage collection occurs AFTER the current session is loaded.&nbsp; <br />
<br />
This means that:<br />
even if session.gc_maxlifetime = 1 second, <br />
if someone starts a session A and no one starts a session for an hour,&nbsp; that person can reconnect to session A and all of their previous session values will be available (That is, session A will not be cleaned up even though it is older than gc_maxlifetime).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="session.security.html">Sessions and security</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.session-cache-expire.html">session_cache_expire</a></div>
 <div class="up"><a href="book.session.html">Sessions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
