<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>SoapServer constructor</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="soapserver.setpersistence.html">SoapServer::setPersistence</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="class.soapfault.html">SoapFault</a></div>
 <div class="up"><a href="class.soapserver.html">SoapServer</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="soapserver.soapserver" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">SoapServer::SoapServer</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.0.1)</p><p class="refpurpose"><span class="refname">SoapServer::SoapServer</span> &mdash; <span class="dc-title">SoapServer constructor</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-soapserver.soapserver-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span>  <span class="methodname"><b>SoapServer::SoapServer</b></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <tt class="parameter">$wsdl</tt></span>
   [, <span class="methodparam"><span class="type">array</span> <tt class="parameter">$options</tt></span>
  ] )</div>

  <p class="para rdfs-comment">
   This constructor allows the creation of <a href="class.soapserver.html" class="classname">SoapServer</a>
   objects in WSDL or non-WSDL mode.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-soapserver.soapserver-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><i><tt class="parameter">wsdl</tt></i></span>
     <dd>

      <p class="para">
       To use the SoapServer in WSDL mode, pass the URI of a WSDL file.
       Otherwise, pass <b><tt>NULL</tt></b> and set the <i>uri</i> option to the
       target namespace for the server.
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><i><tt class="parameter">options</tt></i></span>
     <dd>

      <p class="para">
       Allow setting a default SOAP version (<i>soap_version</i>),
       internal character encoding (<i>encoding</i>),
       and actor URI (<i>actor</i>).
      </p>
      <p class="para">
       The <i>classmap</i> option can be used to map some WSDL 
       types to PHP classes. This option must be an array with WSDL types 
       as keys and names of PHP classes as values.
      </p>
      <p class="para">
       The <i>typemap</i> option is an array of type mappings.
       Type mapping is an array with keys <i>type_name</i>,
       <i>type_ns</i> (namespace URI), <i>from_xml</i>
       (callback accepting one string parameter) and <i>to_xml</i>
       (callback accepting one object parameter).
      </p>
      <p class="para">
       The <i>cache_wsdl</i> option is one of
       <b><tt>WSDL_CACHE_NONE</tt></b>,
       <b><tt>WSDL_CACHE_DISK</tt></b>,
       <b><tt>WSDL_CACHE_MEMORY</tt></b> or
       <b><tt>WSDL_CACHE_BOTH</tt></b>.
      </p>
      <p class="para">
       There is also a <i>features</i> option which can be set to
       <b><tt>SOAP_WAIT_ONE_WAY_CALLS</tt></b>,
       <b><tt>SOAP_SINGLE_ELEMENT_ARRAYS</tt></b>,
       <b><tt>SOAP_USE_XSI_ARRAY_TYPE</tt></b>.
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-soapserver.soapserver-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-4850">
    <p><b>Example #1 <span class="function"><b>SoapServer::SoapServer()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$server&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SoapServer</span><span style="color: #007700">(</span><span style="color: #DD0000">"some.wsdl"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$server&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SoapServer</span><span style="color: #007700">(</span><span style="color: #DD0000">"some.wsdl"</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'soap_version'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">SOAP_1_2</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">$server&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SoapServer</span><span style="color: #007700">(</span><span style="color: #DD0000">"some.wsdl"</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'actor'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"http://example.org/ts-tests/C"</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">$server&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SoapServer</span><span style="color: #007700">(</span><span style="color: #DD0000">"some.wsdl"</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'encoding'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">$server&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SoapServer</span><span style="color: #007700">(</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'uri'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"http://test-uri/"</span><span style="color: #007700">));<br /><br />class&nbsp;</span><span style="color: #0000BB">MyBook&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$author</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$server&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SoapServer</span><span style="color: #007700">(</span><span style="color: #DD0000">"books.wsdl"</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'classmap'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #DD0000">'book'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"MyBook"</span><span style="color: #007700">)));<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-soapserver.soapserver-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">5.2.0</td>
       <td align="left">
        Added the <i>typemap</i> option.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-soapserver.soapserver-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="methodname"><a href="soapclient.soapclient.html" class="methodname" rel="rdfs-seeAlso">SoapClient::SoapClient()</a> - SoapClient constructor</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103866""></a>
  <div class="note">
   <strong class="user">jille at quis dot cx</strong>
   <a href="#103866" class="date">07-May-2011 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The SoapServer can not generate WSDL's yet. (PHP 5.3.5)<br />
It'll exit with "SOAP-ENV:ServerWSDL generation is not supported yet"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102143""></a>
  <div class="note">
   <strong class="user">ricohn hotmail com</strong>
   <a href="#102143" class="date">28-Jan-2011 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're running $soapServer-&gt;handle() and getting an empty server response and no errors (even in the logs), check if you're instantiating the SOAP server like this:<br />
<br />
<span class="default">&lt;?php<br />
$soapServer </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/soap/endpoint?wsdl" rel="nofollow" target="_blank">http://www.example.com/soap/endpoint?wsdl</a>'</span><span class="keyword">);<br />
</span><span class="comment">//...<br />
</span><span class="default">$soapServer</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">(); </span><span class="comment">// Result: Empty response<br />
</span><span class="default">?&gt;<br />
</span><br />
Instantiating the SOAP server with one the following should fix it:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// With slash before ?wsdl:<br />
</span><span class="default">$soapServer </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/soap/endpoint/?wsdl" rel="nofollow" target="_blank">http://www.example.com/soap/endpoint/?wsdl</a>'</span><span class="keyword">);<br />
</span><span class="comment">// Or instantiate with the "uri" option, which works with or without the trailing slash:<br />
</span><span class="default">$soapServer </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="default">null</span><span class="keyword">, array(</span><span class="string">'uri' </span><span class="keyword">=&gt; </span><span class="string">'<a href="http://www.example.com/soap/endpoint?wsdl" rel="nofollow" target="_blank">http://www.example.com/soap/endpoint?wsdl</a>'</span><span class="keyword">));<br />
</span><span class="default">$soapServer </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="default">null</span><span class="keyword">, array(</span><span class="string">'uri' </span><span class="keyword">=&gt; </span><span class="string">'<a href="http://www.example.com/soap/endpoint/?wsdl" rel="nofollow" target="_blank">http://www.example.com/soap/endpoint/?wsdl</a>'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope that helps somebody! Zend_Soap_Server wasn't working for me, and I eventually found that it had to do with the native PHP SOAP class (which ZF uses).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97851""></a>
  <div class="note">
   <strong class="user">nilzor at gmail dot com</strong>
   <a href="#97851" class="date">12-May-2010 03:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Calling a server from .NET: <br />
If you intend to call a PHP SOAP server from a .NET Client, there are a couple of things to be aware of. First of all, I've only got it working in WSDL mode. If anyone have made it work in non-WSDL-mode, I'd be interested in hearing that. In WSDL-mode it works, but both input and output-parameters are wrapped from .NET.<br />
<br />
Basically, a function with this signature:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">SomeFunction</span><span class="keyword">(</span><span class="default">$param1</span><span class="keyword">, </span><span class="default">$param2</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; return </span><span class="default">$param1</span><span class="keyword">+</span><span class="default">$param2</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Must be rewritten to this, without changing the WSDL:<br />
&nbsp;<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">SomeFunction</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) <br />
{ <br />
&nbsp;</span><span class="default">$valueArray </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$param1 </span><span class="keyword">= </span><span class="default">$valueArray</span><span class="keyword">[</span><span class="string">"param1"</span><span class="keyword">];<br />
&nbsp;</span><span class="default">$param2 </span><span class="keyword">= </span><span class="default">$valueArray</span><span class="keyword">[</span><span class="string">"param2"</span><span class="keyword">];<br />
&nbsp;return Array(</span><span class="string">"SomeFunctionResult" </span><span class="keyword">=&gt; </span><span class="default">$param1</span><span class="keyword">+</span><span class="default">$param2</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93937""></a>
  <div class="note">
   <strong class="user">Sloloem</strong>
   <a href="#93937" class="date">07-Oct-2009 08:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
typemap isn't very well documented at all, but I thought I might be able to use it to clean some things up and map between object fields and XML attributes that have different names but are conceptually the same thing.<br />
<br />
Unfortunately type map works at the object level, not the field level like I was hoping, requiring you to provide functions for building the entire object from an XML string (using the XML parser of your choice) and vice versa.&nbsp; I found the wording of the docs very confusing, both parameters are strings which are function names.<br />
<br />
the to_xml function will take the object as a parameter and return a string,<br />
the from_xml function will take an xml string as a parameter and should return an object of the correct type.<br />
<br />
Both methods can also throw SOAPFaults or other exceptions which can be caught from the actual client method call ($client-&gt;someRemoteMethod())<br />
<br />
There are decent usage examples in the PHP build tests:&nbsp; <a href="http://cvs.php.net/viewvc.cgi/php-src/ext/soap/tests/?diff_format=u" rel="nofollow" target="_blank">http://cvs.php.net/viewvc.cgi/php-src/ext/soap/tests/?diff_format=u</a><br />
The typemap tests are at the bottom.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93654""></a>
  <div class="note">
   <strong class="user">spiro79 at gmail dot com</strong>
   <a href="#93654" class="date">21-Sep-2009 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting an error about always_populate_raw_post_data or Can't find HTTP_RAW_POST_DATA then it means the server isn't getting info from the (you guessed!) raw post data.<br />
Try doing something like this when coding your server:<br />
<br />
<span class="default">&lt;?php<br />
$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="default">null</span><span class="keyword">,array(</span><span class="string">'uri' </span><span class="keyword">=&gt; </span><span class="string">"<a href="http://localhost/namespace" rel="nofollow" target="_blank">http://localhost/namespace</a>"</span><span class="keyword">));<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">'myClass'</span><span class="keyword">);<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'php://input'</span><span class="keyword">);<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Worked for me!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89912""></a>
  <div class="note">
   <strong class="user">kostya[.]chumickin [at] 9mail[.]c0m</strong>
   <a href="#89912" class="date">28-Mar-2009 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware: in wsdl mode SoapServer does not properly validate if<br />
request matches the given WSDL. It just skips invalid elements. <a href="http://bugs.php.net/bug.php?id=45966" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=45966</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86811""></a>
  <div class="note">
   <strong class="user">beckman at angryox.com</strong>
   <a href="#86811" class="date">04-Nov-2008 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While others may not do what I did, I thought if my WSDL was not local and needed to be grabbed via HTTP, I should set the $wsdl var in __construct() to NULL, and set the 'uri' value in the additional parameters.<br />
<br />
This does enable non-WSDL mode, which only causes problems when using complex types.&nbsp; Since your complex types are not respected/imported, you get unexpected problems out the wazoo.<br />
<br />
So if you are exposing your class via "setClass" to the SOAP server and for some reason your "types" aren't being returned, you can do this:<br />
<br />
<span class="default">&lt;?php<br />
$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">'<a href="http://soap.example.com/genwsdl.php?api" rel="nofollow" target="_blank">http://soap.example.com/genwsdl.php?api</a>'</span><span class="keyword">);<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">'myClass'</span><span class="keyword">); </span><span class="comment">// previously included or defined<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
This is NOT correct:<br />
<span class="default">&lt;?php<br />
$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="default">NULL</span><span class="keyword">, array(</span><span class="string">'uri' </span><span class="keyword">=&gt; </span><span class="string">'<a href="http://soap.example.com/genwsdl.php?api" rel="nofollow" target="_blank">http://soap.example.com/genwsdl.php?api</a>'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
I sure wish someone really smart would go into a bit more detail in this documentation of the SoapServer options, why they exist, when to use them, etc.&nbsp; I find the SOAP docs lacking polish.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84772""></a>
  <div class="note">
   <strong class="user">lordi at msdi dot ca</strong>
   <a href="#84772" class="date">29-Jul-2008 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Things that I've searched a lot for that might be useful to somebody:<br />
<br />
If you are using Zend Studio, you can easily generate a wsdl file using the WSDL Generator if you document your code using PHPDOC.<br />
<br />
One thing a lot of people are searching everywhere, is the way to pass/return an array of variables... In your PHPDOC block use the [] after the variable name like this<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SoapServer </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; * This is My Soap Server<br />
&nbsp;&nbsp; * @param integer[] $a<br />
&nbsp;&nbsp; * @param string[] $b<br />
&nbsp;&nbsp; * @param bar[] $c<br />
&nbsp; */<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">foo </span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">){<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span>This way, the function will require an array of integers for $a, an array of strings for $b and an array of objets of Class "bar" for $c<br />
<br />
In the WSDL, you'll find something like this<br />
<br />
&lt;xsd:complexType name="barArray"&gt;<br />
&nbsp; &lt;xsd:complexContent&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;xsd:restriction base="soapenc:Array"&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;xsd:attribute ref="soapenc:arrayType" wsdl:arrayType="typens:bar[]"/&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/xsd:restriction&gt;<br />
&nbsp; &lt;/xsd:complexContent&gt;<br />
&lt;/xsd:complexType&gt;<br />
&lt;xsd:complexType name="bar"&gt;<br />
&nbsp; &lt;xsd:all&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;xsd:element name="var1" type="xsd:boolean"/&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;xsd:element name="var2" type="xsd:integer"/&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;xsd:element name="var3" type="xsd:string"/&gt;<br />
&nbsp; &lt;/xsd:all&gt;<br />
&lt;/xsd:complexType&gt;<br />
<br />
I didn't define anywhere the barArray type, Zend's WSDL Generator generated it automatically...<br />
<br />
If you are not using Zend you can generate the wsdl file manually.<br />
<br />
Hope it helps someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80824""></a>
  <div class="note">
   <strong class="user">alan dot bryan at gmail dot com</strong>
   <a href="#80824" class="date">01-Feb-2008 04:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This site helped me put it all together.<br />
<a href="http://techblog.bronto.com/brontotechblog/2007/04/php_and_soap_he.html" rel="nofollow" target="_blank">http://techblog.bronto.com/brontotechblog/2007/04/php_and_soap_he.html</a><br />
<br />
My issue was I was trying the below example but missing parts in the wsdl.&nbsp; The above link filled in the pieces that I was missing so it all worked.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78872""></a>
  <div class="note">
   <strong class="user">php dot net at juamei dot com</strong>
   <a href="#78872" class="date">31-Oct-2007 03:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to Timo, it is possible to access Soap Headers from the SoapServer class and call methods to handle them. Rather than treat them seperately, they are treated as part of the Soap request. <br />
<br />
To pass approximately wss standard headers (note that I couldn't get attributes from the header tags without text preprocessing, so standards compliance failed me), first create the following class on the client:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp;* Login credentials to be supplied as a SOAP header<br />
&nbsp;* Class used to ensure Soap Head tags in correct format.<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">SoapHeaderUsernameToken<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/** @var int Password */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public </span><span class="default">$Password</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/** @var int Username */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public </span><span class="default">$Username</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$l</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Password </span><span class="keyword">= </span><span class="default">$p</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Username </span><span class="keyword">= </span><span class="default">$l</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Now, set the Soap Headers:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set the login headers<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wsu </span><span class="keyword">= </span><span class="string">'<a href="http://schemas.xmlsoap.org/ws/2002/07/utility" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/ws/2002/07/utility</a>'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$usernameToken </span><span class="keyword">= new </span><span class="default">SoapHeaderUsernameToken</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">username</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">password</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$soapHeaders</span><span class="keyword">[] = new </span><span class="default">SoapHeader</span><span class="keyword">(</span><span class="default">$wsu</span><span class="keyword">, </span><span class="string">'UsernameToken'</span><span class="keyword">, </span><span class="default">$usernameToken</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Next instantiate the client object, add the headers and make the call:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $client </span><span class="keyword">= new </span><span class="default">SoapClient</span><span class="keyword">( </span><span class="default">$wsdl</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">__setSoapHeaders</span><span class="keyword">( </span><span class="default">$soapHeaders </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">__soapCall</span><span class="keyword">( </span><span class="default">$method</span><span class="keyword">, </span><span class="default">$params </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Moving to the Server, you'll handle the Soap call somewhat like:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Instantiate server with relevant wsdl &amp; class. <br />
</span><span class="default">$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">( </span><span class="string">'mysoapwsdl.wsdl' </span><span class="keyword">);<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(&nbsp; </span><span class="string">'mysoapclass' </span><span class="keyword">);<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">(); <br />
</span><span class="default">?&gt;<br />
</span><br />
The key here is that the headers will be handled first by the server which will call the method mysoapclass::UsernameToken. The way we work this is the UsernameToken method authenticates the username / password combo and sets a protected class var. Then when the Soap Body is handled and the appropriate class method called, a check is made at the start of callable method to ensure authentication has been passed.<br />
<br />
If the Soap auth header is missing, the soap body method will be called anyway so the check is essential in case a malevolent client deliberately leaves the headers off.<br />
<br />
An example server class is below (missing various methods which I leave as an exercise to the reader to provide):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">mysoapclass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; * Authentication function<br />
&nbsp;&nbsp; &nbsp; * This is called by the Soap header of the same name. The function name is a Ws-security standard auth tag<br />
&nbsp;&nbsp; &nbsp; * and corresponds to the header tag.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param string username<br />
&nbsp;&nbsp; &nbsp; * @param string password<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">UsernameToken</span><span class="keyword">( </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Store username for logging<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Username </span><span class="keyword">= </span><span class="default">$username</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$auth </span><span class="keyword">= new </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">AuthClass</span><span class="keyword">( </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$auth</span><span class="keyword">-&gt;</span><span class="default">IsValid</span><span class="keyword">() ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Authenticated </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ThrowSoapFault</span><span class="keyword">( </span><span class="string">'auth' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; * Test method<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">felineResponse</span><span class="keyword">( </span><span class="default">$action </span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Place this at the start of every exposed method<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // This is because the SoapServer will attempt to call<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // if no authentication headers are passed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Authenticated</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ThrowSoapFault</span><span class="keyword">( </span><span class="string">'auth' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$action </span><span class="keyword">== </span><span class="string">'stroke' </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'purr'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif( </span><span class="default">$action </span><span class="keyword">== </span><span class="string">'tease' </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'hiss'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This is a adaptation of stuff I found online somewhere...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76335""></a>
  <div class="note">
   <strong class="user">joel dot pearson at gmail dot com</strong>
   <a href="#76335" class="date">10-Jul-2007 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to jas [at] dansupport (dot) dk:<br />
<br />
All you need to do is disable wsdl caching like so:<br />
<br />
ini_set("soap.wsdl_cache_enabled", "0");<br />
<br />
Then you don't need to delete any cache files.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75436""></a>
  <div class="note">
   <strong class="user">jas [at] dansupport (dot) dk</strong>
   <a href="#75436" class="date">29-May-2007 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A general thing i've experienced with SOAP and which, for some reason, isn't mentioned in ANY tutorials I've read, is this: The server tends to cache the interface. This means that if you add a function you'll usually get errors that the function doesn't exist.<br />
If your SOAP server is written in PHP just delete the cache files, usually located in /tmp, whenever you add a function, or modify the parameters. These are named wsdl-******something******<br />
I hope this will spare someone the grief I've experienced with this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68610""></a>
  <div class="note">
   <strong class="user">Timo</strong>
   <a href="#68610" class="date">03-Aug-2006 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is currently not possible to process soap headers from within a SoapServer instance. If soap headers are specified within a WSDL file, you have to extract the headers manually from the request.<br />
<br />
For more information please see <a href="http://bugs.php.net/bug.php?id=38309" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=38309</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="soapserver.setpersistence.html">SoapServer::setPersistence</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="class.soapfault.html">SoapFault</a></div>
 <div class="up"><a href="class.soapserver.html">SoapServer</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
