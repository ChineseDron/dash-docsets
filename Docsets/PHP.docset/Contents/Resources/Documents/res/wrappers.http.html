<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Accessing HTTP(s) URLs</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="wrappers.file.html">file://</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="wrappers.ftp.html">ftp://</a></div>
 <div class="up"><a href="wrappers.html">Supported Protocols and Wrappers</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="wrappers.http" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">http://</h1>
  <h1 class="refname">https://</h1>
  <p class="refpurpose"><span class="refname">http://</span> -- <span class="refname">https://</span> &mdash; <span class="dc-title">Accessing HTTP(s) URLs</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-wrappers.http-description">
  <h3 class="title">Description</h3>
  <p class="para">
   Allows read-only access to files/resources via HTTP 1.0,
   using the HTTP GET method. A <i>Host:</i> header is sent with the request
   to handle name-based virtual hosts.  If you have configured
   a <a href="filesystem.configuration.html#ini.user-agent" class="link">user_agent</a> string using
   your <var class="filename">php.ini</var> file or the stream context, it will also be included
   in the request.
  </p>
  <p class="simpara">
   The stream allows access to the <em class="emphasis">body</em> of
   the resource; the headers are stored in the
   <var class="varname"><var class="varname"><a href="reserved.variables.httpresponseheader.html" class="classname">$http_response_header</a></var></var> variable.
  </p>
  <p class="simpara">
   If it&#039;s important to know the URL of the resource where
   your document came from (after all redirects have been processed),
   you&#039;ll need to process the series of response headers returned by the
   stream.
  </p>
  <p class="simpara">
   The <a href="filesystem.configuration.html#ini.from" class="link">from</a> directive will be used for the
   <i>From:</i> header if set and not overwritten by the
   <a href="context.html" class="xref">Context options and parameters</a>.
  </p>
 </div>


 <div class="refsect1 usage" id="refsect1-wrappers.http-usage"> 
  <h3 class="title">Options</h3>
  <ul class="itemizedlist">
   <li class="listitem"><span class="simpara"><var class="filename">http://example.com</var></span></li>
   <li class="listitem"><span class="simpara"><var class="filename">http://example.com/file.php?var1=val1&amp;var2=val2</var></span></li>
   <li class="listitem"><span class="simpara"><var class="filename">http://user:password@example.com</var></span></li>
   <li class="listitem"><span class="simpara"><var class="filename">https://example.com</var></span></li>
   <li class="listitem"><span class="simpara"><var class="filename">https://example.com/file.php?var1=val1&amp;var2=val2</var></span></li>
   <li class="listitem"><span class="simpara"><var class="filename">https://user:password@example.com</var></span></li>
  </ul>
 </div>
 

 <div class="refsect1 options" id="refsect1-wrappers.http-options">
  <h3 class="title">Options</h3>
  <p class="para">
   <table class="doctable table">
    <caption><b>Wrapper Summary</b></caption>
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Attribute</th>
       <th>Supported</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">Restricted by <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">allow_url_fopen</a></td>
       <td align="left">Yes</td>
      </tr>

      <tr valign="middle">
       <td align="left">Allows Reading</td>
       <td align="left">Yes</td>
      </tr>

      <tr valign="middle">
       <td align="left">Allows Writing</td>
       <td align="left">No</td>
      </tr>

      <tr valign="middle">
       <td align="left">Allows Appending</td>
       <td align="left">No</td>
      </tr>

      <tr valign="middle">
       <td align="left">Allows Simultaneous Reading and Writing</td>
       <td align="left">N/A</td>
      </tr>

      <tr valign="middle">
       <td align="left">Supports <span class="function"><a href="function.stat.html" class="function">stat()</a></span></td>
       <td align="left">No</td>
      </tr>

      <tr valign="middle">
       <td align="left">Supports <span class="function"><a href="function.unlink.html" class="function">unlink()</a></span></td>
       <td align="left">No</td>
      </tr>

      <tr valign="middle">
       <td align="left">Supports <span class="function"><a href="function.rename.html" class="function">rename()</a></span></td>
       <td align="left">No</td>
      </tr>

      <tr valign="middle">
       <td align="left">Supports <span class="function"><a href="function.mkdir.html" class="function">mkdir()</a></span></td>
       <td align="left">No</td>
      </tr>

      <tr valign="middle">
       <td align="left">Supports <span class="function"><a href="function.rmdir.html" class="function">rmdir()</a></span></td>
       <td align="left">No</td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>
 

 <div class="refsect1 changelog" id="refsect1-wrappers.http-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead valign="middle">
      <tr valign="middle">
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody valign="middle" class="tbody">
      <tr valign="middle">
       <td align="left">4.3.7</td>
       <td align="left">
        Detect buggy IIS servers to avoid <i>&quot;SSL: Fatal Protocol Error&quot;</i> errors.
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">4.3.0</td>
       <td align="left">
        Added <i>https://</i>.
       </td>
      </tr>

      <tr valign="middle">
       <td align="left">4.0.5</td>
       <td align="left">
        Added support for redirects.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-wrappers.http-examples">
  <h3 class="title">Examples</h3>
  <div class="example" id="wrappers.http.example.basic">
   <p><b>Example #1 Detecting which URL we ended up on after redirects</b></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$url&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'http://www.example.com/redirecting_page.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$url</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$meta_data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stream_get_meta_data</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />foreach&nbsp;(</span><span style="color: #0000BB">$meta_data</span><span style="color: #007700">[</span><span style="color: #DD0000">'wrapper_data'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Were&nbsp;we&nbsp;redirected?&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$response</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">))&nbsp;==&nbsp;</span><span style="color: #DD0000">'location:&nbsp;'</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;update&nbsp;$url&nbsp;with&nbsp;where&nbsp;we&nbsp;were&nbsp;redirected&nbsp;to&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$url&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$response</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <div class="example" id="wrappers.http.example.custom.headers"> 
   <p><b>Example #2 Sending custom headers with an HTTP request</b></p>
   <div class="example-contents"><p>
    Custom headers may be sent using <a href="context.http.html" class="link">context
    options</a>. It is also possible to use this hack:
    Custom headers may be sent with an HTTP request 
    by taking advantage of a side-effect in the
    handling of the <i>user_agent</i> INI setting.
    Set <i>user_agent</i> to any valid string
    (such as the default <i>PHP/version</i> setting)
    followed by a carriage-return/line-feed pair and any
    additional headers.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'user_agent'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"PHP\r\nX-MyCustomHeader:&nbsp;Foo"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://www.example.com/index.php'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Results in the following request being sent:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
GET /index.php HTTP/1.0
Host: www.example.com
User-Agent: PHP
X-MyCustomHeader: Foo
</pre></div>
   </div>
  </div>
 </div>


 <div class="refsect1 notes" id="refsect1-wrappers.http-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><b class="note">Note</b>: 
   <span class="simpara">
    HTTPS is only supported when the <a href="book.openssl.html" class="link">openssl</a>
    extension is enabled.
   </span>
  </p></blockquote>
  <p class="simpara">
   HTTP connections are read-only; writing data or copying
   files to an HTTP resource is not supported.
  </p>
  <p class="simpara">
   Sending <em class="emphasis">POST</em> and <em class="emphasis">PUT</em> requests, for example,
   can be done with the help of <a href="context.http.html" class="link">HTTP Contexts</a>.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-wrappers.http-seealso">
  <h3 class="title">See Also</h3>
  <ul class="simplelist">
   <li class="member"><a href="context.http.html" class="xref">HTTP context options</a></li>
   <li class="member"><var class="varname"><var class="varname"><a href="reserved.variables.httpresponseheader.html" class="classname">$http_response_header</a></var></var></li>
   <li class="member"><span class="function"><a href="function.stream-get-meta-data.html" class="function" rel="rdfs-seeAlso">stream_get_meta_data()</a> - Retrieves header/meta data from streams/file pointers</span></li>
  </ul>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="84067""></a>
  <div class="note">
   <strong class="user">Nick Lewis</strong>
   <a href="#84067" class="date">26-Jun-2008 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note on how to deal with Cookies<br />
<br />
To receive a cookie:<br />
<br />
$httphandle = fopen($url,"r");<br />
$meta = stream_get_meta_data($httphandle);<br />
for ($j = 0; isset($meta['wrapper_data'][$j]); $j++) {<br />
&nbsp;&nbsp; $httpline = $meta['wrapper_data'][$j];<br />
&nbsp;&nbsp; @list($header,$parameters) = explode(";",$httpline,2);<br />
&nbsp;&nbsp; @list($attr,$value) = explode(":",$header,2);<br />
&nbsp;&nbsp; if (strtolower(trim($attr)) == "set-cookie") {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $cookie = trim($value);<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; }<br />
}<br />
fclose($httphandle);<br />
echo $cookie;<br />
<br />
To send a cookie:<br />
<br />
$user_agent = ini_get("user_agent");<br />
ini_set("user_agent",$user_agent . "\r\nCookie: " . $cookie);<br />
$httphandle = fopen($url,"r");<br />
fclose($httphandle);<br />
ini_set("user_agent",$user_agent);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78703""></a>
  <div class="note">
   <strong class="user">spazdaq</strong>
   <a href="#78703" class="date">24-Oct-2007 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
just an FYI about digest authentication.<br />
<br />
While one of the above http examples has the username and password info supplied with the url, this must only be for basic authentication. it does not appear to work for digest authentication. you have to handle the digest followup request on your own.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76760""></a>
  <div class="note">
   <strong class="user">NEA at AraTaraBul dot com</strong>
   <a href="#76760" class="date">29-Jul-2007 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
HTTP post function;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">post_it</span><span class="keyword">(</span><span class="default">$datastream</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">) { <br />
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"@^<a href="http://@i" rel="nofollow" target="_blank">http://@i</a>"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">$host </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">));<br />
</span><span class="default">$uri </span><span class="keyword">= </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$reqbody </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$datastream </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$reqbody</span><span class="keyword">)) </span><span class="default">$reqbody</span><span class="keyword">.= </span><span class="string">"&amp;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$reqbody</span><span class="keyword">.= </span><span class="default">$key</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
</span><span class="default">$contentlength </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$reqbody</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$reqheader </span><span class="keyword">=&nbsp; </span><span class="string">"POST </span><span class="default">$uri</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\n"</span><span class="keyword">. </span><span class="string">"User-Agent: PostIt\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"Content-Length: </span><span class="default">$contentlength</span><span class="string">\r\n\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"</span><span class="default">$reqbody</span><span class="string">\r\n"</span><span class="keyword">; <br />
<br />
</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">);<br />
<br />
if (!</span><span class="default">$socket</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"errno"</span><span class="keyword">] = </span><span class="default">$errno</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"errstr"</span><span class="keyword">] = </span><span class="default">$errstr</span><span class="keyword">;<br />
&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$reqheader</span><span class="keyword">);<br />
<br />
while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) {<br />
&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
<br />
return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76058""></a>
  <div class="note">
   <strong class="user">Sinured</strong>
   <a href="#76058" class="date">28-Jun-2007 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to send more than one custom header, just make header an array:<br />
<br />
<span class="default">&lt;?php<br />
$default_opts </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'http' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'user_agent' </span><span class="keyword">=&gt; </span><span class="string">'Foobar'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'X-Foo: Bar'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'X-Bar: Baz'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; )<br />
);<br />
</span><span class="default">stream_context_get_default</span><span class="keyword">(</span><span class="default">$default_opts</span><span class="keyword">);<br />
</span><span class="default">readfile</span><span class="keyword">(</span><span class="string">'<a href="http://www.xhaus.com/headers" rel="nofollow" target="_blank">http://www.xhaus.com/headers</a>'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71226""></a>
  <div class="note">
   <strong class="user">dwalton at acm dot org</strong>
   <a href="#71226" class="date">17-Nov-2006 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As it says on this page:<br />
<br />
"The stream allows access to the body of the resource; the headers are stored in the $http_response_header variable. Since PHP 4.3.0, the headers are available using stream_get_meta_data()."<br />
<br />
This one sentence is the only documentation I have found on the mysterious $http_response_header variable, and I'm afraid it's misleading.&nbsp; It implies that from 4.3.0 onward, stream_get_meta_data() ought to be used in favor of $http_response_header.&nbsp; <br />
<br />
Don't be fooled!&nbsp; stream_get_meta_data() requires a stream reference, which makes it ONLY useful with fopen() and related functions.&nbsp; However, $http_response_header can be used to get the headers from the much simpler file_get_contents() and related functions, which makes it still very useful in 5.x.<br />
<br />
Also note that even when file_get_contents() and friends fail due to a 4xx or 5xx error and return false, the headers are still available in $http_response_header.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="wrappers.file.html">file://</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="wrappers.ftp.html">ftp://</a></div>
 <div class="up"><a href="wrappers.html">Supported Protocols and Wrappers</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
